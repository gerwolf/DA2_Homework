% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[
]{article}
\usepackage{lmodern}
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\hypersetup{
  pdftitle={Datenanalyse 2 - Accompanying code},
  hidelinks,
  pdfcreator={LaTeX via pandoc}}
\urlstyle{same} % disable monospaced font for URLs
\usepackage[margin=1in]{geometry}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{graphicx,grffile}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{-\maxdimen} % remove section numbering
\usepackage{booktabs}
\usepackage{longtable}
\usepackage{array}
\usepackage{multirow}
\usepackage{wrapfig}
\usepackage{float}
\usepackage{colortbl}
\usepackage{pdflscape}
\usepackage{tabu}
\usepackage{threeparttable}
\usepackage{threeparttablex}
\usepackage[normalem]{ulem}
\usepackage{makecell}
\usepackage{xcolor}

\title{Datenanalyse 2 - Accompanying code}
\author{}
\date{\vspace{-2.5em}}

\begin{document}
\maketitle

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#############################################################}

\CommentTok{# Data prep}

\KeywordTok{library}\NormalTok{(}\StringTok{"rio"}\NormalTok{)}
\NormalTok{x <-}\StringTok{ }\KeywordTok{import}\NormalTok{(}\StringTok{"https://docs.google.com/spreadsheets/d/1h7XhLd2Byp4OcXSdtxHly9iS7RA673RJ/export?format=csv&gid=1083477596"}\NormalTok{)}
\NormalTok{x}\OperatorTok{$}\NormalTok{commentCount <-}\StringTok{ }\KeywordTok{as.integer}\NormalTok{(x}\OperatorTok{$}\NormalTok{commentCount)}
\NormalTok{x}\OperatorTok{$}\NormalTok{viewsCount <-}\StringTok{ }\KeywordTok{as.numeric}\NormalTok{(x}\OperatorTok{$}\NormalTok{viewsCount)}
\NormalTok{x}\OperatorTok{$}\NormalTok{acousticness <-}\StringTok{ }\KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{sub}\NormalTok{(}\StringTok{","}\NormalTok{, }\StringTok{"."}\NormalTok{, x}\OperatorTok{$}\NormalTok{acousticness, }\DataTypeTok{fixed =} \OtherTok{TRUE}\NormalTok{))}
\NormalTok{x}\OperatorTok{$}\NormalTok{danceability <-}\StringTok{ }\KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{sub}\NormalTok{(}\StringTok{","}\NormalTok{, }\StringTok{"."}\NormalTok{, x}\OperatorTok{$}\NormalTok{danceability, }\DataTypeTok{fixed =} \OtherTok{TRUE}\NormalTok{))}
\NormalTok{x}\OperatorTok{$}\NormalTok{energy <-}\StringTok{ }\KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{sub}\NormalTok{(}\StringTok{","}\NormalTok{, }\StringTok{"."}\NormalTok{, x}\OperatorTok{$}\NormalTok{energy, }\DataTypeTok{fixed =} \OtherTok{TRUE}\NormalTok{))}
\NormalTok{x}\OperatorTok{$}\NormalTok{instrumentalness <-}\StringTok{ }\KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{sub}\NormalTok{(}\StringTok{","}\NormalTok{, }\StringTok{"."}\NormalTok{, x}\OperatorTok{$}\NormalTok{instrumentalness, }\DataTypeTok{fixed =} \OtherTok{TRUE}\NormalTok{))}
\NormalTok{x}\OperatorTok{$}\NormalTok{liveness <-}\StringTok{ }\KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{sub}\NormalTok{(}\StringTok{","}\NormalTok{, }\StringTok{"."}\NormalTok{, x}\OperatorTok{$}\NormalTok{liveness, }\DataTypeTok{fixed =} \OtherTok{TRUE}\NormalTok{))}
\NormalTok{x}\OperatorTok{$}\NormalTok{loudness <-}\StringTok{ }\KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{sub}\NormalTok{(}\StringTok{","}\NormalTok{, }\StringTok{"."}\NormalTok{, x}\OperatorTok{$}\NormalTok{loudness, }\DataTypeTok{fixed =} \OtherTok{TRUE}\NormalTok{))}
\NormalTok{x}\OperatorTok{$}\NormalTok{speechiness <-}\StringTok{ }\KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{sub}\NormalTok{(}\StringTok{","}\NormalTok{, }\StringTok{"."}\NormalTok{, x}\OperatorTok{$}\NormalTok{speechiness, }\DataTypeTok{fixed =} \OtherTok{TRUE}\NormalTok{))}
\NormalTok{x}\OperatorTok{$}\NormalTok{tempo <-}\StringTok{ }\KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{sub}\NormalTok{(}\StringTok{","}\NormalTok{, }\StringTok{"."}\NormalTok{, x}\OperatorTok{$}\NormalTok{tempo, }\DataTypeTok{fixed =} \OtherTok{TRUE}\NormalTok{))}
\NormalTok{x}\OperatorTok{$}\NormalTok{valence <-}\StringTok{ }\KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{sub}\NormalTok{(}\StringTok{","}\NormalTok{, }\StringTok{"."}\NormalTok{, x}\OperatorTok{$}\NormalTok{valence, }\DataTypeTok{fixed =} \OtherTok{TRUE}\NormalTok{))}
\NormalTok{x}\OperatorTok{$}\NormalTok{key <-}\StringTok{ }\KeywordTok{as.factor}\NormalTok{(x}\OperatorTok{$}\NormalTok{key)}
\NormalTok{x}\OperatorTok{$}\NormalTok{time_signature <-}\StringTok{ }\KeywordTok{as.factor}\NormalTok{(x}\OperatorTok{$}\NormalTok{time_signature)}
\NormalTok{min_max_normalize <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(x)}
\NormalTok{\{}
  \KeywordTok{return}\NormalTok{( (}\DecValTok{1000-10}\NormalTok{)}\OperatorTok{*}\NormalTok{((x}\OperatorTok{-}\StringTok{ }\KeywordTok{min}\NormalTok{(x)) }\OperatorTok{/}\NormalTok{(}\KeywordTok{max}\NormalTok{(x)}\OperatorTok{-}\KeywordTok{min}\NormalTok{(x))) }\OperatorTok{+}\StringTok{ }\DecValTok{10}\NormalTok{)}
\NormalTok{\}}
\NormalTok{x}\OperatorTok{$}\NormalTok{acousticness <-}\StringTok{ }\KeywordTok{min_max_normalize}\NormalTok{(x}\OperatorTok{$}\NormalTok{acousticness)}
\NormalTok{x}\OperatorTok{$}\NormalTok{danceability <-}\StringTok{ }\KeywordTok{min_max_normalize}\NormalTok{(x}\OperatorTok{$}\NormalTok{danceability)}
\NormalTok{x}\OperatorTok{$}\NormalTok{energy <-}\StringTok{ }\KeywordTok{min_max_normalize}\NormalTok{(x}\OperatorTok{$}\NormalTok{energy)}
\NormalTok{x}\OperatorTok{$}\NormalTok{instrumentalness <-}\StringTok{ }\KeywordTok{min_max_normalize}\NormalTok{(x}\OperatorTok{$}\NormalTok{instrumentalness)}
\NormalTok{x}\OperatorTok{$}\NormalTok{liveness <-}\StringTok{ }\KeywordTok{min_max_normalize}\NormalTok{(x}\OperatorTok{$}\NormalTok{liveness)}
\NormalTok{x}\OperatorTok{$}\NormalTok{loudness <-}\StringTok{ }\KeywordTok{min_max_normalize}\NormalTok{(x}\OperatorTok{$}\NormalTok{loudness)}
\NormalTok{x}\OperatorTok{$}\NormalTok{speechiness <-}\StringTok{ }\KeywordTok{min_max_normalize}\NormalTok{(x}\OperatorTok{$}\NormalTok{speechiness)}
\NormalTok{x}\OperatorTok{$}\NormalTok{tempo <-}\StringTok{ }\KeywordTok{min_max_normalize}\NormalTok{(x}\OperatorTok{$}\NormalTok{tempo)}
\NormalTok{x}\OperatorTok{$}\NormalTok{valence <-}\StringTok{ }\KeywordTok{min_max_normalize}\NormalTok{(x}\OperatorTok{$}\NormalTok{valence)}
\NormalTok{x}\OperatorTok{$}\NormalTok{Genre <-}\StringTok{ }\KeywordTok{as.factor}\NormalTok{(x}\OperatorTok{$}\NormalTok{Genre)}
\NormalTok{x}\OperatorTok{$}\NormalTok{key <-}\StringTok{ }\KeywordTok{as.factor}\NormalTok{(x}\OperatorTok{$}\NormalTok{key)}
\NormalTok{x}\OperatorTok{$}\NormalTok{mode <-}\StringTok{ }\KeywordTok{as.factor}\NormalTok{(x}\OperatorTok{$}\NormalTok{mode)}
\NormalTok{x}\OperatorTok{$}\NormalTok{Charts <-}\StringTok{ }\KeywordTok{as.factor}\NormalTok{(x}\OperatorTok{$}\NormalTok{Charts)}

\KeywordTok{library}\NormalTok{(}\StringTok{"dplyr"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Attaching package: 'dplyr'
\end{verbatim}

\begin{verbatim}
## The following objects are masked from 'package:stats':
## 
##     filter, lag
\end{verbatim}

\begin{verbatim}
## The following objects are masked from 'package:base':
## 
##     intersect, setdiff, setequal, union
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x <-}\StringTok{ }\NormalTok{dplyr}\OperatorTok{::}\KeywordTok{select}\NormalTok{(x, }\OperatorTok{-}\KeywordTok{one_of}\NormalTok{(}\StringTok{'Streams'}\NormalTok{))}
\NormalTok{x <-}\StringTok{ }\NormalTok{x[}\KeywordTok{complete.cases}\NormalTok{(x), ]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{var_list <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{'Artist_Albums_Number'}\NormalTok{, }\StringTok{'Artist_Albums_Tracks_Number'}\NormalTok{, }\StringTok{'Artist_Appearances_Number'}\NormalTok{, }\StringTok{'Artist_Appearances_Tracks_Number'}\NormalTok{, }\StringTok{'Artist_Compilations_Number'}\NormalTok{, }\StringTok{'Artist_Compilations_Tracks_Number'}\NormalTok{, }\StringTok{'Artist_Follower'}\NormalTok{, }\StringTok{'Artist_Popularity'}\NormalTok{, }\StringTok{'Artist_Singles_Number'}\NormalTok{, }\StringTok{'Artist_Singles_Tracks_Number'}\NormalTok{, }\StringTok{'Track_Duration_ms'}\NormalTok{, }\StringTok{'Track_Popularity'}\NormalTok{, }\StringTok{'acousticness'}\NormalTok{, }\StringTok{'danceability'}\NormalTok{, }\StringTok{'energy'}\NormalTok{, }\StringTok{'instrumentalness'}\NormalTok{, }\StringTok{'liveness'}\NormalTok{, }\StringTok{'loudness'}\NormalTok{, }\StringTok{'speechiness'}\NormalTok{, }\StringTok{'tempo'}\NormalTok{, }\StringTok{'valence'}\NormalTok{, }\StringTok{'commentCount'}\NormalTok{, }\StringTok{'dislikeCount'}\NormalTok{, }\StringTok{'likeCount'}\NormalTok{, }\StringTok{'viewsCount'}\NormalTok{)}

\KeywordTok{par}\NormalTok{(}\DataTypeTok{mar =} \KeywordTok{rep}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DecValTok{4}\NormalTok{))}

\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfrow=}\KeywordTok{c}\NormalTok{(}\DecValTok{5}\NormalTok{,}\DecValTok{5}\NormalTok{))}

\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\KeywordTok{length}\NormalTok{(var_list))\{}
  
  \KeywordTok{hist}\NormalTok{(x[, var_list[i]], }\DataTypeTok{probability =} \OtherTok{TRUE}\NormalTok{, }\DataTypeTok{col =} \StringTok{"gray"}\NormalTok{, }\DataTypeTok{main =}\NormalTok{ var_list[i], }\DataTypeTok{xlab =} \StringTok{""}\NormalTok{)}
  \KeywordTok{lines}\NormalTok{(}\KeywordTok{density}\NormalTok{(x[, var_list[i]]), }\DataTypeTok{col =} \StringTok{"red"}\NormalTok{)}

\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-2-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{par}\NormalTok{(}\DataTypeTok{mar =} \KeywordTok{rep}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DecValTok{4}\NormalTok{))}

\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfrow=}\KeywordTok{c}\NormalTok{(}\DecValTok{5}\NormalTok{,}\DecValTok{5}\NormalTok{))}

\ControlFlowTok{for}\NormalTok{(i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\KeywordTok{length}\NormalTok{(var_list))\{}
  
\NormalTok{  df <-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(x[,var_list[i]])}
  \KeywordTok{names}\NormalTok{(df)[}\DecValTok{1}\NormalTok{] <-}\StringTok{ }\NormalTok{var_list[i]}
  
  \CommentTok{#ggplot(df, aes(x="",y=Artist_Albums_Number)) + stat_boxplot(geom ='errorbar') + geom_boxplot(outlier.colour="black", outlier.shape=16, #outlier.size=2, notch=FALSE)}
  
  \KeywordTok{boxplot}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ df[,}\DecValTok{1}\NormalTok{], }\DataTypeTok{main =}\NormalTok{ var_list[i], }\DataTypeTok{notch =} \OtherTok{FALSE}\NormalTok{)}

\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-3-1.pdf}

Normality testing

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#strictly_positive_variables <- c('Artist_Follower', 'Artist_Popularity', 'Track_Duration_ms', 'Track_Popularity', 'viewsCount', #'acousticness', 'danceability', 'energy', 'liveness', 'loudness', 'speechiness', 'tempo', 'valence')}

\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\KeywordTok{length}\NormalTok{(var_list))\{}
  
\NormalTok{  column_name <-}\StringTok{ }\NormalTok{var_list[i]}
  
  \KeywordTok{message}\NormalTok{(column_name)}
  
\NormalTok{  sub_df <-}\StringTok{ }\KeywordTok{as.numeric}\NormalTok{(x[,column_name])}
  
  \CommentTok{# sub_df <- sub_df[complete.cases(sub_df), ]}
  
  \CommentTok{#sub_df <- as.numeric(as.character(unlist(sub_df[[1]])))}
  
\NormalTok{  test_statistic <-}\StringTok{ }\KeywordTok{ks.test}\NormalTok{(sub_df, }\StringTok{"pnorm"}\NormalTok{, }\DataTypeTok{mean=}\KeywordTok{mean}\NormalTok{(sub_df), }\DataTypeTok{sd=}\KeywordTok{sd}\NormalTok{(sub_df))}\OperatorTok{$}\NormalTok{statistic}
\NormalTok{  critical_value <-}\StringTok{ }\FloatTok{1.3581} \OperatorTok{/}\StringTok{ }\KeywordTok{sqrt}\NormalTok{ (}\KeywordTok{length}\NormalTok{(sub_df))}
  
  \ControlFlowTok{if}\NormalTok{ (test_statistic }\OperatorTok{>}\StringTok{ }\NormalTok{critical_value) \{}
\KeywordTok{message}\NormalTok{(column_name)}
\NormalTok{\} }\ControlFlowTok{else}\NormalTok{ \{}
\KeywordTok{message}\NormalTok{(}\KeywordTok{paste}\NormalTok{(}\StringTok{" "}\NormalTok{, column_name , }\StringTok{" is approximately normally distributed!"}\NormalTok{, test_statistic, critical_value))  }
\NormalTok{\}\}}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Artist_Albums_Number
\end{verbatim}

\begin{verbatim}
## Warning in ks.test(sub_df, "pnorm", mean = mean(sub_df), sd = sd(sub_df)): ties
## should not be present for the Kolmogorov-Smirnov test
\end{verbatim}

\begin{verbatim}
## Artist_Albums_Number
\end{verbatim}

\begin{verbatim}
## Artist_Albums_Tracks_Number
\end{verbatim}

\begin{verbatim}
## Warning in ks.test(sub_df, "pnorm", mean = mean(sub_df), sd = sd(sub_df)): ties
## should not be present for the Kolmogorov-Smirnov test
\end{verbatim}

\begin{verbatim}
## Artist_Albums_Tracks_Number
\end{verbatim}

\begin{verbatim}
## Artist_Appearances_Number
\end{verbatim}

\begin{verbatim}
## Warning in ks.test(sub_df, "pnorm", mean = mean(sub_df), sd = sd(sub_df)): ties
## should not be present for the Kolmogorov-Smirnov test
\end{verbatim}

\begin{verbatim}
## Artist_Appearances_Number
\end{verbatim}

\begin{verbatim}
## Artist_Appearances_Tracks_Number
\end{verbatim}

\begin{verbatim}
## Warning in ks.test(sub_df, "pnorm", mean = mean(sub_df), sd = sd(sub_df)): ties
## should not be present for the Kolmogorov-Smirnov test
\end{verbatim}

\begin{verbatim}
## Artist_Appearances_Tracks_Number
\end{verbatim}

\begin{verbatim}
## Artist_Compilations_Number
\end{verbatim}

\begin{verbatim}
## Warning in ks.test(sub_df, "pnorm", mean = mean(sub_df), sd = sd(sub_df)): ties
## should not be present for the Kolmogorov-Smirnov test
\end{verbatim}

\begin{verbatim}
## Artist_Compilations_Number
\end{verbatim}

\begin{verbatim}
## Artist_Compilations_Tracks_Number
\end{verbatim}

\begin{verbatim}
## Warning in ks.test(sub_df, "pnorm", mean = mean(sub_df), sd = sd(sub_df)): ties
## should not be present for the Kolmogorov-Smirnov test
\end{verbatim}

\begin{verbatim}
## Artist_Compilations_Tracks_Number
\end{verbatim}

\begin{verbatim}
## Artist_Follower
## Artist_Follower
\end{verbatim}

\begin{verbatim}
## Artist_Popularity
\end{verbatim}

\begin{verbatim}
## Warning in ks.test(sub_df, "pnorm", mean = mean(sub_df), sd = sd(sub_df)): ties
## should not be present for the Kolmogorov-Smirnov test
\end{verbatim}

\begin{verbatim}
##   Artist_Popularity  is approximately normally distributed! 0.0579112990955349 0.0970071428571429
\end{verbatim}

\begin{verbatim}
## Artist_Singles_Number
\end{verbatim}

\begin{verbatim}
## Warning in ks.test(sub_df, "pnorm", mean = mean(sub_df), sd = sd(sub_df)): ties
## should not be present for the Kolmogorov-Smirnov test
\end{verbatim}

\begin{verbatim}
## Artist_Singles_Number
\end{verbatim}

\begin{verbatim}
## Artist_Singles_Tracks_Number
\end{verbatim}

\begin{verbatim}
## Warning in ks.test(sub_df, "pnorm", mean = mean(sub_df), sd = sd(sub_df)): ties
## should not be present for the Kolmogorov-Smirnov test
\end{verbatim}

\begin{verbatim}
## Artist_Singles_Tracks_Number
\end{verbatim}

\begin{verbatim}
## Track_Duration_ms
\end{verbatim}

\begin{verbatim}
## Warning in ks.test(sub_df, "pnorm", mean = mean(sub_df), sd = sd(sub_df)): ties
## should not be present for the Kolmogorov-Smirnov test
\end{verbatim}

\begin{verbatim}
## Track_Duration_ms
\end{verbatim}

\begin{verbatim}
## Track_Popularity
\end{verbatim}

\begin{verbatim}
## Warning in ks.test(sub_df, "pnorm", mean = mean(sub_df), sd = sd(sub_df)): ties
## should not be present for the Kolmogorov-Smirnov test
\end{verbatim}

\begin{verbatim}
## Track_Popularity
\end{verbatim}

\begin{verbatim}
## acousticness
\end{verbatim}

\begin{verbatim}
## Warning in ks.test(sub_df, "pnorm", mean = mean(sub_df), sd = sd(sub_df)): ties
## should not be present for the Kolmogorov-Smirnov test
\end{verbatim}

\begin{verbatim}
## acousticness
\end{verbatim}

\begin{verbatim}
## danceability
\end{verbatim}

\begin{verbatim}
## Warning in ks.test(sub_df, "pnorm", mean = mean(sub_df), sd = sd(sub_df)): ties
## should not be present for the Kolmogorov-Smirnov test
\end{verbatim}

\begin{verbatim}
## danceability
\end{verbatim}

\begin{verbatim}
## energy
\end{verbatim}

\begin{verbatim}
## Warning in ks.test(sub_df, "pnorm", mean = mean(sub_df), sd = sd(sub_df)): ties
## should not be present for the Kolmogorov-Smirnov test
\end{verbatim}

\begin{verbatim}
## energy
\end{verbatim}

\begin{verbatim}
## instrumentalness
\end{verbatim}

\begin{verbatim}
## Warning in ks.test(sub_df, "pnorm", mean = mean(sub_df), sd = sd(sub_df)): ties
## should not be present for the Kolmogorov-Smirnov test
\end{verbatim}

\begin{verbatim}
## instrumentalness
\end{verbatim}

\begin{verbatim}
## liveness
\end{verbatim}

\begin{verbatim}
## Warning in ks.test(sub_df, "pnorm", mean = mean(sub_df), sd = sd(sub_df)): ties
## should not be present for the Kolmogorov-Smirnov test
\end{verbatim}

\begin{verbatim}
## liveness
\end{verbatim}

\begin{verbatim}
## loudness
\end{verbatim}

\begin{verbatim}
## Warning in ks.test(sub_df, "pnorm", mean = mean(sub_df), sd = sd(sub_df)): ties
## should not be present for the Kolmogorov-Smirnov test
\end{verbatim}

\begin{verbatim}
## loudness
\end{verbatim}

\begin{verbatim}
## speechiness
\end{verbatim}

\begin{verbatim}
## Warning in ks.test(sub_df, "pnorm", mean = mean(sub_df), sd = sd(sub_df)): ties
## should not be present for the Kolmogorov-Smirnov test
\end{verbatim}

\begin{verbatim}
## speechiness
\end{verbatim}

\begin{verbatim}
## tempo
\end{verbatim}

\begin{verbatim}
## Warning in ks.test(sub_df, "pnorm", mean = mean(sub_df), sd = sd(sub_df)): ties
## should not be present for the Kolmogorov-Smirnov test
\end{verbatim}

\begin{verbatim}
## tempo
\end{verbatim}

\begin{verbatim}
## valence
\end{verbatim}

\begin{verbatim}
## Warning in ks.test(sub_df, "pnorm", mean = mean(sub_df), sd = sd(sub_df)): ties
## should not be present for the Kolmogorov-Smirnov test
\end{verbatim}

\begin{verbatim}
## valence
\end{verbatim}

\begin{verbatim}
## commentCount
\end{verbatim}

\begin{verbatim}
## Warning in ks.test(sub_df, "pnorm", mean = mean(sub_df), sd = sd(sub_df)): ties
## should not be present for the Kolmogorov-Smirnov test
\end{verbatim}

\begin{verbatim}
## commentCount
\end{verbatim}

\begin{verbatim}
## dislikeCount
\end{verbatim}

\begin{verbatim}
## Warning in ks.test(sub_df, "pnorm", mean = mean(sub_df), sd = sd(sub_df)): ties
## should not be present for the Kolmogorov-Smirnov test
\end{verbatim}

\begin{verbatim}
## dislikeCount
\end{verbatim}

\begin{verbatim}
## likeCount
\end{verbatim}

\begin{verbatim}
## Warning in ks.test(sub_df, "pnorm", mean = mean(sub_df), sd = sd(sub_df)): ties
## should not be present for the Kolmogorov-Smirnov test
\end{verbatim}

\begin{verbatim}
## likeCount
\end{verbatim}

\begin{verbatim}
## viewsCount
## viewsCount
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x_scaled <-}\StringTok{ }\KeywordTok{as.data.frame}\NormalTok{(}\KeywordTok{scale}\NormalTok{(x[, var_list]))}

\KeywordTok{par}\NormalTok{(}\DataTypeTok{mar =} \KeywordTok{rep}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DecValTok{4}\NormalTok{))}

\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfrow=}\KeywordTok{c}\NormalTok{(}\DecValTok{5}\NormalTok{,}\DecValTok{5}\NormalTok{))}

\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\KeywordTok{length}\NormalTok{(var_list))\{}
  
  \KeywordTok{hist}\NormalTok{(x_scaled[, var_list[i]], }\DataTypeTok{probability =} \OtherTok{TRUE}\NormalTok{, }\DataTypeTok{col =} \StringTok{"gray"}\NormalTok{, }\DataTypeTok{main =}\NormalTok{ var_list[i], }\DataTypeTok{xlab =} \StringTok{""}\NormalTok{)}
  \KeywordTok{lines}\NormalTok{(}\KeywordTok{density}\NormalTok{(x_scaled[, var_list[i]]), }\DataTypeTok{col =} \StringTok{"red"}\NormalTok{)}

\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-5-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{par}\NormalTok{(}\DataTypeTok{mar =} \KeywordTok{rep}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DecValTok{4}\NormalTok{))}

\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfrow=}\KeywordTok{c}\NormalTok{(}\DecValTok{5}\NormalTok{,}\DecValTok{5}\NormalTok{))}

\ControlFlowTok{for}\NormalTok{(i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\KeywordTok{length}\NormalTok{(var_list))\{}
  
\NormalTok{  df <-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(x_scaled[,var_list[i]])}
  \KeywordTok{names}\NormalTok{(df)[}\DecValTok{1}\NormalTok{] <-}\StringTok{ }\NormalTok{var_list[i]}
  
  \CommentTok{#ggplot(df, aes(x="",y=Artist_Albums_Number)) + stat_boxplot(geom ='errorbar') + geom_boxplot(outlier.colour="black", outlier.shape=16, #outlier.size=2, notch=FALSE)}
  
  \KeywordTok{boxplot}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ df[,}\DecValTok{1}\NormalTok{], }\DataTypeTok{main =}\NormalTok{ var_list[i], }\DataTypeTok{notch =} \OtherTok{FALSE}\NormalTok{)}

\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-6-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\KeywordTok{length}\NormalTok{(var_list))\{}
  
\NormalTok{  column_name <-}\StringTok{ }\NormalTok{var_list[i]}
  
  \KeywordTok{message}\NormalTok{(column_name)}
  
\NormalTok{  sub_df <-}\StringTok{ }\KeywordTok{as.numeric}\NormalTok{(x_scaled[,column_name])}
  
  \CommentTok{# sub_df <- sub_df[complete.cases(sub_df), ]}
  
  \CommentTok{#sub_df <- as.numeric(as.character(unlist(sub_df[[1]])))}
  
\NormalTok{  test_statistic <-}\StringTok{ }\KeywordTok{ks.test}\NormalTok{(sub_df, }\StringTok{"pnorm"}\NormalTok{, }\DataTypeTok{mean=}\KeywordTok{mean}\NormalTok{(sub_df), }\DataTypeTok{sd=}\KeywordTok{sd}\NormalTok{(sub_df))}\OperatorTok{$}\NormalTok{statistic}
\NormalTok{  critical_value <-}\StringTok{ }\FloatTok{1.3581} \OperatorTok{/}\StringTok{ }\KeywordTok{sqrt}\NormalTok{ (}\KeywordTok{length}\NormalTok{(sub_df))}
  
  \ControlFlowTok{if}\NormalTok{ (test_statistic }\OperatorTok{>}\StringTok{ }\NormalTok{critical_value) \{}
\KeywordTok{message}\NormalTok{(column_name)}
\NormalTok{\} }\ControlFlowTok{else}\NormalTok{ \{}
\KeywordTok{message}\NormalTok{(}\KeywordTok{paste}\NormalTok{(}\StringTok{" "}\NormalTok{, column_name , }\StringTok{" is approximately normally distributed!"}\NormalTok{, test_statistic, critical_value))  }
\NormalTok{\}\}}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Artist_Albums_Number
\end{verbatim}

\begin{verbatim}
## Warning in ks.test(sub_df, "pnorm", mean = mean(sub_df), sd = sd(sub_df)): ties
## should not be present for the Kolmogorov-Smirnov test
\end{verbatim}

\begin{verbatim}
## Artist_Albums_Number
\end{verbatim}

\begin{verbatim}
## Artist_Albums_Tracks_Number
\end{verbatim}

\begin{verbatim}
## Warning in ks.test(sub_df, "pnorm", mean = mean(sub_df), sd = sd(sub_df)): ties
## should not be present for the Kolmogorov-Smirnov test
\end{verbatim}

\begin{verbatim}
## Artist_Albums_Tracks_Number
\end{verbatim}

\begin{verbatim}
## Artist_Appearances_Number
\end{verbatim}

\begin{verbatim}
## Warning in ks.test(sub_df, "pnorm", mean = mean(sub_df), sd = sd(sub_df)): ties
## should not be present for the Kolmogorov-Smirnov test
\end{verbatim}

\begin{verbatim}
## Artist_Appearances_Number
\end{verbatim}

\begin{verbatim}
## Artist_Appearances_Tracks_Number
\end{verbatim}

\begin{verbatim}
## Warning in ks.test(sub_df, "pnorm", mean = mean(sub_df), sd = sd(sub_df)): ties
## should not be present for the Kolmogorov-Smirnov test
\end{verbatim}

\begin{verbatim}
## Artist_Appearances_Tracks_Number
\end{verbatim}

\begin{verbatim}
## Artist_Compilations_Number
\end{verbatim}

\begin{verbatim}
## Warning in ks.test(sub_df, "pnorm", mean = mean(sub_df), sd = sd(sub_df)): ties
## should not be present for the Kolmogorov-Smirnov test
\end{verbatim}

\begin{verbatim}
## Artist_Compilations_Number
\end{verbatim}

\begin{verbatim}
## Artist_Compilations_Tracks_Number
\end{verbatim}

\begin{verbatim}
## Warning in ks.test(sub_df, "pnorm", mean = mean(sub_df), sd = sd(sub_df)): ties
## should not be present for the Kolmogorov-Smirnov test
\end{verbatim}

\begin{verbatim}
## Artist_Compilations_Tracks_Number
\end{verbatim}

\begin{verbatim}
## Artist_Follower
## Artist_Follower
\end{verbatim}

\begin{verbatim}
## Artist_Popularity
\end{verbatim}

\begin{verbatim}
## Warning in ks.test(sub_df, "pnorm", mean = mean(sub_df), sd = sd(sub_df)): ties
## should not be present for the Kolmogorov-Smirnov test
\end{verbatim}

\begin{verbatim}
##   Artist_Popularity  is approximately normally distributed! 0.0579112990955349 0.0970071428571429
\end{verbatim}

\begin{verbatim}
## Artist_Singles_Number
\end{verbatim}

\begin{verbatim}
## Warning in ks.test(sub_df, "pnorm", mean = mean(sub_df), sd = sd(sub_df)): ties
## should not be present for the Kolmogorov-Smirnov test
\end{verbatim}

\begin{verbatim}
## Artist_Singles_Number
\end{verbatim}

\begin{verbatim}
## Artist_Singles_Tracks_Number
\end{verbatim}

\begin{verbatim}
## Warning in ks.test(sub_df, "pnorm", mean = mean(sub_df), sd = sd(sub_df)): ties
## should not be present for the Kolmogorov-Smirnov test
\end{verbatim}

\begin{verbatim}
## Artist_Singles_Tracks_Number
\end{verbatim}

\begin{verbatim}
## Track_Duration_ms
\end{verbatim}

\begin{verbatim}
## Warning in ks.test(sub_df, "pnorm", mean = mean(sub_df), sd = sd(sub_df)): ties
## should not be present for the Kolmogorov-Smirnov test
\end{verbatim}

\begin{verbatim}
## Track_Duration_ms
\end{verbatim}

\begin{verbatim}
## Track_Popularity
\end{verbatim}

\begin{verbatim}
## Warning in ks.test(sub_df, "pnorm", mean = mean(sub_df), sd = sd(sub_df)): ties
## should not be present for the Kolmogorov-Smirnov test
\end{verbatim}

\begin{verbatim}
## Track_Popularity
\end{verbatim}

\begin{verbatim}
## acousticness
\end{verbatim}

\begin{verbatim}
## Warning in ks.test(sub_df, "pnorm", mean = mean(sub_df), sd = sd(sub_df)): ties
## should not be present for the Kolmogorov-Smirnov test
\end{verbatim}

\begin{verbatim}
## acousticness
\end{verbatim}

\begin{verbatim}
## danceability
\end{verbatim}

\begin{verbatim}
## Warning in ks.test(sub_df, "pnorm", mean = mean(sub_df), sd = sd(sub_df)): ties
## should not be present for the Kolmogorov-Smirnov test
\end{verbatim}

\begin{verbatim}
## danceability
\end{verbatim}

\begin{verbatim}
## energy
\end{verbatim}

\begin{verbatim}
## Warning in ks.test(sub_df, "pnorm", mean = mean(sub_df), sd = sd(sub_df)): ties
## should not be present for the Kolmogorov-Smirnov test
\end{verbatim}

\begin{verbatim}
## energy
\end{verbatim}

\begin{verbatim}
## instrumentalness
\end{verbatim}

\begin{verbatim}
## Warning in ks.test(sub_df, "pnorm", mean = mean(sub_df), sd = sd(sub_df)): ties
## should not be present for the Kolmogorov-Smirnov test
\end{verbatim}

\begin{verbatim}
## instrumentalness
\end{verbatim}

\begin{verbatim}
## liveness
\end{verbatim}

\begin{verbatim}
## Warning in ks.test(sub_df, "pnorm", mean = mean(sub_df), sd = sd(sub_df)): ties
## should not be present for the Kolmogorov-Smirnov test
\end{verbatim}

\begin{verbatim}
## liveness
\end{verbatim}

\begin{verbatim}
## loudness
\end{verbatim}

\begin{verbatim}
## Warning in ks.test(sub_df, "pnorm", mean = mean(sub_df), sd = sd(sub_df)): ties
## should not be present for the Kolmogorov-Smirnov test
\end{verbatim}

\begin{verbatim}
## loudness
\end{verbatim}

\begin{verbatim}
## speechiness
\end{verbatim}

\begin{verbatim}
## Warning in ks.test(sub_df, "pnorm", mean = mean(sub_df), sd = sd(sub_df)): ties
## should not be present for the Kolmogorov-Smirnov test
\end{verbatim}

\begin{verbatim}
## speechiness
\end{verbatim}

\begin{verbatim}
## tempo
\end{verbatim}

\begin{verbatim}
## Warning in ks.test(sub_df, "pnorm", mean = mean(sub_df), sd = sd(sub_df)): ties
## should not be present for the Kolmogorov-Smirnov test
\end{verbatim}

\begin{verbatim}
## tempo
\end{verbatim}

\begin{verbatim}
## valence
\end{verbatim}

\begin{verbatim}
## Warning in ks.test(sub_df, "pnorm", mean = mean(sub_df), sd = sd(sub_df)): ties
## should not be present for the Kolmogorov-Smirnov test
\end{verbatim}

\begin{verbatim}
## valence
\end{verbatim}

\begin{verbatim}
## commentCount
\end{verbatim}

\begin{verbatim}
## Warning in ks.test(sub_df, "pnorm", mean = mean(sub_df), sd = sd(sub_df)): ties
## should not be present for the Kolmogorov-Smirnov test
\end{verbatim}

\begin{verbatim}
## commentCount
\end{verbatim}

\begin{verbatim}
## dislikeCount
\end{verbatim}

\begin{verbatim}
## Warning in ks.test(sub_df, "pnorm", mean = mean(sub_df), sd = sd(sub_df)): ties
## should not be present for the Kolmogorov-Smirnov test
\end{verbatim}

\begin{verbatim}
## dislikeCount
\end{verbatim}

\begin{verbatim}
## likeCount
\end{verbatim}

\begin{verbatim}
## Warning in ks.test(sub_df, "pnorm", mean = mean(sub_df), sd = sd(sub_df)): ties
## should not be present for the Kolmogorov-Smirnov test
\end{verbatim}

\begin{verbatim}
## likeCount
\end{verbatim}

\begin{verbatim}
## viewsCount
## viewsCount
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{strictly_positive_variables <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{'Artist_Follower'}\NormalTok{, }\StringTok{'Artist_Popularity'}\NormalTok{, }\StringTok{'Artist_Singles_Number'}\NormalTok{, }\StringTok{'Artist_Singles_Tracks_Number'}\NormalTok{, }\StringTok{'Track_Duration_ms'}\NormalTok{, }\StringTok{'Track_Popularity'}\NormalTok{, }\StringTok{'acousticness'}\NormalTok{, }\StringTok{'danceability'}\NormalTok{, }\StringTok{'energy'}\NormalTok{, }\StringTok{'instrumentalness'}\NormalTok{, }\StringTok{'liveness'}\NormalTok{, }\StringTok{'loudness'}\NormalTok{, }\StringTok{'speechiness'}\NormalTok{, }\StringTok{'tempo'}\NormalTok{, }\StringTok{'valence'}\NormalTok{, }\StringTok{'likeCount'}\NormalTok{, }\StringTok{'viewsCount'}\NormalTok{)}

\KeywordTok{library}\NormalTok{(}\StringTok{"psych"}\NormalTok{)}
\KeywordTok{library}\NormalTok{(}\StringTok{"car"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Loading required package: carData
\end{verbatim}

\begin{verbatim}
## 
## Attaching package: 'car'
\end{verbatim}

\begin{verbatim}
## The following object is masked from 'package:psych':
## 
##     logit
\end{verbatim}

\begin{verbatim}
## The following object is masked from 'package:dplyr':
## 
##     recode
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ksD <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{ (p, x) \{}
\NormalTok{  y <-}\StringTok{ }\KeywordTok{bcPower}\NormalTok{(x, p)}
  \KeywordTok{ks.test}\NormalTok{(y, }\StringTok{"pnorm"}\NormalTok{, }\DataTypeTok{mean=}\KeywordTok{mean}\NormalTok{(y), }\DataTypeTok{sd=}\KeywordTok{sd}\NormalTok{(y))}\OperatorTok{$}\NormalTok{statistic}
\NormalTok{\}}

\NormalTok{oldw <-}\StringTok{ }\KeywordTok{getOption}\NormalTok{(}\StringTok{"warn"}\NormalTok{)}
\KeywordTok{options}\NormalTok{(}\DataTypeTok{warn =} \DecValTok{-1}\NormalTok{)}

\NormalTok{min_values <-}\StringTok{ }\KeywordTok{c}\NormalTok{()}

\ControlFlowTok{for}\NormalTok{ (column_index }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\KeywordTok{length}\NormalTok{(strictly_positive_variables))\{}
  
\NormalTok{  column_name <-}\StringTok{ }\NormalTok{strictly_positive_variables[column_index]}
  
\NormalTok{  x_sub <-}\StringTok{ }\NormalTok{x[[}\KeywordTok{paste}\NormalTok{(column_name)]]}
  
\NormalTok{  result <-}\StringTok{ }\KeywordTok{optimize}\NormalTok{(ksD, }\KeywordTok{c}\NormalTok{(}\OperatorTok{-}\DecValTok{5}\NormalTok{,}\DecValTok{5}\NormalTok{), }\DataTypeTok{x=}\NormalTok{x_sub)}
  
\NormalTok{  min_values[column_index] <-}\StringTok{ }\NormalTok{result}\OperatorTok{$}\NormalTok{minimum}
  
  \KeywordTok{message}\NormalTok{(}\KeywordTok{paste}\NormalTok{(column_index, }\StringTok{', minimum value is: '}\NormalTok{, result}\OperatorTok{$}\NormalTok{minimum))}
  
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 1 , minimum value is:  -0.0049316395173003
\end{verbatim}

\begin{verbatim}
## 2 , minimum value is:  1.40215894049501
\end{verbatim}

\begin{verbatim}
## 3 , minimum value is:  0.240525077020065
\end{verbatim}

\begin{verbatim}
## 4 , minimum value is:  0.262671909258923
\end{verbatim}

\begin{verbatim}
## 5 , minimum value is:  -0.699387491055179
\end{verbatim}

\begin{verbatim}
## 6 , minimum value is:  0.949365177476973
\end{verbatim}

\begin{verbatim}
## 7 , minimum value is:  0.130600084313768
\end{verbatim}

\begin{verbatim}
## 8 , minimum value is:  3.51730755217668
\end{verbatim}

\begin{verbatim}
## 9 , minimum value is:  3.07785781966221
\end{verbatim}

\begin{verbatim}
## 10 , minimum value is:  -0.795345146822112
\end{verbatim}

\begin{verbatim}
## 11 , minimum value is:  -0.303366878680729
\end{verbatim}

\begin{verbatim}
## 12 , minimum value is:  4.64767393430379
\end{verbatim}

\begin{verbatim}
## 13 , minimum value is:  -0.403363137393642
\end{verbatim}

\begin{verbatim}
## 14 , minimum value is:  1.16379372652619
\end{verbatim}

\begin{verbatim}
## 15 , minimum value is:  0.453314295028104
\end{verbatim}

\begin{verbatim}
## 16 , minimum value is:  0.05466614868127
\end{verbatim}

\begin{verbatim}
## 17 , minimum value is:  0.0345455532264414
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{options}\NormalTok{(}\DataTypeTok{warn =}\NormalTok{ oldw)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{column_index <-}\StringTok{ }\DecValTok{1}
\NormalTok{column_name <-}\StringTok{ }\NormalTok{strictly_positive_variables[column_index]}
\NormalTok{x_sub <-}\StringTok{ }\NormalTok{x[[}\KeywordTok{paste}\NormalTok{(column_name)]]}
\NormalTok{Artist_Follower_trans <-}\StringTok{ }\KeywordTok{bcPower}\NormalTok{(x_sub, min_values[column_index])}

\NormalTok{column_index <-}\StringTok{ }\DecValTok{2}
\NormalTok{column_name <-}\StringTok{ }\NormalTok{strictly_positive_variables[column_index]}
\NormalTok{x_sub <-}\StringTok{ }\NormalTok{x[[}\KeywordTok{paste}\NormalTok{(column_name)]]}
\NormalTok{Artist_Popularity_trans <-}\StringTok{ }\KeywordTok{bcPower}\NormalTok{(x_sub, min_values[column_index])}

\NormalTok{column_index <-}\StringTok{ }\DecValTok{3}
\NormalTok{column_name <-}\StringTok{ }\NormalTok{strictly_positive_variables[column_index]}
\NormalTok{x_sub <-}\StringTok{ }\NormalTok{x[[}\KeywordTok{paste}\NormalTok{(column_name)]]}
\NormalTok{Artist_Singles_Number_trans <-}\StringTok{ }\KeywordTok{bcPower}\NormalTok{(x_sub, min_values[column_index])}

\NormalTok{column_index <-}\StringTok{ }\DecValTok{4}
\NormalTok{column_name <-}\StringTok{ }\NormalTok{strictly_positive_variables[column_index]}
\NormalTok{x_sub <-}\StringTok{ }\NormalTok{x[[}\KeywordTok{paste}\NormalTok{(column_name)]]}
\NormalTok{Artist_Singles_Tracks_Number_trans <-}\StringTok{ }\KeywordTok{bcPower}\NormalTok{(x_sub, min_values[column_index])}

\NormalTok{column_index <-}\StringTok{ }\DecValTok{5}
\NormalTok{column_name <-}\StringTok{ }\NormalTok{strictly_positive_variables[column_index]}
\NormalTok{x_sub <-}\StringTok{ }\NormalTok{x[[}\KeywordTok{paste}\NormalTok{(column_name)]]}
\NormalTok{Track_Duration_ms_trans <-}\StringTok{ }\KeywordTok{bcPower}\NormalTok{(x_sub, min_values[column_index])}

\NormalTok{column_index <-}\StringTok{ }\DecValTok{6}
\NormalTok{column_name <-}\StringTok{ }\NormalTok{strictly_positive_variables[column_index]}
\NormalTok{x_sub <-}\StringTok{ }\NormalTok{x[[}\KeywordTok{paste}\NormalTok{(column_name)]]}
\NormalTok{Track_Popularity_trans <-}\StringTok{ }\KeywordTok{bcPower}\NormalTok{(x_sub, min_values[column_index])}

\NormalTok{column_index <-}\StringTok{ }\DecValTok{7}
\NormalTok{column_name <-}\StringTok{ }\NormalTok{strictly_positive_variables[column_index]}
\NormalTok{x_sub <-}\StringTok{ }\NormalTok{x[[}\KeywordTok{paste}\NormalTok{(column_name)]]}
\NormalTok{acousticness_trans <-}\StringTok{ }\KeywordTok{bcPower}\NormalTok{(x_sub, min_values[column_index])}

\NormalTok{column_index <-}\StringTok{ }\DecValTok{8}
\NormalTok{column_name <-}\StringTok{ }\NormalTok{strictly_positive_variables[column_index]}
\NormalTok{x_sub <-}\StringTok{ }\NormalTok{x[[}\KeywordTok{paste}\NormalTok{(column_name)]]}
\NormalTok{danceability_trans <-}\StringTok{ }\KeywordTok{bcPower}\NormalTok{(x_sub, min_values[column_index])}

\NormalTok{column_index <-}\StringTok{ }\DecValTok{9}
\NormalTok{column_name <-}\StringTok{ }\NormalTok{strictly_positive_variables[column_index]}
\NormalTok{x_sub <-}\StringTok{ }\NormalTok{x[[}\KeywordTok{paste}\NormalTok{(column_name)]]}
\NormalTok{energy_trans <-}\StringTok{ }\KeywordTok{bcPower}\NormalTok{(x_sub, min_values[column_index])}

\NormalTok{column_index <-}\StringTok{ }\DecValTok{10}
\NormalTok{column_name <-}\StringTok{ }\NormalTok{strictly_positive_variables[column_index]}
\NormalTok{x_sub <-}\StringTok{ }\NormalTok{x[[}\KeywordTok{paste}\NormalTok{(column_name)]]}
\NormalTok{instrumentalness_trans <-}\StringTok{ }\KeywordTok{bcPower}\NormalTok{(x_sub, min_values[column_index])}

\NormalTok{column_index <-}\StringTok{ }\DecValTok{11}
\NormalTok{column_name <-}\StringTok{ }\NormalTok{strictly_positive_variables[column_index]}
\NormalTok{x_sub <-}\StringTok{ }\NormalTok{x[[}\KeywordTok{paste}\NormalTok{(column_name)]]}
\NormalTok{liveness_trans <-}\StringTok{ }\KeywordTok{bcPower}\NormalTok{(x_sub, min_values[column_index])}

\NormalTok{column_index <-}\StringTok{ }\DecValTok{12}
\NormalTok{column_name <-}\StringTok{ }\NormalTok{strictly_positive_variables[column_index]}
\NormalTok{x_sub <-}\StringTok{ }\NormalTok{x[[}\KeywordTok{paste}\NormalTok{(column_name)]]}
\NormalTok{loudness_trans <-}\StringTok{ }\KeywordTok{bcPower}\NormalTok{(x_sub, min_values[column_index])}

\NormalTok{column_index <-}\StringTok{ }\DecValTok{13}
\NormalTok{column_name <-}\StringTok{ }\NormalTok{strictly_positive_variables[column_index]}
\NormalTok{x_sub <-}\StringTok{ }\NormalTok{x[[}\KeywordTok{paste}\NormalTok{(column_name)]]}
\NormalTok{speechiness_trans <-}\StringTok{ }\KeywordTok{bcPower}\NormalTok{(x_sub, min_values[column_index])}

\NormalTok{column_index <-}\StringTok{ }\DecValTok{14}
\NormalTok{column_name <-}\StringTok{ }\NormalTok{strictly_positive_variables[column_index]}
\NormalTok{x_sub <-}\StringTok{ }\NormalTok{x[[}\KeywordTok{paste}\NormalTok{(column_name)]]}
\NormalTok{tempo_trans <-}\StringTok{ }\KeywordTok{bcPower}\NormalTok{(x_sub, min_values[column_index])}

\NormalTok{column_index <-}\StringTok{ }\DecValTok{15}
\NormalTok{column_name <-}\StringTok{ }\NormalTok{strictly_positive_variables[column_index]}
\NormalTok{x_sub <-}\StringTok{ }\NormalTok{x[[}\KeywordTok{paste}\NormalTok{(column_name)]]}
\NormalTok{valence_trans <-}\StringTok{ }\KeywordTok{bcPower}\NormalTok{(x_sub, min_values[column_index])}

\NormalTok{column_index <-}\StringTok{ }\DecValTok{16}
\NormalTok{column_name <-}\StringTok{ }\NormalTok{strictly_positive_variables[column_index]}
\NormalTok{x_sub <-}\StringTok{ }\NormalTok{x[[}\KeywordTok{paste}\NormalTok{(column_name)]]}
\NormalTok{likeCount_trans <-}\StringTok{ }\KeywordTok{bcPower}\NormalTok{(x_sub, min_values[column_index])}

\NormalTok{column_index <-}\StringTok{ }\DecValTok{17}
\NormalTok{column_name <-}\StringTok{ }\NormalTok{strictly_positive_variables[column_index]}
\NormalTok{x_sub <-}\StringTok{ }\NormalTok{x[[}\KeywordTok{paste}\NormalTok{(column_name)]]}
\NormalTok{viewsCount_trans <-}\StringTok{ }\KeywordTok{bcPower}\NormalTok{(x_sub, min_values[column_index])}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{hist_trans_list <-}\StringTok{ }\KeywordTok{list}\NormalTok{(Artist_Follower_trans, }
\NormalTok{                        Artist_Popularity_trans,}
\NormalTok{                        Artist_Singles_Number_trans,}
\NormalTok{                        Artist_Singles_Tracks_Number_trans,}
\NormalTok{                        Track_Duration_ms_trans, }
\NormalTok{                        Track_Popularity_trans,}
\NormalTok{                     acousticness_trans, }
\NormalTok{                     danceability_trans, }
\NormalTok{                     energy_trans, }
\NormalTok{                     instrumentalness_trans,}
\NormalTok{                     liveness_trans, }
\NormalTok{                     loudness_trans, }
\NormalTok{                     speechiness_trans, }
\NormalTok{                     tempo_trans, }
\NormalTok{                     valence_trans,}
\NormalTok{                     likeCount_trans,}
\NormalTok{                     viewsCount_trans)}

\KeywordTok{par}\NormalTok{(}\DataTypeTok{mar =} \KeywordTok{rep}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DecValTok{4}\NormalTok{))}
\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfrow=}\KeywordTok{c}\NormalTok{(}\DecValTok{4}\NormalTok{,}\DecValTok{5}\NormalTok{))}

\ControlFlowTok{for}\NormalTok{ (trans_index }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\KeywordTok{length}\NormalTok{(hist_trans_list))\{}
  
\NormalTok{  column_name <-}\StringTok{ }\NormalTok{strictly_positive_variables[trans_index]}
  
\NormalTok{  selected_trans <-}\StringTok{ }\NormalTok{hist_trans_list[trans_index]}
\NormalTok{  selected_trans <-}\StringTok{ }\KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{as.character}\NormalTok{(}\KeywordTok{unlist}\NormalTok{(selected_trans[[}\DecValTok{1}\NormalTok{]])))}
  
  \KeywordTok{hist}\NormalTok{(selected_trans, }\DataTypeTok{col =} \StringTok{"gray"}\NormalTok{, }\DataTypeTok{probability =} \OtherTok{TRUE}\NormalTok{, }\DataTypeTok{main =}\NormalTok{ column_name, }\DataTypeTok{xlab =} \StringTok{""}\NormalTok{)}
  \KeywordTok{points}\NormalTok{(}\KeywordTok{seq}\NormalTok{(}\KeywordTok{min}\NormalTok{(selected_trans), }\KeywordTok{max}\NormalTok{(selected_trans), }\DataTypeTok{length.out =} \DecValTok{500}\NormalTok{),}
       \KeywordTok{dnorm}\NormalTok{(}\KeywordTok{seq}\NormalTok{(}\KeywordTok{min}\NormalTok{(selected_trans), }\KeywordTok{max}\NormalTok{(selected_trans), }\DataTypeTok{length.out =} \DecValTok{500}\NormalTok{),}
             \KeywordTok{mean}\NormalTok{(selected_trans),}\KeywordTok{sd}\NormalTok{(selected_trans)), }\DataTypeTok{type =} \StringTok{"l"}\NormalTok{, }\DataTypeTok{col =} \StringTok{"red"}\NormalTok{)}
  
\NormalTok{  test_statistic <-}\StringTok{ }\KeywordTok{ks.test}\NormalTok{(selected_trans, }\StringTok{"pnorm"}\NormalTok{, }\DataTypeTok{mean=}\KeywordTok{mean}\NormalTok{(selected_trans), }\DataTypeTok{sd=}\KeywordTok{sd}\NormalTok{(selected_trans))}\OperatorTok{$}\NormalTok{statistic}
\NormalTok{  critical_value <-}\StringTok{ }\FloatTok{1.3581} \OperatorTok{/}\StringTok{ }\KeywordTok{sqrt}\NormalTok{ (}\KeywordTok{length}\NormalTok{(selected_trans))}
  
  \ControlFlowTok{if}\NormalTok{ (test_statistic }\OperatorTok{>}\StringTok{ }\NormalTok{critical_value) \{}
\KeywordTok{message}\NormalTok{(}\KeywordTok{paste}\NormalTok{(}\StringTok{"Transformed "}\NormalTok{, column_name , }\StringTok{" is not approximately normally distributed."}\NormalTok{, test_statistic, critical_value))}
\NormalTok{\} }\ControlFlowTok{else}\NormalTok{ \{}
\KeywordTok{message}\NormalTok{(}\KeywordTok{paste}\NormalTok{(}\StringTok{"Transformed "}\NormalTok{, column_name , }\StringTok{" is approximately normally distributed!"}\NormalTok{, test_statistic, critical_value))  }
\NormalTok{\}\}}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Transformed  Artist_Follower  is approximately normally distributed! 0.0485813205231013 0.0970071428571429
\end{verbatim}

\begin{verbatim}
## Warning in ks.test(selected_trans, "pnorm", mean = mean(selected_trans), : ties
## should not be present for the Kolmogorov-Smirnov test
\end{verbatim}

\begin{verbatim}
## Transformed  Artist_Popularity  is approximately normally distributed! 0.047962859540898 0.0970071428571429
\end{verbatim}

\begin{verbatim}
## Warning in ks.test(selected_trans, "pnorm", mean = mean(selected_trans), : ties
## should not be present for the Kolmogorov-Smirnov test
\end{verbatim}

\begin{verbatim}
## Transformed  Artist_Singles_Number  is approximately normally distributed! 0.0639302516161726 0.0970071428571429
\end{verbatim}

\begin{verbatim}
## Warning in ks.test(selected_trans, "pnorm", mean = mean(selected_trans), : ties
## should not be present for the Kolmogorov-Smirnov test
\end{verbatim}

\begin{verbatim}
## Transformed  Artist_Singles_Tracks_Number  is approximately normally distributed! 0.0334178939616578 0.0970071428571429
\end{verbatim}

\begin{verbatim}
## Warning in ks.test(selected_trans, "pnorm", mean = mean(selected_trans), : ties
## should not be present for the Kolmogorov-Smirnov test
\end{verbatim}

\begin{verbatim}
## Transformed  Track_Duration_ms  is not approximately normally distributed. 0.0998436682047523 0.0970071428571429
\end{verbatim}

\begin{verbatim}
## Warning in ks.test(selected_trans, "pnorm", mean = mean(selected_trans), : ties
## should not be present for the Kolmogorov-Smirnov test
\end{verbatim}

\begin{verbatim}
## Transformed  Track_Popularity  is not approximately normally distributed. 0.108864892250361 0.0970071428571429
\end{verbatim}

\begin{verbatim}
## Warning in ks.test(selected_trans, "pnorm", mean = mean(selected_trans), : ties
## should not be present for the Kolmogorov-Smirnov test
\end{verbatim}

\begin{verbatim}
## Transformed  acousticness  is not approximately normally distributed. 0.108064790247887 0.0970071428571429
\end{verbatim}

\begin{verbatim}
## Warning in ks.test(selected_trans, "pnorm", mean = mean(selected_trans), : ties
## should not be present for the Kolmogorov-Smirnov test
\end{verbatim}

\begin{verbatim}
## Transformed  danceability  is not approximately normally distributed. 0.113440523942993 0.0970071428571429
\end{verbatim}

\begin{verbatim}
## Warning in ks.test(selected_trans, "pnorm", mean = mean(selected_trans), : ties
## should not be present for the Kolmogorov-Smirnov test
\end{verbatim}

\begin{verbatim}
## Transformed  energy  is not approximately normally distributed. 0.114310681616891 0.0970071428571429
\end{verbatim}

\begin{verbatim}
## Warning in ks.test(selected_trans, "pnorm", mean = mean(selected_trans), : ties
## should not be present for the Kolmogorov-Smirnov test
\end{verbatim}

\begin{verbatim}
## Transformed  instrumentalness  is not approximately normally distributed. 0.285896259482658 0.0970071428571429
\end{verbatim}

\begin{verbatim}
## Warning in ks.test(selected_trans, "pnorm", mean = mean(selected_trans), : ties
## should not be present for the Kolmogorov-Smirnov test
\end{verbatim}

\begin{verbatim}
## Transformed  liveness  is not approximately normally distributed. 0.103366239896501 0.0970071428571429
\end{verbatim}

\begin{verbatim}
## Warning in ks.test(selected_trans, "pnorm", mean = mean(selected_trans), : ties
## should not be present for the Kolmogorov-Smirnov test
\end{verbatim}

\begin{verbatim}
## Transformed  loudness  is approximately normally distributed! 0.0958614307678946 0.0970071428571429
\end{verbatim}

\begin{verbatim}
## Warning in ks.test(selected_trans, "pnorm", mean = mean(selected_trans), : ties
## should not be present for the Kolmogorov-Smirnov test
\end{verbatim}

\begin{verbatim}
## Transformed  speechiness  is approximately normally distributed! 0.0660473903454177 0.0970071428571429
\end{verbatim}

\begin{verbatim}
## Warning in ks.test(selected_trans, "pnorm", mean = mean(selected_trans), : ties
## should not be present for the Kolmogorov-Smirnov test
\end{verbatim}

\begin{verbatim}
## Transformed  tempo  is approximately normally distributed! 0.0841680160106226 0.0970071428571429
\end{verbatim}

\begin{verbatim}
## Warning in ks.test(selected_trans, "pnorm", mean = mean(selected_trans), : ties
## should not be present for the Kolmogorov-Smirnov test
\end{verbatim}

\begin{verbatim}
## Transformed  valence  is approximately normally distributed! 0.0879386163770323 0.0970071428571429
\end{verbatim}

\begin{verbatim}
## Warning in ks.test(selected_trans, "pnorm", mean = mean(selected_trans), : ties
## should not be present for the Kolmogorov-Smirnov test
\end{verbatim}

\begin{verbatim}
## Transformed  likeCount  is approximately normally distributed! 0.0696106433502905 0.0970071428571429
\end{verbatim}

\begin{verbatim}
## Transformed  viewsCount  is approximately normally distributed! 0.0770680692211038 0.0970071428571429
\end{verbatim}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-10-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{par}\NormalTok{(}\DataTypeTok{mar =} \KeywordTok{rep}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DecValTok{4}\NormalTok{))}

\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfrow=}\KeywordTok{c}\NormalTok{(}\DecValTok{4}\NormalTok{,}\DecValTok{5}\NormalTok{))}

\ControlFlowTok{for}\NormalTok{(trans_index }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\KeywordTok{length}\NormalTok{(strictly_positive_variables))\{}
  
  
\NormalTok{  column_name <-}\StringTok{ }\NormalTok{strictly_positive_variables[trans_index]}
  
\NormalTok{  selected_trans <-}\StringTok{ }\NormalTok{hist_trans_list[trans_index]}
\NormalTok{  selected_trans <-}\StringTok{ }\KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{as.character}\NormalTok{(}\KeywordTok{unlist}\NormalTok{(selected_trans[[}\DecValTok{1}\NormalTok{]])))}
  
\NormalTok{  df <-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(selected_trans)}
  \KeywordTok{names}\NormalTok{(df)[}\DecValTok{1}\NormalTok{] <-}\StringTok{ }\NormalTok{strictly_positive_variables[trans_index]}
  
  \KeywordTok{boxplot}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ df[,}\DecValTok{1}\NormalTok{], }\DataTypeTok{main =}\NormalTok{ strictly_positive_variables[trans_index], }\DataTypeTok{notch =} \OtherTok{FALSE}\NormalTok{)}
  
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-11-1.pdf}

Correlation

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(corrplot)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## corrplot 0.84 loaded
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{method <-}\StringTok{ "pearson"}

\NormalTok{clean_cor <-}\StringTok{ }\KeywordTok{cor}\NormalTok{(x[,var_list], }\DataTypeTok{method =}\NormalTok{ method)}

\NormalTok{cor.mtest <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(mat, ...) \{}
\NormalTok{  mat <-}\StringTok{ }\KeywordTok{as.matrix}\NormalTok{(mat)}
\NormalTok{  n <-}\StringTok{ }\KeywordTok{ncol}\NormalTok{(mat)}
\NormalTok{  p.mat<-}\StringTok{ }\KeywordTok{matrix}\NormalTok{(}\OtherTok{NA}\NormalTok{, n, n)}
  \KeywordTok{diag}\NormalTok{(p.mat) <-}\StringTok{ }\DecValTok{0}
  \ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\NormalTok{(n }\OperatorTok{-}\StringTok{ }\DecValTok{1}\NormalTok{)) \{}
    \ControlFlowTok{for}\NormalTok{ (j }\ControlFlowTok{in}\NormalTok{ (i }\OperatorTok{+}\StringTok{ }\DecValTok{1}\NormalTok{)}\OperatorTok{:}\NormalTok{n) \{}
\NormalTok{      tmp <-}\StringTok{ }\KeywordTok{cor.test}\NormalTok{(mat[, i], mat[, j], ..., }\DataTypeTok{method =}\NormalTok{ method)}
\NormalTok{      p.mat[i, j] <-}\StringTok{ }\NormalTok{p.mat[j, i] <-}\StringTok{ }\NormalTok{tmp}\OperatorTok{$}\NormalTok{p.value}
\NormalTok{    \}}
\NormalTok{  \}}
  \KeywordTok{colnames}\NormalTok{(p.mat) <-}\StringTok{ }\KeywordTok{rownames}\NormalTok{(p.mat) <-}\StringTok{ }\KeywordTok{colnames}\NormalTok{(mat)}
\NormalTok{  p.mat}
\NormalTok{\}}

\CommentTok{# matrix of the p-value of the correlation}
\NormalTok{p.mat <-}\StringTok{ }\KeywordTok{cor.mtest}\NormalTok{(clean_cor)}

\NormalTok{col <-}\StringTok{ }\KeywordTok{colorRampPalette}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\StringTok{"#BB4444"}\NormalTok{, }\StringTok{"#EE9988"}\NormalTok{, }\StringTok{"#FFFFFF"}\NormalTok{, }\StringTok{"#77AADD"}\NormalTok{, }\StringTok{"#4477AA"}\NormalTok{))}
\NormalTok{significance_level <-}\StringTok{ }\FloatTok{0.05}

\KeywordTok{corrplot}\NormalTok{(clean_cor, }\DataTypeTok{method=}\StringTok{"color"}\NormalTok{, }\DataTypeTok{col=}\KeywordTok{col}\NormalTok{(}\DecValTok{200}\NormalTok{),}
         \DataTypeTok{type=}\StringTok{"upper"}\NormalTok{, }\DataTypeTok{order=}\StringTok{"alphabet"}\NormalTok{, }
         \DataTypeTok{addCoef.col =} \StringTok{"black"}\NormalTok{, }\CommentTok{# Add coefficient of correlation}
         \DataTypeTok{tl.col=}\StringTok{"black"}\NormalTok{, }\DataTypeTok{tl.srt=}\DecValTok{90}\NormalTok{, }\CommentTok{#Text label color and rotation}
         \CommentTok{# Combine with significance}
         \DataTypeTok{p.mat =}\NormalTok{ p.mat, }\DataTypeTok{sig.level =}\NormalTok{ significance_level, }\DataTypeTok{insig =} \StringTok{"blank"}\NormalTok{, }
         \CommentTok{# hide correlation coefficient on the principal diagonal}
         \DataTypeTok{diag=}\OtherTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-12-1.pdf}

Steiger's Z test

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#}

\NormalTok{lm1 <-}\StringTok{ }\KeywordTok{lm}\NormalTok{(x}\OperatorTok{$}\NormalTok{Artist_Popularity }\OperatorTok{~}\StringTok{ }\NormalTok{x}\OperatorTok{$}\NormalTok{Artist_Follower)}
\KeywordTok{summary}\NormalTok{(lm1)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## lm(formula = x$Artist_Popularity ~ x$Artist_Follower)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -39.796  -9.761   2.344  10.590  27.413 
## 
## Coefficients:
##                    Estimate Std. Error t value Pr(>|t|)    
## (Intercept)       6.268e+01  1.029e+00  60.900  < 2e-16 ***
## x$Artist_Follower 1.216e-06  1.491e-07   8.154  4.3e-14 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 13.72 on 194 degrees of freedom
## Multiple R-squared:  0.2552, Adjusted R-squared:  0.2514 
## F-statistic: 66.49 on 1 and 194 DF,  p-value: 4.298e-14
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{lm2 <-}\StringTok{ }\KeywordTok{lm}\NormalTok{(Artist_Popularity_trans }\OperatorTok{~}\StringTok{ }\NormalTok{Artist_Follower_trans)}
\KeywordTok{summary}\NormalTok{(lm2)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## lm(formula = Artist_Popularity_trans ~ Artist_Follower_trans)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -92.767 -23.106  -7.232  23.326 121.213 
## 
## Coefficients:
##                       Estimate Std. Error t value Pr(>|t|)    
## (Intercept)           -108.514     12.039  -9.014   <2e-16 ***
## Artist_Follower_trans   31.226      1.017  30.713   <2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 34.89 on 194 degrees of freedom
## Multiple R-squared:  0.8294, Adjusted R-squared:  0.8285 
## F-statistic: 943.3 on 1 and 194 DF,  p-value: < 2.2e-16
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfrow=}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{))}
\KeywordTok{plot}\NormalTok{(x}\OperatorTok{$}\NormalTok{Artist_Follower, x}\OperatorTok{$}\NormalTok{Artist_Popularity, }\DataTypeTok{main =} \KeywordTok{paste}\NormalTok{(}\StringTok{"Untransformed, R^2="}\NormalTok{, }\KeywordTok{round}\NormalTok{(}\KeywordTok{summary}\NormalTok{(lm1)}\OperatorTok{$}\NormalTok{r.squared, }\DataTypeTok{digits =}\DecValTok{2}\NormalTok{)), }\DataTypeTok{xlab =} \StringTok{"Artist_Follower"}\NormalTok{, }\DataTypeTok{ylab =} \StringTok{"Artist_Popularity"}\NormalTok{)}
\KeywordTok{plot}\NormalTok{(Artist_Follower_trans, Artist_Popularity_trans, }\DataTypeTok{main =} \KeywordTok{paste}\NormalTok{(}\StringTok{"Box-Cox transformed, R^2="}\NormalTok{, }\KeywordTok{round}\NormalTok{(}\KeywordTok{summary}\NormalTok{(lm2)}\OperatorTok{$}\NormalTok{r.squared, }\DataTypeTok{digits =}\DecValTok{2}\NormalTok{)), }\DataTypeTok{xlab =} \StringTok{"Artist_Follower"}\NormalTok{, }\DataTypeTok{ylab =} \StringTok{"Artist_Popularity"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-13-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{bivariate_df_base <-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(x}\OperatorTok{$}\NormalTok{Artist_Follower, x}\OperatorTok{$}\NormalTok{Artist_Popularity)}
\NormalTok{bivariate_df_bc <-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(Artist_Follower_trans, Artist_Popularity_trans)}

\KeywordTok{library}\NormalTok{(}\StringTok{"MVN"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Registered S3 method overwritten by 'GGally':
##   method from   
##   +.gg   ggplot2
\end{verbatim}

\begin{verbatim}
## sROC 0.1-2 loaded
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{MVN}\OperatorTok{::}\KeywordTok{mvn}\NormalTok{(bivariate_df_base, }\DataTypeTok{mvnTest =} \StringTok{"mardia"}\NormalTok{)}\OperatorTok{$}\NormalTok{multivariateNormality }\CommentTok{# Not jointly normal}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##              Test        Statistic               p value Result
## 1 Mardia Skewness 1064.24182004233 4.26236649364691e-229     NO
## 2 Mardia Kurtosis 69.9387062454922                     0     NO
## 3             MVN             <NA>                  <NA>     NO
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{MVN}\OperatorTok{::}\KeywordTok{mvn}\NormalTok{(bivariate_df_base, }\DataTypeTok{mvnTest =} \StringTok{"hz"}\NormalTok{)}\OperatorTok{$}\NormalTok{multivariateNormality }\CommentTok{# Not jointly normal}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##            Test       HZ p value MVN
## 1 Henze-Zirkler 22.14031       0  NO
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{MVN}\OperatorTok{::}\KeywordTok{mvn}\NormalTok{(bivariate_df_base, }\DataTypeTok{mvnTest =} \StringTok{"royston"}\NormalTok{)}\OperatorTok{$}\NormalTok{multivariateNormality }\CommentTok{# Not jointly normal}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##      Test        H      p value MVN
## 1 Royston 116.5077 5.152235e-26  NO
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{MVN}\OperatorTok{::}\KeywordTok{mvn}\NormalTok{(bivariate_df_base, }\DataTypeTok{mvnTest =} \StringTok{"energy"}\NormalTok{)}\OperatorTok{$}\NormalTok{multivariateNormality }\CommentTok{# Jointly normal}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##          Test Statistic p value MVN
## 1 E-statistic  -48.8541       1 YES
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{MVN}\OperatorTok{::}\KeywordTok{mvn}\NormalTok{(bivariate_df_bc, }\DataTypeTok{mvnTest =} \StringTok{"mardia"}\NormalTok{)}\OperatorTok{$}\NormalTok{multivariateNormality }\CommentTok{# Not jointly normal}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##              Test         Statistic              p value Result
## 1 Mardia Skewness  32.2845309272687 1.67329071040184e-06     NO
## 2 Mardia Kurtosis 0.652384359984547    0.514153251211866    YES
## 3             MVN              <NA>                 <NA>     NO
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{MVN}\OperatorTok{::}\KeywordTok{mvn}\NormalTok{(bivariate_df_bc, }\DataTypeTok{mvnTest =} \StringTok{"hz"}\NormalTok{)}\OperatorTok{$}\NormalTok{multivariateNormality }\CommentTok{# Not jointly normal}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##            Test       HZ      p value MVN
## 1 Henze-Zirkler 2.659756 2.618751e-06  NO
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{MVN}\OperatorTok{::}\KeywordTok{mvn}\NormalTok{(bivariate_df_bc, }\DataTypeTok{mvnTest =} \StringTok{"royston"}\NormalTok{)}\OperatorTok{$}\NormalTok{multivariateNormality }\CommentTok{# Not jointly normal}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##      Test        H    p value MVN
## 1 Royston 5.617594 0.03210878  NO
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{MVN}\OperatorTok{::}\KeywordTok{mvn}\NormalTok{(bivariate_df_bc, }\DataTypeTok{mvnTest =} \StringTok{"energy"}\NormalTok{)}\OperatorTok{$}\NormalTok{multivariateNormality }\CommentTok{# Jointly normal}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##          Test Statistic p value MVN
## 1 E-statistic   2.65097       0  NO
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{boxcox_df <-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(}\KeywordTok{matrix}\NormalTok{(}\KeywordTok{vector}\NormalTok{(), }\DataTypeTok{nrow =} \DecValTok{196}\NormalTok{, }\DataTypeTok{ncol =} \DecValTok{17}\NormalTok{))}
\NormalTok{boxcox_df}\OperatorTok{$}\NormalTok{Artist_Follower <-}\StringTok{ }\NormalTok{Artist_Follower_trans}
\NormalTok{boxcox_df}\OperatorTok{$}\NormalTok{Artist_Popularity <-}\StringTok{ }\NormalTok{Artist_Popularity_trans}
\NormalTok{boxcox_df}\OperatorTok{$}\NormalTok{Artist_Singles_Number <-}\StringTok{ }\NormalTok{Artist_Singles_Number_trans}
\NormalTok{boxcox_df}\OperatorTok{$}\NormalTok{Artist_Singles_Tracks_Number <-}\StringTok{ }\NormalTok{Artist_Singles_Tracks_Number_trans}
\NormalTok{boxcox_df}\OperatorTok{$}\NormalTok{Track_Duration_ms <-}\StringTok{ }\NormalTok{Track_Duration_ms_trans}
\NormalTok{boxcox_df}\OperatorTok{$}\NormalTok{Track_Popularity <-}\StringTok{ }\NormalTok{Track_Popularity_trans}
\NormalTok{boxcox_df}\OperatorTok{$}\NormalTok{acousticness <-}\StringTok{ }\NormalTok{acousticness_trans}
\NormalTok{boxcox_df}\OperatorTok{$}\NormalTok{danceability <-}\StringTok{ }\NormalTok{danceability_trans}
\NormalTok{boxcox_df}\OperatorTok{$}\NormalTok{energy <-}\StringTok{ }\NormalTok{energy_trans}
\NormalTok{boxcox_df}\OperatorTok{$}\NormalTok{instrumentalness <-}\StringTok{ }\NormalTok{instrumentalness_trans}
\NormalTok{boxcox_df}\OperatorTok{$}\NormalTok{liveness <-}\StringTok{ }\NormalTok{liveness_trans}
\NormalTok{boxcox_df}\OperatorTok{$}\NormalTok{loudness <-}\StringTok{ }\NormalTok{loudness_trans}
\NormalTok{boxcox_df}\OperatorTok{$}\NormalTok{speechiness <-}\StringTok{ }\NormalTok{speechiness_trans}
\NormalTok{boxcox_df}\OperatorTok{$}\NormalTok{tempo <-}\StringTok{ }\NormalTok{tempo_trans}
\NormalTok{boxcox_df}\OperatorTok{$}\NormalTok{valence <-}\StringTok{ }\NormalTok{valence_trans}
\NormalTok{boxcox_df}\OperatorTok{$}\NormalTok{likeCount <-}\StringTok{ }\NormalTok{likeCount_trans}
\NormalTok{boxcox_df}\OperatorTok{$}\NormalTok{viewsCount <-}\StringTok{ }\NormalTok{viewsCount_trans}

\NormalTok{drop.cols <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{'X1'}\NormalTok{, }\StringTok{'X2'}\NormalTok{, }\StringTok{'X3'}\NormalTok{, }\StringTok{'X4'}\NormalTok{, }\StringTok{'X5'}\NormalTok{, }\StringTok{'X6'}\NormalTok{, }\StringTok{'X7'}\NormalTok{, }\StringTok{'X8'}\NormalTok{, }\StringTok{'X9'}\NormalTok{, }\StringTok{'X10'}\NormalTok{, }\StringTok{'X11'}\NormalTok{, }\StringTok{'X12'}\NormalTok{, }\StringTok{'X13'}\NormalTok{, }\StringTok{'X14'}\NormalTok{, }\StringTok{'X15'}\NormalTok{, }\StringTok{'X16'}\NormalTok{, }\StringTok{'X17'}\NormalTok{)}

\NormalTok{boxcox_df <-}\StringTok{ }\NormalTok{dplyr}\OperatorTok{::}\KeywordTok{select}\NormalTok{(boxcox_df, }\OperatorTok{-}\KeywordTok{one_of}\NormalTok{(drop.cols))}

\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfrow=}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{))}

\NormalTok{palette <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{'red'}\NormalTok{, }\StringTok{'blue'}\NormalTok{, }\StringTok{'black'}\NormalTok{, }\StringTok{'purple'}\NormalTok{)}
\CommentTok{# palette <- rainbow(length(levels(as.factor(x$Genre))))}
\NormalTok{my_colors <-}\StringTok{ }\NormalTok{palette[}\KeywordTok{as.numeric}\NormalTok{(x}\OperatorTok{$}\NormalTok{Genre)]}

\KeywordTok{plot}\NormalTok{(Artist_Follower_trans, Artist_Popularity_trans, }\DataTypeTok{main =} \KeywordTok{paste}\NormalTok{(}\StringTok{"Box-Cox transformed, R^2="}\NormalTok{, }\KeywordTok{round}\NormalTok{(}\KeywordTok{summary}\NormalTok{(lm2)}\OperatorTok{$}\NormalTok{r.squared, }\DataTypeTok{digits =}\DecValTok{2}\NormalTok{)), }\DataTypeTok{xlab =} \StringTok{"Artist_Follower"}\NormalTok{, }\DataTypeTok{ylab =} \StringTok{"Artist_Popularity"}\NormalTok{, }\DataTypeTok{col =}\NormalTok{ my_colors, }\DataTypeTok{pch =} \DecValTok{16}\NormalTok{)}
\KeywordTok{legend}\NormalTok{(}\StringTok{"bottomright"}\NormalTok{, }\DataTypeTok{legend =} \KeywordTok{levels}\NormalTok{(}\KeywordTok{as.factor}\NormalTok{(x}\OperatorTok{$}\NormalTok{Genre)), }\DataTypeTok{col =}\NormalTok{ palette, }\DataTypeTok{pch =} \DecValTok{16}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-14-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(}\StringTok{"lattice"}\NormalTok{)}
\KeywordTok{xyplot}\NormalTok{(Artist_Popularity_trans}\OperatorTok{~}\NormalTok{Artist_Follower_trans}\OperatorTok{|}\NormalTok{x}\OperatorTok{$}\NormalTok{Genre, }\DataTypeTok{pch=}\DecValTok{19}\NormalTok{, }\DataTypeTok{xlab =} \StringTok{'viewsCount (transformed)'}\NormalTok{, }\DataTypeTok{ylab =} \StringTok{'Artist_Popularity (transformed)'}\NormalTok{, }\DataTypeTok{main =} \StringTok{"Biplot"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-14-2.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# pairs(boxcox_df)}

\NormalTok{sunflower_Artist_pop <-}\StringTok{ }\DecValTok{2}\OperatorTok{*}\KeywordTok{round}\NormalTok{(boxcox_df}\OperatorTok{$}\NormalTok{Artist_Popularity}\OperatorTok{/}\DecValTok{2}\NormalTok{)}
\NormalTok{sunflower_viewsCount  <-}\StringTok{ }\DecValTok{2}\OperatorTok{*}\KeywordTok{round}\NormalTok{(boxcox_df}\OperatorTok{$}\NormalTok{viewsCount}\OperatorTok{/}\DecValTok{2}\NormalTok{)}
\KeywordTok{sunflowerplot}\NormalTok{(sunflower_Artist_pop}\OperatorTok{~}\NormalTok{sunflower_viewsCount, }\DataTypeTok{xlab =} \StringTok{'viewsCount (transformed)'}\NormalTok{, }\DataTypeTok{ylab =} \StringTok{'Artist_Popularity (transformed)'}\NormalTok{, }\DataTypeTok{main =} \StringTok{'Sunflower plot'}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-14-3.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{require}\NormalTok{(}\StringTok{"MASS"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Loading required package: MASS
\end{verbatim}

\begin{verbatim}
## 
## Attaching package: 'MASS'
\end{verbatim}

\begin{verbatim}
## The following object is masked from 'package:dplyr':
## 
##     select
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{parcoord}\NormalTok{(boxcox_df, }\DataTypeTok{var.label =} \OtherTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-14-4.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#library("lattice")}
\CommentTok{#parallelplot(boxcox_df, horizontal.axis=T)}

\CommentTok{#library("ggplot2")}
\CommentTok{#library("GGally")}
\CommentTok{#ggparcoord(boxcox_df) + geom_line()}

\KeywordTok{library}\NormalTok{(}\StringTok{"andrews"}\NormalTok{)}
\KeywordTok{andrews}\NormalTok{(boxcox_df, }\DataTypeTok{ymax=}\DecValTok{7}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-14-5.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{audio_features <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{'acousticness'}\NormalTok{ , }\StringTok{'danceability'}\NormalTok{ ,}\StringTok{'energy'}\NormalTok{, }\StringTok{'instrumentalness'}\NormalTok{, }\StringTok{'liveness'}\NormalTok{, }\StringTok{'loudness'}\NormalTok{, }\StringTok{'speechiness'}\NormalTok{, }\StringTok{'tempo'}\NormalTok{, }\StringTok{'valence'}\NormalTok{)}

\NormalTok{selected_columns <-}\StringTok{ }\NormalTok{dplyr}\OperatorTok{::}\KeywordTok{select}\NormalTok{(boxcox_df, audio_features)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Note: Using an external vector in selections is ambiguous.
## i Use `all_of(audio_features)` instead of `audio_features` to silence this message.
## i See <https://tidyselect.r-lib.org/reference/faq-external-vector.html>.
## This message is displayed once per session.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{parcoord}\NormalTok{(selected_columns , }\DataTypeTok{col=}\NormalTok{ my_colors, }\DataTypeTok{var.label =} \OtherTok{FALSE}\NormalTok{, }\DataTypeTok{... =} \KeywordTok{par}\NormalTok{(}\DataTypeTok{las=}\DecValTok{2}\NormalTok{, }\DataTypeTok{mar =} \KeywordTok{c}\NormalTok{(}\DecValTok{8}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{3}\NormalTok{,}\DecValTok{1}\NormalTok{), }\DataTypeTok{xpd=}\OtherTok{TRUE}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning in plot.window(...): "..." ist kein Grafikparameter
\end{verbatim}

\begin{verbatim}
## Warning in plot.xy(xy, type, ...): "..." ist kein Grafikparameter
\end{verbatim}

\begin{verbatim}
## Warning in title(...): "..." ist kein Grafikparameter
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# title("Parallel coordinates", line = 0.6, adj = 0.1)}
\KeywordTok{legend}\NormalTok{(}\StringTok{"topright"}\NormalTok{, }\DataTypeTok{inset=}\KeywordTok{c}\NormalTok{(}\FloatTok{0.035}\NormalTok{,}\OperatorTok{-}\FloatTok{0.08}\NormalTok{),}\DataTypeTok{legend =} \KeywordTok{c}\NormalTok{(}\StringTok{'Classic'}\NormalTok{, }\StringTok{'Techno'}\NormalTok{, }\StringTok{'Pop'}\NormalTok{, }\StringTok{'Hip Hop'}\NormalTok{), }\DataTypeTok{col =} \KeywordTok{unique}\NormalTok{(my_colors),}
  \DataTypeTok{bty =} \StringTok{'o'}\NormalTok{, }\DataTypeTok{horiz =} \OtherTok{TRUE}\NormalTok{, }\DataTypeTok{pch =} \DecValTok{15}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-14-6.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ax <-}\StringTok{ }\NormalTok{selected_columns}
\NormalTok{ax}\OperatorTok{$}\NormalTok{clr <-}\StringTok{ }\NormalTok{x}\OperatorTok{$}\NormalTok{Genre}
\KeywordTok{andrews}\NormalTok{(ax, }\DataTypeTok{ymax=}\DecValTok{4}\NormalTok{, }\DataTypeTok{clr=}\DecValTok{10}\NormalTok{)}
\KeywordTok{legend}\NormalTok{(}\StringTok{"topright"}\NormalTok{,}\DataTypeTok{legend=}\KeywordTok{levels}\NormalTok{(ax}\OperatorTok{$}\NormalTok{clr), }\DataTypeTok{fill=}\KeywordTok{rainbow}\NormalTok{(}\KeywordTok{length}\NormalTok{(}\KeywordTok{levels}\NormalTok{(}\KeywordTok{as.factor}\NormalTok{(ax}\OperatorTok{$}\NormalTok{clr)))))}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-14-7.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(}\StringTok{"scagnostics"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Loading required package: rJava
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sub_df <-}\StringTok{ }\KeywordTok{as.data.frame}\NormalTok{(x[, var_list])}

\NormalTok{s <-}\StringTok{ }\KeywordTok{scagnostics}\NormalTok{(sub_df)}
\NormalTok{o <-}\StringTok{ }\KeywordTok{scagnosticsOutliers}\NormalTok{(s)}
\NormalTok{g <-}\StringTok{ }\KeywordTok{scagnosticsGrid}\NormalTok{(s)}

\NormalTok{go <-}\StringTok{ }\NormalTok{g[o,]}

\CommentTok{# Outliers: strongly different from the other plots}

\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfrow=}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{))}

\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\KeywordTok{nrow}\NormalTok{(go))\{}
\KeywordTok{plot}\NormalTok{(sub_df[[go[i,}\DecValTok{1}\NormalTok{]]], sub_df[[go[i,}\DecValTok{2}\NormalTok{]]], }\DataTypeTok{pch=}\DecValTok{19}\NormalTok{, }\DataTypeTok{xlab=}\KeywordTok{names}\NormalTok{(sub_df)[go[i,}\DecValTok{1}\NormalTok{]], }\DataTypeTok{ylab=}\KeywordTok{names}\NormalTok{(sub_df)[go[i,}\DecValTok{2}\NormalTok{]])}
\KeywordTok{print}\NormalTok{(}\KeywordTok{paste}\NormalTok{(}\StringTok{"Outlying pair: "}\NormalTok{, }\StringTok{"y="}\NormalTok{, }\KeywordTok{names}\NormalTok{(sub_df)[go[i,}\DecValTok{2}\NormalTok{]], }\StringTok{"x="}\NormalTok{, }\KeywordTok{names}\NormalTok{(sub_df)[go[i,}\DecValTok{1}\NormalTok{]]))\}}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-14-8.pdf}

\begin{verbatim}
## [1] "Outlying pair:  y= Artist_Compilations_Number x= Artist_Albums_Number"
\end{verbatim}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-14-9.pdf}

\begin{verbatim}
## [1] "Outlying pair:  y= Artist_Compilations_Number x= Artist_Albums_Tracks_Number"
\end{verbatim}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-14-10.pdf}

\begin{verbatim}
## [1] "Outlying pair:  y= Artist_Compilations_Tracks_Number x= Artist_Albums_Number"
\end{verbatim}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-14-11.pdf}

\begin{verbatim}
## [1] "Outlying pair:  y= Artist_Compilations_Tracks_Number x= Artist_Compilations_Number"
\end{verbatim}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-14-12.pdf}

\begin{verbatim}
## [1] "Outlying pair:  y= Artist_Popularity x= Artist_Follower"
\end{verbatim}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-14-13.pdf}

\begin{verbatim}
## [1] "Outlying pair:  y= Artist_Singles_Number x= Artist_Albums_Number"
\end{verbatim}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-14-14.pdf}

\begin{verbatim}
## [1] "Outlying pair:  y= Artist_Singles_Number x= Artist_Compilations_Tracks_Number"
\end{verbatim}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-14-15.pdf}

\begin{verbatim}
## [1] "Outlying pair:  y= Artist_Singles_Tracks_Number x= Artist_Compilations_Tracks_Number"
\end{verbatim}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-14-16.pdf}

\begin{verbatim}
## [1] "Outlying pair:  y= Artist_Singles_Tracks_Number x= Artist_Singles_Number"
\end{verbatim}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-14-17.pdf}

\begin{verbatim}
## [1] "Outlying pair:  y= instrumentalness x= Track_Duration_ms"
\end{verbatim}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-14-18.pdf}

\begin{verbatim}
## [1] "Outlying pair:  y= loudness x= Artist_Albums_Tracks_Number"
\end{verbatim}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-14-19.pdf}

\begin{verbatim}
## [1] "Outlying pair:  y= valence x= instrumentalness"
\end{verbatim}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-14-20.pdf}

\begin{verbatim}
## [1] "Outlying pair:  y= dislikeCount x= Artist_Follower"
\end{verbatim}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-14-21.pdf}

\begin{verbatim}
## [1] "Outlying pair:  y= likeCount x= Artist_Follower"
\end{verbatim}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-14-22.pdf}

\begin{verbatim}
## [1] "Outlying pair:  y= likeCount x= commentCount"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Highlights:}

\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfrow=}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{))}
\KeywordTok{plot}\NormalTok{(x}\OperatorTok{$}\NormalTok{Track_Duration_ms, x}\OperatorTok{$}\NormalTok{instrumentalness, }\DataTypeTok{col =}\NormalTok{ my_colors, }\DataTypeTok{pch =} \DecValTok{16}\NormalTok{, }\DataTypeTok{xlab =} \StringTok{'Track_Duration_ms'}\NormalTok{, }\DataTypeTok{ylab =} \StringTok{'instrumentalness'}\NormalTok{)}
\KeywordTok{plot}\NormalTok{(x}\OperatorTok{$}\NormalTok{instrumentalness, x}\OperatorTok{$}\NormalTok{valence, }\DataTypeTok{col =}\NormalTok{ my_colors, }\DataTypeTok{pch =} \DecValTok{16}\NormalTok{,  }\DataTypeTok{xlab =} \StringTok{'instrumentalness'}\NormalTok{, }\DataTypeTok{ylab =} \StringTok{'valence'}\NormalTok{)}
\KeywordTok{legend}\NormalTok{(}\DataTypeTok{x=}\OperatorTok{-}\DecValTok{1300}\NormalTok{, }\DataTypeTok{y=}\DecValTok{1250}\NormalTok{, }\DataTypeTok{legend =} \KeywordTok{levels}\NormalTok{(}\KeywordTok{as.factor}\NormalTok{(x}\OperatorTok{$}\NormalTok{Genre)), }\DataTypeTok{col =}\NormalTok{ palette, }\DataTypeTok{pch =} \DecValTok{16}\NormalTok{, }\DataTypeTok{horiz =} \OtherTok{TRUE}\NormalTok{, }\DataTypeTok{xpd =} \OtherTok{NA}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-14-23.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Exemplars: group of similar plots}

\NormalTok{e <-}\StringTok{ }\KeywordTok{scagnosticsExemplars}\NormalTok{(s)}

\NormalTok{ge <-}\StringTok{ }\NormalTok{g[e,]}

\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfrow =} \KeywordTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{))}

\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\KeywordTok{dim}\NormalTok{(ge)[}\DecValTok{1}\NormalTok{])\{}
  \KeywordTok{plot}\NormalTok{(sub_df[[ge}\OperatorTok{$}\NormalTok{x[i]]], sub_df[[ge}\OperatorTok{$}\NormalTok{y[i]]], }\DataTypeTok{pch=}\DecValTok{19}\NormalTok{,}
  \DataTypeTok{xlab=}\KeywordTok{names}\NormalTok{(sub_df)[ge}\OperatorTok{$}\NormalTok{x[i]], }\DataTypeTok{ylab=}\KeywordTok{names}\NormalTok{(sub_df)[ge}\OperatorTok{$}\NormalTok{y[i]])}
  \KeywordTok{print}\NormalTok{(}\KeywordTok{paste}\NormalTok{(}\StringTok{"Exemplary pair: "}\NormalTok{, }\StringTok{"y="}\NormalTok{, }\KeywordTok{names}\NormalTok{(sub_df)[ge}\OperatorTok{$}\NormalTok{y[i]], }\StringTok{"x="}\NormalTok{, }\KeywordTok{names}\NormalTok{(sub_df)[ge}\OperatorTok{$}\NormalTok{x[i]]))}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Exemplary pair:  y= Track_Popularity x= Artist_Appearances_Tracks_Number"
\end{verbatim}

\begin{verbatim}
## [1] "Exemplary pair:  y= energy x= Artist_Albums_Tracks_Number"
\end{verbatim}

\begin{verbatim}
## [1] "Exemplary pair:  y= likeCount x= Artist_Appearances_Number"
\end{verbatim}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-14-24.pdf}

\begin{verbatim}
## [1] "Exemplary pair:  y= viewsCount x= tempo"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{table}\NormalTok{(x}\OperatorTok{$}\NormalTok{Genre)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Classic Hip Hop     Pop  Techno 
##      49      50      50      47
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x}\OperatorTok{$}\NormalTok{Artist_Popularity_quantile <-}\StringTok{ }\DecValTok{0}

\NormalTok{Artist_Popularity_quantiles <-}\StringTok{ }\KeywordTok{quantile}\NormalTok{(x}\OperatorTok{$}\NormalTok{Artist_Popularity, }\DataTypeTok{probs =} \KeywordTok{c}\NormalTok{(}\FloatTok{0.25}\NormalTok{, }\FloatTok{0.5}\NormalTok{, }\FloatTok{0.75}\NormalTok{))}

\NormalTok{Artist_Pop_q_}\DecValTok{25}\NormalTok{ <-}\StringTok{ }\NormalTok{Artist_Popularity_quantiles[}\DecValTok{1}\NormalTok{]}
\NormalTok{Artist_Pop_median <-}\StringTok{ }\NormalTok{Artist_Popularity_quantiles[}\DecValTok{2}\NormalTok{]}
\NormalTok{Artist_Pop_q_}\DecValTok{75}\NormalTok{ <-}\StringTok{ }\NormalTok{Artist_Popularity_quantiles[}\DecValTok{3}\NormalTok{]}

\NormalTok{x}\OperatorTok{$}\NormalTok{Artist_Popularity_quantile <-}\StringTok{ }\KeywordTok{ifelse}\NormalTok{(x}\OperatorTok{$}\NormalTok{Artist_Popularity }\OperatorTok{<}\StringTok{ }\NormalTok{Artist_Pop_q_}\DecValTok{25}\NormalTok{, }\DecValTok{1}\NormalTok{, x}\OperatorTok{$}\NormalTok{Artist_Popularity_quantile }\OperatorTok{+}\StringTok{ }\DecValTok{0}\NormalTok{)}

\NormalTok{x}\OperatorTok{$}\NormalTok{Artist_Popularity_quantile <-}\StringTok{ }\KeywordTok{ifelse}\NormalTok{(((x}\OperatorTok{$}\NormalTok{Artist_Popularity }\OperatorTok{>=}\StringTok{ }\NormalTok{Artist_Pop_q_}\DecValTok{25}\NormalTok{) }\OperatorTok{&}\StringTok{ }\NormalTok{(x}\OperatorTok{$}\NormalTok{Artist_Popularity }\OperatorTok{<}\StringTok{ }\NormalTok{Artist_Pop_median)), }\DecValTok{2}\NormalTok{, x}\OperatorTok{$}\NormalTok{Artist_Popularity_quantile }\OperatorTok{+}\StringTok{ }\DecValTok{0}\NormalTok{)}

\NormalTok{x}\OperatorTok{$}\NormalTok{Artist_Popularity_quantile <-}\StringTok{ }\KeywordTok{ifelse}\NormalTok{(((x}\OperatorTok{$}\NormalTok{Artist_Popularity }\OperatorTok{>=}\StringTok{ }\NormalTok{Artist_Pop_median) }\OperatorTok{&}\StringTok{ }\NormalTok{(x}\OperatorTok{$}\NormalTok{Artist_Popularity }\OperatorTok{<}\StringTok{ }\NormalTok{Artist_Pop_q_}\DecValTok{75}\NormalTok{)), }\DecValTok{3}\NormalTok{, x}\OperatorTok{$}\NormalTok{Artist_Popularity_quantile }\OperatorTok{+}\StringTok{ }\DecValTok{0}\NormalTok{)}

\NormalTok{x}\OperatorTok{$}\NormalTok{Artist_Popularity_quantile <-}\StringTok{ }\KeywordTok{ifelse}\NormalTok{((x}\OperatorTok{$}\NormalTok{Artist_Popularity }\OperatorTok{>=}\StringTok{ }\NormalTok{Artist_Pop_q_}\DecValTok{75}\NormalTok{), }\DecValTok{4}\NormalTok{, x}\OperatorTok{$}\NormalTok{Artist_Popularity_quantile }\OperatorTok{+}\StringTok{ }\DecValTok{0}\NormalTok{)}
\NormalTok{x}\OperatorTok{$}\NormalTok{Artist_Popularity_quantile <-}\StringTok{ }\KeywordTok{as.factor}\NormalTok{(x}\OperatorTok{$}\NormalTok{Artist_Popularity_quantile)}

\NormalTok{tab<-}\KeywordTok{table}\NormalTok{(x}\OperatorTok{$}\NormalTok{Genre, x}\OperatorTok{$}\NormalTok{Artist_Popularity_quantile)}
\NormalTok{tab}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##          
##            1  2  3  4
##   Classic  9 21 13  6
##   Hip Hop  0  8 25 17
##   Pop      1  8 10 31
##   Techno  37 10  0  0
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# r = 4, c = 4}
\CommentTok{#df = (r-1)*(c-1) = 3+3 = 9}
\CommentTok{# critical value: 16.919}


\KeywordTok{chisq.test}\NormalTok{(tab)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##  Pearson's Chi-squared test
## 
## data:  tab
## X-squared = 156.23, df = 9, p-value < 2.2e-16
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{chisq.test}\NormalTok{(tab, }\DataTypeTok{simulate.p.value =} \OtherTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##  Pearson's Chi-squared test with simulated p-value (based on 2000
##  replicates)
## 
## data:  tab
## X-squared = 156.23, df = NA, p-value = 0.0004998
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(}\StringTok{"vcd"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Loading required package: grid
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{assocstats}\NormalTok{(tab)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##                     X^2 df P(> X^2)
## Likelihood Ratio 168.67  9        0
## Pearson          156.23  9        0
## 
## Phi-Coefficient   : NA 
## Contingency Coeff.: 0.666 
## Cramer's V        : 0.515
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#library("openintro")}

\CommentTok{#contTable(tab)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x}\OperatorTok{$}\NormalTok{viewsCount_quantile <-}\StringTok{ }\DecValTok{0}

\NormalTok{viewsCount_quantiles <-}\StringTok{ }\KeywordTok{quantile}\NormalTok{(x}\OperatorTok{$}\NormalTok{viewsCount, }\DataTypeTok{probs =} \KeywordTok{c}\NormalTok{(}\FloatTok{0.25}\NormalTok{, }\FloatTok{0.5}\NormalTok{, }\FloatTok{0.75}\NormalTok{))}

\NormalTok{viewsCount_q_}\DecValTok{25}\NormalTok{ <-}\StringTok{ }\NormalTok{viewsCount_quantiles[}\DecValTok{1}\NormalTok{]}
\NormalTok{viewsCount_median <-}\StringTok{ }\NormalTok{viewsCount_quantiles[}\DecValTok{2}\NormalTok{]}
\NormalTok{viewsCount_q_}\DecValTok{75}\NormalTok{ <-}\StringTok{ }\NormalTok{viewsCount_quantiles[}\DecValTok{3}\NormalTok{]}

\NormalTok{x}\OperatorTok{$}\NormalTok{viewsCount_quantile <-}\StringTok{ }\KeywordTok{ifelse}\NormalTok{(x}\OperatorTok{$}\NormalTok{viewsCount }\OperatorTok{<}\StringTok{ }\NormalTok{viewsCount_q_}\DecValTok{25}\NormalTok{, }\DecValTok{1}\NormalTok{, x}\OperatorTok{$}\NormalTok{viewsCount_quantile }\OperatorTok{+}\StringTok{ }\DecValTok{0}\NormalTok{)}

\NormalTok{x}\OperatorTok{$}\NormalTok{viewsCount_quantile <-}\StringTok{ }\KeywordTok{ifelse}\NormalTok{(((x}\OperatorTok{$}\NormalTok{viewsCount }\OperatorTok{>=}\StringTok{ }\NormalTok{viewsCount_q_}\DecValTok{25}\NormalTok{) }\OperatorTok{&}\StringTok{ }\NormalTok{(x}\OperatorTok{$}\NormalTok{viewsCount }\OperatorTok{<}\StringTok{ }\NormalTok{viewsCount_median)), }\DecValTok{2}\NormalTok{, x}\OperatorTok{$}\NormalTok{viewsCount_quantile }\OperatorTok{+}\StringTok{ }\DecValTok{0}\NormalTok{)}

\NormalTok{x}\OperatorTok{$}\NormalTok{viewsCount_quantile <-}\StringTok{ }\KeywordTok{ifelse}\NormalTok{(((x}\OperatorTok{$}\NormalTok{viewsCount }\OperatorTok{>=}\StringTok{ }\NormalTok{viewsCount_median) }\OperatorTok{&}\StringTok{ }\NormalTok{(x}\OperatorTok{$}\NormalTok{viewsCount }\OperatorTok{<}\StringTok{ }\NormalTok{viewsCount_q_}\DecValTok{75}\NormalTok{)), }\DecValTok{3}\NormalTok{, x}\OperatorTok{$}\NormalTok{viewsCount_quantile }\OperatorTok{+}\StringTok{ }\DecValTok{0}\NormalTok{)}

\NormalTok{x}\OperatorTok{$}\NormalTok{viewsCount_quantile <-}\StringTok{ }\KeywordTok{ifelse}\NormalTok{((x}\OperatorTok{$}\NormalTok{viewsCount }\OperatorTok{>=}\StringTok{ }\NormalTok{viewsCount_q_}\DecValTok{75}\NormalTok{), }\DecValTok{4}\NormalTok{, x}\OperatorTok{$}\NormalTok{viewsCount_quantile }\OperatorTok{+}\StringTok{ }\DecValTok{0}\NormalTok{)}
\NormalTok{x}\OperatorTok{$}\NormalTok{viewsCount_quantile <-}\StringTok{ }\KeywordTok{as.factor}\NormalTok{(x}\OperatorTok{$}\NormalTok{viewsCount_quantile)}


\NormalTok{tab<-}\KeywordTok{table}\NormalTok{(x}\OperatorTok{$}\NormalTok{viewsCount_quantile, x}\OperatorTok{$}\NormalTok{Artist_Popularity_quantile)}
\NormalTok{tab}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    
##      1  2  3  4
##   1 36  6  4  3
##   2 10 19 12  8
##   3  1 18 19 11
##   4  0  4 13 32
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{chisq.test}\NormalTok{(tab)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##  Pearson's Chi-squared test
## 
## data:  tab
## X-squared = 133.34, df = 9, p-value < 2.2e-16
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{chisq.test}\NormalTok{(tab, }\DataTypeTok{simulate.p.value =} \OtherTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##  Pearson's Chi-squared test with simulated p-value (based on 2000
##  replicates)
## 
## data:  tab
## X-squared = 133.34, df = NA, p-value = 0.0004998
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(}\StringTok{"vcd"}\NormalTok{)}
\KeywordTok{assocstats}\NormalTok{(tab)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##                     X^2 df P(> X^2)
## Likelihood Ratio 133.48  9        0
## Pearson          133.34  9        0
## 
## Phi-Coefficient   : NA 
## Contingency Coeff.: 0.636 
## Cramer's V        : 0.476
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#contTable(tab)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ab2 <-}\StringTok{ }\KeywordTok{na.omit}\NormalTok{(}\KeywordTok{cbind}\NormalTok{(x}\OperatorTok{$}\NormalTok{Artist_Popularity_quantile, x}\OperatorTok{$}\NormalTok{viewsCount_quantile))}
\KeywordTok{nrow}\NormalTok{(ab2)}\OperatorTok{*}\NormalTok{(}\KeywordTok{nrow}\NormalTok{(ab2)}\OperatorTok{-}\DecValTok{1}\NormalTok{)}\OperatorTok{/}\DecValTok{2}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 19110
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#}
\NormalTok{ind <-}\StringTok{ }\KeywordTok{order}\NormalTok{(ab2[,}\DecValTok{1}\NormalTok{], ab2[,}\DecValTok{2}\NormalTok{])}
\NormalTok{ab2 <-}\StringTok{ }\NormalTok{ab2[ind,]}
\CommentTok{#b}
\NormalTok{C <-}\StringTok{ }\NormalTok{D <-}\StringTok{ }\NormalTok{Tx <-}\StringTok{ }\NormalTok{Ty <-}\StringTok{ }\NormalTok{Txy <-}\StringTok{ }\DecValTok{0}
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\NormalTok{(}\KeywordTok{nrow}\NormalTok{(ab2)}\OperatorTok{-}\DecValTok{1}\NormalTok{)) \{}
  \ControlFlowTok{if}\NormalTok{ (i}\OperatorTok{%%}\DecValTok{100}\OperatorTok{==}\DecValTok{0}\NormalTok{) }\KeywordTok{cat}\NormalTok{(i, }\StringTok{"}\CharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
  \ControlFlowTok{for}\NormalTok{(j }\ControlFlowTok{in}\NormalTok{ (i}\OperatorTok{+}\DecValTok{1}\NormalTok{)}\OperatorTok{:}\KeywordTok{nrow}\NormalTok{(ab2)) \{}
    \ControlFlowTok{if}\NormalTok{ (ab2[i,}\DecValTok{1}\NormalTok{]}\OperatorTok{==}\NormalTok{ab2[j,}\DecValTok{1}\NormalTok{]) \{}
      \ControlFlowTok{if}\NormalTok{ (ab2[i,}\DecValTok{2}\NormalTok{]}\OperatorTok{==}\NormalTok{ab2[j,}\DecValTok{2}\NormalTok{]) \{}
\NormalTok{        Txy <-}\StringTok{ }\NormalTok{Txy}\OperatorTok{+}\DecValTok{1}
\NormalTok{      \} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{        Tx <-}\StringTok{ }\NormalTok{Tx}\OperatorTok{+}\NormalTok{(ab2[i,}\DecValTok{2}\NormalTok{]}\OperatorTok{<}\NormalTok{ab2[j,}\DecValTok{2}\NormalTok{])}
\NormalTok{      \}}
\NormalTok{    \} }\ControlFlowTok{else}\NormalTok{ \{   }
      \ControlFlowTok{if}\NormalTok{ (ab2[i,}\DecValTok{2}\NormalTok{]}\OperatorTok{==}\NormalTok{ab2[j,}\DecValTok{2}\NormalTok{]) Ty <-}\StringTok{ }\NormalTok{Ty}\OperatorTok{+}\DecValTok{1}
      \ControlFlowTok{if}\NormalTok{ (ab2[i,}\DecValTok{2}\NormalTok{]}\OperatorTok{<}\NormalTok{ab2[j,}\DecValTok{2}\NormalTok{]) C <-}\StringTok{ }\NormalTok{C}\OperatorTok{+}\DecValTok{1}
      \ControlFlowTok{if}\NormalTok{ (ab2[i,}\DecValTok{2}\NormalTok{]}\OperatorTok{>}\NormalTok{ab2[j,}\DecValTok{2}\NormalTok{]) D <-}\StringTok{ }\NormalTok{D}\OperatorTok{+}\DecValTok{1}
\NormalTok{    \}}
\NormalTok{  \}}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 100
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{c}\NormalTok{(}\DataTypeTok{C=}\NormalTok{C, }\DataTypeTok{D=}\NormalTok{D, }\DataTypeTok{Tx=}\NormalTok{Tx, }\DataTypeTok{Ty=}\NormalTok{Ty, }\DataTypeTok{Txy=}\NormalTok{Txy)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##     C     D    Tx    Ty   Txy 
## 10048  1560  2798  2781  1923
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{k_t <-}\StringTok{ }\NormalTok{(C }\OperatorTok{-}\StringTok{ }\NormalTok{D)}\OperatorTok{/}\NormalTok{(}\KeywordTok{nrow}\NormalTok{(ab2)}\OperatorTok{*}\NormalTok{(}\KeywordTok{nrow}\NormalTok{(ab2)}\OperatorTok{-}\DecValTok{1}\NormalTok{)}\OperatorTok{/}\DecValTok{2}\NormalTok{)}
\NormalTok{k_t }\CommentTok{# (without ties)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.4441654
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(}\StringTok{"ryouready"}\NormalTok{)}
\KeywordTok{ord.tau}\NormalTok{(}\KeywordTok{table}\NormalTok{(ab2[,}\DecValTok{1}\NormalTok{], ab2[,}\DecValTok{2}\NormalTok{]))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Kendall's (and Stuart's) Tau statistics
##  Tau-b: 0.590
##  Tau-c: 0.589
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{cor}\NormalTok{(}\KeywordTok{as.numeric}\NormalTok{(x}\OperatorTok{$}\NormalTok{Artist_Popularity_quantile), }\KeywordTok{as.numeric}\NormalTok{(x}\OperatorTok{$}\NormalTok{viewsCount_quantile), }\DataTypeTok{method =} \StringTok{"kendall"}\NormalTok{) }\CommentTok{# identical result}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.5895469
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{cor.test}\NormalTok{(}\KeywordTok{as.numeric}\NormalTok{(x}\OperatorTok{$}\NormalTok{Artist_Popularity_quantile), }\KeywordTok{as.numeric}\NormalTok{(x}\OperatorTok{$}\NormalTok{viewsCount_quantile), }\DataTypeTok{method=}\StringTok{"kendall"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##  Kendall's rank correlation tau
## 
## data:  as.numeric(x$Artist_Popularity_quantile) and as.numeric(x$viewsCount_quantile)
## z = 9.8748, p-value < 2.2e-16
## alternative hypothesis: true tau is not equal to 0
## sample estimates:
##       tau 
## 0.5895469
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{modetab <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(x, }\DataTypeTok{margin=}\DecValTok{0}\NormalTok{) \{ }
  \ControlFlowTok{if}\NormalTok{ (margin}\OperatorTok{>}\DecValTok{0}\NormalTok{) }\KeywordTok{apply}\NormalTok{(x, margin, max) }\ControlFlowTok{else} \KeywordTok{max}\NormalTok{(x) }
\NormalTok{\}}

\NormalTok{tab2 <-}\StringTok{ }\KeywordTok{table}\NormalTok{(x}\OperatorTok{$}\NormalTok{Artist_Popularity_quantile, }
\NormalTok{              x}\OperatorTok{$}\NormalTok{Genre, }\DataTypeTok{dnn =} \KeywordTok{c}\NormalTok{(}\StringTok{"Artist Popularity quantile"}\NormalTok{, }\StringTok{"Genre"}\NormalTok{))}

\NormalTok{tab2}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##                           Genre
## Artist Popularity quantile Classic Hip Hop Pop Techno
##                          1       9       0   1     37
##                          2      21       8   8     10
##                          3      13      25  10      0
##                          4       6      17  31      0
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# contTable(tab2)}


\NormalTok{tab <-}\StringTok{ }\KeywordTok{rowSums}\NormalTok{(tab2)}

\KeywordTok{message}\NormalTok{(}\KeywordTok{paste}\NormalTok{(}\StringTok{"The mode across all four quantiles of stream distribution is"}\NormalTok{, }\KeywordTok{modetab}\NormalTok{(tab), }\StringTok{" and is in the 4th quantile. So the best prediction for a new artist without further knowledge is that she will fall in the top quantile of the popularity distribution."}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## The mode across all four quantiles of stream distribution is 54  and is in the 4th quantile. So the best prediction for a new artist without further knowledge is that she will fall in the top quantile of the popularity distribution.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{e1_streams <-}\StringTok{ }\KeywordTok{sum}\NormalTok{(tab) }\OperatorTok{-}\StringTok{ }\KeywordTok{modetab}\NormalTok{(tab)}

\KeywordTok{message}\NormalTok{(}\KeywordTok{paste}\NormalTok{(}\StringTok{"Without any knowledge about an additional feature other than artist popularity quantile itself and using the mode across classes as best predictor for class assignment for a new observation, the number of falsely predicted cases would be: "}\NormalTok{, e1_streams, }\StringTok{" or "}\NormalTok{, e1_streams}\OperatorTok{/}\KeywordTok{sum}\NormalTok{(tab)}\OperatorTok{*}\DecValTok{100}\NormalTok{, }\StringTok{"%."}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Without any knowledge about an additional feature other than artist popularity quantile itself and using the mode across classes as best predictor for class assignment for a new observation, the number of falsely predicted cases would be:  142  or  72.4489795918367 %.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{e2_streams <-}\StringTok{ }\KeywordTok{sum}\NormalTok{(tab2) }\OperatorTok{-}\StringTok{ }\KeywordTok{sum}\NormalTok{(}\KeywordTok{modetab}\NormalTok{(tab2, }\DecValTok{2}\NormalTok{))}

\KeywordTok{message}\NormalTok{(}\KeywordTok{paste}\NormalTok{(}\StringTok{"Now having knowledge about an association between artist popularity and its genre and using class-internal modes for the additional feature, the number of falsely predicted cases would be: "}\NormalTok{, e2_streams, }\StringTok{" or "}\NormalTok{, e2_streams}\OperatorTok{/}\KeywordTok{sum}\NormalTok{(tab)}\OperatorTok{*}\DecValTok{100}\NormalTok{, }\StringTok{"%, which is already much lower compared to the error rate from predicting without any knowledge about an association. On the other hand, "}\NormalTok{, }\KeywordTok{sum}\NormalTok{(tab2)}\OperatorTok{-}\NormalTok{e2_streams, }\StringTok{" or "}\NormalTok{, (}\KeywordTok{sum}\NormalTok{(tab2)}\OperatorTok{-}\NormalTok{e2_streams)}\OperatorTok{/}\KeywordTok{sum}\NormalTok{(tab2)}\OperatorTok{*}\DecValTok{100}\NormalTok{, }\StringTok{"% would have been predicted correctly (compared to "}\NormalTok{, (}\DecValTok{1}\OperatorTok{-}\NormalTok{e1_streams}\OperatorTok{/}\KeywordTok{sum}\NormalTok{(tab))}\OperatorTok{*}\DecValTok{100}\NormalTok{, }\StringTok{"% if there was no knowledge about genre.)"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Now having knowledge about an association between artist popularity and its genre and using class-internal modes for the additional feature, the number of falsely predicted cases would be:  82  or  41.8367346938776 %, which is already much lower compared to the error rate from predicting without any knowledge about an association. On the other hand,  114  or  58.1632653061224 % would have been predicted correctly (compared to  27.5510204081633 % if there was no knowledge about genre.)
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{lambda <-}\StringTok{ }\NormalTok{(e1_streams }\OperatorTok{-}\StringTok{ }\NormalTok{e2_streams)}\OperatorTok{/}\NormalTok{e1_streams}

\KeywordTok{message}\NormalTok{(}\KeywordTok{paste}\NormalTok{(}\StringTok{"Therefore, Goodmann and Kruskals Lambda is: "}\NormalTok{, lambda))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Therefore, Goodmann and Kruskals Lambda is:  0.422535211267606
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(}\StringTok{"ryouready"}\NormalTok{)}

\KeywordTok{nom.lambda}\NormalTok{(tab2)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Lambda:
##  Columns dependent: 0.438 
##  Rows dependent: 0.423 
##  Symmetric: 0.431
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{modetab <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(x, }\DataTypeTok{margin=}\DecValTok{0}\NormalTok{) \{ }
  \ControlFlowTok{if}\NormalTok{ (margin}\OperatorTok{>}\DecValTok{0}\NormalTok{) }\KeywordTok{apply}\NormalTok{(x, margin, max) }\ControlFlowTok{else} \KeywordTok{max}\NormalTok{(x) }
\NormalTok{\}}

\NormalTok{tab2 <-}\StringTok{ }\KeywordTok{table}\NormalTok{(x}\OperatorTok{$}\NormalTok{Artist_Popularity_quantile, }
\NormalTok{              x}\OperatorTok{$}\NormalTok{viewsCount_quantile, }\DataTypeTok{dnn =} \KeywordTok{c}\NormalTok{(}\StringTok{"Artist Popularity quantile"}\NormalTok{, }\StringTok{"viewsCount quantile"}\NormalTok{))}

\NormalTok{tab2}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##                           viewsCount quantile
## Artist Popularity quantile  1  2  3  4
##                          1 36 10  1  0
##                          2  6 19 18  4
##                          3  4 12 19 13
##                          4  3  8 11 32
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tab <-}\StringTok{ }\KeywordTok{rowSums}\NormalTok{(tab2)}

\KeywordTok{message}\NormalTok{(}\KeywordTok{paste}\NormalTok{(}\StringTok{"The mode across all four quantiles of stream distribution is"}\NormalTok{, }\KeywordTok{modetab}\NormalTok{(tab), }\StringTok{" and is in the 4th quantile. So the best prediction for a new artist without further knowledge is that she will fall in the top quantile of the popularity distribution."}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## The mode across all four quantiles of stream distribution is 54  and is in the 4th quantile. So the best prediction for a new artist without further knowledge is that she will fall in the top quantile of the popularity distribution.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{e1_streams <-}\StringTok{ }\KeywordTok{sum}\NormalTok{(tab) }\OperatorTok{-}\StringTok{ }\KeywordTok{modetab}\NormalTok{(tab)}

\KeywordTok{message}\NormalTok{(}\KeywordTok{paste}\NormalTok{(}\StringTok{"Without any knowledge about an additional feature other than artist popularity quantile itself and using the mode across classes as best predictor for class assignment for a new observation, the number of falsely predicted cases would be: "}\NormalTok{, e1_streams, }\StringTok{" or "}\NormalTok{, e1_streams}\OperatorTok{/}\KeywordTok{sum}\NormalTok{(tab)}\OperatorTok{*}\DecValTok{100}\NormalTok{, }\StringTok{"%."}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Without any knowledge about an additional feature other than artist popularity quantile itself and using the mode across classes as best predictor for class assignment for a new observation, the number of falsely predicted cases would be:  142  or  72.4489795918367 %.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{e2_streams <-}\StringTok{ }\KeywordTok{sum}\NormalTok{(tab2) }\OperatorTok{-}\StringTok{ }\KeywordTok{sum}\NormalTok{(}\KeywordTok{modetab}\NormalTok{(tab2, }\DecValTok{2}\NormalTok{))}

\KeywordTok{message}\NormalTok{(}\KeywordTok{paste}\NormalTok{(}\StringTok{"Now having knowledge about an association between artist popularity and its viewsCount quantile and using class-internal modes for the additional feature, the number of falsely predicted cases would be: "}\NormalTok{, e2_streams, }\StringTok{" or "}\NormalTok{, e2_streams}\OperatorTok{/}\KeywordTok{sum}\NormalTok{(tab)}\OperatorTok{*}\DecValTok{100}\NormalTok{, }\StringTok{"%, which is already much lower compared to the error rate from predicting without any knowledge about an association. On the other hand, "}\NormalTok{, }\KeywordTok{sum}\NormalTok{(tab2)}\OperatorTok{-}\NormalTok{e2_streams, }\StringTok{" or "}\NormalTok{, (}\KeywordTok{sum}\NormalTok{(tab2)}\OperatorTok{-}\NormalTok{e2_streams)}\OperatorTok{/}\KeywordTok{sum}\NormalTok{(tab2)}\OperatorTok{*}\DecValTok{100}\NormalTok{, }\StringTok{"% would have been predicted correctly (compared to "}\NormalTok{, (}\DecValTok{1}\OperatorTok{-}\NormalTok{e1_streams}\OperatorTok{/}\KeywordTok{sum}\NormalTok{(tab))}\OperatorTok{*}\DecValTok{100}\NormalTok{, }\StringTok{"% if there was no knowledge about viewsCount quantile.)"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Now having knowledge about an association between artist popularity and its viewsCount quantile and using class-internal modes for the additional feature, the number of falsely predicted cases would be:  90  or  45.9183673469388 %, which is already much lower compared to the error rate from predicting without any knowledge about an association. On the other hand,  106  or  54.0816326530612 % would have been predicted correctly (compared to  27.5510204081633 % if there was no knowledge about viewsCount quantile.)
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{lambda <-}\StringTok{ }\NormalTok{(e1_streams }\OperatorTok{-}\StringTok{ }\NormalTok{e2_streams)}\OperatorTok{/}\NormalTok{e1_streams}

\KeywordTok{message}\NormalTok{(}\KeywordTok{paste}\NormalTok{(}\StringTok{"Therefore, Goodmann and Kruskals Lambda is: "}\NormalTok{, lambda))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Therefore, Goodmann and Kruskals Lambda is:  0.366197183098592
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(}\StringTok{"ryouready"}\NormalTok{)}

\KeywordTok{nom.lambda}\NormalTok{(tab2)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Lambda:
##  Columns dependent: 0.388 
##  Rows dependent: 0.366 
##  Symmetric: 0.377
\end{verbatim}

ANOVA

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fit <-}\StringTok{ }\KeywordTok{aov}\NormalTok{(Artist_Popularity}\OperatorTok{~}\NormalTok{Genre , }\DataTypeTok{data =}\NormalTok{x)}
\KeywordTok{summary}\NormalTok{(fit)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##              Df Sum Sq Mean Sq F value Pr(>F)    
## Genre         3  31032   10344   110.3 <2e-16 ***
## Residuals   192  18006      94                   
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ks.test}\NormalTok{(x}\OperatorTok{$}\NormalTok{Artist_Popularity[x}\OperatorTok{$}\NormalTok{Genre }\OperatorTok{==}\StringTok{ 'Classic'}\NormalTok{], }\StringTok{"pnorm"}\NormalTok{, }\DataTypeTok{mean =} \KeywordTok{mean}\NormalTok{ (x}\OperatorTok{$}\NormalTok{Artist_Popularity[x}\OperatorTok{$}\NormalTok{Genre }\OperatorTok{==}\StringTok{ 'Classic'}\NormalTok{]) , }\DataTypeTok{sd=}\KeywordTok{sd}\NormalTok{(x}\OperatorTok{$}\NormalTok{Artist_Popularity[x}\OperatorTok{$}\NormalTok{Genre }\OperatorTok{==}\StringTok{ 'Classic'}\NormalTok{]))}\OperatorTok{$}\NormalTok{statistic}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning in ks.test(x$Artist_Popularity[x$Genre == "Classic"], "pnorm", mean
## = mean(x$Artist_Popularity[x$Genre == : ties should not be present for the
## Kolmogorov-Smirnov test
\end{verbatim}

\begin{verbatim}
##          D 
## 0.06209392
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FloatTok{1.3581} \OperatorTok{/}\StringTok{ }\KeywordTok{sqrt}\NormalTok{ (}\KeywordTok{length}\NormalTok{(x}\OperatorTok{$}\NormalTok{Artist_Popularity[x}\OperatorTok{$}\NormalTok{Genre }\OperatorTok{==}\StringTok{ 'Classic'}\NormalTok{]))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.1940143
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ks.test}\NormalTok{(x}\OperatorTok{$}\NormalTok{Artist_Popularity[x}\OperatorTok{$}\NormalTok{Genre }\OperatorTok{==}\StringTok{ 'Techno'}\NormalTok{], }\StringTok{"pnorm"}\NormalTok{, }\DataTypeTok{mean =} \KeywordTok{mean}\NormalTok{ (x}\OperatorTok{$}\NormalTok{Artist_Popularity[x}\OperatorTok{$}\NormalTok{Genre }\OperatorTok{==}\StringTok{ 'Techno'}\NormalTok{]) , }\DataTypeTok{sd=}\KeywordTok{sd}\NormalTok{(x}\OperatorTok{$}\NormalTok{Artist_Popularity[x}\OperatorTok{$}\NormalTok{Genre }\OperatorTok{==}\StringTok{ 'Techno'}\NormalTok{]))}\OperatorTok{$}\NormalTok{statistic}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning in ks.test(x$Artist_Popularity[x$Genre == "Techno"], "pnorm", mean
## = mean(x$Artist_Popularity[x$Genre == : ties should not be present for the
## Kolmogorov-Smirnov test
\end{verbatim}

\begin{verbatim}
##         D 
## 0.1108916
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FloatTok{1.3581} \OperatorTok{/}\StringTok{ }\KeywordTok{sqrt}\NormalTok{ (}\KeywordTok{length}\NormalTok{(x}\OperatorTok{$}\NormalTok{Artist_Popularity[x}\OperatorTok{$}\NormalTok{Genre }\OperatorTok{==}\StringTok{ 'Techno'}\NormalTok{]))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.1980992
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ks.test}\NormalTok{(x}\OperatorTok{$}\NormalTok{Artist_Popularity[x}\OperatorTok{$}\NormalTok{Genre }\OperatorTok{==}\StringTok{ 'Hip Hop'}\NormalTok{], }\StringTok{"pnorm"}\NormalTok{, }\DataTypeTok{mean =} \KeywordTok{mean}\NormalTok{ (x}\OperatorTok{$}\NormalTok{Artist_Popularity[x}\OperatorTok{$}\NormalTok{Genre }\OperatorTok{==}\StringTok{ 'Hip Hop'}\NormalTok{]) , }\DataTypeTok{sd=}\KeywordTok{sd}\NormalTok{(x}\OperatorTok{$}\NormalTok{Artist_Popularity[x}\OperatorTok{$}\NormalTok{Genre }\OperatorTok{==}\StringTok{ 'Hip Hop'}\NormalTok{]))}\OperatorTok{$}\NormalTok{statistic}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning in ks.test(x$Artist_Popularity[x$Genre == "Hip Hop"], "pnorm", mean
## = mean(x$Artist_Popularity[x$Genre == : ties should not be present for the
## Kolmogorov-Smirnov test
\end{verbatim}

\begin{verbatim}
##          D 
## 0.09990045
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FloatTok{1.3581} \OperatorTok{/}\StringTok{ }\KeywordTok{sqrt}\NormalTok{ (}\KeywordTok{length}\NormalTok{(x}\OperatorTok{$}\NormalTok{Artist_Popularity[x}\OperatorTok{$}\NormalTok{Genre }\OperatorTok{==}\StringTok{ 'Hip Hop'}\NormalTok{]))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.1920643
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ks.test}\NormalTok{(x}\OperatorTok{$}\NormalTok{Artist_Popularity[x}\OperatorTok{$}\NormalTok{Genre }\OperatorTok{==}\StringTok{ 'Pop'}\NormalTok{], }\StringTok{"pnorm"}\NormalTok{, }\DataTypeTok{mean =} \KeywordTok{mean}\NormalTok{ (x}\OperatorTok{$}\NormalTok{Artist_Popularity[x}\OperatorTok{$}\NormalTok{Genre }\OperatorTok{==}\StringTok{ 'Pop'}\NormalTok{]) , }\DataTypeTok{sd=}\KeywordTok{sd}\NormalTok{(x}\OperatorTok{$}\NormalTok{Artist_Popularity[x}\OperatorTok{$}\NormalTok{Genre }\OperatorTok{==}\StringTok{ 'Pop'}\NormalTok{]))}\OperatorTok{$}\NormalTok{statistic}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning in ks.test(x$Artist_Popularity[x$Genre == "Pop"], "pnorm", mean =
## mean(x$Artist_Popularity[x$Genre == : ties should not be present for the
## Kolmogorov-Smirnov test
\end{verbatim}

\begin{verbatim}
##         D 
## 0.1191381
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FloatTok{1.3581} \OperatorTok{/}\StringTok{ }\KeywordTok{sqrt}\NormalTok{ (}\KeywordTok{length}\NormalTok{(x}\OperatorTok{$}\NormalTok{Artist_Popularity[x}\OperatorTok{$}\NormalTok{Genre }\OperatorTok{==}\StringTok{ 'Pop'}\NormalTok{]))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.1920643
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{leveneTest}\NormalTok{ (Artist_Popularity}\OperatorTok{~}\NormalTok{Genre, }\DataTypeTok{data =}\NormalTok{x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Levene's Test for Homogeneity of Variance (center = median)
##        Df F value   Pr(>F)   
## group   3  4.2258 0.006399 **
##       192                    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{varq <-}\StringTok{ }\KeywordTok{tapply}\NormalTok{(x}\OperatorTok{$}\NormalTok{Artist_Popularity, x}\OperatorTok{$}\NormalTok{Genre, var, }\DataTypeTok{na.rm=} \OtherTok{TRUE}\NormalTok{)}
\NormalTok{varq}\OperatorTok{/}\KeywordTok{min}\NormalTok{(varq)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  Classic  Hip Hop      Pop   Techno 
## 1.522737 1.000000 2.293584 1.117978
\end{verbatim}

PCA

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{audio_features <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{'acousticness'}\NormalTok{ , }\StringTok{'danceability'}\NormalTok{ ,}\StringTok{'energy'}\NormalTok{, }\StringTok{'instrumentalness'}\NormalTok{, }\StringTok{'liveness'}\NormalTok{, }\StringTok{'loudness'}\NormalTok{, }\StringTok{'speechiness'}\NormalTok{, }\StringTok{'tempo'}\NormalTok{, }\StringTok{'valence'}\NormalTok{)}
\NormalTok{x_features <-}\StringTok{ }\NormalTok{dplyr}\OperatorTok{::}\KeywordTok{select}\NormalTok{(x, audio_features)}
\NormalTok{z <-}\StringTok{ }\KeywordTok{scale}\NormalTok{(x_features)}
\NormalTok{eigen_cor <-}\StringTok{ }\KeywordTok{eigen}\NormalTok{(}\KeywordTok{cov}\NormalTok{(z))}
\NormalTok{E <-}\StringTok{ }\NormalTok{eigen_cor}\OperatorTok{$}\NormalTok{vectors}
\NormalTok{pc_cor <-}\StringTok{ }\KeywordTok{prcomp}\NormalTok{(z, }\DataTypeTok{center =}\NormalTok{ F, }\DataTypeTok{scale =}\NormalTok{ F)}
\KeywordTok{plot}\NormalTok{(pc_cor, }\DataTypeTok{main=}\StringTok{"Scree plot as bar chart (cor)"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-21-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{plot}\NormalTok{(pc_cor}\OperatorTok{$}\NormalTok{sdev}\OperatorTok{^}\DecValTok{2}\NormalTok{, }\DataTypeTok{type=}\StringTok{"b"}\NormalTok{, }\DataTypeTok{main=}\StringTok{"Scree plot (cor)"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-21-2.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pc_index <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"PC1"}\NormalTok{, }\StringTok{"PC2"}\NormalTok{, }\StringTok{"PC3"}\NormalTok{, }\StringTok{"PC4"}\NormalTok{, }\StringTok{"PC5"}\NormalTok{, }\StringTok{"PC6"}\NormalTok{, }\StringTok{"PC7"}\NormalTok{, }\StringTok{"PC8"}\NormalTok{, }\StringTok{"PC9"}\NormalTok{)}
\NormalTok{eigen_values <-}\StringTok{ }\KeywordTok{round}\NormalTok{(eigen_cor}\OperatorTok{$}\NormalTok{values, }\DataTypeTok{digits =} \DecValTok{2}\NormalTok{)}
\NormalTok{variance_explained <-}\StringTok{ }\KeywordTok{round}\NormalTok{(eigen_cor}\OperatorTok{$}\NormalTok{values}\OperatorTok{/}\KeywordTok{length}\NormalTok{(audio_features), }\DataTypeTok{digits =} \DecValTok{2}\NormalTok{)}
\NormalTok{cum_variance <-}\StringTok{ }\KeywordTok{round}\NormalTok{(}\KeywordTok{cumsum}\NormalTok{(eigen_cor}\OperatorTok{$}\NormalTok{values)}\OperatorTok{/}\KeywordTok{length}\NormalTok{(audio_features), }\DataTypeTok{digits =} \DecValTok{2}\NormalTok{)}
\NormalTok{eigen_df <-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(pc_index, eigen_values, variance_explained, cum_variance)}
\KeywordTok{colnames}\NormalTok{(eigen_df) <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"PC"}\NormalTok{, }\StringTok{"Eigen value"}\NormalTok{, }\StringTok{"Variance explained"}\NormalTok{, }\StringTok{"Cumulative variance explained"}\NormalTok{)}




\KeywordTok{as.data.frame}\NormalTok{(E)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##            V1          V2          V3          V4            V5          V6
## 1  0.41183863  0.30495962  0.02630426 -0.22471138  0.1170423459 -0.06945199
## 2 -0.42126058 -0.15275057 -0.02117371  0.19264297 -0.0505193940 -0.32872097
## 3 -0.43267467 -0.27262746  0.01541572  0.11184124  0.0007580271  0.13959636
## 4  0.24359382 -0.60358357  0.13748733  0.01310136 -0.3195863976 -0.55696819
## 5 -0.09467774  0.27920580  0.86875660  0.09974950 -0.3762605416  0.08156841
## 6 -0.44601607 -0.03843375 -0.03403742  0.11056800  0.0814563461  0.28291553
## 7 -0.20624555  0.36992289 -0.43003436 -0.21358467 -0.7513277732 -0.11648134
## 8 -0.21135995 -0.26849838  0.17288191 -0.90305440  0.0436935134  0.12191226
## 9 -0.33358460  0.39580384  0.09489502 -0.12811119  0.4086602043 -0.66505122
##            V7            V8           V9
## 1 -0.02449030  0.6725817070 -0.463371381
## 2 -0.74539401  0.3045745602 -0.051571039
## 3  0.28431419 -0.0912429322 -0.785540096
## 4  0.32344504  0.1858017422  0.076069002
## 5 -0.01220957  0.0014557218 -0.003957312
## 6  0.38874610  0.6281822072  0.392168238
## 7  0.10283658  0.0003830087 -0.037881861
## 8 -0.13103949 -0.0154221260  0.060492025
## 9  0.28163350 -0.1310253081  0.029355536
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{E[,}\DecValTok{1}\NormalTok{] <-}\StringTok{ }\NormalTok{E[,}\DecValTok{1}\NormalTok{]}\OperatorTok{*-}\DecValTok{1}
\NormalTok{E[,}\DecValTok{3}\NormalTok{] <-}\StringTok{ }\NormalTok{E[,}\DecValTok{3}\NormalTok{]}\OperatorTok{*-}\DecValTok{1}
\NormalTok{E[,}\DecValTok{4}\NormalTok{] <-}\StringTok{ }\NormalTok{E[,}\DecValTok{4}\NormalTok{]}\OperatorTok{*-}\DecValTok{1}
\NormalTok{E[,}\DecValTok{5}\NormalTok{] <-}\StringTok{ }\NormalTok{E[,}\DecValTok{5}\NormalTok{]}\OperatorTok{*-}\DecValTok{1}
\NormalTok{E[,}\DecValTok{6}\NormalTok{] <-}\StringTok{ }\NormalTok{E[,}\DecValTok{6}\NormalTok{]}\OperatorTok{*-}\DecValTok{1}
\KeywordTok{as.data.frame}\NormalTok{(E)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##            V1          V2          V3          V4            V5          V6
## 1 -0.41183863  0.30495962 -0.02630426  0.22471138 -0.1170423459  0.06945199
## 2  0.42126058 -0.15275057  0.02117371 -0.19264297  0.0505193940  0.32872097
## 3  0.43267467 -0.27262746 -0.01541572 -0.11184124 -0.0007580271 -0.13959636
## 4 -0.24359382 -0.60358357 -0.13748733 -0.01310136  0.3195863976  0.55696819
## 5  0.09467774  0.27920580 -0.86875660 -0.09974950  0.3762605416 -0.08156841
## 6  0.44601607 -0.03843375  0.03403742 -0.11056800 -0.0814563461 -0.28291553
## 7  0.20624555  0.36992289  0.43003436  0.21358467  0.7513277732  0.11648134
## 8  0.21135995 -0.26849838 -0.17288191  0.90305440 -0.0436935134 -0.12191226
## 9  0.33358460  0.39580384 -0.09489502  0.12811119 -0.4086602043  0.66505122
##            V7            V8           V9
## 1 -0.02449030  0.6725817070 -0.463371381
## 2 -0.74539401  0.3045745602 -0.051571039
## 3  0.28431419 -0.0912429322 -0.785540096
## 4  0.32344504  0.1858017422  0.076069002
## 5 -0.01220957  0.0014557218 -0.003957312
## 6  0.38874610  0.6281822072  0.392168238
## 7  0.10283658  0.0003830087 -0.037881861
## 8 -0.13103949 -0.0154221260  0.060492025
## 9  0.28163350 -0.1310253081  0.029355536
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{scores <-}\StringTok{ }\NormalTok{z }\OperatorTok{%*%}\StringTok{ }\NormalTok{E}

\KeywordTok{library}\NormalTok{(corrplot)}

\NormalTok{col <-}\StringTok{ }\KeywordTok{colorRampPalette}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\StringTok{"#BB4444"}\NormalTok{, }\StringTok{"#EE9988"}\NormalTok{, }\StringTok{"#FFFFFF"}\NormalTok{, }\StringTok{"#77AADD"}\NormalTok{, }\StringTok{"#4477AA"}\NormalTok{))}

\CommentTok{#par(mfrow=c(1,1))}
\CommentTok{#plot((pc_cor$sdev^2)/round(sum(pc_cor$sdev^2))*100, type="b", xlab = "Number of components", ylab = "Percentage of variance explained")}

\KeywordTok{corrplot}\NormalTok{(pc_cor}\OperatorTok{$}\NormalTok{rotation, }\DataTypeTok{method=}\StringTok{"color"}\NormalTok{, }\DataTypeTok{col=}\KeywordTok{col}\NormalTok{(}\DecValTok{200}\NormalTok{), }
        \DataTypeTok{addCoef.col =} \StringTok{"black"}\NormalTok{, }\CommentTok{# Add coefficient of correlation}
        \DataTypeTok{tl.col=}\StringTok{"black"}\NormalTok{, }\DataTypeTok{tl.srt=}\DecValTok{90}\NormalTok{, }\CommentTok{#Text label color and rotation}
         \DataTypeTok{diag=}\OtherTok{TRUE}\NormalTok{, }\DataTypeTok{mar =} \KeywordTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{5}\NormalTok{,}\DecValTok{5}\NormalTok{), }\DataTypeTok{title =} \StringTok{'PCA - loadings matrix'}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-21-3.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{plot}\NormalTok{(scores[,}\DecValTok{1}\NormalTok{], scores[,}\DecValTok{2}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-21-4.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{plot}\NormalTok{(pc_cor}\OperatorTok{$}\NormalTok{x[,}\DecValTok{1}\NormalTok{], pc_cor}\OperatorTok{$}\NormalTok{x[,}\DecValTok{2}\NormalTok{]) }\CommentTok{# both plots are identical}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-21-5.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(}\StringTok{"psych"}\NormalTok{)}
\NormalTok{psych_pca <-}\StringTok{ }\NormalTok{psych}\OperatorTok{::}\KeywordTok{principal}\NormalTok{(z, }\DataTypeTok{nfactors =} \DecValTok{9}\NormalTok{, }\DataTypeTok{rotate =} \StringTok{"none"}\NormalTok{)}
\KeywordTok{scree}\NormalTok{(z)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-21-6.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# psych_pca$scores[,1]*sqrt(psych_pca$values[1]) # == scores[,1]}

\CommentTok{# transform loadings of psych::principal to unit-length eigenvectors according to 1/sqrt(a^2 + b^2) * (a,b)}
\CommentTok{# 1/sqrt(sum(psych_pca$loadings[,1]^2))*psych_pca$loadings[,1] # is identical to pc_cor$rotation[,1] and E[,1]}

\CommentTok{# transforming unit-length eigenvectors to loadings like in psych::principal:}

\NormalTok{manual_loadings <-}\StringTok{ }\KeywordTok{matrix}\NormalTok{(}\DataTypeTok{nrow =} \KeywordTok{dim}\NormalTok{(z)[}\DecValTok{2}\NormalTok{], }\DataTypeTok{ncol =} \KeywordTok{dim}\NormalTok{(z)[}\DecValTok{2}\NormalTok{])}

\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\KeywordTok{dim}\NormalTok{(z)[}\DecValTok{2}\NormalTok{])\{}
  
\NormalTok{  manual_loadings[,i] <-}\StringTok{ }\NormalTok{E[,i] }\OperatorTok{*}\StringTok{ }\KeywordTok{sqrt}\NormalTok{(eigen_cor}\OperatorTok{$}\NormalTok{values[i])}
  
\NormalTok{\}}

\CommentTok{# Still signs are interchanged, affected components are 3 and 9, change signs manually}

\NormalTok{manual_loadings[,}\DecValTok{3}\NormalTok{] <-}\StringTok{ }\NormalTok{manual_loadings[,}\DecValTok{3}\NormalTok{]}\OperatorTok{*-}\DecValTok{1}
\NormalTok{manual_loadings[,}\DecValTok{9}\NormalTok{] <-}\StringTok{ }\NormalTok{manual_loadings[,}\DecValTok{9}\NormalTok{]}\OperatorTok{*-}\DecValTok{1}

\CommentTok{# Scores in psych are computed according to }

\NormalTok{(z }\OperatorTok{%*%}\StringTok{ }\NormalTok{E[,}\DecValTok{1}\NormalTok{]) }\OperatorTok{/}\StringTok{ }\KeywordTok{sqrt}\NormalTok{(eigen_cor}\OperatorTok{$}\NormalTok{values[}\DecValTok{1}\NormalTok{]) }\CommentTok{#  == psych_pca$scores[,1]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##            [,1]
## 1   -1.59390372
## 2   -1.89244014
## 3   -1.56727583
## 4   -2.02403816
## 5   -1.34328173
## 6   -1.98652322
## 7   -1.65063718
## 8    0.23454238
## 9    0.33189660
## 10  -0.50527012
## 11   0.48474383
## 12   0.35548126
## 13   0.40438968
## 14   0.41389912
## 15   0.88932839
## 16   0.29545887
## 17   0.74966760
## 18  -0.33006285
## 19   0.42233800
## 20   0.60508283
## 21   0.35531678
## 22   1.08286743
## 23   0.33772362
## 24   0.39438136
## 25   0.38074682
## 26   0.53275627
## 27   0.35164160
## 28   0.89806447
## 29   0.34945558
## 30   0.79905861
## 31   0.64973543
## 32   0.79940254
## 33  -1.28729950
## 34   0.32285315
## 35   0.28938500
## 36   0.59057212
## 37  -0.91856390
## 38   0.54122847
## 39   0.77222028
## 40  -0.08719343
## 41   0.53776316
## 42   0.48802436
## 43   0.92409950
## 44   0.32211784
## 45   0.35080523
## 46   0.50370165
## 47   0.43417619
## 48   0.65562461
## 49   0.82640247
## 50   0.22221084
## 51   1.23872589
## 52  -0.27480596
## 53  -0.60837106
## 54   1.09983941
## 55   1.07217376
## 56   1.01232351
## 57   0.62184771
## 58   0.84979050
## 59   0.80091618
## 60   0.85471565
## 61   0.88031931
## 62   1.25090015
## 63   0.89078171
## 64   0.76487318
## 65   0.76159508
## 66   0.30109461
## 67   0.68030322
## 68   0.80407226
## 69   0.72002543
## 70   1.15107907
## 71   0.40045381
## 72   1.02252137
## 73   0.48945386
## 74   0.89961735
## 75   0.58542734
## 76   0.99733632
## 77   0.79627998
## 78   0.98885771
## 79   1.28630203
## 80   0.46651096
## 81   1.33907715
## 82   0.64998223
## 83   0.55201140
## 84   0.75942752
## 85   0.53261883
## 86   0.74383810
## 87   0.74165546
## 88   0.74866137
## 89   0.96277142
## 90   0.62715735
## 91   0.64793200
## 92   0.95334623
## 93   0.44942747
## 94   0.69025775
## 95   0.97104873
## 96   1.18362619
## 97   0.59019519
## 98  -0.39117191
## 99   0.40327243
## 100  0.99054825
## 101  0.86270002
## 102  0.67556803
## 103  1.01390165
## 104  1.36233335
## 105  0.81443559
## 106  1.12486562
## 107  0.70258335
## 108  0.10632817
## 109  0.99193014
## 110  0.75504621
## 111  0.65676336
## 112  0.33047902
## 113  0.95870755
## 114  0.75603911
## 115 -2.11696526
## 116 -1.74364531
## 117 -1.53213316
## 118 -1.94291687
## 119 -1.72239513
## 120 -1.36619922
## 121 -1.66305915
## 122 -2.06411957
## 123 -1.97969420
## 124 -1.73865879
## 125 -1.59092573
## 126 -1.75704042
## 127 -1.65120933
## 128 -0.90738230
## 129 -1.57915022
## 130 -1.79710843
## 131 -0.72000536
## 132 -1.11982385
## 133 -1.16126131
## 134 -1.26343254
## 135 -1.59056965
## 136 -1.19417247
## 137 -1.92762287
## 138 -1.75542132
## 139 -2.11166874
## 140 -1.75851617
## 141 -1.30171171
## 142 -1.64499033
## 143 -0.70384029
## 145 -2.22479894
## 146 -0.43936157
## 147 -1.98892924
## 148 -2.10319657
## 149  0.35090994
## 150  0.35960014
## 152  0.27783403
## 153  0.23520099
## 154  0.42816581
## 155  0.29415102
## 156  0.28883891
## 157  0.28901016
## 158  0.32561591
## 159  0.33618271
## 160  0.53796886
## 161  0.15721183
## 162  0.48276945
## 163  0.18837789
## 165  0.38861944
## 166  0.15693865
## 167  0.34641160
## 168  0.46655158
## 169  0.33666927
## 170  0.23963328
## 171  0.37607131
## 172  0.51586048
## 173 -0.01126555
## 174  0.40426506
## 175  0.23144730
## 176  0.40281787
## 177  0.20758467
## 178  0.24328905
## 179  0.06504826
## 180  0.25132125
## 181  0.18718854
## 183  0.39566848
## 184  0.49874147
## 185  0.39761257
## 186  0.59112779
## 187  0.52223745
## 188  0.34826820
## 189  0.17079406
## 190  0.22460558
## 191  0.18252664
## 192 -1.69078006
## 193 -1.32535523
## 194 -1.35844177
## 195 -1.97935120
## 196 -1.43855432
## 197 -1.63893155
## 198 -0.83876042
## 199 -1.32071392
## 200 -1.71405630
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# i.e. using the unit-length eigenvectors and dividing them by the square root of the corresponding eigenvalue}

\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfrow=}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{))}
\KeywordTok{biplot}\NormalTok{(pc_cor) }\CommentTok{# loadings plot with loadings scaled to fit in same graph with scores}
\KeywordTok{plot}\NormalTok{(pc_cor}\OperatorTok{$}\NormalTok{rotation[, }\DecValTok{1}\OperatorTok{:}\DecValTok{2}\NormalTok{]) }\CommentTok{# loadings in original measures}
\KeywordTok{text}\NormalTok{(pc_cor}\OperatorTok{$}\NormalTok{rotation[, }\DecValTok{1}\OperatorTok{:}\DecValTok{2}\NormalTok{], }\KeywordTok{as.character}\NormalTok{(}\KeywordTok{colnames}\NormalTok{(z)), }\DataTypeTok{pos =} \DecValTok{1}\NormalTok{, }\DataTypeTok{cex =} \FloatTok{0.7}\NormalTok{, }\DataTypeTok{offset =} \FloatTok{0.1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-21-7.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#palette <- rainbow(length(levels(as.factor(x$Genre))))}
\CommentTok{#my_colors <- palette[as.numeric(x$Genre)]}

\NormalTok{palette <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{'red'}\NormalTok{, }\StringTok{'blue'}\NormalTok{, }\StringTok{'black'}\NormalTok{, }\StringTok{'purple'}\NormalTok{)}
\CommentTok{# palette <- rainbow(length(levels(as.factor(x$Genre))))}
\NormalTok{my_colors <-}\StringTok{ }\NormalTok{palette[}\KeywordTok{as.numeric}\NormalTok{(x}\OperatorTok{$}\NormalTok{Genre)]}

\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfrow=}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{))}
\KeywordTok{plot}\NormalTok{(scores[, }\DecValTok{1}\OperatorTok{:}\DecValTok{2}\NormalTok{], }\DataTypeTok{col =}\NormalTok{ my_colors, }\DataTypeTok{pch =} \DecValTok{19}\NormalTok{, }\DataTypeTok{xlab =} \StringTok{"Scores PC1 (47.84% expl. variance)"}\NormalTok{, }\DataTypeTok{ylab =} \StringTok{"Scores PC2 (16.25% expl. variance)"}\NormalTok{)}
\KeywordTok{legend}\NormalTok{(}\StringTok{"topleft"}\NormalTok{, }\DataTypeTok{legend =} \KeywordTok{levels}\NormalTok{(}\KeywordTok{as.factor}\NormalTok{(x}\OperatorTok{$}\NormalTok{Genre)), }\DataTypeTok{col =}\NormalTok{ palette, }\DataTypeTok{pch =} \DecValTok{16}\NormalTok{, }\DataTypeTok{horiz =}\NormalTok{ T)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-21-8.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#plot(pc_cor$rotation[, 1:2])}
\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfrow=}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{))}
\KeywordTok{plot}\NormalTok{(E[, }\DecValTok{1}\OperatorTok{:}\DecValTok{2}\NormalTok{])}
\KeywordTok{text}\NormalTok{(E[, }\DecValTok{1}\OperatorTok{:}\DecValTok{2}\NormalTok{], }\KeywordTok{as.character}\NormalTok{(}\KeywordTok{colnames}\NormalTok{(z)), }\DataTypeTok{pos =} \DecValTok{1}\NormalTok{, }\DataTypeTok{cex =} \FloatTok{0.7}\NormalTok{, }\DataTypeTok{offset =} \FloatTok{0.1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-21-9.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{cumsum}\NormalTok{(eigen_cor}\OperatorTok{$}\NormalTok{values)}\OperatorTok{/}\KeywordTok{length}\NormalTok{(audio_features)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.4783993 0.6408610 0.7496500 0.8399854 0.9171536 0.9507038 0.9754113
## [8] 0.9910233 1.0000000
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# According to the 90% criterion there would be 5 components needed to appropriately retain the variance in the data by reducing the feature space from nine to five.}

\NormalTok{RMSE =}\StringTok{ }\ControlFlowTok{function}\NormalTok{(m, o)\{}
  
  \KeywordTok{sqrt}\NormalTok{(}\KeywordTok{mean}\NormalTok{((m }\OperatorTok{-}\StringTok{ }\NormalTok{o)}\OperatorTok{^}\DecValTok{2}\NormalTok{))}
  
\NormalTok{\}}

\CommentTok{# All expressions for the scores are identical}

\NormalTok{scores <-}\StringTok{ }\NormalTok{z }\OperatorTok{%*%}\StringTok{ }\NormalTok{E}
\NormalTok{scores_from_psych <-}\StringTok{ }\NormalTok{(z }\OperatorTok{%*%}\StringTok{ }\NormalTok{(}\DecValTok{1}\OperatorTok{/}\KeywordTok{sqrt}\NormalTok{(}\KeywordTok{sum}\NormalTok{(psych_pca}\OperatorTok{$}\NormalTok{loadings[,}\DecValTok{1}\NormalTok{]}\OperatorTok{^}\DecValTok{2}\NormalTok{))}\OperatorTok{*}\NormalTok{psych_pca}\OperatorTok{$}\NormalTok{loadings[,}\DecValTok{1}\NormalTok{])) }\OperatorTok{/}\StringTok{ }\KeywordTok{sqrt}\NormalTok{(psych_pca}\OperatorTok{$}\NormalTok{values[}\DecValTok{1}\NormalTok{]) }\CommentTok{# == psych_pca$scores[,1]}
\NormalTok{scores_from_princomp <-}\StringTok{ }\NormalTok{(z }\OperatorTok{%*%}\StringTok{ }\NormalTok{pc_cor}\OperatorTok{$}\NormalTok{rotation[,}\DecValTok{1}\NormalTok{]) }\OperatorTok{/}\StringTok{ }\KeywordTok{sqrt}\NormalTok{(eigen_cor}\OperatorTok{$}\NormalTok{values[}\DecValTok{1}\NormalTok{])}

\NormalTok{fits <-}\StringTok{ }\KeywordTok{matrix}\NormalTok{(}\DataTypeTok{nrow =} \KeywordTok{dim}\NormalTok{(z)[}\DecValTok{2}\NormalTok{], }\DataTypeTok{ncol =} \DecValTok{3}\NormalTok{)}

\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\KeywordTok{dim}\NormalTok{(z)[}\DecValTok{2}\NormalTok{])\{}
  
\NormalTok{  num_comp <-}\StringTok{ }\NormalTok{i}
\NormalTok{  fit <-}\StringTok{ }\NormalTok{scores[, }\DecValTok{1}\OperatorTok{:}\NormalTok{num_comp] }\OperatorTok{%*%}\StringTok{ }\KeywordTok{t}\NormalTok{(E[, }\DecValTok{1}\OperatorTok{:}\NormalTok{num_comp])}
\NormalTok{  residuals <-}\StringTok{ }\NormalTok{z }\OperatorTok{-}\StringTok{ }\NormalTok{fit}
\NormalTok{  rmse <-}\StringTok{ }\KeywordTok{RMSE}\NormalTok{(z, fit)}
\NormalTok{  r2 <-}\StringTok{ }\DecValTok{1}\OperatorTok{-}\NormalTok{(}\KeywordTok{sum}\NormalTok{(}\KeywordTok{diag}\NormalTok{(}\KeywordTok{var}\NormalTok{(residuals)))}\OperatorTok{/}\StringTok{ }\KeywordTok{sum}\NormalTok{(}\KeywordTok{diag}\NormalTok{(}\KeywordTok{var}\NormalTok{(z))))}
  
\NormalTok{  fits[i,}\DecValTok{1}\NormalTok{] <-}\StringTok{ }\NormalTok{num_comp}
\NormalTok{  fits[i,}\DecValTok{2}\NormalTok{] <-}\StringTok{ }\NormalTok{rmse}
\NormalTok{  fits[i,}\DecValTok{3}\NormalTok{] <-}\StringTok{ }\NormalTok{r2}
  
\NormalTok{\}}

\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfrow=}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{))}
\KeywordTok{plot}\NormalTok{(fits[,}\DecValTok{1}\NormalTok{], fits[,}\DecValTok{2}\NormalTok{], }\DataTypeTok{type =} \StringTok{"l"}\NormalTok{, }\DataTypeTok{ylab =} \StringTok{'RMSE'}\NormalTok{, }\DataTypeTok{xlab =} \StringTok{'Number of components'}\NormalTok{)}
\KeywordTok{par}\NormalTok{(}\DataTypeTok{new =} \OtherTok{TRUE}\NormalTok{)}
\KeywordTok{plot}\NormalTok{(fits[,}\DecValTok{1}\NormalTok{], fits[,}\DecValTok{3}\NormalTok{], }\DataTypeTok{type =} \StringTok{"l"}\NormalTok{, }\DataTypeTok{axes =} \OtherTok{FALSE}\NormalTok{, }\DataTypeTok{bty =} \StringTok{"n"}\NormalTok{, }\DataTypeTok{xlab =} \StringTok{""}\NormalTok{, }\DataTypeTok{ylab =} \StringTok{""}\NormalTok{)}
\KeywordTok{axis}\NormalTok{(}\DataTypeTok{side=}\DecValTok{4}\NormalTok{, }\DataTypeTok{at =} \KeywordTok{pretty}\NormalTok{(}\KeywordTok{range}\NormalTok{(fits[,}\DecValTok{3}\NormalTok{])))}
\KeywordTok{mtext}\NormalTok{(}\StringTok{"R^2"}\NormalTok{, }\DataTypeTok{side =} \DecValTok{4}\NormalTok{, }\DataTypeTok{line =} \DecValTok{-1}\NormalTok{)}
\KeywordTok{abline}\NormalTok{(}\DataTypeTok{v =} \DecValTok{2}\NormalTok{, }\DataTypeTok{lty =} \DecValTok{2}\NormalTok{, }\DataTypeTok{col =} \StringTok{'green'}\NormalTok{)}
\KeywordTok{mtext}\NormalTok{(}\StringTok{"Kaiser criterion"}\NormalTok{, }\DataTypeTok{side =} \DecValTok{1}\NormalTok{, }\DataTypeTok{line =} \DecValTok{2}\NormalTok{, }\DataTypeTok{adj =} \FloatTok{0.1}\NormalTok{)}
\KeywordTok{abline}\NormalTok{(}\DataTypeTok{v=}\KeywordTok{min}\NormalTok{(}\KeywordTok{which}\NormalTok{(fits[,}\DecValTok{3}\NormalTok{]}\OperatorTok{>=}\FloatTok{0.9}\NormalTok{)), }\DataTypeTok{lty =} \DecValTok{2}\NormalTok{, }\DataTypeTok{col =} \StringTok{'red'}\NormalTok{)}
\KeywordTok{mtext}\NormalTok{(}\StringTok{"90% rule"}\NormalTok{, }\DataTypeTok{side =} \DecValTok{1}\NormalTok{, }\DataTypeTok{line =} \DecValTok{1}\NormalTok{, }\DataTypeTok{adj =} \FloatTok{0.5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-21-10.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Squared prediction errors / Q-residuals}

\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfrow=}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{))}

\NormalTok{a <-}\StringTok{ }\DecValTok{1}
\NormalTok{Xhat <-}\StringTok{ }\NormalTok{pc_cor}\OperatorTok{$}\NormalTok{x[,}\KeywordTok{seq}\NormalTok{(}\DecValTok{1}\NormalTok{,a)] }\OperatorTok{%*%}\StringTok{ }\KeywordTok{t}\NormalTok{(pc_cor}\OperatorTok{$}\NormalTok{rotation[,}\KeywordTok{seq}\NormalTok{(}\DecValTok{1}\NormalTok{,a)])}
\KeywordTok{RMSE}\NormalTok{(z, Xhat)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.7203745
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{res <-}\StringTok{ }\NormalTok{z }\OperatorTok{-}\StringTok{ }\NormalTok{Xhat}
\NormalTok{E2 <-}\StringTok{ }\NormalTok{res }\OperatorTok{*}\StringTok{ }\NormalTok{res}
\NormalTok{SPE_}\DecValTok{1}\NormalTok{ <-}\StringTok{ }\KeywordTok{apply}\NormalTok{(E2, }\DecValTok{1}\NormalTok{, sum) }\CommentTok{# not using sqrt(apply(E2, 1, sum))!}

\CommentTok{# Box (1954) method: weighted Chi-squared}

\NormalTok{v <-}\StringTok{ }\KeywordTok{var}\NormalTok{(SPE_}\DecValTok{1}\NormalTok{)}
\NormalTok{m <-}\StringTok{ }\KeywordTok{mean}\NormalTok{(SPE_}\DecValTok{1}\NormalTok{)}
\NormalTok{h <-}\StringTok{ }\NormalTok{(}\DecValTok{2}\OperatorTok{*}\NormalTok{m}\OperatorTok{^}\DecValTok{2}\NormalTok{)}\OperatorTok{/}\NormalTok{v}
\NormalTok{g <-}\StringTok{ }\NormalTok{v }\OperatorTok{/}\StringTok{ }\NormalTok{(}\DecValTok{2}\OperatorTok{*}\NormalTok{m)}
\NormalTok{lim_k1_}\DecValTok{95}\NormalTok{ <-}\StringTok{ }\NormalTok{g}\OperatorTok{*}\KeywordTok{qchisq}\NormalTok{(.}\DecValTok{95}\NormalTok{, }\DataTypeTok{df=}\NormalTok{h) }
\KeywordTok{plot}\NormalTok{(SPE_}\DecValTok{1}\NormalTok{, }\DataTypeTok{ylab =} \KeywordTok{paste}\NormalTok{(}\StringTok{'SPE after using'}\NormalTok{, a, }\StringTok{'component'}\NormalTok{), }\DataTypeTok{xlab =} \StringTok{'index'}\NormalTok{)}
\KeywordTok{abline}\NormalTok{(}\DataTypeTok{h =}\NormalTok{ lim_k1_}\DecValTok{95}\NormalTok{, }\DataTypeTok{lty =} \DecValTok{2}\NormalTok{, }\DataTypeTok{col =} \StringTok{'darkgreen'}\NormalTok{)}
\KeywordTok{mtext}\NormalTok{(}\KeywordTok{paste}\NormalTok{(}\StringTok{'RMSE ='}\NormalTok{, }\KeywordTok{round}\NormalTok{(}\KeywordTok{sqrt}\NormalTok{(}\KeywordTok{mean}\NormalTok{(SPE_}\DecValTok{1}\NormalTok{)), }\DataTypeTok{digits =} \DecValTok{4}\NormalTok{)), }\DataTypeTok{side=}\DecValTok{1}\NormalTok{, }\DataTypeTok{line=}\FloatTok{3.5}\NormalTok{, }\DataTypeTok{at=}\DecValTok{9}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-21-11.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{sqrt}\NormalTok{(}\KeywordTok{mean}\NormalTok{(SPE_}\DecValTok{1}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 2.161124
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{a <-}\StringTok{ }\DecValTok{2}
\NormalTok{Xhat <-}\StringTok{ }\NormalTok{pc_cor}\OperatorTok{$}\NormalTok{x[,}\KeywordTok{seq}\NormalTok{(}\DecValTok{1}\NormalTok{,a)] }\OperatorTok{%*%}\StringTok{ }\KeywordTok{t}\NormalTok{(pc_cor}\OperatorTok{$}\NormalTok{rotation[,}\KeywordTok{seq}\NormalTok{(}\DecValTok{1}\NormalTok{,a)])}
\KeywordTok{RMSE}\NormalTok{(z, Xhat)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.5977514
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{res <-}\StringTok{ }\NormalTok{z }\OperatorTok{-}\StringTok{ }\NormalTok{Xhat}
\NormalTok{E2 <-}\StringTok{ }\NormalTok{res }\OperatorTok{*}\StringTok{ }\NormalTok{res}
\CommentTok{#SPE_2 <- sqrt(apply(E2, 1, sum))}
\NormalTok{SPE_}\DecValTok{2}\NormalTok{ <-}\StringTok{ }\KeywordTok{apply}\NormalTok{(E2, }\DecValTok{1}\NormalTok{, sum)}
\CommentTok{# pca(z, ncomp = a, center = FALSE, scale = FALSE, alpha = 0.05)$Qlim[1]}

\NormalTok{v <-}\StringTok{ }\KeywordTok{var}\NormalTok{(SPE_}\DecValTok{2}\NormalTok{)}
\NormalTok{m <-}\StringTok{ }\KeywordTok{mean}\NormalTok{(SPE_}\DecValTok{2}\NormalTok{)}
\NormalTok{h <-}\StringTok{ }\NormalTok{(}\DecValTok{2}\OperatorTok{*}\NormalTok{m}\OperatorTok{^}\DecValTok{2}\NormalTok{)}\OperatorTok{/}\NormalTok{v}
\NormalTok{g <-}\StringTok{ }\NormalTok{v }\OperatorTok{/}\StringTok{ }\NormalTok{(}\DecValTok{2}\OperatorTok{*}\NormalTok{m)}
\NormalTok{lim_k2_}\DecValTok{95}\NormalTok{ <-}\StringTok{ }\NormalTok{g}\OperatorTok{*}\KeywordTok{qchisq}\NormalTok{(.}\DecValTok{95}\NormalTok{, }\DataTypeTok{df=}\NormalTok{h) }
\KeywordTok{plot}\NormalTok{(SPE_}\DecValTok{2}\NormalTok{, }\DataTypeTok{ylab =} \KeywordTok{paste}\NormalTok{(}\StringTok{'SPE after using'}\NormalTok{, a, }\StringTok{'components'}\NormalTok{), }\DataTypeTok{xlab =} \StringTok{'index'}\NormalTok{)}
\KeywordTok{abline}\NormalTok{(}\DataTypeTok{h =}\NormalTok{ lim_k2_}\DecValTok{95}\NormalTok{, }\DataTypeTok{lty =} \DecValTok{2}\NormalTok{, }\DataTypeTok{col =} \StringTok{'darkgreen'}\NormalTok{)}
\KeywordTok{mtext}\NormalTok{(}\KeywordTok{paste}\NormalTok{(}\StringTok{'RMSE ='}\NormalTok{, }\KeywordTok{round}\NormalTok{(}\KeywordTok{sqrt}\NormalTok{(}\KeywordTok{mean}\NormalTok{(SPE_}\DecValTok{2}\NormalTok{)), }\DataTypeTok{digits =} \DecValTok{4}\NormalTok{)), }\DataTypeTok{side=}\DecValTok{1}\NormalTok{, }\DataTypeTok{line=}\FloatTok{3.5}\NormalTok{, }\DataTypeTok{at=}\DecValTok{9}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-21-12.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{sqrt}\NormalTok{(}\KeywordTok{mean}\NormalTok{(SPE_}\DecValTok{2}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1.793254
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{a <-}\StringTok{ }\DecValTok{9}
\NormalTok{Xhat <-}\StringTok{ }\NormalTok{pc_cor}\OperatorTok{$}\NormalTok{x[,}\KeywordTok{seq}\NormalTok{(}\DecValTok{1}\NormalTok{,a)] }\OperatorTok{%*%}\StringTok{ }\KeywordTok{t}\NormalTok{(pc_cor}\OperatorTok{$}\NormalTok{rotation[,}\KeywordTok{seq}\NormalTok{(}\DecValTok{1}\NormalTok{,a)])}
\KeywordTok{RMSE}\NormalTok{(z, Xhat)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 9.521473e-16
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{res <-}\StringTok{ }\NormalTok{z }\OperatorTok{-}\StringTok{ }\NormalTok{Xhat}
\NormalTok{E2 <-}\StringTok{ }\NormalTok{res }\OperatorTok{*}\StringTok{ }\NormalTok{res}
\CommentTok{# SPE_9 <- sqrt(apply(E2, 1, sum))}
\NormalTok{SPE_}\DecValTok{9}\NormalTok{ <-}\StringTok{ }\KeywordTok{apply}\NormalTok{(E2, }\DecValTok{1}\NormalTok{, sum)}
\CommentTok{# pca(z, ncomp = a, center = FALSE, scale = FALSE, alpha = 0.05)$Qlim[1]}

\NormalTok{v <-}\StringTok{ }\KeywordTok{var}\NormalTok{(SPE_}\DecValTok{9}\NormalTok{)}
\NormalTok{m <-}\StringTok{ }\KeywordTok{mean}\NormalTok{(SPE_}\DecValTok{9}\NormalTok{)}
\NormalTok{h <-}\StringTok{ }\NormalTok{(}\DecValTok{2}\OperatorTok{*}\NormalTok{m}\OperatorTok{^}\DecValTok{2}\NormalTok{)}\OperatorTok{/}\NormalTok{v}
\NormalTok{g <-}\StringTok{ }\NormalTok{v }\OperatorTok{/}\StringTok{ }\NormalTok{(}\DecValTok{2}\OperatorTok{*}\NormalTok{m)}
\NormalTok{lim_k9_}\DecValTok{95}\NormalTok{ <-}\StringTok{ }\NormalTok{g}\OperatorTok{*}\KeywordTok{qchisq}\NormalTok{(.}\DecValTok{95}\NormalTok{, }\DataTypeTok{df=}\NormalTok{h) }
\KeywordTok{plot}\NormalTok{(SPE_}\DecValTok{9}\NormalTok{, }\DataTypeTok{ylab =} \KeywordTok{paste}\NormalTok{(}\StringTok{'SPE after using'}\NormalTok{, a, }\StringTok{'components'}\NormalTok{), }\DataTypeTok{xlab =} \StringTok{'index'}\NormalTok{)}
\KeywordTok{abline}\NormalTok{(}\DataTypeTok{h =}\NormalTok{ lim_k9_}\DecValTok{95}\NormalTok{, }\DataTypeTok{lty =} \DecValTok{2}\NormalTok{, }\DataTypeTok{col =} \StringTok{'darkgreen'}\NormalTok{)}
\KeywordTok{mtext}\NormalTok{(}\KeywordTok{paste}\NormalTok{(}\StringTok{'RMSE ='}\NormalTok{, }\KeywordTok{round}\NormalTok{(}\KeywordTok{sqrt}\NormalTok{(}\KeywordTok{mean}\NormalTok{(SPE_}\DecValTok{9}\NormalTok{)), }\DataTypeTok{digits =} \DecValTok{4}\NormalTok{)), }\DataTypeTok{side=}\DecValTok{1}\NormalTok{, }\DataTypeTok{line=}\FloatTok{3.5}\NormalTok{, }\DataTypeTok{at=}\DecValTok{9}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-21-13.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{sqrt}\NormalTok{(}\KeywordTok{mean}\NormalTok{(SPE_}\DecValTok{9}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 2.856442e-15
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfrow=}\KeywordTok{c}\NormalTok{(}\DecValTok{3}\NormalTok{,}\DecValTok{1}\NormalTok{))}

\KeywordTok{plot}\NormalTok{(SPE_}\DecValTok{1}\NormalTok{, }\DataTypeTok{type =} \StringTok{'l'}\NormalTok{, }\DataTypeTok{col =} \StringTok{'darkgreen'}\NormalTok{, }\DataTypeTok{ylab =} \StringTok{"SPE for PC1"}\NormalTok{)}
\KeywordTok{abline}\NormalTok{(}\DataTypeTok{h =}\NormalTok{ lim_k1_}\DecValTok{95}\NormalTok{, }\DataTypeTok{lty =} \DecValTok{2}\NormalTok{, }\DataTypeTok{col =} \StringTok{'darkgreen'}\NormalTok{)}
\KeywordTok{plot}\NormalTok{(SPE_}\DecValTok{2}\NormalTok{, }\DataTypeTok{type =} \StringTok{'l'}\NormalTok{, }\DataTypeTok{col =} \StringTok{'red'}\NormalTok{, }\DataTypeTok{ylab =} \StringTok{"SPE for PC1 + PC2"}\NormalTok{)}
\KeywordTok{abline}\NormalTok{(}\DataTypeTok{h =}\NormalTok{ lim_k2_}\DecValTok{95}\NormalTok{, }\DataTypeTok{lty =} \DecValTok{2}\NormalTok{, }\DataTypeTok{col =} \StringTok{'darkgreen'}\NormalTok{)}
\KeywordTok{plot}\NormalTok{(SPE_}\DecValTok{9}\NormalTok{, }\DataTypeTok{type =} \StringTok{'l'}\NormalTok{, }\DataTypeTok{col =} \StringTok{'blue'}\NormalTok{, }\DataTypeTok{ylab =} \StringTok{"SPE for all PCs"}\NormalTok{)}
\KeywordTok{abline}\NormalTok{(}\DataTypeTok{h =}\NormalTok{ lim_k9_}\DecValTok{95}\NormalTok{, }\DataTypeTok{lty =} \DecValTok{2}\NormalTok{, }\DataTypeTok{col =} \StringTok{'darkgreen'}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-21-14.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{sum}\NormalTok{(SPE_}\DecValTok{1} \OperatorTok{>}\StringTok{ }\NormalTok{lim_k1_}\DecValTok{95}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 6
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{sum}\NormalTok{(SPE_}\DecValTok{1} \OperatorTok{>}\StringTok{ }\NormalTok{lim_k1_}\DecValTok{95}\NormalTok{)}\OperatorTok{/}\KeywordTok{length}\NormalTok{(SPE_}\DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.03061224
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{sum}\NormalTok{(SPE_}\DecValTok{2} \OperatorTok{>}\StringTok{ }\NormalTok{lim_k2_}\DecValTok{95}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 7
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{sum}\NormalTok{(SPE_}\DecValTok{2} \OperatorTok{>}\StringTok{ }\NormalTok{lim_k2_}\DecValTok{95}\NormalTok{)}\OperatorTok{/}\KeywordTok{length}\NormalTok{(SPE_}\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.03571429
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{sum}\NormalTok{(SPE_}\DecValTok{9} \OperatorTok{>}\StringTok{ }\NormalTok{lim_k9_}\DecValTok{95}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 10
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{sum}\NormalTok{(SPE_}\DecValTok{9} \OperatorTok{>}\StringTok{ }\NormalTok{lim_k9_}\DecValTok{95}\NormalTok{)}\OperatorTok{/}\KeywordTok{length}\NormalTok{(SPE_}\DecValTok{9}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.05102041
\end{verbatim}

Hotelling's T\^{}2

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{num_comp <-}\StringTok{ }\DecValTok{2}

\NormalTok{inverse_cov <-}\StringTok{ }\KeywordTok{diag}\NormalTok{(eigen_cor}\OperatorTok{$}\NormalTok{values[}\DecValTok{1}\OperatorTok{:}\NormalTok{num_comp], }\DataTypeTok{nrow =}\NormalTok{ num_comp, }\DataTypeTok{ncol =}\NormalTok{ num_comp)}\OperatorTok{^-}\DecValTok{1}
\NormalTok{inverse_cov[}\KeywordTok{is.infinite}\NormalTok{(inverse_cov)] <-}\StringTok{ }\DecValTok{0}

\NormalTok{tsquared <-}\StringTok{ }\KeywordTok{diag}\NormalTok{(z }\OperatorTok{%*%}\StringTok{ }\NormalTok{E[,}\DecValTok{1}\OperatorTok{:}\NormalTok{num_comp] }\OperatorTok{%*%}\StringTok{ }\NormalTok{inverse_cov }\OperatorTok{%*%}\StringTok{ }\KeywordTok{t}\NormalTok{(z }\OperatorTok{%*%}\StringTok{ }\NormalTok{E[,}\DecValTok{1}\OperatorTok{:}\NormalTok{num_comp]))}

\CommentTok{# which is equivalent to the Mahalanobis distance: (for k > 1)}

\NormalTok{tsquared_mahal <-}\StringTok{ }\KeywordTok{mahalanobis}\NormalTok{(scores[,}\DecValTok{1}\OperatorTok{:}\NormalTok{num_comp], }\DataTypeTok{center =} \OtherTok{FALSE}\NormalTok{, }\KeywordTok{cov}\NormalTok{(}\KeywordTok{cbind}\NormalTok{(scores[,}\DecValTok{1}\NormalTok{], scores[,num_comp])), }\DataTypeTok{inverted =} \OtherTok{FALSE}\NormalTok{)}
\NormalTok{tsquared_lim95 <-}\StringTok{ }\NormalTok{(((}\KeywordTok{dim}\NormalTok{(z)[}\DecValTok{1}\NormalTok{] }\OperatorTok{-}\StringTok{ }\DecValTok{1}\NormalTok{) }\OperatorTok{*}\StringTok{ }\NormalTok{(}\KeywordTok{dim}\NormalTok{(z)[}\DecValTok{1}\NormalTok{] }\OperatorTok{+}\StringTok{ }\DecValTok{1}\NormalTok{) }\OperatorTok{*}\StringTok{ }\NormalTok{num_comp) }\OperatorTok{/}\StringTok{ }\NormalTok{(}\KeywordTok{dim}\NormalTok{(z)[}\DecValTok{1}\NormalTok{] }\OperatorTok{*}\StringTok{ }\NormalTok{(}\KeywordTok{dim}\NormalTok{(z)[}\DecValTok{1}\NormalTok{] }\OperatorTok{-}\StringTok{ }\NormalTok{num_comp))) }\OperatorTok{*}\StringTok{ }\KeywordTok{qf}\NormalTok{(}\DataTypeTok{p =}\NormalTok{.}\DecValTok{95}\NormalTok{, }\DataTypeTok{df1 =}\NormalTok{ num_comp, }\DataTypeTok{df2 =} \KeywordTok{dim}\NormalTok{(z)[}\DecValTok{1}\NormalTok{] }\OperatorTok{-}\StringTok{ }\NormalTok{num_comp)}
\NormalTok{tsquared_lim99 <-}\StringTok{ }\NormalTok{(((}\KeywordTok{dim}\NormalTok{(z)[}\DecValTok{1}\NormalTok{] }\OperatorTok{-}\StringTok{ }\DecValTok{1}\NormalTok{) }\OperatorTok{*}\StringTok{ }\NormalTok{(}\KeywordTok{dim}\NormalTok{(z)[}\DecValTok{1}\NormalTok{] }\OperatorTok{+}\StringTok{ }\DecValTok{1}\NormalTok{) }\OperatorTok{*}\StringTok{ }\NormalTok{num_comp) }\OperatorTok{/}\StringTok{ }\NormalTok{(}\KeywordTok{dim}\NormalTok{(z)[}\DecValTok{1}\NormalTok{] }\OperatorTok{*}\StringTok{ }\NormalTok{(}\KeywordTok{dim}\NormalTok{(z)[}\DecValTok{1}\NormalTok{] }\OperatorTok{-}\StringTok{ }\NormalTok{num_comp))) }\OperatorTok{*}\StringTok{ }\KeywordTok{qf}\NormalTok{(}\DataTypeTok{p =}\NormalTok{.}\DecValTok{99}\NormalTok{, }\DataTypeTok{df1 =}\NormalTok{ num_comp, }\DataTypeTok{df2 =} \KeywordTok{dim}\NormalTok{(z)[}\DecValTok{1}\NormalTok{] }\OperatorTok{-}\StringTok{ }\NormalTok{num_comp)}

\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfrow=}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{))}

\KeywordTok{plot}\NormalTok{(tsquared, }\DataTypeTok{type =} \StringTok{'l'}\NormalTok{, }\DataTypeTok{ylim =} \KeywordTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,tsquared_lim99}\OperatorTok{*}\FloatTok{1.1}\NormalTok{), }\DataTypeTok{ylab =} \StringTok{"Hotelling's T2"}\NormalTok{)}
\KeywordTok{abline}\NormalTok{(}\DataTypeTok{h=}\NormalTok{tsquared_lim99, }\DataTypeTok{col =} \StringTok{'red'}\NormalTok{, }\DataTypeTok{lty =} \DecValTok{2}\NormalTok{)}
\KeywordTok{text}\NormalTok{(}\DecValTok{190}\NormalTok{,}\DecValTok{10}\NormalTok{, }\StringTok{"99% limit"}\NormalTok{, }\DataTypeTok{col =} \StringTok{"red"}\NormalTok{)}
\KeywordTok{abline}\NormalTok{(}\DataTypeTok{h=}\NormalTok{tsquared_lim95, }\DataTypeTok{col =} \StringTok{'darkgreen'}\NormalTok{, }\DataTypeTok{lty =} \DecValTok{2}\NormalTok{)}
\KeywordTok{text}\NormalTok{(}\DecValTok{190}\NormalTok{,}\FloatTok{6.6}\NormalTok{, }\StringTok{"95% limit"}\NormalTok{, }\DataTypeTok{col =} \StringTok{"darkgreen"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-22-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# source: https://github.com/hredestig/pcaMethods/blob/master/R/pca.R}

\NormalTok{simpleEllipse <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(x, y, }\DataTypeTok{alfa=}\FloatTok{0.95}\NormalTok{, }\DataTypeTok{len=}\DecValTok{200}\NormalTok{) \{}
\NormalTok{  N <-}\StringTok{ }\KeywordTok{length}\NormalTok{(x)}
\NormalTok{  A <-}\StringTok{ }\DecValTok{2}
\NormalTok{  mypi <-}\StringTok{ }\KeywordTok{seq}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{2} \OperatorTok{*}\StringTok{ }\NormalTok{pi, }\DataTypeTok{length=}\NormalTok{len)}
\NormalTok{  r1 <-}\StringTok{ }\KeywordTok{sqrt}\NormalTok{(}\KeywordTok{var}\NormalTok{(x) }\OperatorTok{*}\StringTok{ }\KeywordTok{qf}\NormalTok{(alfa, }\DecValTok{2}\NormalTok{, N }\OperatorTok{-}\StringTok{ }\DecValTok{2}\NormalTok{) }\OperatorTok{*}\StringTok{ }\NormalTok{(}\DecValTok{2}\OperatorTok{*}\NormalTok{(N}\OperatorTok{^}\DecValTok{2} \OperatorTok{-}\StringTok{ }\DecValTok{1}\NormalTok{)}\OperatorTok{/}\NormalTok{(N }\OperatorTok{*}\StringTok{ }\NormalTok{(N }\OperatorTok{-}\StringTok{ }\DecValTok{2}\NormalTok{))))}
\NormalTok{  r2 <-}\StringTok{ }\KeywordTok{sqrt}\NormalTok{(}\KeywordTok{var}\NormalTok{(y) }\OperatorTok{*}\StringTok{ }\KeywordTok{qf}\NormalTok{(alfa, }\DecValTok{2}\NormalTok{, N }\OperatorTok{-}\StringTok{ }\DecValTok{2}\NormalTok{) }\OperatorTok{*}\StringTok{ }\NormalTok{(}\DecValTok{2}\OperatorTok{*}\NormalTok{(N}\OperatorTok{^}\DecValTok{2} \OperatorTok{-}\StringTok{ }\DecValTok{1}\NormalTok{)}\OperatorTok{/}\NormalTok{(N }\OperatorTok{*}\StringTok{ }\NormalTok{(N }\OperatorTok{-}\StringTok{ }\DecValTok{2}\NormalTok{))))}
  \KeywordTok{cbind}\NormalTok{(r1 }\OperatorTok{*}\StringTok{ }\KeywordTok{cos}\NormalTok{(mypi) }\OperatorTok{+}\StringTok{ }\KeywordTok{mean}\NormalTok{(x), r2 }\OperatorTok{*}\StringTok{ }\KeywordTok{sin}\NormalTok{(mypi) }\OperatorTok{+}\StringTok{ }\KeywordTok{mean}\NormalTok{(y))}
\NormalTok{\}}


\NormalTok{confidence_ellipse95 <-}\StringTok{ }\KeywordTok{simpleEllipse}\NormalTok{(scores[,}\DecValTok{1}\NormalTok{], scores[,}\DecValTok{2}\NormalTok{], }\DataTypeTok{alfa =} \FloatTok{0.95}\NormalTok{, }\DataTypeTok{len=}\DecValTok{500}\NormalTok{)}
\NormalTok{confidence_ellipse99 <-}\StringTok{ }\KeywordTok{simpleEllipse}\NormalTok{(scores[,}\DecValTok{1}\NormalTok{], scores[,}\DecValTok{2}\NormalTok{], }\DataTypeTok{alfa =} \FloatTok{0.99}\NormalTok{, }\DataTypeTok{len=}\DecValTok{500}\NormalTok{)}

\KeywordTok{plot}\NormalTok{(scores[,}\DecValTok{1}\NormalTok{], scores[,}\DecValTok{2}\NormalTok{], }\DataTypeTok{xlim =} \KeywordTok{c}\NormalTok{(}\KeywordTok{min}\NormalTok{(confidence_ellipse99[,}\DecValTok{1}\NormalTok{]), }\KeywordTok{max}\NormalTok{(confidence_ellipse99[,}\DecValTok{1}\NormalTok{])), }
     \DataTypeTok{ylim =} \KeywordTok{c}\NormalTok{(}\KeywordTok{min}\NormalTok{(confidence_ellipse99[,}\DecValTok{2}\NormalTok{]), }\KeywordTok{max}\NormalTok{(confidence_ellipse99[,}\DecValTok{2}\NormalTok{])), }\DataTypeTok{ylab =} \StringTok{'Scores PC2'}\NormalTok{, }\DataTypeTok{xlab =} \StringTok{'Scores PC1'}\NormalTok{)}
\KeywordTok{abline}\NormalTok{(}\DataTypeTok{h =} \DecValTok{0}\NormalTok{, }\DataTypeTok{v =} \DecValTok{0}\NormalTok{)}
\KeywordTok{points}\NormalTok{(confidence_ellipse95, }\DataTypeTok{type =} \StringTok{'l'}\NormalTok{, }\DataTypeTok{lty =} \DecValTok{2}\NormalTok{, }\DataTypeTok{col =} \StringTok{'darkgreen'}\NormalTok{)}
\KeywordTok{points}\NormalTok{(confidence_ellipse99, }\DataTypeTok{type =} \StringTok{'l'}\NormalTok{, }\DataTypeTok{lty =} \DecValTok{2}\NormalTok{, }\DataTypeTok{col =} \StringTok{'red'}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-22-2.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x[}\KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{names}\NormalTok{(tsquared[tsquared }\OperatorTok{>}\StringTok{ }\NormalTok{tsquared_lim95])),}\KeywordTok{c}\NormalTok{(}\StringTok{'Track_Title'}\NormalTok{, }\StringTok{'Track_Artist'}\NormalTok{, }\StringTok{'Genre'}\NormalTok{)]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##                                                        Track_Title Track_Artist
## 21                                                   Gibt es Dich? Shirin David
## 146 Recomposed By Max Richter: Vivaldi, The Four Seasons: Spring 1  Max Richter
##       Genre
## 21      Pop
## 146 Classic
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{outlier_tracks <-}\StringTok{ }\NormalTok{x[}\KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{names}\NormalTok{(tsquared[tsquared }\OperatorTok{>}\StringTok{ }\NormalTok{tsquared_lim95])),}\KeywordTok{c}\NormalTok{(}\StringTok{'Track_Title'}\NormalTok{, }\StringTok{'Track_Artist'}\NormalTok{, }\StringTok{'Genre'}\NormalTok{)]}
\KeywordTok{round}\NormalTok{(z[}\KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{names}\NormalTok{(tsquared[tsquared }\OperatorTok{>}\StringTok{ }\NormalTok{tsquared_lim95])),], }\DataTypeTok{digits =} \DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##     acousticness danceability energy instrumentalness liveness loudness
## 21          0.88         0.21  -0.51            -0.90    -0.23    -0.04
## 146         0.35         0.49  -0.79             1.26     2.13    -0.20
##     speechiness tempo valence
## 21         4.30 -0.95    1.08
## 146       -0.61 -0.41   -0.68
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{audio_z <-}\StringTok{ }\KeywordTok{as.data.frame}\NormalTok{(z[}\KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{names}\NormalTok{(tsquared[tsquared }\OperatorTok{>}\StringTok{ }\NormalTok{tsquared_lim95])),])}
\NormalTok{outlier_tracks}\OperatorTok{$}\NormalTok{acousticness <-}\StringTok{ }\NormalTok{audio_z}\OperatorTok{$}\NormalTok{acousticness}
\NormalTok{outlier_tracks}\OperatorTok{$}\NormalTok{danceability <-}\StringTok{ }\NormalTok{audio_z}\OperatorTok{$}\NormalTok{danceability}
\NormalTok{outlier_tracks}\OperatorTok{$}\NormalTok{energy <-}\StringTok{ }\NormalTok{audio_z}\OperatorTok{$}\NormalTok{energy}
\NormalTok{outlier_tracks}\OperatorTok{$}\NormalTok{instrumentalness <-}\StringTok{ }\NormalTok{audio_z}\OperatorTok{$}\NormalTok{instrumentalness}
\NormalTok{outlier_tracks}\OperatorTok{$}\NormalTok{liveness <-}\StringTok{ }\NormalTok{audio_z}\OperatorTok{$}\NormalTok{liveness}
\NormalTok{outlier_tracks}\OperatorTok{$}\NormalTok{loudness <-}\StringTok{ }\NormalTok{audio_z}\OperatorTok{$}\NormalTok{loudness}
\NormalTok{outlier_tracks}\OperatorTok{$}\NormalTok{speechiness <-}\StringTok{ }\NormalTok{audio_z}\OperatorTok{$}\NormalTok{speechiness}
\NormalTok{outlier_tracks}\OperatorTok{$}\NormalTok{tempo <-}\StringTok{ }\NormalTok{audio_z}\OperatorTok{$}\NormalTok{tempo}
\NormalTok{outlier_tracks}\OperatorTok{$}\NormalTok{valence <-}\StringTok{ }\NormalTok{audio_z}\OperatorTok{$}\NormalTok{valence}

\CommentTok{# Finally, combining residuals and scores (i.e. Hotelling's T^2)}

\CommentTok{# cumsum(pc_cor$sdev^2 / sum(pc_cor$sdev^2))[num_comp]}

\KeywordTok{plot}\NormalTok{(tsquared, SPE_}\DecValTok{2}\NormalTok{, }
     \DataTypeTok{xlab =} \KeywordTok{paste}\NormalTok{(}\StringTok{"Hotelling's T2 ("}\NormalTok{, }\KeywordTok{round}\NormalTok{(}\KeywordTok{cumsum}\NormalTok{(pc_cor}\OperatorTok{$}\NormalTok{sdev}\OperatorTok{^}\DecValTok{2} \OperatorTok{/}\StringTok{ }\KeywordTok{sum}\NormalTok{(pc_cor}\OperatorTok{$}\NormalTok{sdev}\OperatorTok{^}\DecValTok{2}\NormalTok{))[num_comp]}\OperatorTok{*}\DecValTok{100}\NormalTok{, }\DataTypeTok{digits =} \DecValTok{2}\NormalTok{), }\StringTok{"%)"}\NormalTok{),}
     \DataTypeTok{ylab =} \KeywordTok{paste}\NormalTok{(}\StringTok{"Q-residuals ("}\NormalTok{, }\KeywordTok{round}\NormalTok{((}\DecValTok{1}\OperatorTok{-}\KeywordTok{cumsum}\NormalTok{(pc_cor}\OperatorTok{$}\NormalTok{sdev}\OperatorTok{^}\DecValTok{2} \OperatorTok{/}\StringTok{ }\KeywordTok{sum}\NormalTok{(pc_cor}\OperatorTok{$}\NormalTok{sdev}\OperatorTok{^}\DecValTok{2}\NormalTok{))[num_comp])}\OperatorTok{*}\DecValTok{100}\NormalTok{, }\DataTypeTok{digits =} \DecValTok{2}\NormalTok{), }\StringTok{"%)"}\NormalTok{))}
\KeywordTok{abline}\NormalTok{(}\DataTypeTok{h =}\NormalTok{ lim_k2_}\DecValTok{95}\NormalTok{, }\DataTypeTok{lty =} \DecValTok{2}\NormalTok{, }\DataTypeTok{col =} \StringTok{'darkgreen'}\NormalTok{) }\CommentTok{# seven residual outliers}
\KeywordTok{abline}\NormalTok{(}\DataTypeTok{v =}\NormalTok{ tsquared_lim95, }\DataTypeTok{lty =} \DecValTok{2}\NormalTok{, }\DataTypeTok{col =} \StringTok{'darkgreen'}\NormalTok{) }\CommentTok{#  two score outliers}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-22-3.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(}\StringTok{"robustbase"}\NormalTok{)}
\NormalTok{out <-}\StringTok{ }\KeywordTok{adjOutlyingness}\NormalTok{(z, }\DataTypeTok{ndir=}\DecValTok{5000}\NormalTok{, }\DataTypeTok{clower=}\DecValTok{0}\NormalTok{, }\DataTypeTok{cupper=}\DecValTok{0}\NormalTok{)}
\KeywordTok{hist}\NormalTok{(out}\OperatorTok{$}\NormalTok{adjout)}
\KeywordTok{rug}\NormalTok{(out}\OperatorTok{$}\NormalTok{adjout)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-22-4.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{z[}\OperatorTok{!}\NormalTok{out}\OperatorTok{$}\NormalTok{nonOut,]}\CommentTok{#  as we can confirm, the outlying cases differ strongly in their characteristics from their respective                         centers, that is especially liveness and energy are inconsistent with the model}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##     acousticness danceability     energy instrumentalness   liveness   loudness
## 15  -0.094467802  0.305088118  0.4781728       -0.9049362  4.3284375  0.5324131
## 21   0.882322256  0.212927329 -0.5076300       -0.9049323 -0.2300724 -0.0352499
## 39  -0.957209569 -0.687734925  0.2276552       -0.9049362 -0.2592936  0.7591936
## 51  -0.725356105  0.292520737  1.1679094       -0.9049362  7.1823764  0.8712256
## 66  -0.067632910 -0.172472333 -0.1725221       -0.9049362 -0.4141660  0.5886878
## 68   0.436863054 -0.440576446  0.5399888       -0.9049362 -0.3985814  0.7324146
## 88  -0.008596148  0.439140174 -0.1725221       -0.9047249 -0.3469572  0.2811821
## 96  -0.561394917  1.507367499  0.8197876       -0.9042543  4.8251982  0.5040817
## 105 -0.448688372 -0.000718136  0.3968359       -0.9049362 -0.1813703  0.7114572
## 140  1.588079907 -1.818799151 -1.6889666        0.5378426  3.1693292 -1.7704512
## 145  1.419020090 -1.709881855 -1.8773428       -0.9048587 -0.3469572 -4.0775846
##     speechiness       tempo    valence
## 15   -0.3911434  1.11569104  1.3435281
## 21    4.3016000 -0.94770231  1.0815371
## 39    3.1036744 -1.37811770  1.5468644
## 51   -0.5411446 -0.42960905  1.6680842
## 66    3.4161767 -0.96530254 -0.5998981
## 68    3.4578437  2.23014470  0.3190258
## 88    3.4995106  0.75786761  0.7335191
## 96    1.4994957 -0.06945090  0.1156894
## 105   3.5515944  0.02013067  0.2290886
## 140  -0.5848949 -1.98956402 -1.0077438
## 145  -0.6432287 -1.63411123 -1.1700219
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x[}\KeywordTok{rownames}\NormalTok{(z[}\OperatorTok{!}\NormalTok{out}\OperatorTok{$}\NormalTok{nonOut,]),}\KeywordTok{c}\NormalTok{(}\StringTok{"Track_Title"}\NormalTok{, }\StringTok{"Track_Artist"}\NormalTok{, }\StringTok{"Genre"}\NormalTok{, }\StringTok{"Track_Popularity"}\NormalTok{)]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##                                           Track_Title            Track_Artist
## 15                                    Einmal im Leben           Wincent Weiss
## 21                                      Gibt es Dich?            Shirin David
## 39                                      Never Go Back            Dennis Lloyd
## 51                    Merry Christmas, Happy Holidays                  *NSYNC
## 66                                               COLT                   Samra
## 68                                                110             Capital Bra
## 88                                           9mm Bang                 Olexesh
## 96                                    Paul Castellano            Miami Yacine
## 105                                    Glas fÃ¼r Glas                      LX
## 140     Scheherazade: The Tale of the Kalendar Prince Nikolai Rimsky-Korsakov
## 145 Spiegel im Spiegel - Version for Violin and Piano              Arvo PÃ¤rt
##       Genre Track_Popularity
## 15      Pop               58
## 21      Pop               44
## 39      Pop               71
## 51      Pop               44
## 66  Hip Hop               75
## 68  Hip Hop               71
## 88  Hip Hop               46
## 96  Hip Hop               39
## 105 Hip Hop               42
## 140 Classic               47
## 145 Classic               50
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(}\StringTok{"paran"}\NormalTok{)}
\KeywordTok{paran}\NormalTok{(z, }\DataTypeTok{centile=}\DecValTok{95}\NormalTok{, }\DataTypeTok{all=}\NormalTok{T, }\DataTypeTok{graph=}\NormalTok{T)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Using eigendecomposition of correlation matrix.
## Computing: 10%  20%  30%  40%  50%  60%  70%  80%  90%  100%
## 
## 
## Results of Horn's Parallel Analysis for component retention
## 270 iterations, using the 95 centile estimate
## 
## -------------------------------------------------- 
## Component   Adjusted    Unadjusted    Estimated 
##             Eigenvalue  Eigenvalue    Bias 
## -------------------------------------------------- 
## 1           3.863308    4.305594      0.442285
## 2           1.164607    1.462154      0.297546
## 3           0.786086    0.979100      0.193014
## 4           0.702101    0.813018      0.110917
## 5           0.658372    0.694514      0.036141
## 6           0.334835    0.301951     -0.03288
## 7           0.318054    0.222367     -0.09568
## 8           0.303243    0.140507     -0.16273
## 9           0.315336    0.080790     -0.23454
## -------------------------------------------------- 
## 
## Adjusted eigenvalues > 1 indicate dimensions to retain.
## (2 components retained)
\end{verbatim}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-22-5.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x}\OperatorTok{$}\NormalTok{pc_}\DecValTok{1}\NormalTok{ <-}\StringTok{ }\NormalTok{pc_cor}\OperatorTok{$}\NormalTok{x[,}\DecValTok{1}\NormalTok{]}
\NormalTok{x}\OperatorTok{$}\NormalTok{pc_}\DecValTok{2}\NormalTok{ <-}\StringTok{ }\NormalTok{pc_cor}\OperatorTok{$}\NormalTok{x[,}\DecValTok{2}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x}\OperatorTok{$}\NormalTok{Release_Date <-}\StringTok{ }\KeywordTok{as.Date}\NormalTok{(}\KeywordTok{paste}\NormalTok{(x}\OperatorTok{$}\NormalTok{Release_Date, }\DecValTok{1}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DataTypeTok{sep =} \StringTok{"-"}\NormalTok{))}
\NormalTok{x}\OperatorTok{$}\NormalTok{days_release_orig <-}\StringTok{ }\KeywordTok{as.integer}\NormalTok{(}\KeywordTok{round}\NormalTok{(}\KeywordTok{difftime}\NormalTok{(}\StringTok{'2020-03-01'}\NormalTok{, x}\OperatorTok{$}\NormalTok{Release_Date, }\DataTypeTok{units =} \StringTok{"days"}\NormalTok{), }\DataTypeTok{digits =} \DecValTok{0}\NormalTok{))}
\NormalTok{x}\OperatorTok{$}\NormalTok{Release_Date <-}\StringTok{ }\OtherTok{NULL}
\NormalTok{x}\OperatorTok{$}\NormalTok{days_release <-}\StringTok{ }\KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{scale}\NormalTok{(x}\OperatorTok{$}\NormalTok{days_release_orig))}


\NormalTok{drop.cols <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{'Artist_ID'}\NormalTok{, }\StringTok{'Genre'}\NormalTok{, }\StringTok{'Track_Artist'}\NormalTok{,}\StringTok{'Track_ID'}\NormalTok{, }\StringTok{'Track_Title'}\NormalTok{, }\StringTok{'key'}\NormalTok{,}
               \StringTok{'mode'}\NormalTok{, }\StringTok{'time_signature'}\NormalTok{, }\StringTok{'video_ID'}\NormalTok{, }\StringTok{'Charts'}\NormalTok{, }\StringTok{'acousticness'}\NormalTok{, }\StringTok{'danceability'}\NormalTok{, }\StringTok{'energy'}\NormalTok{, }\StringTok{'instrumentalness'}\NormalTok{,}
               \StringTok{'liveness'}\NormalTok{, }\StringTok{'loudness'}\NormalTok{, }\StringTok{'speechiness'}\NormalTok{, }\StringTok{'tempo'}\NormalTok{, }\StringTok{'valence'}\NormalTok{, }\StringTok{'Artist_Popularity'}\NormalTok{, }\StringTok{'Track_Popularity'}\NormalTok{, }\StringTok{'Artist_Popularity_quantile'}\NormalTok{, }\StringTok{'viewsCount_quantile'}\NormalTok{, }\StringTok{'days_release_orig'}\NormalTok{, }\StringTok{'pc_1'}\NormalTok{, }\StringTok{'pc_2'}\NormalTok{)}

\NormalTok{x_sel <-}\StringTok{ }\NormalTok{dplyr}\OperatorTok{::}\KeywordTok{select}\NormalTok{(x, }\OperatorTok{-}\KeywordTok{one_of}\NormalTok{(drop.cols))}
\NormalTok{complete_index <-}\StringTok{ }\KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{rownames}\NormalTok{(x_sel))}

\NormalTok{z <-}\StringTok{ }\KeywordTok{scale}\NormalTok{(x_sel)}

\CommentTok{# inverse and partial correlations}
\NormalTok{p  <-}\StringTok{ }\KeywordTok{solve}\NormalTok{(}\KeywordTok{cor}\NormalTok{(z, }\DataTypeTok{use=}\StringTok{"complete.obs"}\NormalTok{))}

\CommentTok{# if the model holds then the non-diagonal elements of R􀀀1}
\CommentTok{# must be close to zero (relative to the diagonal element)}

\KeywordTok{levelplot}\NormalTok{(p, }\DataTypeTok{scales=}\KeywordTok{list}\NormalTok{(}\DataTypeTok{x=}\KeywordTok{list}\NormalTok{(}\DataTypeTok{rot=}\DecValTok{90}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-23-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Partial correlations}
\NormalTok{pr <-}\StringTok{ }\OperatorTok{-}\NormalTok{p}\OperatorTok{/}\KeywordTok{sqrt}\NormalTok{(}\KeywordTok{outer}\NormalTok{(}\KeywordTok{diag}\NormalTok{(p), }\KeywordTok{diag}\NormalTok{(p)))}
\KeywordTok{levelplot}\NormalTok{(pr, }\DataTypeTok{scales=}\KeywordTok{list}\NormalTok{(}\DataTypeTok{x=}\KeywordTok{list}\NormalTok{(}\DataTypeTok{rot=}\DecValTok{90}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-23-2.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{KMO}\NormalTok{(z)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Kaiser-Meyer-Olkin factor adequacy
## Call: KMO(r = z)
## Overall MSA =  0.74
## MSA for each item = 
##              Artist_Albums_Number       Artist_Albums_Tracks_Number 
##                              0.81                              0.70 
##         Artist_Appearances_Number  Artist_Appearances_Tracks_Number 
##                              0.56                              0.53 
##        Artist_Compilations_Number Artist_Compilations_Tracks_Number 
##                              0.71                              0.69 
##                   Artist_Follower             Artist_Singles_Number 
##                              0.71                              0.78 
##      Artist_Singles_Tracks_Number                 Track_Duration_ms 
##                              0.60                              0.70 
##                      commentCount                      dislikeCount 
##                              0.85                              0.84 
##                         likeCount                        viewsCount 
##                              0.80                              0.85 
##                      days_release 
##                              0.65
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# result: 0.74 overall: middling, every individual MSA value is as least as high as 0.53 (middling)}

\KeywordTok{cortest.bartlett}\NormalTok{(z) }\CommentTok{# result: correlation matrix is NOT an identity matrix, so proceed with factor analysis}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## R was not square, finding R from data
\end{verbatim}

\begin{verbatim}
## $chisq
## [1] 3167.088
## 
## $p.value
## [1] 0
## 
## $df
## [1] 105
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{scree}\NormalTok{(z)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-23-3.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(}\StringTok{"paran"}\NormalTok{)}
\KeywordTok{paran}\NormalTok{(z, }\DataTypeTok{centile=}\DecValTok{95}\NormalTok{, }\DataTypeTok{all=}\NormalTok{T, }\DataTypeTok{graph=}\NormalTok{T) }\CommentTok{# four factors are appropriate}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Using eigendecomposition of correlation matrix.
## Computing: 10%  20%  30%  40%  50%  60%  70%  80%  90%  100%
## 
## 
## Results of Horn's Parallel Analysis for component retention
## 450 iterations, using the 95 centile estimate
## 
## -------------------------------------------------- 
## Component   Adjusted    Unadjusted    Estimated 
##             Eigenvalue  Eigenvalue    Bias 
## -------------------------------------------------- 
## 1           3.979037    4.590215      0.611177
## 2           3.297855    3.761880      0.464025
## 3           1.670137    2.026943      0.356805
## 4           1.053988    1.333118      0.279130
## 5           0.744090    0.955038      0.210947
## 6           0.510641    0.649312      0.138671
## 7           0.517758    0.598370      0.080612
## 8           0.353105    0.377677      0.024572
## 9           0.276011    0.245019     -0.03099
## 10          0.260819    0.177595     -0.08322
## 11          0.243338    0.106222     -0.13711
## 12          0.287015    0.096959     -0.19005
## 13          0.277999    0.036315     -0.24168
## 14          0.320197    0.025889     -0.29430
## 15          0.377404    0.019441     -0.35796
## -------------------------------------------------- 
## 
## Adjusted eigenvalues > 1 indicate dimensions to retain.
## (4 components retained)
\end{verbatim}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-23-4.pdf}

Loadings

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pca <-}\StringTok{ }\KeywordTok{principal}\NormalTok{(z, }\DataTypeTok{nfactors=}\DecValTok{4}\NormalTok{, }\DataTypeTok{rotate=}\StringTok{"none"}\NormalTok{) }\CommentTok{# h2 are "communalities"}
\NormalTok{pa <-}\StringTok{ }\KeywordTok{fa}\NormalTok{(z, }\DataTypeTok{nfactors=}\DecValTok{4}\NormalTok{, }\DataTypeTok{rotate=}\StringTok{"none"}\NormalTok{, }\DataTypeTok{fm=}\StringTok{"pa"}\NormalTok{) }\CommentTok{# principal axis extraction}
\NormalTok{uls <-}\StringTok{ }\KeywordTok{fa}\NormalTok{(z, }\DataTypeTok{nfactors=}\DecValTok{4}\NormalTok{, }\DataTypeTok{rotate=}\StringTok{"none"}\NormalTok{)}
\NormalTok{ml <-}\StringTok{ }\KeywordTok{fa}\NormalTok{(z, }\DataTypeTok{nfactors=}\DecValTok{4}\NormalTok{, }\DataTypeTok{rotate=}\StringTok{"none"}\NormalTok{, }\DataTypeTok{fm=}\StringTok{"ml"}\NormalTok{)}
\KeywordTok{library}\NormalTok{(}\StringTok{"xtable"}\NormalTok{)}
\CommentTok{# xtable(unclass(ml$loadings))}
\KeywordTok{print}\NormalTok{(ml}\OperatorTok{$}\NormalTok{loadings, }\DataTypeTok{sort =}\NormalTok{ T)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Loadings:
##                                   ML2    ML3    ML1    ML4   
## commentCount                       0.965        -0.144       
## dislikeCount                       0.968        -0.161       
## likeCount                          0.980        -0.145       
## viewsCount                         0.943        -0.108       
## Artist_Albums_Number                      0.750  0.503       
## Artist_Albums_Tracks_Number               0.638  0.232  0.587
## Artist_Compilations_Number                0.876  0.365       
## Artist_Compilations_Tracks_Number         0.896  0.408       
## Artist_Singles_Number                     0.358  0.685 -0.206
## Artist_Singles_Tracks_Number             -0.105  0.988       
## Artist_Appearances_Number                        0.212  0.870
## Artist_Appearances_Tracks_Number                 0.231  0.551
## Artist_Follower                    0.335                     
## Track_Duration_ms                                0.268  0.375
## days_release                              0.384  0.106  0.392
## 
##                  ML2   ML3   ML1   ML4
## SS loadings    3.879 2.849 2.315 1.756
## Proportion Var 0.259 0.190 0.154 0.117
## Cumulative Var 0.259 0.449 0.603 0.720
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{print}\NormalTok{(ml}\OperatorTok{$}\NormalTok{loadings, }\DataTypeTok{cutoff=}\NormalTok{.}\DecValTok{4}\NormalTok{, }\DataTypeTok{sort =}\NormalTok{ T)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Loadings:
##                                   ML2    ML3    ML1    ML4   
## commentCount                       0.965                     
## dislikeCount                       0.968                     
## likeCount                          0.980                     
## viewsCount                         0.943                     
## Artist_Albums_Number                      0.750  0.503       
## Artist_Albums_Tracks_Number               0.638         0.587
## Artist_Compilations_Number                0.876              
## Artist_Compilations_Tracks_Number         0.896  0.408       
## Artist_Singles_Number                            0.685       
## Artist_Singles_Tracks_Number                     0.988       
## Artist_Appearances_Number                               0.870
## Artist_Appearances_Tracks_Number                        0.551
## Artist_Follower                                              
## Track_Duration_ms                                            
## days_release                                                 
## 
##                  ML2   ML3   ML1   ML4
## SS loadings    3.879 2.849 2.315 1.756
## Proportion Var 0.259 0.190 0.154 0.117
## Cumulative Var 0.259 0.449 0.603 0.720
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{42}\NormalTok{)}
\NormalTok{ml.varimax <-}\StringTok{ }\KeywordTok{fa}\NormalTok{(z, }\DataTypeTok{nfactors=}\DecValTok{4}\NormalTok{, }\DataTypeTok{rotate=}\StringTok{"varimax"}\NormalTok{, }\DataTypeTok{fm=}\StringTok{"ml"}\NormalTok{) }
\KeywordTok{print}\NormalTok{(ml.varimax}\OperatorTok{$}\NormalTok{loadings, }\DataTypeTok{cutoff=}\NormalTok{.}\DecValTok{4}\NormalTok{, }\DataTypeTok{sort =}\NormalTok{ T)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Loadings:
##                                   ML2    ML3    ML4    ML1   
## commentCount                       0.974                     
## dislikeCount                       0.979                     
## likeCount                          0.989                     
## viewsCount                         0.950                     
## Artist_Albums_Number                      0.857              
## Artist_Compilations_Number                0.948              
## Artist_Compilations_Tracks_Number         0.976              
## Artist_Albums_Tracks_Number               0.619  0.643       
## Artist_Appearances_Number                        0.898       
## Artist_Appearances_Tracks_Number                 0.587       
## Artist_Singles_Number                     0.555         0.579
## Artist_Singles_Tracks_Number                            0.955
## Artist_Follower                                              
## Track_Duration_ms                                0.430       
## days_release                                     0.417       
## 
##                  ML2   ML3   ML4   ML1
## SS loadings    3.922 3.457 2.015 1.404
## Proportion Var 0.261 0.230 0.134 0.094
## Cumulative Var 0.261 0.492 0.626 0.720
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# xtable(unclass(ml.varimax$loadings))}

\KeywordTok{fa.congruence}\NormalTok{(ml, ml.varimax)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##       ML2   ML3   ML4   ML1
## ML2  1.00 -0.07 -0.09 -0.01
## ML3 -0.01  0.98  0.33  0.17
## ML1 -0.20  0.69  0.45  0.89
## ML4 -0.03  0.14  0.96 -0.09
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfrow=}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{))}

\NormalTok{threshold <-}\StringTok{ }\FloatTok{0.4}
\KeywordTok{plot}\NormalTok{(ml.varimax}\OperatorTok{$}\NormalTok{loadings[,}\DecValTok{1}\NormalTok{], ml.varimax}\OperatorTok{$}\NormalTok{loadings[,}\DecValTok{2}\NormalTok{], }\DataTypeTok{xlim =} \KeywordTok{c}\NormalTok{(}\OperatorTok{-}\DecValTok{1}\NormalTok{, }\DecValTok{1}\NormalTok{), }\DataTypeTok{ylim =} \KeywordTok{c}\NormalTok{(}\OperatorTok{-}\DecValTok{1}\NormalTok{,}\FloatTok{1.1}\NormalTok{), }\DataTypeTok{xlab =} \StringTok{'ML2'}\NormalTok{, }\DataTypeTok{ylab =} \StringTok{'ML3'}\NormalTok{)}
\NormalTok{palette <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{'red'}\NormalTok{, }\StringTok{'blue'}\NormalTok{)}
\NormalTok{col_index <-}\StringTok{ }\KeywordTok{ifelse}\NormalTok{((}\KeywordTok{abs}\NormalTok{(ml.varimax}\OperatorTok{$}\NormalTok{loadings[,}\DecValTok{1}\NormalTok{]) }\OperatorTok{>}\StringTok{ }\NormalTok{threshold) }\OperatorTok{|}\StringTok{ }\NormalTok{(}\KeywordTok{abs}\NormalTok{(ml.varimax}\OperatorTok{$}\NormalTok{loadings[,}\DecValTok{2}\NormalTok{]) }\OperatorTok{>}\StringTok{ }\NormalTok{threshold), }\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{)}
\NormalTok{cols <-}\StringTok{ }\NormalTok{palette[}\KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{as.factor}\NormalTok{(col_index))]}
\KeywordTok{points}\NormalTok{(ml.varimax}\OperatorTok{$}\NormalTok{loadings[,}\DecValTok{1}\NormalTok{], ml.varimax}\OperatorTok{$}\NormalTok{loadings[,}\DecValTok{2}\NormalTok{], }\DataTypeTok{pch=}\DecValTok{19}\NormalTok{, }\DataTypeTok{col=}\NormalTok{cols)}
\KeywordTok{abline}\NormalTok{(}\DataTypeTok{h =} \DecValTok{0}\NormalTok{, }\DataTypeTok{v=} \DecValTok{0}\NormalTok{)}
\KeywordTok{text}\NormalTok{(ml.varimax}\OperatorTok{$}\NormalTok{loadings[,}\DecValTok{1}\OperatorTok{:}\DecValTok{2}\NormalTok{], }\KeywordTok{as.character}\NormalTok{(}\KeywordTok{rownames}\NormalTok{(ml.varimax}\OperatorTok{$}\NormalTok{loadings)), }\DataTypeTok{pos =} \DecValTok{1}\NormalTok{, }\DataTypeTok{cex =} \FloatTok{0.6}\NormalTok{, }\DataTypeTok{offset =} \FloatTok{0.5}\NormalTok{)}
\KeywordTok{rect}\NormalTok{(}\DataTypeTok{xleft =} \OperatorTok{-}\NormalTok{threshold, }\DataTypeTok{ybottom =} \OperatorTok{-}\NormalTok{threshold, }\DataTypeTok{xright =}\NormalTok{ threshold, }\DataTypeTok{ytop =}\NormalTok{ threshold)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-24-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# fa.diagram(ml.varimax, simple=TRUE, cut=.2, digits=2)}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{42}\NormalTok{)}
\NormalTok{ml.promax <-}\StringTok{ }\KeywordTok{fa}\NormalTok{(z, }\DataTypeTok{nfactors=}\DecValTok{4}\NormalTok{, }\DataTypeTok{rotate=}\StringTok{"promax"}\NormalTok{, }\DataTypeTok{fm=}\StringTok{"ml"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Loading required namespace: GPArotation
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{fa.congruence}\NormalTok{(ml.promax, ml.varimax)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##       ML2   ML3   ML4   ML1
## ML2  1.00 -0.01 -0.03 -0.08
## ML3 -0.01  0.99  0.19  0.29
## ML4  0.00  0.09  0.97  0.10
## ML1 -0.09  0.24  0.12  0.99
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ml.promax}\OperatorTok{$}\NormalTok{Phi}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##             ML2        ML3        ML4         ML1
## ML2  1.00000000 -0.1234826 -0.1397866  0.07121945
## ML3 -0.12348257  1.0000000  0.3651684  0.16587388
## ML4 -0.13978664  0.3651684  1.0000000 -0.00887250
## ML1  0.07121945  0.1658739 -0.0088725  1.00000000
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{print}\NormalTok{(ml.promax}\OperatorTok{$}\NormalTok{loadings, }\DataTypeTok{cutoff=}\NormalTok{.}\DecValTok{4}\NormalTok{, }\DataTypeTok{sort =}\NormalTok{ T)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Loadings:
##                                   ML2    ML3    ML4    ML1   
## commentCount                       0.984                     
## dislikeCount                       0.990                     
## likeCount                          0.999                     
## viewsCount                         0.962                     
## Artist_Albums_Number                      0.860              
## Artist_Albums_Tracks_Number               0.552  0.545       
## Artist_Compilations_Number                0.999              
## Artist_Compilations_Tracks_Number         1.018              
## Artist_Appearances_Number                        0.940       
## Artist_Appearances_Tracks_Number                 0.643       
## Artist_Singles_Number                     0.535         0.541
## Artist_Singles_Tracks_Number                            0.956
## Artist_Follower                                              
## Track_Duration_ms                                0.436       
## days_release                                                 
## 
##                  ML2   ML3   ML4   ML1
## SS loadings    3.989 3.519 2.033 1.346
## Proportion Var 0.266 0.235 0.136 0.090
## Cumulative Var 0.266 0.501 0.636 0.726
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#xtable(unclass(ml.promax$loadings))}

\KeywordTok{print}\NormalTok{(ml.promax}\OperatorTok{$}\NormalTok{Structure, }\DataTypeTok{cutoff =} \FloatTok{0.4}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Loadings:
##                                   ML2    ML3    ML4    ML1   
## Artist_Albums_Number                      0.889              
## Artist_Albums_Tracks_Number               0.721  0.744       
## Artist_Appearances_Number                        0.891       
## Artist_Appearances_Tracks_Number                 0.565       
## Artist_Compilations_Number                0.941              
## Artist_Compilations_Tracks_Number         0.980              
## Artist_Follower                                              
## Artist_Singles_Number                     0.582         0.632
## Artist_Singles_Tracks_Number                            0.958
## Track_Duration_ms                                0.449       
## commentCount                       0.974                     
## dislikeCount                       0.979                     
## likeCount                          0.989                     
## viewsCount                         0.947                     
## days_release                              0.426  0.477       
## 
##                  ML2   ML3   ML4   ML1
## SS loadings    3.969 3.890 2.427 1.548
## Proportion Var 0.265 0.259 0.162 0.103
## Cumulative Var 0.265 0.524 0.686 0.789
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# For orthoghonal rotations: cor(item, factor) = loadings ("pattern") matrix = structure matrix, }
\CommentTok{# since structure matrix = loadings matrix *%* factor intercorrelation matrix (which is identity for orthogonal rotations)}
\CommentTok{# example: ml.promax$loadings %*% ml.promax$Phi = structure matrix}


\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfrow=}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{))}

\NormalTok{threshold <-}\StringTok{ }\FloatTok{0.5}
\KeywordTok{plot}\NormalTok{(ml.promax}\OperatorTok{$}\NormalTok{Structure[,}\DecValTok{1}\NormalTok{], ml.promax}\OperatorTok{$}\NormalTok{Structure[,}\DecValTok{2}\NormalTok{], }\DataTypeTok{xlim =} \KeywordTok{c}\NormalTok{(}\OperatorTok{-}\DecValTok{1}\NormalTok{, }\DecValTok{1}\NormalTok{), }\DataTypeTok{ylim =} \KeywordTok{c}\NormalTok{(}\OperatorTok{-}\DecValTok{1}\NormalTok{,}\FloatTok{1.1}\NormalTok{), }\DataTypeTok{xlab =} \StringTok{'ML2'}\NormalTok{, }\DataTypeTok{ylab =} \StringTok{'ML3'}\NormalTok{)}
\NormalTok{palette <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{'red'}\NormalTok{, }\StringTok{'blue'}\NormalTok{)}
\NormalTok{col_index <-}\StringTok{ }\KeywordTok{ifelse}\NormalTok{((}\KeywordTok{abs}\NormalTok{(ml.promax}\OperatorTok{$}\NormalTok{Structure[,}\DecValTok{1}\NormalTok{]) }\OperatorTok{>}\StringTok{ }\NormalTok{threshold) }\OperatorTok{|}\StringTok{ }\NormalTok{(}\KeywordTok{abs}\NormalTok{(ml.promax}\OperatorTok{$}\NormalTok{Structure[,}\DecValTok{2}\NormalTok{]) }\OperatorTok{>}\StringTok{ }\NormalTok{threshold), }\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{)}
\NormalTok{cols <-}\StringTok{ }\NormalTok{palette[}\KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{as.factor}\NormalTok{(col_index))]}
\KeywordTok{points}\NormalTok{(ml.promax}\OperatorTok{$}\NormalTok{Structure[,}\DecValTok{1}\NormalTok{], ml.promax}\OperatorTok{$}\NormalTok{Structure[,}\DecValTok{2}\NormalTok{], }\DataTypeTok{pch=}\DecValTok{19}\NormalTok{, }\DataTypeTok{col=}\NormalTok{cols)}
\KeywordTok{abline}\NormalTok{(}\DataTypeTok{h =} \DecValTok{0}\NormalTok{, }\DataTypeTok{v=} \DecValTok{0}\NormalTok{)}
\KeywordTok{text}\NormalTok{(ml.promax}\OperatorTok{$}\NormalTok{Structure[,}\DecValTok{1}\OperatorTok{:}\DecValTok{2}\NormalTok{], }\KeywordTok{as.character}\NormalTok{(}\KeywordTok{rownames}\NormalTok{(ml.promax}\OperatorTok{$}\NormalTok{Structure)), }\DataTypeTok{pos =} \DecValTok{1}\NormalTok{, }\DataTypeTok{cex =} \FloatTok{0.6}\NormalTok{, }\DataTypeTok{offset =} \FloatTok{0.5}\NormalTok{)}
\KeywordTok{rect}\NormalTok{(}\DataTypeTok{xleft =} \OperatorTok{-}\NormalTok{threshold, }\DataTypeTok{ybottom =} \OperatorTok{-}\NormalTok{threshold, }\DataTypeTok{xright =}\NormalTok{ threshold, }\DataTypeTok{ytop =}\NormalTok{ threshold)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-24-2.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fa1 <-}\KeywordTok{factanal}\NormalTok{(z, }\DataTypeTok{factors=}\DecValTok{4}\NormalTok{, }\DataTypeTok{scores =} \StringTok{'regression'}\NormalTok{, }\DataTypeTok{lower =} \FloatTok{0.1}\NormalTok{) }\CommentTok{# ML with Kaiser normalization }
\KeywordTok{head}\NormalTok{(fa1}\OperatorTok{$}\NormalTok{scores)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##       Factor1   Factor2    Factor3    Factor4
## 1 -0.09032514 4.7229399 -1.1982826  1.1913023
## 2 -0.06532926 1.9592530  0.6796187  1.9294387
## 3 -0.17155114 1.2161697  2.5043243 -0.6176557
## 4 -0.14220859 4.8213406 -1.0227099  0.2499034
## 5 -0.15666866 6.0158376 -1.7644434 -0.1556914
## 6 -0.16905143 0.1190256  2.0571621 -0.1523273
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fa2 <-}\StringTok{ }\KeywordTok{fa}\NormalTok{(z, }\DataTypeTok{nfactors=}\DecValTok{4}\NormalTok{) }\CommentTok{# oblimin rotation without Kaiser normalization}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning in fa.stats(r = r, f = f, phi = phi, n.obs = n.obs, np.obs = np.obs, :
## The estimated weights for the factor scores are probably incorrect. Try a
## different factor score estimation method.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{head}\NormalTok{(fa2}\OperatorTok{$}\NormalTok{scores)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##          MR2       MR1        MR3        MR4
## 1 -0.1257348 4.9076402 -1.4064326  3.2185555
## 2 -0.2186062 2.3024182  0.7123318  2.1407078
## 3 -0.2078290 1.3247000  2.3948606 -0.3356255
## 4 -0.1849004 4.2448612  0.0405285  1.8486009
## 5 -0.2345250 5.4651211 -0.7047564  1.0788027
## 6 -0.2682063 0.3496226  1.8536951  0.1795223
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{cor}\NormalTok{(fa1}\OperatorTok{$}\NormalTok{scores, fa2}\OperatorTok{$}\NormalTok{scores)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##                 MR2         MR1         MR3        MR4
## Factor1  0.99066727 -0.04263156 -0.03183455 0.02879820
## Factor2 -0.02300522  0.98601395  0.12472840 0.27124108
## Factor3 -0.03546517  0.11316250  0.97914604 0.09737382
## Factor4 -0.05458080  0.13298949 -0.03618965 0.93878256
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{cor}\NormalTok{(fa1}\OperatorTok{$}\NormalTok{scores, ml.promax}\OperatorTok{$}\NormalTok{scores)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##                  ML2         ML3         ML4         ML1
## Factor1  0.995994444 -0.06746742 -0.08311111 0.060236052
## Factor2 -0.051288886  0.97618626  0.22252324 0.086347208
## Factor3 -0.056169205  0.17796182  0.97556026 0.002189822
## Factor4  0.007625069  0.11489683  0.02445173 0.989366259
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{cor}\NormalTok{(ml.promax}\OperatorTok{$}\NormalTok{scores, ml.varimax}\OperatorTok{$}\NormalTok{scores)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##             ML2         ML3          ML4        ML1
## ML2  0.99714527 -0.05043569 -0.058887859 0.01154380
## ML3 -0.06617328  0.97785070  0.193263920 0.08735674
## ML4 -0.08094263  0.19810346  0.979273972 0.03916156
## ML1  0.06253243  0.10010835 -0.004175889 0.99271103
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fa_bartlett_scores <-}\StringTok{ }\KeywordTok{fa}\NormalTok{(z, }\DataTypeTok{nfactors=}\DecValTok{4}\NormalTok{, }\DataTypeTok{rotate=}\StringTok{"varimax"}\NormalTok{, }\DataTypeTok{fm=}\StringTok{"ml"}\NormalTok{, }\DataTypeTok{scores =} \StringTok{'Bartlett'}\NormalTok{)}
\KeywordTok{cor}\NormalTok{(ml.varimax}\OperatorTok{$}\NormalTok{scores, fa_bartlett_scores}\OperatorTok{$}\NormalTok{scores)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##               ML2           ML3          ML4           ML1
## ML2  9.999945e-01 -1.574145e-18 8.383016e-17 -1.545713e-17
## ML3  4.392591e-17  9.999300e-01 7.699237e-16 -1.960363e-16
## ML4  3.900769e-18  7.222804e-19 9.995550e-01  3.371781e-17
## ML1 -5.920793e-18 -3.169430e-16 5.198842e-16  9.996269e-01
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{cor}\NormalTok{(fa_bartlett_scores}\OperatorTok{$}\NormalTok{scores)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##               ML2           ML3          ML4           ML1
## ML2  1.0000000000  0.0003036624  0.003257071 -0.0006236104
## ML3  0.0003036624  1.0000000000 -0.011669369 -0.0016210978
## ML4  0.0032570710 -0.0116693685  1.000000000 -0.0272409055
## ML1 -0.0006236104 -0.0016210978 -0.027240905  1.0000000000
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# sum scores}

\NormalTok{threshold <-}\StringTok{ }\FloatTok{0.5}

\NormalTok{vars_}\DecValTok{1}\NormalTok{ <-}\StringTok{ }\KeywordTok{abs}\NormalTok{(ml.promax}\OperatorTok{$}\NormalTok{Structure[,}\DecValTok{1}\NormalTok{])}\OperatorTok{>}\NormalTok{threshold}
\NormalTok{vars_}\DecValTok{2}\NormalTok{ <-}\StringTok{ }\KeywordTok{abs}\NormalTok{(ml.promax}\OperatorTok{$}\NormalTok{Structure[,}\DecValTok{2}\NormalTok{])}\OperatorTok{>}\NormalTok{threshold}
\NormalTok{vars_}\DecValTok{3}\NormalTok{ <-}\StringTok{ }\KeywordTok{abs}\NormalTok{(ml.promax}\OperatorTok{$}\NormalTok{Structure[,}\DecValTok{3}\NormalTok{])}\OperatorTok{>}\NormalTok{threshold}
\NormalTok{vars_}\DecValTok{4}\NormalTok{ <-}\StringTok{ }\KeywordTok{abs}\NormalTok{(ml.promax}\OperatorTok{$}\NormalTok{Structure[,}\DecValTok{4}\NormalTok{])}\OperatorTok{>}\NormalTok{threshold}

\NormalTok{key.list <-}\StringTok{ }\KeywordTok{list}\NormalTok{(}\DataTypeTok{one =} \KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{which}\NormalTok{(vars_}\DecValTok{1}\OperatorTok{==}\DecValTok{1}\NormalTok{)), }
                \DataTypeTok{two =} \KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{which}\NormalTok{(vars_}\DecValTok{2}\OperatorTok{==}\DecValTok{1}\NormalTok{)), }
                \DataTypeTok{three =} \KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{which}\NormalTok{(vars_}\DecValTok{3}\OperatorTok{==}\DecValTok{1}\NormalTok{)), }
                \DataTypeTok{four =} \KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{which}\NormalTok{(vars_}\DecValTok{4}\OperatorTok{==}\DecValTok{1}\NormalTok{)))}

\NormalTok{sign.mat <-}\StringTok{ }\KeywordTok{cbind}\NormalTok{(}\KeywordTok{sign}\NormalTok{(ml.promax}\OperatorTok{$}\NormalTok{Structure[,}\DecValTok{1}\NormalTok{]), }
                      \KeywordTok{sign}\NormalTok{(ml.promax}\OperatorTok{$}\NormalTok{Structure[,}\DecValTok{2}\NormalTok{]),}
                      \KeywordTok{sign}\NormalTok{(ml.promax}\OperatorTok{$}\NormalTok{Structure[,}\DecValTok{3}\NormalTok{]),}
                      \KeywordTok{sign}\NormalTok{(ml.promax}\OperatorTok{$}\NormalTok{Structure[,}\DecValTok{4}\NormalTok{]))}

\NormalTok{keys <-}\StringTok{ }\KeywordTok{make.keys}\NormalTok{(z, key.list,}\DataTypeTok{item.labels =} \KeywordTok{colnames}\NormalTok{(z))}

\NormalTok{si <-}\StringTok{ }\KeywordTok{scoreItems}\NormalTok{(keys }\OperatorTok{*}\StringTok{ }\NormalTok{sign.mat, z) }\CommentTok{# these are the scores I finally use}

\KeywordTok{pairs}\NormalTok{(}\KeywordTok{cbind}\NormalTok{(si}\OperatorTok{$}\NormalTok{scores[,}\DecValTok{1}\NormalTok{], si}\OperatorTok{$}\NormalTok{scores[,}\DecValTok{2}\NormalTok{], si}\OperatorTok{$}\NormalTok{scores[,}\DecValTok{3}\NormalTok{], si}\OperatorTok{$}\NormalTok{scores[,}\DecValTok{4}\NormalTok{]))}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-25-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{cor}\NormalTok{(}\KeywordTok{cbind}\NormalTok{(si}\OperatorTok{$}\NormalTok{scores[,}\DecValTok{1}\NormalTok{], si}\OperatorTok{$}\NormalTok{scores[,}\DecValTok{2}\NormalTok{], si}\OperatorTok{$}\NormalTok{scores[,}\DecValTok{3}\NormalTok{], si}\OperatorTok{$}\NormalTok{scores[,}\DecValTok{4}\NormalTok{]))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##             [,1]        [,2]        [,3]        [,4]
## [1,]  1.00000000 -0.07190494 -0.04542303 -0.04038714
## [2,] -0.07190494  1.00000000  0.42361028  0.62898318
## [3,] -0.04542303  0.42361028  1.00000000  0.19564730
## [4,] -0.04038714  0.62898318  0.19564730  1.00000000
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{print}\NormalTok{(ml.promax}\OperatorTok{$}\NormalTok{loadings, }\DataTypeTok{cutoff =} \FloatTok{0.5}\NormalTok{, }\DataTypeTok{sort =}\NormalTok{ T)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Loadings:
##                                   ML2    ML3    ML4    ML1   
## commentCount                       0.984                     
## dislikeCount                       0.990                     
## likeCount                          0.999                     
## viewsCount                         0.962                     
## Artist_Albums_Number                      0.860              
## Artist_Albums_Tracks_Number               0.552  0.545       
## Artist_Compilations_Number                0.999              
## Artist_Compilations_Tracks_Number         1.018              
## Artist_Appearances_Number                        0.940       
## Artist_Appearances_Tracks_Number                 0.643       
## Artist_Singles_Number                     0.535         0.541
## Artist_Singles_Tracks_Number                            0.956
## Artist_Follower                                              
## Track_Duration_ms                                            
## days_release                                                 
## 
##                  ML2   ML3   ML4   ML1
## SS loadings    3.989 3.519 2.033 1.346
## Proportion Var 0.266 0.235 0.136 0.090
## Cumulative Var 0.266 0.501 0.636 0.726
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# I apply a threshold of 0.5 for manual computation of sum scores}

\NormalTok{f2 <-}\StringTok{ }\NormalTok{(z[,}\DecValTok{11}\NormalTok{] }\OperatorTok{+}\StringTok{ }\NormalTok{z[,}\DecValTok{12}\NormalTok{] }\OperatorTok{+}\StringTok{ }\NormalTok{z[,}\DecValTok{13}\NormalTok{] }\OperatorTok{+}\StringTok{ }\NormalTok{z[,}\DecValTok{14}\NormalTok{])}\OperatorTok{/}\DecValTok{4} \CommentTok{# commentCount, dislikeCount, likeCount, viewsCount}
\NormalTok{f3 <-}\StringTok{ }\NormalTok{(z[,}\DecValTok{1}\NormalTok{] }\OperatorTok{+}\StringTok{ }\NormalTok{z[,}\DecValTok{2}\NormalTok{] }\OperatorTok{+}\StringTok{ }\NormalTok{z[,}\DecValTok{5}\NormalTok{])}\OperatorTok{/}\DecValTok{3} \CommentTok{# Artist_Albums_Number, Artist_Compilations_Number, Artist_Compilations_Tracks_Number}
\NormalTok{f4 <-}\StringTok{ }\NormalTok{(z[,}\DecValTok{2}\NormalTok{] }\OperatorTok{+}\StringTok{ }\NormalTok{z[,}\DecValTok{3}\NormalTok{] }\OperatorTok{+}\StringTok{ }\NormalTok{z[,}\DecValTok{4}\NormalTok{])}\OperatorTok{/}\DecValTok{3} \CommentTok{# Artist_Albums_Tracks_Number, Artist_Appearances_Number, Artist_Appearances_Tracks_Number}
\NormalTok{f1 <-}\StringTok{ }\NormalTok{(z[,}\DecValTok{8}\NormalTok{] }\OperatorTok{+}\StringTok{ }\NormalTok{z[,}\DecValTok{9}\NormalTok{])}\OperatorTok{/}\DecValTok{2} \CommentTok{# Artist_Singles_Number, Artist_Singles_Tracks_Number}

\KeywordTok{pairs}\NormalTok{(}\KeywordTok{cbind}\NormalTok{(f2, f3, f4, f1))}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-25-2.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{cor}\NormalTok{(}\KeywordTok{cbind}\NormalTok{(f2, f3, f4, f1))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##             f2          f3          f4          f1
## f2  1.00000000 -0.08246012 -0.04542303 -0.04038714
## f3 -0.08246012  1.00000000  0.51683413  0.47961885
## f4 -0.04542303  0.51683413  1.00000000  0.19564730
## f1 -0.04038714  0.47961885  0.19564730  1.00000000
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{psych}\OperatorTok{::}\KeywordTok{alpha}\NormalTok{(}\KeywordTok{cor}\NormalTok{(z[,vars_}\DecValTok{1}\NormalTok{]), }\DataTypeTok{check.keys =}\NormalTok{ T) }\CommentTok{# commentCount, dislikeCount, likeCount, viewsCount}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Reliability analysis   
## Call: psych::alpha(x = cor(z[, vars_1]), check.keys = T)
## 
##   raw_alpha std.alpha G6(smc) average_r S/N median_r
##       0.99      0.99    0.99      0.95  74     0.96
## 
##  Reliability if an item is dropped:
##              raw_alpha std.alpha G6(smc) average_r S/N   var.r med.r
## commentCount      0.98      0.98    0.98      0.95  55 7.2e-04  0.95
## dislikeCount      0.98      0.98    0.98      0.94  49 9.3e-04  0.95
## likeCount         0.98      0.98    0.97      0.93  42 1.2e-03  0.92
## viewsCount        0.99      0.99    0.98      0.97  96 1.5e-05  0.97
## 
##  Item statistics 
##                 r r.cor r.drop
## commentCount 0.98  0.97   0.97
## dislikeCount 0.98  0.98   0.97
## likeCount    0.99  0.99   0.99
## viewsCount   0.96  0.95   0.94
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{psych}\OperatorTok{::}\KeywordTok{alpha}\NormalTok{(}\KeywordTok{cor}\NormalTok{(z[,vars_}\DecValTok{2}\NormalTok{]), }\DataTypeTok{check.keys =}\NormalTok{ T) }\CommentTok{# Artist_Albums_Number, Artist_Albums_Tracks_Number, Artist_Compilations_Number, Artist_Compilations_Tracks_Number, Artist_Singles_Number}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Reliability analysis   
## Call: psych::alpha(x = cor(z[, vars_2]), check.keys = T)
## 
##   raw_alpha std.alpha G6(smc) average_r S/N median_r
##       0.91      0.91    0.92      0.66 9.7     0.63
## 
##  Reliability if an item is dropped:
##                                   raw_alpha std.alpha G6(smc) average_r  S/N
## Artist_Albums_Number                   0.86      0.86    0.88      0.60  6.1
## Artist_Albums_Tracks_Number            0.92      0.92    0.92      0.75 11.7
## Artist_Compilations_Number             0.86      0.86    0.87      0.61  6.2
## Artist_Compilations_Tracks_Number      0.85      0.85    0.85      0.59  5.7
## Artist_Singles_Number                  0.92      0.92    0.93      0.75 12.1
##                                   var.r med.r
## Artist_Albums_Number              0.047  0.60
## Artist_Albums_Tracks_Number       0.024  0.72
## Artist_Compilations_Number        0.039  0.63
## Artist_Compilations_Tracks_Number 0.034  0.61
## Artist_Singles_Number             0.023  0.74
## 
##  Item statistics 
##                                      r r.cor r.drop
## Artist_Albums_Number              0.93  0.92   0.89
## Artist_Albums_Tracks_Number       0.73  0.64   0.59
## Artist_Compilations_Number        0.93  0.94   0.88
## Artist_Compilations_Tracks_Number 0.95  0.97   0.92
## Artist_Singles_Number             0.72  0.62   0.58
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{psych}\OperatorTok{::}\KeywordTok{alpha}\NormalTok{(}\KeywordTok{cor}\NormalTok{(z[,vars_}\DecValTok{3}\NormalTok{]), }\DataTypeTok{check.keys =}\NormalTok{ T) }\CommentTok{# Artist_Albums_Tracks_Number, Artist_Appearances_Number, Artist_Appearances_Tracks_Number, Track_Duration_ms }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Reliability analysis   
## Call: psych::alpha(x = cor(z[, vars_3]), check.keys = T)
## 
##   raw_alpha std.alpha G6(smc) average_r S/N median_r
##       0.74      0.74    0.69      0.48 2.8     0.52
## 
##  Reliability if an item is dropped:
##                                  raw_alpha std.alpha G6(smc) average_r  S/N
## Artist_Albums_Tracks_Number           0.69      0.69    0.52      0.52 2.18
## Artist_Appearances_Number             0.47      0.47    0.31      0.31 0.88
## Artist_Appearances_Tracks_Number      0.76      0.76    0.62      0.62 3.21
##                                  var.r med.r
## Artist_Albums_Tracks_Number         NA  0.52
## Artist_Appearances_Number           NA  0.31
## Artist_Appearances_Tracks_Number    NA  0.62
## 
##  Item statistics 
##                                     r r.cor r.drop
## Artist_Albums_Tracks_Number      0.79  0.65   0.53
## Artist_Appearances_Number        0.88  0.82   0.70
## Artist_Appearances_Tracks_Number 0.75  0.55   0.46
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{psych}\OperatorTok{::}\KeywordTok{alpha}\NormalTok{(}\KeywordTok{cor}\NormalTok{(z[,vars_}\DecValTok{4}\NormalTok{]), }\DataTypeTok{check.keys =}\NormalTok{ T) }\CommentTok{# Artist_Singles_Number, Artist_Singles_Tracks_Number}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning in matrix(unlist(drop.item), ncol = 10, byrow = TRUE): Datenlänge [16]
## ist kein Teiler oder Vielfaches der Anzahl der Spalten [10]
\end{verbatim}

\begin{verbatim}
## 
## Reliability analysis   
## Call: psych::alpha(x = cor(z[, vars_4]), check.keys = T)
## 
##   raw_alpha std.alpha G6(smc) average_r S/N median_r
##       0.78      0.78    0.65      0.65 3.6     0.65
## 
##  Reliability if an item is dropped:
##                              raw_alpha std.alpha G6(smc) average_r S/N var.r
## Artist_Singles_Number             0.65      0.65    0.42      0.65  NA  0.65
## Artist_Singles_Tracks_Number      0.42      0.65      NA        NA  NA  0.42
##                              med.r
## Artist_Singles_Number         0.65
## Artist_Singles_Tracks_Number  0.65
## 
##  Item statistics 
##                                 r r.cor r.drop
## Artist_Singles_Number        0.91  0.73   0.65
## Artist_Singles_Tracks_Number 0.91  0.73   0.65
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{items_}\DecValTok{1}\NormalTok{ <-}\StringTok{ }\KeywordTok{reverse.code}\NormalTok{((keys[,}\DecValTok{1}\NormalTok{] }\OperatorTok{*}\StringTok{ }\NormalTok{sign.mat[,}\DecValTok{1}\NormalTok{])[(keys[,}\DecValTok{1}\NormalTok{] }\OperatorTok{*}\StringTok{ }\NormalTok{sign.mat[,}\DecValTok{1}\NormalTok{]) }\OperatorTok{!=}\StringTok{ }\DecValTok{0}\NormalTok{], z[, vars_}\DecValTok{1}\NormalTok{])}
\NormalTok{items_}\DecValTok{2}\NormalTok{ <-}\StringTok{ }\KeywordTok{reverse.code}\NormalTok{((keys[,}\DecValTok{2}\NormalTok{] }\OperatorTok{*}\StringTok{ }\NormalTok{sign.mat[,}\DecValTok{2}\NormalTok{])[(keys[,}\DecValTok{2}\NormalTok{] }\OperatorTok{*}\StringTok{ }\NormalTok{sign.mat[,}\DecValTok{2}\NormalTok{]) }\OperatorTok{!=}\StringTok{ }\DecValTok{0}\NormalTok{], z[, vars_}\DecValTok{2}\NormalTok{])}
\NormalTok{items_}\DecValTok{3}\NormalTok{ <-}\StringTok{ }\KeywordTok{reverse.code}\NormalTok{((keys[,}\DecValTok{3}\NormalTok{] }\OperatorTok{*}\StringTok{ }\NormalTok{sign.mat[,}\DecValTok{3}\NormalTok{])[(keys[,}\DecValTok{3}\NormalTok{] }\OperatorTok{*}\StringTok{ }\NormalTok{sign.mat[,}\DecValTok{3}\NormalTok{]) }\OperatorTok{!=}\StringTok{ }\DecValTok{0}\NormalTok{], z[, vars_}\DecValTok{3}\NormalTok{])}
\NormalTok{items_}\DecValTok{4}\NormalTok{ <-}\StringTok{ }\KeywordTok{reverse.code}\NormalTok{((keys[,}\DecValTok{4}\NormalTok{] }\OperatorTok{*}\StringTok{ }\NormalTok{sign.mat[,}\DecValTok{4}\NormalTok{])[(keys[,}\DecValTok{4}\NormalTok{] }\OperatorTok{*}\StringTok{ }\NormalTok{sign.mat[,}\DecValTok{4}\NormalTok{]) }\OperatorTok{!=}\StringTok{ }\DecValTok{0}\NormalTok{], z[, vars_}\DecValTok{4}\NormalTok{])}

\KeywordTok{library}\NormalTok{(}\StringTok{"additivityTests"}\NormalTok{)}

\KeywordTok{tukey.test}\NormalTok{(items_}\DecValTok{1}\NormalTok{) }\CommentTok{# result: H0 rejected, i.e. sum score is insufficient to represent the variables (factor 2)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Tukey test on 5% alpha-level:
## 
## Test statistic: 16.19 
## Critival value: 3.857 
## The additivity hypothesis was rejected.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{tukey.test}\NormalTok{(items_}\DecValTok{2}\NormalTok{) }\CommentTok{# result: H0 rejected (factor 3)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Tukey test on 5% alpha-level:
## 
## Test statistic: 9.276 
## Critival value: 3.853 
## The additivity hypothesis was rejected.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{tukey.test}\NormalTok{(items_}\DecValTok{3}\NormalTok{) }\CommentTok{# result: H0 cannot be rejected (factor 4)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Tukey test on 5% alpha-level:
## 
## Test statistic: 0.3105 
## Critival value: 3.865 
## The additivity hypothesis cannot be rejected.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{tukey.test}\NormalTok{(items_}\DecValTok{4}\NormalTok{) }\CommentTok{# result: H0 cannot be rejected (factor 1)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Tukey test on 5% alpha-level:
## 
## Test statistic: 0.004627 
## Critival value: 3.89 
## The additivity hypothesis cannot be rejected.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{cor}\NormalTok{(ml.promax}\OperatorTok{$}\NormalTok{scores, si}\OperatorTok{$}\NormalTok{scores)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##             one         two        three         four
## ML2  0.99592621 -0.09140514 -0.079332072 -0.002099964
## ML3 -0.09594147  0.97336006  0.416099225  0.487503635
## ML4 -0.11258045  0.39562748  0.960537575  0.200024816
## ML1  0.01023158  0.29765356 -0.008730584  0.882141227
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fa_bartlett_scores <-}\StringTok{ }\KeywordTok{fa}\NormalTok{(z, }\DataTypeTok{nfactors=}\DecValTok{4}\NormalTok{, }\DataTypeTok{rotate=}\StringTok{"promax"}\NormalTok{, }\DataTypeTok{fm=}\StringTok{"ml"}\NormalTok{, }\DataTypeTok{scores =} \StringTok{'Bartlett'}\NormalTok{)}
\KeywordTok{cor}\NormalTok{(ml.promax}\OperatorTok{$}\NormalTok{scores, fa_bartlett_scores}\OperatorTok{$}\NormalTok{scores)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##             ML2        ML3          ML4          ML1
## ML2  0.99999331 -0.1228703 -0.132348818  0.071013967
## ML3 -0.12409086  0.9999497  0.347443877  0.166211182
## ML4 -0.14750946  0.3834347  0.999105855 -0.009335731
## ML1  0.07138876  0.1654449 -0.008420436  0.999492034
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{cor}\NormalTok{(si}\OperatorTok{$}\NormalTok{scores, fa_bartlett_scores}\OperatorTok{$}\NormalTok{scores)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##                ML2         ML3         ML4         ML1
## one    0.995760702 -0.09422492 -0.09953451  0.01023589
## two   -0.091504358  0.97260263  0.36373011  0.29006661
## three -0.082455588  0.42220226  0.95965169 -0.03857534
## four  -0.001308527  0.48171167  0.16518758  0.87773348
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{cor}\NormalTok{(}\KeywordTok{cbind}\NormalTok{(f2, f3, f4, f1), si}\OperatorTok{$}\NormalTok{scores) }\CommentTok{# are almost identical now}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##            one         two       three        four
## f2  1.00000000 -0.07190494 -0.04542303 -0.04038714
## f3 -0.08246012  0.97220279  0.51683413  0.47961885
## f4 -0.04542303  0.42361028  1.00000000  0.19564730
## f1 -0.04038714  0.62898318  0.19564730  1.00000000
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{cor}\NormalTok{(}\KeywordTok{cbind}\NormalTok{(f2, f3, f4, f1), fa_bartlett_scores}\OperatorTok{$}\NormalTok{scores)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##             ML2         ML3         ML4         ML1
## f2  0.995760702 -0.09422492 -0.09953451  0.01023589
## f3 -0.113694191  0.96801245  0.47604146  0.14747026
## f4 -0.082455588  0.42220226  0.95965169 -0.03857534
## f1 -0.001308527  0.48171167  0.16518758  0.87773348
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{cor}\NormalTok{(si}\OperatorTok{$}\NormalTok{scores, fa_bartlett_scores}\OperatorTok{$}\NormalTok{scores)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##                ML2         ML3         ML4         ML1
## one    0.995760702 -0.09422492 -0.09953451  0.01023589
## two   -0.091504358  0.97260263  0.36373011  0.29006661
## three -0.082455588  0.42220226  0.95965169 -0.03857534
## four  -0.001308527  0.48171167  0.16518758  0.87773348
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# I choose the manually computed scoreItems and sum scores omitting <= 0.5 structure loadings and assigning the item with the larger loading to a single factor in case of ambiguity}

\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfrow=}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{))}
\KeywordTok{hist}\NormalTok{(ml.promax}\OperatorTok{$}\NormalTok{scores[,}\DecValTok{1}\NormalTok{], }\DataTypeTok{main =} \StringTok{'Youtube popularity factor'}\NormalTok{, }\DataTypeTok{xlab =} \StringTok{'Score corresponding to factor 2 (promax)'}\NormalTok{)}
\KeywordTok{rug}\NormalTok{(ml.promax}\OperatorTok{$}\NormalTok{scores[}\KeywordTok{ifelse}\NormalTok{(x[complete_index, }\StringTok{'Charts'}\NormalTok{] }\OperatorTok{==}\StringTok{ }\DecValTok{1}\NormalTok{, }\OtherTok{TRUE}\NormalTok{, }\OtherTok{FALSE}\NormalTok{), }\DecValTok{1}\NormalTok{], }\DataTypeTok{col=}\StringTok{"blue"}\NormalTok{)}
\KeywordTok{rug}\NormalTok{(ml.promax}\OperatorTok{$}\NormalTok{scores[}\KeywordTok{ifelse}\NormalTok{(x[complete_index, }\StringTok{'Charts'}\NormalTok{] }\OperatorTok{!=}\StringTok{ }\DecValTok{1}\NormalTok{, }\OtherTok{TRUE}\NormalTok{, }\OtherTok{FALSE}\NormalTok{), }\DecValTok{1}\NormalTok{], }\DataTypeTok{col=}\StringTok{"red"}\NormalTok{)}

\KeywordTok{hist}\NormalTok{(ml.promax}\OperatorTok{$}\NormalTok{scores[,}\DecValTok{2}\NormalTok{], }\DataTypeTok{main =} \StringTok{'Music supply factor'}\NormalTok{, }\DataTypeTok{xlab =} \StringTok{'Score corresponding to factor 3 (promax)'}\NormalTok{)}
\KeywordTok{rug}\NormalTok{(ml.promax}\OperatorTok{$}\NormalTok{scores[}\KeywordTok{ifelse}\NormalTok{(x[complete_index, }\StringTok{'Charts'}\NormalTok{] }\OperatorTok{==}\StringTok{ }\DecValTok{1}\NormalTok{, }\OtherTok{TRUE}\NormalTok{, }\OtherTok{FALSE}\NormalTok{), }\DecValTok{2}\NormalTok{], }\DataTypeTok{col=}\StringTok{"blue"}\NormalTok{)}
\KeywordTok{rug}\NormalTok{(ml.promax}\OperatorTok{$}\NormalTok{scores[}\KeywordTok{ifelse}\NormalTok{(x[complete_index, }\StringTok{'Charts'}\NormalTok{] }\OperatorTok{!=}\StringTok{ }\DecValTok{1}\NormalTok{, }\OtherTok{TRUE}\NormalTok{, }\OtherTok{FALSE}\NormalTok{), }\DecValTok{2}\NormalTok{], }\DataTypeTok{col=}\StringTok{"red"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-25-3.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfrow=}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{))}
\KeywordTok{hist}\NormalTok{(si}\OperatorTok{$}\NormalTok{scores[,}\DecValTok{1}\NormalTok{], }\DataTypeTok{main =} \StringTok{'Youtube popularity factor'}\NormalTok{, }\DataTypeTok{xlab =} \StringTok{'Score corresponding to factor 2 (promax)'}\NormalTok{)}
\KeywordTok{rug}\NormalTok{(si}\OperatorTok{$}\NormalTok{scores[}\KeywordTok{ifelse}\NormalTok{(x[complete_index, }\StringTok{'Charts'}\NormalTok{] }\OperatorTok{==}\StringTok{ }\DecValTok{1}\NormalTok{, }\OtherTok{TRUE}\NormalTok{, }\OtherTok{FALSE}\NormalTok{), }\DecValTok{1}\NormalTok{], }\DataTypeTok{col=}\StringTok{"blue"}\NormalTok{)}
\KeywordTok{rug}\NormalTok{(si}\OperatorTok{$}\NormalTok{scores[}\KeywordTok{ifelse}\NormalTok{(x[complete_index, }\StringTok{'Charts'}\NormalTok{] }\OperatorTok{!=}\StringTok{ }\DecValTok{1}\NormalTok{, }\OtherTok{TRUE}\NormalTok{, }\OtherTok{FALSE}\NormalTok{), }\DecValTok{1}\NormalTok{], }\DataTypeTok{col=}\StringTok{"red"}\NormalTok{)}

\KeywordTok{hist}\NormalTok{(si}\OperatorTok{$}\NormalTok{scores[,}\DecValTok{2}\NormalTok{], }\DataTypeTok{main =} \StringTok{'Music supply factor'}\NormalTok{, }\DataTypeTok{xlab =} \StringTok{'Score corresponding to factor 3 (promax)'}\NormalTok{)}
\KeywordTok{rug}\NormalTok{(si}\OperatorTok{$}\NormalTok{scores[}\KeywordTok{ifelse}\NormalTok{(x[complete_index, }\StringTok{'Charts'}\NormalTok{] }\OperatorTok{==}\StringTok{ }\DecValTok{1}\NormalTok{, }\OtherTok{TRUE}\NormalTok{, }\OtherTok{FALSE}\NormalTok{), }\DecValTok{2}\NormalTok{], }\DataTypeTok{col=}\StringTok{"blue"}\NormalTok{)}
\KeywordTok{rug}\NormalTok{(si}\OperatorTok{$}\NormalTok{scores[}\KeywordTok{ifelse}\NormalTok{(x[complete_index, }\StringTok{'Charts'}\NormalTok{] }\OperatorTok{!=}\StringTok{ }\DecValTok{1}\NormalTok{, }\OtherTok{TRUE}\NormalTok{, }\OtherTok{FALSE}\NormalTok{), }\DecValTok{2}\NormalTok{], }\DataTypeTok{col=}\StringTok{"red"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-25-4.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfrow=}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{))}
\KeywordTok{hist}\NormalTok{(f2, }\DataTypeTok{main =} \StringTok{'Youtube popularity factor'}\NormalTok{, }\DataTypeTok{xlab =} \StringTok{'Score corresponding to factor 2 (promax)'}\NormalTok{)}
\KeywordTok{rug}\NormalTok{(f2[}\KeywordTok{ifelse}\NormalTok{(x[complete_index, }\StringTok{'Charts'}\NormalTok{] }\OperatorTok{==}\StringTok{ }\DecValTok{1}\NormalTok{, }\OtherTok{TRUE}\NormalTok{, }\OtherTok{FALSE}\NormalTok{)], }\DataTypeTok{col=}\StringTok{"blue"}\NormalTok{)}
\KeywordTok{rug}\NormalTok{(f2[}\KeywordTok{ifelse}\NormalTok{(x[complete_index, }\StringTok{'Charts'}\NormalTok{] }\OperatorTok{!=}\StringTok{ }\DecValTok{1}\NormalTok{, }\OtherTok{TRUE}\NormalTok{, }\OtherTok{FALSE}\NormalTok{)], }\DataTypeTok{col=}\StringTok{"red"}\NormalTok{)}

\KeywordTok{hist}\NormalTok{(f3, }\DataTypeTok{main =} \StringTok{'Music supply factor'}\NormalTok{, }\DataTypeTok{xlab =} \StringTok{'Score corresponding to factor 3 (promax)'}\NormalTok{)}
\KeywordTok{rug}\NormalTok{(f3[}\KeywordTok{ifelse}\NormalTok{(x[complete_index, }\StringTok{'Charts'}\NormalTok{] }\OperatorTok{==}\StringTok{ }\DecValTok{1}\NormalTok{, }\OtherTok{TRUE}\NormalTok{, }\OtherTok{FALSE}\NormalTok{)], }\DataTypeTok{col=}\StringTok{"blue"}\NormalTok{)}
\KeywordTok{rug}\NormalTok{(f3[}\KeywordTok{ifelse}\NormalTok{(x[complete_index, }\StringTok{'Charts'}\NormalTok{] }\OperatorTok{!=}\StringTok{ }\DecValTok{1}\NormalTok{, }\OtherTok{TRUE}\NormalTok{, }\OtherTok{FALSE}\NormalTok{)], }\DataTypeTok{col=}\StringTok{"red"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-25-5.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x}\OperatorTok{$}\NormalTok{factor_}\DecValTok{2}\NormalTok{ <-}\StringTok{ }\NormalTok{si}\OperatorTok{$}\NormalTok{scores[,}\DecValTok{1}\NormalTok{]}
\NormalTok{x}\OperatorTok{$}\NormalTok{factor_}\DecValTok{3}\NormalTok{ <-}\StringTok{ }\NormalTok{si}\OperatorTok{$}\NormalTok{scores[,}\DecValTok{2}\NormalTok{]}
\NormalTok{x}\OperatorTok{$}\NormalTok{factor_}\DecValTok{4}\NormalTok{ <-}\StringTok{ }\NormalTok{si}\OperatorTok{$}\NormalTok{scores[,}\DecValTok{3}\NormalTok{]}
\NormalTok{x}\OperatorTok{$}\NormalTok{factor_}\DecValTok{1}\NormalTok{ <-}\StringTok{ }\NormalTok{si}\OperatorTok{$}\NormalTok{scores[,}\DecValTok{4}\NormalTok{]}

\NormalTok{x}\OperatorTok{$}\NormalTok{factor_2man <-}\StringTok{ }\NormalTok{f2}
\NormalTok{x}\OperatorTok{$}\NormalTok{factor_3man <-}\StringTok{ }\NormalTok{f3}
\NormalTok{x}\OperatorTok{$}\NormalTok{factor_4man <-}\StringTok{ }\NormalTok{f4}
\NormalTok{x}\OperatorTok{$}\NormalTok{factor_1man <-}\StringTok{ }\NormalTok{f1}

\KeywordTok{cor}\NormalTok{(}\KeywordTok{cbind}\NormalTok{(si}\OperatorTok{$}\NormalTok{scores[,}\DecValTok{1}\NormalTok{], si}\OperatorTok{$}\NormalTok{scores[,}\DecValTok{2}\NormalTok{], si}\OperatorTok{$}\NormalTok{scores[,}\DecValTok{3}\NormalTok{], si}\OperatorTok{$}\NormalTok{scores[,}\DecValTok{4}\NormalTok{]), }\KeywordTok{cbind}\NormalTok{(f2, f3, f4, f1))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##               f2          f3          f4          f1
## [1,]  1.00000000 -0.08246012 -0.04542303 -0.04038714
## [2,] -0.07190494  0.97220279  0.42361028  0.62898318
## [3,] -0.04542303  0.51683413  1.00000000  0.19564730
## [4,] -0.04038714  0.47961885  0.19564730  1.00000000
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{cor}\NormalTok{(}\KeywordTok{cbind}\NormalTok{(si}\OperatorTok{$}\NormalTok{scores[,}\DecValTok{1}\NormalTok{], si}\OperatorTok{$}\NormalTok{scores[,}\DecValTok{2}\NormalTok{], si}\OperatorTok{$}\NormalTok{scores[,}\DecValTok{3}\NormalTok{], si}\OperatorTok{$}\NormalTok{scores[,}\DecValTok{4}\NormalTok{]), fa_bartlett_scores}\OperatorTok{$}\NormalTok{scores)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##               ML2         ML3         ML4         ML1
## [1,]  0.995760702 -0.09422492 -0.09953451  0.01023589
## [2,] -0.091504358  0.97260263  0.36373011  0.29006661
## [3,] -0.082455588  0.42220226  0.95965169 -0.03857534
## [4,] -0.001308527  0.48171167  0.16518758  0.87773348
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{cor}\NormalTok{(}\KeywordTok{cbind}\NormalTok{(si}\OperatorTok{$}\NormalTok{scores[,}\DecValTok{1}\NormalTok{], si}\OperatorTok{$}\NormalTok{scores[,}\DecValTok{2}\NormalTok{], si}\OperatorTok{$}\NormalTok{scores[,}\DecValTok{3}\NormalTok{], si}\OperatorTok{$}\NormalTok{scores[,}\DecValTok{4}\NormalTok{]), ml.promax}\OperatorTok{$}\NormalTok{scores)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##               ML2         ML3        ML4          ML1
## [1,]  0.995926214 -0.09594147 -0.1125804  0.010231584
## [2,] -0.091405140  0.97336006  0.3956275  0.297653556
## [3,] -0.079332072  0.41609922  0.9605376 -0.008730584
## [4,] -0.002099964  0.48750364  0.2000248  0.882141227
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x}\OperatorTok{$}\NormalTok{factor_2bartlett <-}\StringTok{ }\NormalTok{fa_bartlett_scores}\OperatorTok{$}\NormalTok{scores[,}\DecValTok{1}\NormalTok{]}
\NormalTok{x}\OperatorTok{$}\NormalTok{factor_3bartlett <-}\StringTok{ }\NormalTok{fa_bartlett_scores}\OperatorTok{$}\NormalTok{scores[,}\DecValTok{2}\NormalTok{]}
\NormalTok{x}\OperatorTok{$}\NormalTok{factor_4bartlett <-}\StringTok{ }\NormalTok{fa_bartlett_scores}\OperatorTok{$}\NormalTok{scores[,}\DecValTok{3}\NormalTok{]}
\NormalTok{x}\OperatorTok{$}\NormalTok{factor_1bartlett <-}\StringTok{ }\NormalTok{fa_bartlett_scores}\OperatorTok{$}\NormalTok{scores[,}\DecValTok{4}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{z <-}\StringTok{ }\KeywordTok{scale}\NormalTok{(x_features)}

\KeywordTok{library}\NormalTok{(factoextra)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Loading required package: ggplot2
\end{verbatim}

\begin{verbatim}
## 
## Attaching package: 'ggplot2'
\end{verbatim}

\begin{verbatim}
## The following objects are masked from 'package:psych':
## 
##     %+%, alpha
\end{verbatim}

\begin{verbatim}
## Welcome! Want to learn more? See two factoextra-related books at https://goo.gl/ve3WBa
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Elbow method}
\KeywordTok{fviz_nbclust}\NormalTok{(z, kmeans, }\DataTypeTok{method =} \StringTok{"wss"}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_vline}\NormalTok{(}\DataTypeTok{xintercept =} \DecValTok{4}\NormalTok{, }\DataTypeTok{linetype =} \DecValTok{2}\NormalTok{) }\OperatorTok{+}\StringTok{ }\KeywordTok{labs}\NormalTok{(}\DataTypeTok{title =} \StringTok{""}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-26-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{42}\NormalTok{)}
\NormalTok{kz <-}\StringTok{ }\KeywordTok{kmeans}\NormalTok{(z, }\DataTypeTok{c=}\DecValTok{4}\NormalTok{)}

\NormalTok{k_techno <-}\StringTok{ }\KeywordTok{names}\NormalTok{(kz}\OperatorTok{$}\NormalTok{cluster[kz}\OperatorTok{$}\NormalTok{cluster }\OperatorTok{==}\StringTok{ }\DecValTok{1}\NormalTok{])}
\NormalTok{k_hiphop <-}\StringTok{ }\KeywordTok{names}\NormalTok{(kz}\OperatorTok{$}\NormalTok{cluster[kz}\OperatorTok{$}\NormalTok{cluster }\OperatorTok{==}\StringTok{ }\DecValTok{2}\NormalTok{])}
\NormalTok{k_pop <-}\StringTok{ }\KeywordTok{names}\NormalTok{(kz}\OperatorTok{$}\NormalTok{cluster[kz}\OperatorTok{$}\NormalTok{cluster }\OperatorTok{==}\StringTok{ }\DecValTok{3}\NormalTok{])}
\NormalTok{k_classic <-}\StringTok{ }\KeywordTok{names}\NormalTok{(kz}\OperatorTok{$}\NormalTok{cluster[kz}\OperatorTok{$}\NormalTok{cluster }\OperatorTok{==}\StringTok{ }\DecValTok{4}\NormalTok{])}

\NormalTok{kz}\OperatorTok{$}\NormalTok{cluster[k_techno] <-}\StringTok{ }\DecValTok{4}
\NormalTok{kz}\OperatorTok{$}\NormalTok{cluster[k_pop] <-}\StringTok{ }\DecValTok{3}
\NormalTok{kz}\OperatorTok{$}\NormalTok{cluster[k_hiphop] <-}\StringTok{ }\DecValTok{2}
\NormalTok{kz}\OperatorTok{$}\NormalTok{cluster[k_classic] <-}\StringTok{ }\DecValTok{1}

\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfcol=}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{))}
\KeywordTok{plot}\NormalTok{(pc_cor}\OperatorTok{$}\NormalTok{x[,}\DecValTok{1}\NormalTok{], pc_cor}\OperatorTok{$}\NormalTok{x[,}\DecValTok{2}\NormalTok{], }\DataTypeTok{col=}\NormalTok{kz}\OperatorTok{$}\NormalTok{cluster, }\DataTypeTok{pch=}\DecValTok{19}\NormalTok{, }\DataTypeTok{xlab =} \StringTok{'PC1'}\NormalTok{, }\DataTypeTok{ylab =} \StringTok{'PC2'}\NormalTok{)}

\CommentTok{# project cluster centers to PCA feature space:}

\NormalTok{cluster_centers_pca <-}\StringTok{ }\NormalTok{kz}\OperatorTok{$}\NormalTok{centers }\OperatorTok{%*%}\StringTok{ }\NormalTok{pc_cor}\OperatorTok{$}\NormalTok{rotation[, }\DecValTok{1}\OperatorTok{:}\DecValTok{2}\NormalTok{]}
\KeywordTok{points}\NormalTok{(cluster_centers_pca[,}\DecValTok{1}\NormalTok{], cluster_centers_pca[,}\DecValTok{2}\NormalTok{], }\DataTypeTok{col =} \StringTok{'magenta'}\NormalTok{, }\DataTypeTok{pch =} \DecValTok{10}\NormalTok{, }\DataTypeTok{cex =} \DecValTok{3}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-26-2.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{plot}\NormalTok{(pc_cor}\OperatorTok{$}\NormalTok{x[,}\DecValTok{1}\NormalTok{], pc_cor}\OperatorTok{$}\NormalTok{x[,}\DecValTok{2}\NormalTok{], }\DataTypeTok{col=}\KeywordTok{as.numeric}\NormalTok{(x}\OperatorTok{$}\NormalTok{Genre), }\DataTypeTok{pch=}\DecValTok{19}\NormalTok{, }\DataTypeTok{xlab =} \StringTok{'PC1'}\NormalTok{, }\DataTypeTok{ylab =} \StringTok{'PC2'}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-26-3.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(}\StringTok{"cluster"}\NormalTok{)}

\NormalTok{sk_}\DecValTok{4}\NormalTok{ <-}\StringTok{ }\KeywordTok{silhouette}\NormalTok{(kz}\OperatorTok{$}\NormalTok{cluster, }\KeywordTok{dist}\NormalTok{(z))}
\KeywordTok{plot}\NormalTok{(sk_}\DecValTok{4}\NormalTok{, }\DataTypeTok{col=}\DecValTok{1}\OperatorTok{:}\DecValTok{4}\NormalTok{, }\DataTypeTok{border=}\OtherTok{NA}\NormalTok{, }\DataTypeTok{ann =}\NormalTok{ T, }\DataTypeTok{main =} \StringTok{""}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-26-4.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(}\StringTok{"caret"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Attaching package: 'caret'
\end{verbatim}

\begin{verbatim}
## The following object is masked _by_ '.GlobalEnv':
## 
##     RMSE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{confusionMatrix}\NormalTok{(}\KeywordTok{as.factor}\NormalTok{(}\KeywordTok{as.numeric}\NormalTok{(kz}\OperatorTok{$}\NormalTok{cluster)), }\KeywordTok{as.factor}\NormalTok{(}\KeywordTok{as.numeric}\NormalTok{(x}\OperatorTok{$}\NormalTok{Genre)))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Confusion Matrix and Statistics
## 
##           Reference
## Prediction  1  2  3  4
##          1  1  1  0 47
##          2  0 34 30  0
##          3 48  0  3  0
##          4  0 15 17  0
## 
## Overall Statistics
##                                          
##                Accuracy : 0.1939         
##                  95% CI : (0.141, 0.2563)
##     No Information Rate : 0.2551         
##     P-Value [Acc > NIR] : 0.9821         
##                                          
##                   Kappa : -0.0767        
##                                          
##  Mcnemar's Test P-Value : <2e-16         
## 
## Statistics by Class:
## 
##                      Class: 1 Class: 2 Class: 3 Class: 4
## Sensitivity          0.020408   0.6800  0.06000   0.0000
## Specificity          0.673469   0.7945  0.67123   0.7852
## Pos Pred Value       0.020408   0.5312  0.05882   0.0000
## Neg Pred Value       0.673469   0.8788  0.67586   0.7134
## Prevalence           0.250000   0.2551  0.25510   0.2398
## Detection Rate       0.005102   0.1735  0.01531   0.0000
## Detection Prevalence 0.250000   0.3265  0.26020   0.1633
## Balanced Accuracy    0.346939   0.7373  0.36562   0.3926
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Although k-means is not a classification algorithm, we can compute the proportions of genres per cluster to assign}
\CommentTok{# an interpretation for each cluster.}

\NormalTok{tab_kmeans <-}\StringTok{ }\KeywordTok{table}\NormalTok{(kz}\OperatorTok{$}\NormalTok{cluster, x}\OperatorTok{$}\NormalTok{Genre)}
\CommentTok{#xtable(round(tab_kmeans/colSums(tab_kmeans), digits = 2)*100)}
\KeywordTok{round}\NormalTok{(tab_kmeans}\OperatorTok{/}\KeywordTok{colSums}\NormalTok{(tab_kmeans), }\DataTypeTok{digits =} \DecValTok{2}\NormalTok{)}\OperatorTok{*}\DecValTok{100}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    
##     Classic Hip Hop Pop Techno
##   1       2       2   0     96
##   2       0      68  60      0
##   3      96       0   6      0
##   4       0      32  36      0
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# It seems that Classic music and Techno music can be accurately distinguished but between Hip Hop and Pop there are }
\CommentTok{# many false negatives, e.g. 62% of the tracks were predicted to be of the genre Pop although the truth was that they were}
\CommentTok{# of class Hip Hop, underlining the ambiguity between those genres in terms of music theoretical characteristics nowadays.}
\CommentTok{# Vice versa, 16% of the tracks predicted to be Hip Hop music were actually Pop music.}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{42}\NormalTok{)}
\NormalTok{cl2 <-}\StringTok{ }\KeywordTok{pam}\NormalTok{(z, }\DecValTok{4}\NormalTok{)}
\KeywordTok{plot}\NormalTok{(pc_cor}\OperatorTok{$}\NormalTok{x[,}\DecValTok{1}\NormalTok{], pc_cor}\OperatorTok{$}\NormalTok{x[,}\DecValTok{2}\NormalTok{], }\DataTypeTok{col=}\NormalTok{cl2}\OperatorTok{$}\NormalTok{clustering)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-27-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{k_classic <-}\StringTok{ }\KeywordTok{names}\NormalTok{(cl2}\OperatorTok{$}\NormalTok{clustering[cl2}\OperatorTok{$}\NormalTok{clustering }\OperatorTok{==}\StringTok{ }\DecValTok{1}\NormalTok{])}
\NormalTok{k_techno <-}\StringTok{ }\KeywordTok{names}\NormalTok{(cl2}\OperatorTok{$}\NormalTok{clustering[cl2}\OperatorTok{$}\NormalTok{clustering }\OperatorTok{==}\StringTok{ }\DecValTok{2}\NormalTok{])}
\NormalTok{k_pop <-}\StringTok{ }\KeywordTok{names}\NormalTok{(cl2}\OperatorTok{$}\NormalTok{clustering[cl2}\OperatorTok{$}\NormalTok{clustering }\OperatorTok{==}\StringTok{ }\DecValTok{3}\NormalTok{])}
\NormalTok{k_hiphop <-}\StringTok{ }\KeywordTok{names}\NormalTok{(cl2}\OperatorTok{$}\NormalTok{clustering[cl2}\OperatorTok{$}\NormalTok{clustering }\OperatorTok{==}\StringTok{ }\DecValTok{4}\NormalTok{])}

\NormalTok{cl2}\OperatorTok{$}\NormalTok{clustering[k_techno] <-}\StringTok{ }\DecValTok{4}
\NormalTok{cl2}\OperatorTok{$}\NormalTok{clustering[k_pop] <-}\StringTok{ }\DecValTok{3}
\NormalTok{cl2}\OperatorTok{$}\NormalTok{clustering[k_hiphop] <-}\StringTok{ }\DecValTok{2}
\NormalTok{cl2}\OperatorTok{$}\NormalTok{clustering[k_classic] <-}\StringTok{ }\DecValTok{1}


\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfcol=}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{))}
\KeywordTok{plot}\NormalTok{(pc_cor}\OperatorTok{$}\NormalTok{x[,}\DecValTok{1}\NormalTok{], pc_cor}\OperatorTok{$}\NormalTok{x[,}\DecValTok{2}\NormalTok{], }\DataTypeTok{col=}\NormalTok{cl2}\OperatorTok{$}\NormalTok{clustering, }\DataTypeTok{pch=}\DecValTok{19}\NormalTok{, }\DataTypeTok{xlab =} \StringTok{'PC1'}\NormalTok{, }\DataTypeTok{ylab =} \StringTok{'PC2'}\NormalTok{)}
\KeywordTok{points}\NormalTok{(pc_cor}\OperatorTok{$}\NormalTok{x[}\KeywordTok{rownames}\NormalTok{(cl2}\OperatorTok{$}\NormalTok{medoids),}\DecValTok{1}\NormalTok{], pc_cor}\OperatorTok{$}\NormalTok{x[}\KeywordTok{rownames}\NormalTok{(cl2}\OperatorTok{$}\NormalTok{medoids),}\DecValTok{2}\NormalTok{], }\DataTypeTok{col =} \StringTok{'magenta'}\NormalTok{, }\DataTypeTok{pch =} \DecValTok{10}\NormalTok{, }\DataTypeTok{cex =} \DecValTok{3}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-27-2.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{plot}\NormalTok{(pc_cor}\OperatorTok{$}\NormalTok{x[,}\DecValTok{1}\NormalTok{], pc_cor}\OperatorTok{$}\NormalTok{x[,}\DecValTok{2}\NormalTok{], }\DataTypeTok{col=}\KeywordTok{as.numeric}\NormalTok{(x}\OperatorTok{$}\NormalTok{Genre), }\DataTypeTok{pch=}\DecValTok{19}\NormalTok{, }\DataTypeTok{xlab =} \StringTok{'PC1'}\NormalTok{, }\DataTypeTok{ylab =} \StringTok{'PC2'}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-27-3.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# xtable(x[rownames(cl2$medoids), c('Track_Title', 'Track_Artist', 'Genre')])}

\NormalTok{x[}\KeywordTok{rownames}\NormalTok{(cl2}\OperatorTok{$}\NormalTok{medoids), }\KeywordTok{c}\NormalTok{(}\StringTok{'Track_Title'}\NormalTok{, }\StringTok{'Track_Artist'}\NormalTok{, }\StringTok{'Genre'}\NormalTok{)]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##                                                                 Track_Title
## 142 Khachaturian: Spartacus Suite No. 2: I. Adagio of Spartacus and Phrygia
## 149                                                                    DT64
## 80                              Lambo Diablo GT (feat. Nimo & Juju) - Remix
## 94                                                             CASINO ROYAL
##          Track_Artist   Genre
## 142 Aram Khachaturian Classic
## 149            Moguai  Techno
## 80               Capo Hip Hop
## 94            Kianush Hip Hop
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sm_}\DecValTok{4}\NormalTok{ <-}\StringTok{ }\KeywordTok{silhouette}\NormalTok{(cl2}\OperatorTok{$}\NormalTok{clustering, }\KeywordTok{dist}\NormalTok{(z))}
\KeywordTok{plot}\NormalTok{(sm_}\DecValTok{4}\NormalTok{, }\DataTypeTok{col=}\DecValTok{1}\OperatorTok{:}\DecValTok{4}\NormalTok{, }\DataTypeTok{border=}\OtherTok{NA}\NormalTok{, }\DataTypeTok{main =} \StringTok{""}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-27-4.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{confusionMatrix}\NormalTok{(}\KeywordTok{as.factor}\NormalTok{(}\KeywordTok{as.numeric}\NormalTok{(cl2}\OperatorTok{$}\NormalTok{clustering)), }\KeywordTok{as.factor}\NormalTok{(}\KeywordTok{as.numeric}\NormalTok{(x}\OperatorTok{$}\NormalTok{Genre)))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Confusion Matrix and Statistics
## 
##           Reference
## Prediction  1  2  3  4
##          1 48  0  2  0
##          2  0 28 13  0
##          3  0 21 35  0
##          4  1  1  0 47
## 
## Overall Statistics
##                                          
##                Accuracy : 0.8061         
##                  95% CI : (0.7437, 0.859)
##     No Information Rate : 0.2551         
##     P-Value [Acc > NIR] : < 2.2e-16      
##                                          
##                   Kappa : 0.7415         
##                                          
##  Mcnemar's Test P-Value : NA             
## 
## Statistics by Class:
## 
##                      Class: 1 Class: 2 Class: 3 Class: 4
## Sensitivity            0.9796   0.5600   0.7000   1.0000
## Specificity            0.9864   0.9110   0.8562   0.9866
## Pos Pred Value         0.9600   0.6829   0.6250   0.9592
## Neg Pred Value         0.9932   0.8581   0.8929   1.0000
## Prevalence             0.2500   0.2551   0.2551   0.2398
## Detection Rate         0.2449   0.1429   0.1786   0.2398
## Detection Prevalence   0.2551   0.2092   0.2857   0.2500
## Balanced Accuracy      0.9830   0.7355   0.7781   0.9933
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tab_kmedoids <-}\StringTok{ }\KeywordTok{table}\NormalTok{(cl2}\OperatorTok{$}\NormalTok{clustering, x}\OperatorTok{$}\NormalTok{Genre)}
\CommentTok{# xtable((round(tab_kmedoids/colSums(tab_kmedoids), digits = 2))*100)}
\KeywordTok{round}\NormalTok{(tab_kmedoids}\OperatorTok{/}\KeywordTok{colSums}\NormalTok{(tab_kmedoids), }\DataTypeTok{digits =} \DecValTok{2}\NormalTok{)}\OperatorTok{*}\DecValTok{100}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    
##     Classic Hip Hop Pop Techno
##   1      98       0   4      0
##   2       0      56  26      0
##   3       0      42  70      0
##   4       2       2   0    100
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Factor analysis + k-means on scores}

\KeywordTok{library}\NormalTok{(}\StringTok{"psych"}\NormalTok{)}
\KeywordTok{KMO}\NormalTok{(z)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Kaiser-Meyer-Olkin factor adequacy
## Call: KMO(r = z)
## Overall MSA =  0.83
## MSA for each item = 
##     acousticness     danceability           energy instrumentalness 
##             0.83             0.92             0.80             0.67 
##         liveness         loudness      speechiness            tempo 
##             0.81             0.87             0.84             0.82 
##          valence 
##             0.80
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{scree}\NormalTok{(z)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-28-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(}\StringTok{"paran"}\NormalTok{)}
\KeywordTok{paran}\NormalTok{(z, }\DataTypeTok{centile=}\DecValTok{95}\NormalTok{, }\DataTypeTok{all=}\NormalTok{T, }\DataTypeTok{graph=}\NormalTok{T) }\CommentTok{# two factors are appropriate}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Using eigendecomposition of correlation matrix.
## Computing: 10%  20%  30%  40%  50%  60%  70%  80%  90%  100%
## 
## 
## Results of Horn's Parallel Analysis for component retention
## 270 iterations, using the 95 centile estimate
## 
## -------------------------------------------------- 
## Component   Adjusted    Unadjusted    Estimated 
##             Eigenvalue  Eigenvalue    Bias 
## -------------------------------------------------- 
## 1           3.846102    4.305594      0.459491
## 2           1.166438    1.462154      0.295715
## 3           0.791006    0.979100      0.188093
## 4           0.708123    0.813018      0.104895
## 5           0.657852    0.694514      0.036661
## 6           0.328989    0.301951     -0.02703
## 7           0.317386    0.222367     -0.09501
## 8           0.304598    0.140507     -0.16409
## 9           0.313412    0.080790     -0.23262
## -------------------------------------------------- 
## 
## Adjusted eigenvalues > 1 indicate dimensions to retain.
## (2 components retained)
\end{verbatim}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-28-2.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fa <-}\StringTok{ }\KeywordTok{fa}\NormalTok{(z, }\DataTypeTok{nfactors=}\DecValTok{2}\NormalTok{, }\DataTypeTok{rotate=}\StringTok{"varimax"}\NormalTok{)}
\KeywordTok{library}\NormalTok{(}\StringTok{"plot.matrix"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Registered S3 method overwritten by 'plot.matrix':
##   method        from
##   plot.loadings pls
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{plot}\NormalTok{(}\KeywordTok{loadings}\NormalTok{(fa), }\DataTypeTok{las=}\DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-28-3.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{al1 <-}\StringTok{ }\NormalTok{psych}\OperatorTok{::}\KeywordTok{alpha}\NormalTok{(z[,}\KeywordTok{c}\NormalTok{(}\StringTok{"acousticness"}\NormalTok{, }\StringTok{"danceability"}\NormalTok{, }\StringTok{"energy"}\NormalTok{, }\StringTok{"loudness"}\NormalTok{)], }\DataTypeTok{check.keys =} \OtherTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning in psych::alpha(z[, c("acousticness", "danceability", "energy", : Some items were negatively correlated with total scale and were automatically reversed.
##  This is indicated by a negative sign for the variable name.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{al1}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Reliability analysis   
## Call: psych::alpha(x = z[, c("acousticness", "danceability", "energy", 
##     "loudness")], check.keys = TRUE)
## 
##   raw_alpha std.alpha G6(smc) average_r S/N    ase mean   sd median_r
##       0.95      0.95    0.94      0.82  18 0.0062 -0.6 0.93     0.81
## 
##  lower alpha upper     95% confidence boundaries
## 0.94 0.95 0.96 
## 
##  Reliability if an item is dropped:
##               raw_alpha std.alpha G6(smc) average_r S/N alpha se   var.r med.r
## acousticness-      0.93      0.93    0.90      0.81  13   0.0092 0.00225  0.80
## danceability       0.94      0.94    0.93      0.85  16   0.0073 0.00298  0.86
## energy             0.92      0.92    0.88      0.79  11   0.0102 0.00058  0.79
## loudness           0.94      0.94    0.92      0.84  15   0.0078 0.00246  0.81
## 
##  Item statistics 
##                 n raw.r std.r r.cor r.drop     mean sd
## acousticness- 196  0.94  0.94  0.92   0.89 -2.4e+00  1
## danceability  196  0.91  0.91  0.86   0.84 -5.5e-18  1
## energy        196  0.96  0.96  0.95   0.92  1.6e-16  1
## loudness      196  0.92  0.92  0.88   0.85  6.0e-17  1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{al2 <-}\StringTok{ }\NormalTok{psych}\OperatorTok{::}\KeywordTok{alpha}\NormalTok{(z[,}\KeywordTok{c}\NormalTok{(}\StringTok{"instrumentalness"}\NormalTok{, }\StringTok{"valence"}\NormalTok{)], }\DataTypeTok{check.keys =} \OtherTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning in psych::alpha(z[, c("instrumentalness", "valence")], check.keys = TRUE): Some items were negatively correlated with total scale and were automatically reversed.
##  This is indicated by a negative sign for the variable name.
\end{verbatim}

\begin{verbatim}
## Warning in matrix(unlist(drop.item), ncol = 10, byrow = TRUE): Datenlänge [16]
## ist kein Teiler oder Vielfaches der Anzahl der Spalten [10]
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{al2}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Reliability analysis   
## Call: psych::alpha(x = z[, c("instrumentalness", "valence")], check.keys = TRUE)
## 
##   raw_alpha std.alpha G6(smc) average_r S/N  ase mean   sd median_r
##       0.79      0.79    0.65      0.65 3.7 0.03 0.62 0.91     0.65
## 
##  lower alpha upper     95% confidence boundaries
## 0.73 0.79 0.85 
## 
##  Reliability if an item is dropped:
##                   raw_alpha std.alpha G6(smc) average_r S/N alpha se var.r
## instrumentalness-      0.65      0.65    0.42      0.65  NA       NA  0.65
## valence                0.42      0.65      NA        NA  NA       NA  0.42
##                   med.r
## instrumentalness-  0.65
## valence            0.65
## 
##  Item statistics 
##                     n raw.r std.r r.cor r.drop    mean sd
## instrumentalness- 196  0.91  0.91  0.73   0.65 1.2e+00  1
## valence           196  0.91  0.91  0.73   0.65 1.4e-17  1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{scale <-}\StringTok{ }\KeywordTok{cbind}\NormalTok{(al1}\OperatorTok{$}\NormalTok{scores, al2}\OperatorTok{$}\NormalTok{scores)}

\KeywordTok{fviz_nbclust}\NormalTok{(scale, kmeans, }\DataTypeTok{method =} \StringTok{"wss"}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_vline}\NormalTok{(}\DataTypeTok{xintercept =} \DecValTok{4}\NormalTok{, }\DataTypeTok{linetype =} \DecValTok{2}\NormalTok{)}\OperatorTok{+}
\StringTok{  }\KeywordTok{labs}\NormalTok{(}\DataTypeTok{subtitle =} \StringTok{"Elbow method"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-28-4.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{reorder <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(x, ...) \{}
\NormalTok{  dr <-}\StringTok{ }\KeywordTok{dist}\NormalTok{(x)}
\NormalTok{  hr <-}\StringTok{ }\KeywordTok{hclust}\NormalTok{(dr)}
\NormalTok{  dc <-}\StringTok{ }\KeywordTok{dist}\NormalTok{(}\KeywordTok{t}\NormalTok{(x))}
\NormalTok{  hc <-}\StringTok{ }\KeywordTok{hclust}\NormalTok{(dc)}
\NormalTok{  x[hr}\OperatorTok{$}\NormalTok{order, hc}\OperatorTok{$}\NormalTok{order]}
\NormalTok{\}}

\KeywordTok{set.seed}\NormalTok{(}\DecValTok{42}\NormalTok{)}
\NormalTok{cl1 <-}\StringTok{ }\KeywordTok{kmeans}\NormalTok{(z, }\DecValTok{4}\NormalTok{)}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{42}\NormalTok{)}
\NormalTok{cl2 <-}\StringTok{ }\KeywordTok{kmeans}\NormalTok{(scale, }\DecValTok{4}\NormalTok{)}

\KeywordTok{print}\NormalTok{(}\KeywordTok{reorder}\NormalTok{(}\KeywordTok{table}\NormalTok{(cl1}\OperatorTok{$}\NormalTok{cluster,cl2}\OperatorTok{$}\NormalTok{cluster)))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    
##      1  3  2  4
##   3 51  0  0  0
##   4  0 49  0  0
##   1  0  0 14 18
##   2  0  0 42 22
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfcol=}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{3}\NormalTok{))}

\KeywordTok{plot}\NormalTok{(pc_cor}\OperatorTok{$}\NormalTok{x[,}\DecValTok{1}\NormalTok{], pc_cor}\OperatorTok{$}\NormalTok{x[,}\DecValTok{2}\NormalTok{], }\DataTypeTok{col=}\NormalTok{cl1}\OperatorTok{$}\NormalTok{cluster, }\DataTypeTok{pch=}\DecValTok{19}\NormalTok{)}
\KeywordTok{plot}\NormalTok{(pc_cor}\OperatorTok{$}\NormalTok{x[,}\DecValTok{1}\NormalTok{], pc_cor}\OperatorTok{$}\NormalTok{x[,}\DecValTok{2}\NormalTok{], }\DataTypeTok{col=}\NormalTok{cl2}\OperatorTok{$}\NormalTok{cluster, }\DataTypeTok{pch=}\DecValTok{19}\NormalTok{)}
\KeywordTok{plot}\NormalTok{(pc_cor}\OperatorTok{$}\NormalTok{x[,}\DecValTok{1}\NormalTok{], pc_cor}\OperatorTok{$}\NormalTok{x[,}\DecValTok{2}\NormalTok{], }\DataTypeTok{col=}\KeywordTok{as.numeric}\NormalTok{(x}\OperatorTok{$}\NormalTok{Genre), }\DataTypeTok{pch=}\DecValTok{19}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-28-5.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfcol=}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{))}
\KeywordTok{library}\NormalTok{(}\StringTok{"e1071"}\NormalTok{)}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{42}\NormalTok{)}
\NormalTok{cl1 <-}\StringTok{ }\KeywordTok{cmeans}\NormalTok{(z, }\DecValTok{4}\NormalTok{)}
\NormalTok{mcolor <-}\StringTok{ }\KeywordTok{colorRamp}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\StringTok{"black"}\NormalTok{, }\StringTok{"green"}\NormalTok{, }\StringTok{"blue"}\NormalTok{, }\StringTok{"red"}\NormalTok{))}
\NormalTok{col <-}\StringTok{ }\KeywordTok{rgb}\NormalTok{(}\KeywordTok{mcolor}\NormalTok{(cl1}\OperatorTok{$}\NormalTok{membership[,}\DecValTok{1}\NormalTok{]), }\DataTypeTok{max=}\DecValTok{255}\NormalTok{)}
\KeywordTok{plot}\NormalTok{(pc_cor}\OperatorTok{$}\NormalTok{x[,}\DecValTok{1}\NormalTok{], pc_cor}\OperatorTok{$}\NormalTok{x[,}\DecValTok{2}\NormalTok{], }\DataTypeTok{pch=}\DecValTok{19}\NormalTok{, }\DataTypeTok{col=}\NormalTok{col, }\DataTypeTok{main =} \StringTok{'Soft-clustering (fuzzy c-means, k = 4)'}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-28-6.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{cl  <-}\StringTok{ }\KeywordTok{diana}\NormalTok{(z)}
\NormalTok{hcl <-}\StringTok{ }\KeywordTok{cutree}\NormalTok{(}\KeywordTok{as.hclust}\NormalTok{(cl), }\DataTypeTok{k =} \DecValTok{4}\NormalTok{)}
\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfrow=}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{))}
\KeywordTok{plot}\NormalTok{(pc_cor}\OperatorTok{$}\NormalTok{x[,}\DecValTok{1}\NormalTok{], pc_cor}\OperatorTok{$}\NormalTok{x[,}\DecValTok{2}\NormalTok{], }\DataTypeTok{col=}\NormalTok{hcl, }
     \DataTypeTok{pch=}\DecValTok{19}\NormalTok{, }\DataTypeTok{cex=}\FloatTok{0.5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-29-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(}\StringTok{"proxy"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Attaching package: 'proxy'
\end{verbatim}

\begin{verbatim}
## The following objects are masked from 'package:stats':
## 
##     as.dist, dist
\end{verbatim}

\begin{verbatim}
## The following object is masked from 'package:base':
## 
##     as.matrix
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{d <-}\StringTok{ }\KeywordTok{as.matrix}\NormalTok{(}\KeywordTok{dist}\NormalTok{(z))}
\KeywordTok{heatmap}\NormalTok{(d)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-30-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{s <-}\StringTok{ }\KeywordTok{pr_dist2simil}\NormalTok{(d) }\CommentTok{# the darker, the more similar}
\KeywordTok{heatmap}\NormalTok{(s)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-30-2.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfcol=}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{))}

\NormalTok{d <-}\StringTok{ }\KeywordTok{dist}\NormalTok{(z)}
\CommentTok{# hclust}
\NormalTok{cl1 <-}\StringTok{ }\KeywordTok{hclust}\NormalTok{(d, }\DataTypeTok{method =} \StringTok{'ward.D2'}\NormalTok{)}
\NormalTok{memb <-}\StringTok{ }\KeywordTok{cutree}\NormalTok{(cl1, }\DecValTok{4}\NormalTok{)}
\KeywordTok{plot}\NormalTok{(pc_cor}\OperatorTok{$}\NormalTok{x[,}\DecValTok{1}\NormalTok{], pc_cor}\OperatorTok{$}\NormalTok{x[,}\DecValTok{2}\NormalTok{], }\DataTypeTok{col=}\NormalTok{memb)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-31-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{plot}\NormalTok{(cl1, }\DataTypeTok{ann =}\NormalTok{ F)}
\KeywordTok{title}\NormalTok{(}\DataTypeTok{xlab =} \StringTok{"Ward.D2"}\NormalTok{, }\DataTypeTok{ylab =} \StringTok{"Height"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-31-2.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(}\StringTok{"ggplot2"}\NormalTok{)}
\KeywordTok{library}\NormalTok{(}\StringTok{"tibble"}\NormalTok{)}

\KeywordTok{ggplot}\NormalTok{(cl1}\OperatorTok{$}\NormalTok{height }\OperatorTok{%>%}
\KeywordTok{as_tibble}\NormalTok{() }\OperatorTok{%>%}
\KeywordTok{add_column}\NormalTok{(}\DataTypeTok{groups =} \KeywordTok{length}\NormalTok{(cl1}\OperatorTok{$}\NormalTok{height)}\OperatorTok{:}\DecValTok{1}\NormalTok{) }\OperatorTok{%>%}
\KeywordTok{rename}\NormalTok{(}\DataTypeTok{height=}\NormalTok{value),}
\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x=}\NormalTok{groups, }\DataTypeTok{y=}\NormalTok{height)) }\OperatorTok{+}
\KeywordTok{geom_point}\NormalTok{() }\OperatorTok{+}
\KeywordTok{geom_line}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: Calling `as_tibble()` on a vector is discouraged, because the behavior is likely to change in the future. Use `tibble::enframe(name = NULL)` instead.
## This warning is displayed once per session.
\end{verbatim}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-32-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(}\StringTok{"mclust"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Package 'mclust' version 5.4.5
## Type 'citation("mclust")' for citing this R package in publications.
\end{verbatim}

\begin{verbatim}
## 
## Attaching package: 'mclust'
\end{verbatim}

\begin{verbatim}
## The following object is masked from 'package:MVN':
## 
##     mvn
\end{verbatim}

\begin{verbatim}
## The following object is masked from 'package:psych':
## 
##     sim
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{42}\NormalTok{)}
\NormalTok{cl <-}\StringTok{ }\KeywordTok{Mclust}\NormalTok{(z)}
\KeywordTok{summary}\NormalTok{(cl)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## ---------------------------------------------------- 
## Gaussian finite mixture model fitted by EM algorithm 
## ---------------------------------------------------- 
## 
## Mclust VVI (diagonal, varying volume and shape) model with 9 components: 
## 
##  log-likelihood   n  df       BIC       ICL
##       -232.2578 196 170 -1361.795 -1368.181
## 
## Clustering table:
##  1  2  3  4  5  6  7  8  9 
##  9 23  7 35  7 65 24  8 18
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfrow=}\KeywordTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{))}
\KeywordTok{plot}\NormalTok{(cl, }\StringTok{"BIC"}\NormalTok{)}
\KeywordTok{plot}\NormalTok{(pc_cor}\OperatorTok{$}\NormalTok{x[,}\DecValTok{1}\NormalTok{], pc_cor}\OperatorTok{$}\NormalTok{x[,}\DecValTok{2}\NormalTok{], }\DataTypeTok{col =}\NormalTok{ cl}\OperatorTok{$}\NormalTok{classification)}
\NormalTok{EM_density_plot <-}\StringTok{ }\KeywordTok{plot}\NormalTok{(cl, }\StringTok{"density"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-33-1.pdf}
\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-33-2.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfcol=}\KeywordTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{))}

\KeywordTok{library}\NormalTok{(}\StringTok{"fpc"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Attaching package: 'fpc'
\end{verbatim}

\begin{verbatim}
## The following object is masked from 'package:xtable':
## 
##     xtable
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{42}\NormalTok{)}
\NormalTok{cl <-}\StringTok{ }\KeywordTok{dbscan}\NormalTok{(z, }\FloatTok{0.5}\NormalTok{, }\DataTypeTok{scale=}\NormalTok{F, }\DataTypeTok{MinPts =} \DecValTok{5}\NormalTok{)}
\NormalTok{col <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{'grey'}\NormalTok{, }\KeywordTok{rainbow}\NormalTok{(}\KeywordTok{max}\NormalTok{(cl}\OperatorTok{$}\NormalTok{cluster)))}
\KeywordTok{plot}\NormalTok{(pc_cor}\OperatorTok{$}\NormalTok{x[,}\DecValTok{1}\NormalTok{], pc_cor}\OperatorTok{$}\NormalTok{x[,}\DecValTok{2}\NormalTok{], }\DataTypeTok{pch=}\DecValTok{19}\NormalTok{, }\DataTypeTok{col=}\NormalTok{col[}\DecValTok{1}\OperatorTok{+}\NormalTok{cl}\OperatorTok{$}\NormalTok{cluster])}

\KeywordTok{set.seed}\NormalTok{(}\DecValTok{42}\NormalTok{)}
\NormalTok{cl <-}\StringTok{ }\KeywordTok{dbscan}\NormalTok{(z, }\DecValTok{1}\NormalTok{, }\DataTypeTok{scale=}\NormalTok{F, }\DataTypeTok{MinPts =} \DecValTok{5}\NormalTok{)}
\NormalTok{col <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{'grey'}\NormalTok{, }\KeywordTok{rainbow}\NormalTok{(}\KeywordTok{max}\NormalTok{(cl}\OperatorTok{$}\NormalTok{cluster)))}
\KeywordTok{plot}\NormalTok{(pc_cor}\OperatorTok{$}\NormalTok{x[,}\DecValTok{1}\NormalTok{], pc_cor}\OperatorTok{$}\NormalTok{x[,}\DecValTok{2}\NormalTok{], }\DataTypeTok{pch=}\DecValTok{19}\NormalTok{, }\DataTypeTok{col=}\NormalTok{col[}\DecValTok{1}\OperatorTok{+}\NormalTok{cl}\OperatorTok{$}\NormalTok{cluster])}

\KeywordTok{set.seed}\NormalTok{(}\DecValTok{42}\NormalTok{)}
\NormalTok{cl <-}\StringTok{ }\KeywordTok{dbscan}\NormalTok{(z, }\FloatTok{1.5}\NormalTok{, }\DataTypeTok{scale=}\NormalTok{F, }\DataTypeTok{MinPts =} \DecValTok{5}\NormalTok{)}
\NormalTok{col <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{'grey'}\NormalTok{, }\KeywordTok{rainbow}\NormalTok{(}\KeywordTok{max}\NormalTok{(cl}\OperatorTok{$}\NormalTok{cluster)))}
\KeywordTok{plot}\NormalTok{(pc_cor}\OperatorTok{$}\NormalTok{x[,}\DecValTok{1}\NormalTok{], pc_cor}\OperatorTok{$}\NormalTok{x[,}\DecValTok{2}\NormalTok{], }\DataTypeTok{pch=}\DecValTok{19}\NormalTok{, }\DataTypeTok{col=}\NormalTok{col[}\DecValTok{1}\OperatorTok{+}\NormalTok{cl}\OperatorTok{$}\NormalTok{cluster])}

\KeywordTok{set.seed}\NormalTok{(}\DecValTok{42}\NormalTok{)}
\NormalTok{cl <-}\StringTok{ }\KeywordTok{dbscan}\NormalTok{(z, }\DecValTok{2}\NormalTok{, }\DataTypeTok{scale=}\NormalTok{F, }\DataTypeTok{MinPts =} \DecValTok{5}\NormalTok{)}
\NormalTok{col <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{'grey'}\NormalTok{, }\KeywordTok{rainbow}\NormalTok{(}\KeywordTok{max}\NormalTok{(cl}\OperatorTok{$}\NormalTok{cluster)))}
\KeywordTok{plot}\NormalTok{(pc_cor}\OperatorTok{$}\NormalTok{x[,}\DecValTok{1}\NormalTok{], pc_cor}\OperatorTok{$}\NormalTok{x[,}\DecValTok{2}\NormalTok{], }\DataTypeTok{pch=}\DecValTok{19}\NormalTok{, }\DataTypeTok{col=}\NormalTok{col[}\DecValTok{1}\OperatorTok{+}\NormalTok{cl}\OperatorTok{$}\NormalTok{cluster])}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-34-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Mixed clustering}


\CommentTok{# hclust}
\NormalTok{d    <-}\StringTok{ }\KeywordTok{dist}\NormalTok{(z)}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{42}\NormalTok{)}
\NormalTok{cl1  <-}\StringTok{ }\KeywordTok{hclust}\NormalTok{(d, }\DataTypeTok{method=}\StringTok{"ward.D2"}\NormalTok{)}
\NormalTok{memb <-}\StringTok{ }\KeywordTok{cutree}\NormalTok{(cl1, }\DecValTok{4}\NormalTok{)}
\CommentTok{# kmeans}
\NormalTok{groupm  <-}\StringTok{ }\KeywordTok{aggregate}\NormalTok{(z, }\KeywordTok{list}\NormalTok{(memb), mean)}
\NormalTok{centers <-}\StringTok{ }\KeywordTok{cbind}\NormalTok{(groupm}\OperatorTok{$}\NormalTok{acousticness, }
\NormalTok{                 groupm}\OperatorTok{$}\NormalTok{danceability, }
\NormalTok{                 groupm}\OperatorTok{$}\NormalTok{energy, }
\NormalTok{                 groupm}\OperatorTok{$}\NormalTok{instrumentalness,}
\NormalTok{                 groupm}\OperatorTok{$}\NormalTok{liveness,}
\NormalTok{                 groupm}\OperatorTok{$}\NormalTok{loudness,}
\NormalTok{                 groupm}\OperatorTok{$}\NormalTok{speechiness,}
\NormalTok{                 groupm}\OperatorTok{$}\NormalTok{tempo,}
\NormalTok{                 groupm}\OperatorTok{$}\NormalTok{valence)}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{42}\NormalTok{)}
\NormalTok{cl2 <-}\StringTok{ }\KeywordTok{kmeans}\NormalTok{(z, }\DataTypeTok{centers =}\NormalTok{ centers)}
\CommentTok{# compare results (confusion matrix)}
\KeywordTok{table}\NormalTok{(memb, cl2}\OperatorTok{$}\NormalTok{cluster) }\CommentTok{# result: k-means has classified 4 observations differently than hclust}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##     
## memb  1  2  3  4
##    1 51  0  0  1
##    2  0 49  0  0
##    3  0  0  7  0
##    4  0  0  3 85
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfcol=}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{))}
\KeywordTok{plot}\NormalTok{(pc_cor}\OperatorTok{$}\NormalTok{x[,}\DecValTok{1}\NormalTok{], pc_cor}\OperatorTok{$}\NormalTok{x[,}\DecValTok{2}\NormalTok{], }\DataTypeTok{col=}\NormalTok{cl2}\OperatorTok{$}\NormalTok{cluster,}
     \DataTypeTok{main=}\StringTok{"Cluster predictions, mixed clustering"}\NormalTok{, }\DataTypeTok{pch=}\DecValTok{19}\NormalTok{, }\DataTypeTok{xlab =} \StringTok{'PC1'}\NormalTok{, }\DataTypeTok{ylab =} \StringTok{'PC2'}\NormalTok{)}

\CommentTok{# project cluster centers to PCA feature space:}

\NormalTok{cluster_centers_pca <-}\StringTok{ }\NormalTok{cl2}\OperatorTok{$}\NormalTok{centers }\OperatorTok{%*%}\StringTok{ }\NormalTok{pc_cor}\OperatorTok{$}\NormalTok{rotation[, }\DecValTok{1}\OperatorTok{:}\DecValTok{2}\NormalTok{]}
\KeywordTok{points}\NormalTok{(cluster_centers_pca[,}\DecValTok{1}\NormalTok{], cluster_centers_pca[,}\DecValTok{2}\NormalTok{], }\DataTypeTok{col =} \StringTok{'magenta'}\NormalTok{, }\DataTypeTok{pch =} \DecValTok{10}\NormalTok{, }\DataTypeTok{cex =} \DecValTok{3}\NormalTok{)}

\KeywordTok{plot}\NormalTok{(pc_cor}\OperatorTok{$}\NormalTok{x[,}\DecValTok{1}\NormalTok{], pc_cor}\OperatorTok{$}\NormalTok{x[,}\DecValTok{2}\NormalTok{], }\DataTypeTok{col=}\KeywordTok{as.numeric}\NormalTok{(x}\OperatorTok{$}\NormalTok{Genre),}
     \DataTypeTok{main=}\StringTok{"Truth"}\NormalTok{, }\DataTypeTok{pch=}\DecValTok{19}\NormalTok{, }\DataTypeTok{xlab =} \StringTok{'PC1'}\NormalTok{, }\DataTypeTok{ylab =} \StringTok{'PC2'}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-35-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(}\StringTok{"NbClust"}\NormalTok{)}

\CommentTok{# Total variance explained}
\NormalTok{tve <-}\StringTok{ }\KeywordTok{rep}\NormalTok{(}\OtherTok{NA}\NormalTok{, }\DecValTok{15}\NormalTok{)}
\ControlFlowTok{for}\NormalTok{ (k }\ControlFlowTok{in} \DecValTok{2}\OperatorTok{:}\DecValTok{15}\NormalTok{) \{}
\NormalTok{  clk <-}\StringTok{ }\KeywordTok{kmeans}\NormalTok{(z, k)}
\NormalTok{  tve[k] <-}\StringTok{ }\DecValTok{1}\OperatorTok{-}\NormalTok{clk}\OperatorTok{$}\NormalTok{tot.withinss}\OperatorTok{/}\NormalTok{clk}\OperatorTok{$}\NormalTok{totss}
\NormalTok{\}}
\KeywordTok{plot}\NormalTok{(tve, }\DataTypeTok{type=}\StringTok{"b"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-36-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{42}\NormalTok{)}
\KeywordTok{NbClust}\NormalTok{(z, }\DataTypeTok{method=}\StringTok{"ward.D2"}\NormalTok{, }\DataTypeTok{index=}\StringTok{"ch"}\NormalTok{) }\CommentTok{# result: k*=2}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## $All.index
##        2        3        4        5        6        7        8        9 
## 139.7710 120.4259  98.3300  88.7335  82.5706  74.8123  69.3249  65.2113 
##       10       11       12       13       14       15 
##  61.9272  59.6528  58.1524  57.0914  56.0043  55.3023 
## 
## $Best.nc
## Number_clusters     Value_Index 
##           2.000         139.771 
## 
## $Best.partition
##   1   2   3   4   5   6   7   8   9  10  11  12  13  14  15  16  17  18  19  20 
##   1   1   1   1   1   1   1   2   2   2   2   2   2   2   2   2   2   1   2   2 
##  21  22  23  24  25  26  27  28  29  30  31  32  33  34  35  36  37  38  39  40 
##   2   2   2   2   2   2   2   2   2   2   2   2   1   2   2   2   1   2   2   2 
##  41  42  43  44  45  46  47  48  49  50  51  52  53  54  55  56  57  58  59  60 
##   2   2   2   2   2   2   2   2   2   2   2   2   1   2   2   2   2   2   2   2 
##  61  62  63  64  65  66  67  68  69  70  71  72  73  74  75  76  77  78  79  80 
##   2   2   2   2   2   2   2   2   2   2   2   2   2   2   2   2   2   2   2   2 
##  81  82  83  84  85  86  87  88  89  90  91  92  93  94  95  96  97  98  99 100 
##   2   2   2   2   2   2   2   2   2   2   2   2   2   2   2   2   2   2   2   2 
## 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 
##   2   2   2   2   2   2   2   2   2   2   2   2   2   2   1   1   1   1   1   1 
## 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 
##   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1 
## 141 142 143 145 146 147 148 149 150 152 153 154 155 156 157 158 159 160 161 162 
##   1   1   1   1   2   1   1   2   2   2   2   2   2   2   2   2   2   2   2   2 
## 163 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 183 184 
##   2   2   2   2   2   2   2   2   2   2   2   2   2   2   2   2   2   2   2   2 
## 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 
##   2   2   2   2   2   2   2   1   1   1   1   1   1   1   1   1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{42}\NormalTok{)}
\KeywordTok{NbClust}\NormalTok{(z, }\DataTypeTok{method=}\StringTok{"ward.D2"}\NormalTok{) }\CommentTok{# result: majority vote (12) for k*=3.}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-36-2.pdf}

\begin{verbatim}
## *** : The Hubert index is a graphical method of determining the number of clusters.
##                 In the plot of Hubert index, we seek a significant knee that corresponds to a 
##                 significant increase of the value of the measure i.e the significant peak in Hubert
##                 index second differences plot. 
## 
\end{verbatim}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-36-3.pdf}

\begin{verbatim}
## *** : The D index is a graphical method of determining the number of clusters. 
##                 In the plot of D index, we seek a significant knee (the significant peak in Dindex
##                 second differences plot) that corresponds to a significant increase of the value of
##                 the measure. 
##  
## ******************************************************************* 
## * Among all indices:                                                
## * 8 proposed 2 as the best number of clusters 
## * 12 proposed 3 as the best number of clusters 
## * 1 proposed 4 as the best number of clusters 
## * 1 proposed 14 as the best number of clusters 
## * 2 proposed 15 as the best number of clusters 
## 
##                    ***** Conclusion *****                            
##  
## * According to the majority rule, the best number of clusters is  3 
##  
##  
## *******************************************************************
\end{verbatim}

\begin{verbatim}
## $All.index
##        KL       CH Hartigan     CCC     Scott      Marriot    TrCovW    TraceW
## 2  2.9225 139.7710  59.4773  3.0748  463.1206 4.072864e+17 21596.043 1020.0706
## 3  3.5131 120.4259  24.7670  6.5366  826.6680 1.433964e+17 11111.650  780.7158
## 4  0.8659  98.3300  24.3660  7.3358  952.5966 1.340864e+17  8423.499  691.9237
## 5  1.1693  88.7335  21.0237  9.1153 1104.3665 9.658613e+16  6515.744  614.0028
## 6  2.4339  82.5706  12.1013 11.0072 1213.6275 7.964860e+16  4756.855  553.1201
## 7  0.9542  74.8123  11.5500 10.5538 1366.8443 4.961074e+16  4347.806  520.0008
## 8  1.0040  69.3249  10.9477 10.3915 1447.6622 4.290265e+16  3883.982  490.0530
## 9  1.0561  65.2113  10.1985 10.3909 1533.7264 3.500170e+16  3428.487  463.0863
## 10 0.8937  61.9272  10.6113 10.4543 1598.4194 3.106406e+16  2948.095  439.1369
## 11 0.9214  59.6528  11.0369 10.7463 1689.2379 2.364879e+16  2610.542  415.4363
## 12 0.9994  58.1524  10.9827 11.8133 1812.3952 1.501397e+16  2480.136  392.0472
## 13 1.1530  57.0914   9.8993 12.5013 1911.2783 1.063937e+16  2136.940  369.9646
## 14 0.9733  56.0043  10.0901 13.0538 1965.2543 9.368841e+15  1826.549  350.9785
## 15 1.3913  55.3023   7.9632 13.7026 2032.3638 7.636806e+15  1567.078  332.5424
##    Friedman  Rubin Cindex     DB Silhouette   Duda Pseudot2   Beale Ratkowsky
## 2   21.7400 1.7205 0.3120 0.9783     0.4265 0.7137  56.9638  2.3921    0.4113
## 3   28.4878 2.2479 0.2692 1.1655     0.3482 0.8329  18.6544  1.1917    0.4042
## 4   29.5447 2.5364 0.3313 1.1514     0.3628 0.8040  20.9664  1.4472    0.3785
## 5   31.1993 2.8583 0.2878 1.4486     0.3458 0.6822  16.3044  2.7196    0.3548
## 6   32.3856 3.1729 0.3217 1.2612     0.3517 0.8201  10.9717  1.2919    0.3361
## 7   37.4071 3.3750 0.3024 1.4710     0.2876 0.7661  14.9600  1.7967    0.3153
## 8   39.0800 3.5812 0.2885 1.5297     0.2588 0.6165   8.0877  3.4690    0.2988
## 9   40.7503 3.7898 0.2840 1.4543     0.2668 0.6327  27.2817  3.4130    0.2849
## 10  42.0453 3.9965 0.2731 1.4046     0.2679 0.6075  12.9223  3.6951    0.2731
## 11  44.1287 4.2245 0.2665 1.3700     0.2704 0.8028   9.5795  1.4381    0.2628
## 12  48.7617 4.4765 0.2489 1.3929     0.2545 0.7169  11.0589  2.2899    0.2538
## 13  52.5702 4.7437 0.2390 1.3446     0.2621 0.6343  12.6834  3.3114    0.2459
## 14  53.4624 5.0003 0.2303 1.2754     0.2686 1.7043  -2.0662 -2.0679    0.2387
## 15  54.9323 5.2775 0.2808 1.2230     0.2738 0.6088   6.4256  3.5078    0.2322
##        Ball Ptbiserial    Frey McClain   Dunn Hubert SDindex Dindex   SDbw
## 2  510.0353     0.6596  1.5894  0.3791 0.1672 0.0014  1.3874 2.1143 0.6318
## 3  260.2386     0.5824 -0.0150  1.0162 0.1346 0.0014  1.4240 1.7562 0.5419
## 4  172.9809     0.6279  0.6392  1.0868 0.1782 0.0015  1.6964 1.6896 0.6632
## 5  122.8006     0.5917  0.1784  1.6348 0.1280 0.0016  1.9833 1.5926 0.7320
## 6   92.1867     0.5988  0.3878  1.7244 0.1504 0.0017  1.7666 1.5282 0.5752
## 7   74.2858     0.5900  0.9796  1.9096 0.1504 0.0018  1.8074 1.4831 0.5428
## 8   61.2566     0.5491  0.0245  2.3354 0.1264 0.0018  2.0264 1.4334 0.4935
## 9   51.4540     0.5521  0.2609  2.3378 0.1264 0.0018  1.9033 1.4024 0.4559
## 10  43.9137     0.5485  0.1750  2.4413 0.1264 0.0018  1.8289 1.3667 0.4188
## 11  37.7669     0.5484  0.3502  2.4821 0.1264 0.0019  1.7465 1.3323 0.3863
## 12  32.6706     0.5333  0.2567  2.7392 0.1264 0.0020  1.7621 1.2967 0.3768
## 13  28.4588     0.5279  0.1186  2.8500 0.1264 0.0021  1.6812 1.2591 0.3519
## 14  25.0699     0.5285 -0.0290  2.8823 0.1264 0.0021  1.6455 1.2326 0.3438
## 15  22.1695     0.5298  0.1067  2.8742 0.1535 0.0022  1.8933 1.2092 0.2842
## 
## $All.CriticalValues
##    CritValue_Duda CritValue_PseudoT2 Fvalue_Beale
## 2          0.8094            33.4492       0.0110
## 3          0.7816            25.9821       0.2967
## 4          0.7759            24.8432       0.1638
## 5          0.6927            15.5269       0.0046
## 6          0.7297            18.5198       0.2388
## 7          0.7278            18.3290       0.0668
## 8          0.5577            10.3089       0.0008
## 9          0.7237            17.9442       0.0005
## 10         0.6225            12.1297       0.0003
## 11         0.7045            16.3556       0.1702
## 12         0.6665            14.0075       0.0174
## 13         0.6355            12.6164       0.0009
## 14         0.3854             7.9739       1.0000
## 15         0.5139             9.4601       0.0009
## 
## $Best.nc
##                     KL      CH Hartigan     CCC    Scott    Marriot   TrCovW
## Number_clusters 3.0000   2.000   3.0000 15.0000   3.0000 3.0000e+00     3.00
## Value_Index     3.5131 139.771  34.7103 13.7026 363.5475 2.5458e+17 10484.39
##                   TraceW Friedman  Rubin  Cindex     DB Silhouette   Duda
## Number_clusters   3.0000   3.0000  3.000 14.0000 2.0000     2.0000 3.0000
## Value_Index     150.5628   6.7478 -0.239  0.2303 0.9783     0.4265 0.8329
##                 PseudoT2  Beale Ratkowsky     Ball PtBiserial   Frey McClain
## Number_clusters   3.0000 3.0000    2.0000   3.0000     2.0000 2.0000  2.0000
## Value_Index      18.6544 1.1917    0.4113 249.7967     0.6596 1.5894  0.3791
##                   Dunn Hubert SDindex Dindex    SDbw
## Number_clusters 4.0000      0  2.0000      0 15.0000
## Value_Index     0.1782      0  1.3874      0  0.2842
## 
## $Best.partition
##   1   2   3   4   5   6   7   8   9  10  11  12  13  14  15  16  17  18  19  20 
##   1   1   1   1   1   1   1   2   2   2   2   2   2   2   3   3   3   1   3   3 
##  21  22  23  24  25  26  27  28  29  30  31  32  33  34  35  36  37  38  39  40 
##   3   3   3   3   3   3   3   3   3   3   3   3   1   3   3   3   1   3   3   3 
##  41  42  43  44  45  46  47  48  49  50  51  52  53  54  55  56  57  58  59  60 
##   3   3   3   3   3   3   3   3   3   3   3   3   1   3   3   3   3   3   3   3 
##  61  62  63  64  65  66  67  68  69  70  71  72  73  74  75  76  77  78  79  80 
##   3   3   3   3   3   3   3   3   3   3   2   3   3   3   3   3   3   3   3   3 
##  81  82  83  84  85  86  87  88  89  90  91  92  93  94  95  96  97  98  99 100 
##   3   3   3   3   3   3   3   3   3   3   3   3   3   3   3   3   3   3   3   3 
## 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 
##   3   3   3   3   3   3   3   3   3   3   3   3   3   3   1   1   1   1   1   1 
## 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 
##   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1 
## 141 142 143 145 146 147 148 149 150 152 153 154 155 156 157 158 159 160 161 162 
##   1   1   1   1   2   1   1   2   2   2   2   2   2   2   2   2   2   2   2   2 
## 163 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 183 184 
##   2   2   2   2   2   2   2   2   2   2   2   2   2   2   2   2   2   2   2   2 
## 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 
##   2   2   2   2   2   2   2   1   1   1   1   1   1   1   1   1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Silhouette method}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{42}\NormalTok{)}
\KeywordTok{fviz_nbclust}\NormalTok{(z, kmeans, }\DataTypeTok{method =} \StringTok{"silhouette"}\NormalTok{)}\OperatorTok{+}
\StringTok{  }\KeywordTok{labs}\NormalTok{(}\DataTypeTok{subtitle =} \StringTok{"Silhouette method"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-37-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{d <-}\StringTok{ }\KeywordTok{dist}\NormalTok{(z)}
\NormalTok{cl1 <-}\StringTok{ }\KeywordTok{hclust}\NormalTok{(d, }\DataTypeTok{method=}\StringTok{"ward.D2"}\NormalTok{)}
\NormalTok{memb2 <-}\StringTok{ }\KeywordTok{cutree}\NormalTok{(cl1, }\DecValTok{2}\NormalTok{)}
\NormalTok{memb3 <-}\StringTok{ }\KeywordTok{cutree}\NormalTok{(cl1, }\DecValTok{3}\NormalTok{)}
\NormalTok{memb4 <-}\StringTok{ }\KeywordTok{cutree}\NormalTok{(cl1, }\DecValTok{4}\NormalTok{)}

\KeywordTok{library}\NormalTok{(}\StringTok{"cluster"}\NormalTok{)}
\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfcol=}\KeywordTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{))}
\KeywordTok{plot}\NormalTok{(pc_cor}\OperatorTok{$}\NormalTok{x[,}\DecValTok{1}\NormalTok{], pc_cor}\OperatorTok{$}\NormalTok{x[,}\DecValTok{2}\NormalTok{], }\DataTypeTok{col=}\NormalTok{memb2)}
\NormalTok{s2 <-}\StringTok{ }\KeywordTok{silhouette}\NormalTok{(memb2, d)}
\KeywordTok{plot}\NormalTok{(s2, }\DataTypeTok{col=}\DecValTok{1}\OperatorTok{:}\DecValTok{2}\NormalTok{, }\DataTypeTok{border=}\OtherTok{NA}\NormalTok{)}
\KeywordTok{plot}\NormalTok{(pc_cor}\OperatorTok{$}\NormalTok{x[,}\DecValTok{1}\NormalTok{], pc_cor}\OperatorTok{$}\NormalTok{x[,}\DecValTok{2}\NormalTok{], }\DataTypeTok{col=}\NormalTok{memb3)}
\NormalTok{s3 <-}\StringTok{ }\KeywordTok{silhouette}\NormalTok{(memb3, d)}
\KeywordTok{plot}\NormalTok{(s3, }\DataTypeTok{col=}\DecValTok{1}\OperatorTok{:}\DecValTok{3}\NormalTok{, }\DataTypeTok{border=}\OtherTok{NA}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-37-2.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfcol=}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{3}\NormalTok{))}
\KeywordTok{clusplot}\NormalTok{(z, memb2, }\DataTypeTok{col.p=}\NormalTok{memb2)}
\KeywordTok{clusplot}\NormalTok{(z, memb3, }\DataTypeTok{col.p=}\NormalTok{memb3)}
\KeywordTok{clusplot}\NormalTok{(z, memb4, }\DataTypeTok{col.p=}\NormalTok{memb4)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-37-3.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(}\StringTok{"cluster"}\NormalTok{)}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{42}\NormalTok{)}
\NormalTok{cl2 <-}\StringTok{ }\KeywordTok{pam}\NormalTok{(z, }\DecValTok{4}\NormalTok{)}
\NormalTok{k_classic <-}\StringTok{ }\KeywordTok{names}\NormalTok{(cl2}\OperatorTok{$}\NormalTok{clustering[cl2}\OperatorTok{$}\NormalTok{clustering }\OperatorTok{==}\StringTok{ }\DecValTok{1}\NormalTok{])}
\NormalTok{k_techno <-}\StringTok{ }\KeywordTok{names}\NormalTok{(cl2}\OperatorTok{$}\NormalTok{clustering[cl2}\OperatorTok{$}\NormalTok{clustering }\OperatorTok{==}\StringTok{ }\DecValTok{2}\NormalTok{])}
\NormalTok{k_pop <-}\StringTok{ }\KeywordTok{names}\NormalTok{(cl2}\OperatorTok{$}\NormalTok{clustering[cl2}\OperatorTok{$}\NormalTok{clustering }\OperatorTok{==}\StringTok{ }\DecValTok{3}\NormalTok{])}
\NormalTok{k_hiphop <-}\StringTok{ }\KeywordTok{names}\NormalTok{(cl2}\OperatorTok{$}\NormalTok{clustering[cl2}\OperatorTok{$}\NormalTok{clustering }\OperatorTok{==}\StringTok{ }\DecValTok{4}\NormalTok{])}

\NormalTok{cl2}\OperatorTok{$}\NormalTok{clustering[k_techno] <-}\StringTok{ }\DecValTok{4}
\NormalTok{cl2}\OperatorTok{$}\NormalTok{clustering[k_pop] <-}\StringTok{ }\DecValTok{3}
\NormalTok{cl2}\OperatorTok{$}\NormalTok{clustering[k_hiphop] <-}\StringTok{ }\DecValTok{2}
\NormalTok{cl2}\OperatorTok{$}\NormalTok{clustering[k_classic] <-}\StringTok{ }\DecValTok{1}

\NormalTok{x}\OperatorTok{$}\NormalTok{cluster <-}\StringTok{ }\KeywordTok{as.factor}\NormalTok{(cl2}\OperatorTok{$}\NormalTok{clustering)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x}\OperatorTok{$}\NormalTok{Artist_Follower <-}\StringTok{ }\NormalTok{x}\OperatorTok{$}\NormalTok{Artist_Follower}\OperatorTok{/}\DecValTok{1000000}

\NormalTok{x}\OperatorTok{$}\NormalTok{fa_}\DecValTok{1}\NormalTok{ <-}\StringTok{ }\NormalTok{x}\OperatorTok{$}\NormalTok{factor_}\DecValTok{1}
\NormalTok{x}\OperatorTok{$}\NormalTok{fa_}\DecValTok{2}\NormalTok{ <-}\StringTok{ }\NormalTok{x}\OperatorTok{$}\NormalTok{factor_}\DecValTok{2}
\NormalTok{x}\OperatorTok{$}\NormalTok{fa_}\DecValTok{3}\NormalTok{ <-}\StringTok{ }\NormalTok{x}\OperatorTok{$}\NormalTok{factor_}\DecValTok{3}
\NormalTok{x}\OperatorTok{$}\NormalTok{fa_}\DecValTok{4}\NormalTok{ <-}\StringTok{ }\NormalTok{x}\OperatorTok{$}\NormalTok{factor_}\DecValTok{4}


\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfrow=}\KeywordTok{c}\NormalTok{(}\DecValTok{3}\NormalTok{,}\DecValTok{3}\NormalTok{))}
\NormalTok{nx <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"fa_1"}\NormalTok{, }\StringTok{"fa_2"}\NormalTok{, }\StringTok{"fa_3"}\NormalTok{, }\StringTok{"fa_4"}\NormalTok{, }\StringTok{"pc_1"}\NormalTok{, }\StringTok{"pc_2"}\NormalTok{, }\StringTok{"Artist_Follower"}\NormalTok{, }\StringTok{"days_release_orig"}\NormalTok{, }\StringTok{"Track_Popularity"}\NormalTok{)}
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\KeywordTok{length}\NormalTok{(nx)) \{}
\NormalTok{  lmi <-}\StringTok{ }\KeywordTok{lm}\NormalTok{(}\KeywordTok{as.formula}\NormalTok{(}\KeywordTok{paste}\NormalTok{(}\StringTok{'Artist_Popularity'}\NormalTok{, nx[i], }\DataTypeTok{sep=}\StringTok{"~"}\NormalTok{)), }\DataTypeTok{data=}\NormalTok{x)}
  \KeywordTok{summary}\NormalTok{(lmi)}
  \KeywordTok{plot}\NormalTok{(x[,nx[i]], x[,}\StringTok{'Artist_Popularity'}\NormalTok{], }\DataTypeTok{xlab=}\NormalTok{nx[i], }\DataTypeTok{ylab=}\StringTok{'Artist Popularity'}\NormalTok{, }\DataTypeTok{main=}\KeywordTok{sprintf}\NormalTok{(}\StringTok{"R^2=%.2f"}\NormalTok{, }\KeywordTok{summary}\NormalTok{(lmi)}\OperatorTok{$}\NormalTok{r.squared))}
  \KeywordTok{abline}\NormalTok{(lmi, }\DataTypeTok{col=}\StringTok{"red"}\NormalTok{)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-39-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{model1 <-}\StringTok{ }\KeywordTok{lm}\NormalTok{(Artist_Popularity }\OperatorTok{~}\StringTok{ }\NormalTok{fa_}\DecValTok{1} \OperatorTok{+}\StringTok{ }\NormalTok{fa_}\DecValTok{2} \OperatorTok{+}\StringTok{ }\NormalTok{fa_}\DecValTok{3} \OperatorTok{+}\StringTok{ }\NormalTok{fa_}\DecValTok{4} \OperatorTok{+}\StringTok{ }\NormalTok{pc_}\DecValTok{1} \OperatorTok{+}\StringTok{ }\NormalTok{pc_}\DecValTok{2} \OperatorTok{+}\StringTok{ }\NormalTok{Artist_Follower }\OperatorTok{+}\StringTok{ }\NormalTok{days_release_orig, }\DataTypeTok{data =}\NormalTok{ x)}

\KeywordTok{summary}\NormalTok{(model1)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## lm(formula = Artist_Popularity ~ fa_1 + fa_2 + fa_3 + fa_4 + 
##     pc_1 + pc_2 + Artist_Follower + days_release_orig, data = x)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -28.4051  -6.6722   0.3102   7.0904  21.0544 
## 
## Coefficients:
##                     Estimate Std. Error t value Pr(>|t|)    
## (Intercept)       64.5143111  0.8690218  74.238  < 2e-16 ***
## fa_1              -0.0816610  1.1386538  -0.072 0.942904    
## fa_2               1.8480927  0.7571880   2.441 0.015589 *  
## fa_3               5.4094057  1.3919701   3.886 0.000141 ***
## fa_4              -1.2986520  1.2829029  -1.012 0.312714    
## pc_1               1.4023625  0.5912068   2.372 0.018706 *  
## pc_2               7.4542956  0.6570917  11.344  < 2e-16 ***
## Artist_Follower    0.8090864  0.1199206   6.747 1.84e-10 ***
## days_release_orig -0.0004646  0.0002093  -2.220 0.027631 *  
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 9.765 on 187 degrees of freedom
## Multiple R-squared:  0.6364, Adjusted R-squared:  0.6208 
## F-statistic: 40.91 on 8 and 187 DF,  p-value: < 2.2e-16
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# fa_2: "Youtube"}
\CommentTok{# fa_3: "Artist content supply"}
\CommentTok{# fa_4: "Artist long-term activity"}
\CommentTok{# fa_1: "One hit wonder"}

\CommentTok{# pc_1 (between classic and Pop, Hip Hop, Techno): strong negative loadings: acousticness and instrumentalness, strong positive loadings: danceability, energy and loudness}
\CommentTok{# pc_2 (between Techno and Pop, Hip Hop): strong negative loadings: instrumentalness and tempo, strong positive loadings: speechiness and valence}

\KeywordTok{vif}\NormalTok{(model1) }\CommentTok{# fa_1, fa_3, fa_4, pc_1 mild collinearity}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##              fa_1              fa_2              fa_3              fa_4 
##          2.181823          1.127092          2.881682          2.202112 
##              pc_1              pc_2   Artist_Follower days_release_orig 
##          3.077405          1.290976          1.276809          1.607455
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(}\StringTok{"perturb"}\NormalTok{) }\CommentTok{# condition index}
\KeywordTok{colldiag}\NormalTok{(model1)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Condition
## Index    Variance Decomposition Proportions
##          intercept fa_1  fa_2  fa_3  fa_4  pc_1  pc_2  Artist_Follower
## 1  1.000 0.002     0.017 0.003 0.030 0.035 0.031 0.000 0.000          
## 2  1.314 0.106     0.011 0.066 0.002 0.000 0.002 0.071 0.129          
## 3  1.462 0.003     0.135 0.054 0.013 0.014 0.008 0.093 0.103          
## 4  1.562 0.203     0.000 0.220 0.006 0.015 0.004 0.141 0.006          
## 5  1.914 0.002     0.036 0.381 0.041 0.049 0.017 0.373 0.025          
## 6  2.154 0.035     0.007 0.265 0.055 0.194 0.002 0.031 0.405          
## 7  2.926 0.635     0.006 0.006 0.000 0.069 0.042 0.099 0.121          
## 8  3.154 0.000     0.412 0.007 0.169 0.323 0.301 0.085 0.204          
## 9  3.912 0.015     0.376 0.000 0.683 0.301 0.593 0.107 0.007          
##   days_release_orig
## 1 0.029            
## 2 0.036            
## 3 0.023            
## 4 0.030            
## 5 0.005            
## 6 0.048            
## 7 0.739            
## 8 0.069            
## 9 0.022
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# I remove some variables according to insignificance (fa_1, fa_4)}

\NormalTok{model2 <-}\StringTok{ }\KeywordTok{lm}\NormalTok{(Artist_Popularity }\OperatorTok{~}\StringTok{ }\NormalTok{fa_}\DecValTok{2} \OperatorTok{+}\StringTok{ }\NormalTok{fa_}\DecValTok{3} \OperatorTok{+}\StringTok{ }\NormalTok{pc_}\DecValTok{1} \OperatorTok{+}\StringTok{ }\NormalTok{pc_}\DecValTok{2} \OperatorTok{+}\StringTok{ }\NormalTok{Artist_Follower }\OperatorTok{+}\StringTok{ }\NormalTok{days_release_orig, }\DataTypeTok{data =}\NormalTok{ x)}
\CommentTok{# summary(model2)}
\KeywordTok{vif}\NormalTok{(model2)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##              fa_2              fa_3              pc_1              pc_2 
##          1.126103          1.674037          2.021619          1.082232 
##   Artist_Follower days_release_orig 
##          1.177174          1.510313
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{select.cols <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"Artist_Popularity"}\NormalTok{, }\StringTok{"fa_2"}\NormalTok{, }\StringTok{"fa_3"}\NormalTok{, }\StringTok{"pc_1"}\NormalTok{, }\StringTok{"pc_2"}\NormalTok{, }\StringTok{"Artist_Follower"}\NormalTok{, }\StringTok{"days_release_orig"}\NormalTok{)}

\NormalTok{z <-}\StringTok{ }\KeywordTok{as.data.frame}\NormalTok{(}\KeywordTok{scale}\NormalTok{(dplyr}\OperatorTok{::}\KeywordTok{select}\NormalTok{(x, select.cols)))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Note: Using an external vector in selections is ambiguous.
## i Use `all_of(select.cols)` instead of `select.cols` to silence this message.
## i See <https://tidyselect.r-lib.org/reference/faq-external-vector.html>.
## This message is displayed once per session.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{model2_z <-}\StringTok{ }\KeywordTok{lm}\NormalTok{(Artist_Popularity }\OperatorTok{~}\StringTok{ }\NormalTok{fa_}\DecValTok{2} \OperatorTok{+}\StringTok{ }\NormalTok{fa_}\DecValTok{3} \OperatorTok{+}\StringTok{ }\NormalTok{pc_}\DecValTok{1} \OperatorTok{+}\StringTok{ }\NormalTok{pc_}\DecValTok{2} \OperatorTok{+}\StringTok{ }\NormalTok{Artist_Follower }\OperatorTok{+}\StringTok{ }\NormalTok{days_release_orig, }\DataTypeTok{data =}\NormalTok{ z)}
\CommentTok{# summary(model2_z)}
\KeywordTok{vif}\NormalTok{(model2_z)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##              fa_2              fa_3              pc_1              pc_2 
##          1.126103          1.674037          2.021619          1.082232 
##   Artist_Follower days_release_orig 
##          1.177174          1.510313
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{model2_z}\OperatorTok{$}\NormalTok{coefficients}\OperatorTok{^}\DecValTok{2}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##       (Intercept)              fa_2              fa_3              pc_1 
##      8.251688e-33      1.318360e-02      8.530193e-02      5.212851e-02 
##              pc_2   Artist_Follower days_release_orig 
##      3.226773e-01      1.063958e-01      1.819168e-02
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{sum}\NormalTok{(model2_z}\OperatorTok{$}\NormalTok{coefficients}\OperatorTok{^}\DecValTok{2}\NormalTok{) }\CommentTok{# 60% is the proportion in the variance of y explained by X and 40% of the variance of y is due to the variance of the residuals outside of the model IFF there was zero multicollinearity. In terms of relevance, 32% of variance in y is explained by pc_2, 10% by Artist_Follower, 8% by fa_3}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.5978788
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{sort}\NormalTok{(}\KeywordTok{round}\NormalTok{((model2_z}\OperatorTok{$}\NormalTok{coefficients)}\OperatorTok{^}\DecValTok{2}\NormalTok{, }\DataTypeTok{digits =} \DecValTok{4}\NormalTok{), }\DataTypeTok{decreasing =}\NormalTok{ T)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##              pc_2   Artist_Follower              fa_3              pc_1 
##            0.3227            0.1064            0.0853            0.0521 
## days_release_orig              fa_2       (Intercept) 
##            0.0182            0.0132            0.0000
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Quadratic specification seems appropriate:}

\CommentTok{# variables without and with quadratic terms (fa_2, pc_2, Artist_Follower)}

\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfcol=}\KeywordTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{))}

\NormalTok{lm_fa2 <-}\StringTok{ }\KeywordTok{lm}\NormalTok{(Artist_Popularity }\OperatorTok{~}\StringTok{ }\NormalTok{fa_}\DecValTok{2}\NormalTok{, }\DataTypeTok{data=}\NormalTok{x)}
\KeywordTok{plot}\NormalTok{(x[,}\StringTok{'fa_2'}\NormalTok{], x[,}\StringTok{'Artist_Popularity'}\NormalTok{], }\DataTypeTok{xlab=}\StringTok{'fa_2'}\NormalTok{, }\DataTypeTok{main=}\KeywordTok{sprintf}\NormalTok{(}\StringTok{"R^2=%.2f"}\NormalTok{, }\KeywordTok{summary}\NormalTok{(lm_fa2)}\OperatorTok{$}\NormalTok{r.squared),}
     \DataTypeTok{ylim =} \KeywordTok{c}\NormalTok{(}\KeywordTok{min}\NormalTok{(}\KeywordTok{min}\NormalTok{(}\KeywordTok{fitted}\NormalTok{(lm_fa2)), }\KeywordTok{min}\NormalTok{(x}\OperatorTok{$}\NormalTok{Artist_Popularity)), }\KeywordTok{max}\NormalTok{(}\KeywordTok{max}\NormalTok{(}\KeywordTok{fitted}\NormalTok{(lm_fa2)), }\KeywordTok{max}\NormalTok{(x}\OperatorTok{$}\NormalTok{Artist_Popularity))), }\DataTypeTok{ylab =} \StringTok{'Artist_Popularity'}\NormalTok{)}
\KeywordTok{abline}\NormalTok{(lm_fa2, }\DataTypeTok{col=}\StringTok{"red"}\NormalTok{)}

\NormalTok{lmq_fa2 <-}\StringTok{ }\KeywordTok{lm}\NormalTok{(Artist_Popularity }\OperatorTok{~}\StringTok{ }\KeywordTok{poly}\NormalTok{(fa_}\DecValTok{2}\NormalTok{, }\DecValTok{2}\NormalTok{), }\DataTypeTok{data=}\NormalTok{x)}
\NormalTok{o <-}\StringTok{ }\KeywordTok{order}\NormalTok{(x}\OperatorTok{$}\NormalTok{fa_}\DecValTok{2}\NormalTok{)}
\KeywordTok{plot}\NormalTok{(x[,}\StringTok{'fa_2'}\NormalTok{], x[,}\StringTok{'Artist_Popularity'}\NormalTok{], }\DataTypeTok{xlab=} \StringTok{'fa_2 + fa_2^2'}\NormalTok{, }\DataTypeTok{main=}\KeywordTok{sprintf}\NormalTok{(}\StringTok{"R^2=%.2f"}\NormalTok{, }\KeywordTok{summary}\NormalTok{(lmq_fa2)}\OperatorTok{$}\NormalTok{r.squared),}
     \DataTypeTok{ylim =} \KeywordTok{c}\NormalTok{(}\KeywordTok{min}\NormalTok{(}\KeywordTok{min}\NormalTok{(}\KeywordTok{fitted}\NormalTok{(lmq_fa2)), }\KeywordTok{min}\NormalTok{(x}\OperatorTok{$}\NormalTok{Artist_Popularity)), }\KeywordTok{max}\NormalTok{(}\KeywordTok{max}\NormalTok{(}\KeywordTok{fitted}\NormalTok{(lmq_fa2)), }\KeywordTok{max}\NormalTok{(x}\OperatorTok{$}\NormalTok{Artist_Popularity))), }\DataTypeTok{ylab =} \StringTok{'Artist_Popularity'}\NormalTok{)}
\KeywordTok{lines}\NormalTok{(x}\OperatorTok{$}\NormalTok{fa_}\DecValTok{2}\NormalTok{[o], }\KeywordTok{fitted}\NormalTok{(lmq_fa2)[o], }\DataTypeTok{col=}\StringTok{"red"}\NormalTok{)}

\NormalTok{lm_follower <-}\StringTok{ }\KeywordTok{lm}\NormalTok{(Artist_Popularity }\OperatorTok{~}\StringTok{ }\NormalTok{Artist_Follower, }\DataTypeTok{data=}\NormalTok{x)}
\KeywordTok{plot}\NormalTok{(x[,}\StringTok{'Artist_Follower'}\NormalTok{], x[,}\StringTok{'Artist_Popularity'}\NormalTok{], }\DataTypeTok{xlab=}\StringTok{'Artist_Follower'}\NormalTok{, }\DataTypeTok{main=}\KeywordTok{sprintf}\NormalTok{(}\StringTok{"R^2=%.2f"}\NormalTok{, }\KeywordTok{summary}\NormalTok{(lm_follower)}\OperatorTok{$}\NormalTok{r.squared),}
     \DataTypeTok{ylim =} \KeywordTok{c}\NormalTok{(}\KeywordTok{min}\NormalTok{(}\KeywordTok{min}\NormalTok{(}\KeywordTok{fitted}\NormalTok{(lm_follower)), }\KeywordTok{min}\NormalTok{(x}\OperatorTok{$}\NormalTok{Artist_Popularity)), }\KeywordTok{max}\NormalTok{(}\KeywordTok{max}\NormalTok{(}\KeywordTok{fitted}\NormalTok{(lm_follower)), }\KeywordTok{max}\NormalTok{(x}\OperatorTok{$}\NormalTok{Artist_Popularity))), }\DataTypeTok{ylab =} \StringTok{'Artist_Popularity'}\NormalTok{)}
\KeywordTok{abline}\NormalTok{(lm_follower, }\DataTypeTok{col=}\StringTok{"red"}\NormalTok{)}

\NormalTok{lmq_follower <-}\StringTok{ }\KeywordTok{lm}\NormalTok{(Artist_Popularity }\OperatorTok{~}\StringTok{ }\KeywordTok{poly}\NormalTok{(Artist_Follower, }\DecValTok{2}\NormalTok{), }\DataTypeTok{data=}\NormalTok{x)}
\NormalTok{o <-}\StringTok{ }\KeywordTok{order}\NormalTok{(x}\OperatorTok{$}\NormalTok{Artist_Follower)}
\KeywordTok{plot}\NormalTok{(x[,}\StringTok{'Artist_Follower'}\NormalTok{], x[,}\StringTok{'Artist_Popularity'}\NormalTok{], }\DataTypeTok{xlab=} \StringTok{'Artist_Follower + Artist_Follower^2'}\NormalTok{, }\DataTypeTok{main=}\KeywordTok{sprintf}\NormalTok{(}\StringTok{"R^2=%.2f"}\NormalTok{, }\KeywordTok{summary}\NormalTok{(lmq_follower)}\OperatorTok{$}\NormalTok{r.squared),}
     \DataTypeTok{ylim =} \KeywordTok{c}\NormalTok{(}\KeywordTok{min}\NormalTok{(}\KeywordTok{min}\NormalTok{(}\KeywordTok{fitted}\NormalTok{(lmq_follower)), }\KeywordTok{min}\NormalTok{(x}\OperatorTok{$}\NormalTok{Artist_Popularity)), }\KeywordTok{max}\NormalTok{(}\KeywordTok{max}\NormalTok{(}\KeywordTok{fitted}\NormalTok{(lmq_follower)), }\KeywordTok{max}\NormalTok{(x}\OperatorTok{$}\NormalTok{Artist_Popularity))), }\DataTypeTok{ylab =} \StringTok{'Artist_Popularity'}\NormalTok{)}
\KeywordTok{lines}\NormalTok{(x}\OperatorTok{$}\NormalTok{Artist_Follower[o], }\KeywordTok{fitted}\NormalTok{(lmq_follower)[o], }\DataTypeTok{col=}\StringTok{"red"}\NormalTok{)}

\NormalTok{lm_pc2 <-}\StringTok{ }\KeywordTok{lm}\NormalTok{(Artist_Popularity }\OperatorTok{~}\StringTok{ }\NormalTok{pc_}\DecValTok{2}\NormalTok{, }\DataTypeTok{data=}\NormalTok{x)}
\KeywordTok{plot}\NormalTok{(x[,}\StringTok{'pc_2'}\NormalTok{], x[,}\StringTok{'Artist_Popularity'}\NormalTok{], }\DataTypeTok{xlab=}\StringTok{'pc_2'}\NormalTok{, }\DataTypeTok{main=}\KeywordTok{sprintf}\NormalTok{(}\StringTok{"R^2=%.2f"}\NormalTok{, }\KeywordTok{summary}\NormalTok{(lm_pc2)}\OperatorTok{$}\NormalTok{r.squared),}
     \DataTypeTok{ylim =} \KeywordTok{c}\NormalTok{(}\KeywordTok{min}\NormalTok{(}\KeywordTok{min}\NormalTok{(}\KeywordTok{fitted}\NormalTok{(lm_pc2)), }\KeywordTok{min}\NormalTok{(x}\OperatorTok{$}\NormalTok{Artist_Popularity)), }\KeywordTok{max}\NormalTok{(}\KeywordTok{max}\NormalTok{(}\KeywordTok{fitted}\NormalTok{(lm_pc2)), }\KeywordTok{max}\NormalTok{(x}\OperatorTok{$}\NormalTok{Artist_Popularity))), }\DataTypeTok{ylab =} \StringTok{'Artist_Popularity'}\NormalTok{)}
\KeywordTok{abline}\NormalTok{(lm_pc2, }\DataTypeTok{col=}\StringTok{"red"}\NormalTok{)}

\NormalTok{lmq_pc2 <-}\StringTok{ }\KeywordTok{lm}\NormalTok{(Artist_Popularity }\OperatorTok{~}\StringTok{ }\KeywordTok{poly}\NormalTok{(pc_}\DecValTok{2}\NormalTok{, }\DecValTok{2}\NormalTok{), }\DataTypeTok{data=}\NormalTok{x)}
\NormalTok{o <-}\StringTok{ }\KeywordTok{order}\NormalTok{(x}\OperatorTok{$}\NormalTok{pc_}\DecValTok{2}\NormalTok{)}
\KeywordTok{plot}\NormalTok{(x[,}\StringTok{'pc_2'}\NormalTok{], x[,}\StringTok{'Artist_Popularity'}\NormalTok{], }\DataTypeTok{xlab=} \StringTok{'pc_2 + pc_2^2'}\NormalTok{, }\DataTypeTok{main=}\KeywordTok{sprintf}\NormalTok{(}\StringTok{"R^2=%.2f"}\NormalTok{, }\KeywordTok{summary}\NormalTok{(lmq_pc2)}\OperatorTok{$}\NormalTok{r.squared),}
     \DataTypeTok{ylim =} \KeywordTok{c}\NormalTok{(}\KeywordTok{min}\NormalTok{(}\KeywordTok{min}\NormalTok{(}\KeywordTok{fitted}\NormalTok{(lmq_pc2)), }\KeywordTok{min}\NormalTok{(x}\OperatorTok{$}\NormalTok{Artist_Popularity)), }\KeywordTok{max}\NormalTok{(}\KeywordTok{max}\NormalTok{(}\KeywordTok{fitted}\NormalTok{(lmq_pc2)), }\KeywordTok{max}\NormalTok{(x}\OperatorTok{$}\NormalTok{Artist_Popularity))), }\DataTypeTok{ylab =} \StringTok{'Artist_Popularity'}\NormalTok{)}
\KeywordTok{lines}\NormalTok{(x}\OperatorTok{$}\NormalTok{pc_}\DecValTok{2}\NormalTok{[o], }\KeywordTok{fitted}\NormalTok{(lmq_pc2)[o], }\DataTypeTok{col=}\StringTok{"red"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-41-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Residuals normality}

\KeywordTok{ks.test}\NormalTok{(model1}\OperatorTok{$}\NormalTok{residuals, }\StringTok{"pnorm"}\NormalTok{, }\DataTypeTok{mean =} \KeywordTok{mean}\NormalTok{(model1}\OperatorTok{$}\NormalTok{residuals), }\DataTypeTok{sd=}\KeywordTok{sd}\NormalTok{(model1}\OperatorTok{$}\NormalTok{residuals))}\OperatorTok{$}\NormalTok{statistic}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##          D 
## 0.04757442
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FloatTok{1.3581} \OperatorTok{/}\StringTok{ }\KeywordTok{sqrt}\NormalTok{(}\KeywordTok{length}\NormalTok{(model1}\OperatorTok{$}\NormalTok{residuals))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.09700714
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ks.test}\NormalTok{(model2}\OperatorTok{$}\NormalTok{residuals, }\StringTok{"pnorm"}\NormalTok{, }\DataTypeTok{mean =} \KeywordTok{mean}\NormalTok{(model2}\OperatorTok{$}\NormalTok{residuals), }\DataTypeTok{sd=}\KeywordTok{sd}\NormalTok{(model2}\OperatorTok{$}\NormalTok{residuals))}\OperatorTok{$}\NormalTok{statistic}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##          D 
## 0.05823339
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FloatTok{1.3581} \OperatorTok{/}\StringTok{ }\KeywordTok{sqrt}\NormalTok{(}\KeywordTok{length}\NormalTok{(model2}\OperatorTok{$}\NormalTok{residuals))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.09700714
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfcol=}\KeywordTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{))}
\KeywordTok{plot}\NormalTok{(model2)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-42-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfcol=}\KeywordTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{))}
\NormalTok{nx <-}\StringTok{ }\KeywordTok{names}\NormalTok{(model2}\OperatorTok{$}\NormalTok{model)}
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{2}\OperatorTok{:}\KeywordTok{length}\NormalTok{(model2}\OperatorTok{$}\NormalTok{model)) \{}
  \KeywordTok{plot}\NormalTok{(model2}\OperatorTok{$}\NormalTok{model[,i], }\KeywordTok{residuals}\NormalTok{(model2), }\DataTypeTok{xlab=}\NormalTok{nx[i])}
  \KeywordTok{lines}\NormalTok{(}\KeywordTok{lowess}\NormalTok{(model2}\OperatorTok{$}\NormalTok{model[,i], }\KeywordTok{residuals}\NormalTok{(model2)), }\DataTypeTok{col =} \StringTok{"red"}\NormalTok{)}
  \KeywordTok{abline}\NormalTok{(}\DataTypeTok{h =} \DecValTok{0}\NormalTok{, }\DataTypeTok{col =} \StringTok{"black"}\NormalTok{, }\DataTypeTok{lty =} \DecValTok{2}\NormalTok{)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-42-2.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfcol=}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{))}
\KeywordTok{plot}\NormalTok{(model2}\OperatorTok{$}\NormalTok{fitted.values, }\KeywordTok{residuals}\NormalTok{(model2))}
\KeywordTok{lines}\NormalTok{(}\KeywordTok{lowess}\NormalTok{(model2}\OperatorTok{$}\NormalTok{fitted.values, }\KeywordTok{residuals}\NormalTok{(model2)), }\DataTypeTok{col =} \StringTok{"red"}\NormalTok{)}
\KeywordTok{abline}\NormalTok{(}\DataTypeTok{h =} \DecValTok{0}\NormalTok{, }\DataTypeTok{col =} \StringTok{"black"}\NormalTok{, }\DataTypeTok{lty =} \DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-42-3.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# residuals vs. predictors and fitted values suggests nonlinearity of the regression function}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfcol=}\KeywordTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{))}
\NormalTok{nx <-}\StringTok{ }\KeywordTok{names}\NormalTok{(model2}\OperatorTok{$}\NormalTok{model)}
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{2}\OperatorTok{:}\KeywordTok{length}\NormalTok{(model2}\OperatorTok{$}\NormalTok{model)) \{}
  \KeywordTok{plot}\NormalTok{(model2}\OperatorTok{$}\NormalTok{model[,i], }\KeywordTok{rstandard}\NormalTok{(model2), }\DataTypeTok{xlab=}\NormalTok{nx[i])}
  \KeywordTok{lines}\NormalTok{(}\KeywordTok{lowess}\NormalTok{(model2}\OperatorTok{$}\NormalTok{model[,i], }\KeywordTok{rstandard}\NormalTok{(model2)), }\DataTypeTok{col =} \StringTok{"red"}\NormalTok{)}
  \CommentTok{# wenn Linie von 0 abweicht: Residuen sind biased, sprich deren Mittelwert nicht 0}
  \KeywordTok{abline}\NormalTok{(}\DataTypeTok{h =} \DecValTok{0}\NormalTok{, }\DataTypeTok{col =} \StringTok{"black"}\NormalTok{, }\DataTypeTok{lty =} \DecValTok{2}\NormalTok{)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-43-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# standardized residuals vs. fitted values}

\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfcol=}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{))}
\KeywordTok{plot}\NormalTok{(model2}\OperatorTok{$}\NormalTok{fitted.values, }\KeywordTok{rstandard}\NormalTok{(model2), }\DataTypeTok{main =} \StringTok{'Standardized residuals vs. fitted values'}\NormalTok{)}
\KeywordTok{lines}\NormalTok{(}\KeywordTok{lowess}\NormalTok{(model2}\OperatorTok{$}\NormalTok{fitted.values, }\KeywordTok{rstandard}\NormalTok{(model2)), }\DataTypeTok{col =} \StringTok{"red"}\NormalTok{)}
\KeywordTok{abline}\NormalTok{(}\DataTypeTok{h =} \DecValTok{0}\NormalTok{, }\DataTypeTok{col =} \StringTok{"black"}\NormalTok{, }\DataTypeTok{lty =} \DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-43-2.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Breusch-Pagan Test + Durbin-Watson Test / spherical errors (i.e. iid)}
\CommentTok{# model2 uses unscaled data}
\NormalTok{auxiliary_reg <-}\StringTok{ }\KeywordTok{lm}\NormalTok{(model2}\OperatorTok{$}\NormalTok{residuals}\OperatorTok{^}\DecValTok{2} \OperatorTok{~}\StringTok{ }\NormalTok{fa_}\DecValTok{2} \OperatorTok{+}\StringTok{ }\NormalTok{fa_}\DecValTok{3} \OperatorTok{+}\StringTok{ }\NormalTok{pc_}\DecValTok{1} \OperatorTok{+}\StringTok{ }\NormalTok{pc_}\DecValTok{2} \OperatorTok{+}\StringTok{ }\NormalTok{Artist_Follower }\OperatorTok{+}\StringTok{ }\NormalTok{days_release_orig, }\DataTypeTok{data =}\NormalTok{ x)}
\KeywordTok{summary}\NormalTok{(auxiliary_reg)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## lm(formula = model2$residuals^2 ~ fa_2 + fa_3 + pc_1 + pc_2 + 
##     Artist_Follower + days_release_orig, data = x)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -209.99  -69.77  -26.75   39.15  712.88 
## 
## Coefficients:
##                     Estimate Std. Error t value Pr(>|t|)    
## (Intercept)        92.093388   9.620134   9.573  < 2e-16 ***
## fa_2                0.973183   8.480588   0.115  0.90876    
## fa_3              -29.748317  11.887822  -2.502  0.01318 *  
## pc_1               -8.915701   5.369201  -1.661  0.09847 .  
## pc_2                4.904291   6.741245   0.728  0.46782    
## Artist_Follower     3.868671   1.290221   2.998  0.00308 ** 
## days_release_orig  -0.004154   0.002273  -1.828  0.06918 .  
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 109.4 on 189 degrees of freedom
## Multiple R-squared:  0.1067, Adjusted R-squared:  0.0783 
## F-statistic: 3.761 on 6 and 189 DF,  p-value: 0.001467
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# R^2: 0.1067}
\CommentTok{# N = 196, N = nrow(x) }
\CommentTok{# test stat: }
\KeywordTok{summary}\NormalTok{(auxiliary_reg)}\OperatorTok{$}\NormalTok{r.square }\OperatorTok{*}\StringTok{ }\KeywordTok{nrow}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 20.90497
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# test stat: 20.90497}
\NormalTok{p <-}\StringTok{ }\KeywordTok{ncol}\NormalTok{(model2}\OperatorTok{$}\NormalTok{model)}\OperatorTok{-}\DecValTok{1}
\KeywordTok{qchisq}\NormalTok{(.}\DecValTok{95}\NormalTok{, }\DataTypeTok{df =}\NormalTok{ p) }\CommentTok{# df = number of parameters p (without the constant!), acc. to Klinke: q = 5*(5+3)/2 WTF?}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 12.59159
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# p_value = P(z > 12.59159) = 1-pchisq(20.90497, p=6) = 0.001908146 < 0.05 ,  reject H0 of homoskedasticity and conclude there is heteroskedasticity}
\DecValTok{1}\OperatorTok{-}\KeywordTok{pchisq}\NormalTok{(}\FloatTok{20.90497}\NormalTok{, p)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.001908146
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(}\StringTok{"lmtest"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Loading required package: zoo
\end{verbatim}

\begin{verbatim}
## 
## Attaching package: 'zoo'
\end{verbatim}

\begin{verbatim}
## The following objects are masked from 'package:base':
## 
##     as.Date, as.Date.numeric
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{bptest}\NormalTok{(model2)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##  studentized Breusch-Pagan test
## 
## data:  model2
## BP = 20.905, df = 6, p-value = 0.001908
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# test statistic n*R^2_aux > X^2_crit = qchisq(.95, df = 5), hence reject H0 and conclude that there's}
\CommentTok{# heteroskedasticity and constancy of error variance does not hold --> inference invalidated}

\KeywordTok{dwtest}\NormalTok{(model2)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##  Durbin-Watson test
## 
## data:  model2
## DW = 1.9149, p-value = 0.2323
## alternative hypothesis: true autocorrelation is greater than 0
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Durbin Watson test confirms that the error variance-covariance is diagonal, i.e. var(eps | X) =  \textbackslash{}Omega * I}
\CommentTok{# fail to reject H0: rho = 0 (alternative hypothesis is that there is autocorrelation in the errors)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# outlier detection / leverage}

\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfcol=}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{))}
\KeywordTok{plot}\NormalTok{(}\KeywordTok{hatvalues}\NormalTok{(model2), }\DataTypeTok{pch=}\DecValTok{19}\NormalTok{, }\DataTypeTok{main=}\StringTok{"Leverage"}\NormalTok{, }\DataTypeTok{cex=}\FloatTok{0.5}\NormalTok{)}
\NormalTok{n <-}\StringTok{ }\KeywordTok{nrow}\NormalTok{(model2}\OperatorTok{$}\NormalTok{model)}
\NormalTok{p <-}\StringTok{ }\KeywordTok{ncol}\NormalTok{(model2}\OperatorTok{$}\NormalTok{model)}\OperatorTok{-}\DecValTok{1}
\KeywordTok{abline}\NormalTok{(}\DataTypeTok{h=}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\DecValTok{3}\NormalTok{)}\OperatorTok{*}\NormalTok{(p}\OperatorTok{+}\DecValTok{1}\NormalTok{)}\OperatorTok{/}\NormalTok{n, }\DataTypeTok{col=}\KeywordTok{c}\NormalTok{(}\StringTok{"black"}\NormalTok{, }\StringTok{"darkred"}\NormalTok{, }\StringTok{"red"}\NormalTok{))}

\KeywordTok{plot}\NormalTok{(}\KeywordTok{cooks.distance}\NormalTok{(model2), }\DataTypeTok{pch=}\DecValTok{19}\NormalTok{, }\DataTypeTok{main=}\StringTok{"Cook's distances"}\NormalTok{,}
     \DataTypeTok{cex=}\FloatTok{0.5}\NormalTok{)}
\NormalTok{n <-}\StringTok{ }\KeywordTok{nrow}\NormalTok{(model2}\OperatorTok{$}\NormalTok{model)}
\NormalTok{p <-}\StringTok{ }\KeywordTok{ncol}\NormalTok{(model2}\OperatorTok{$}\NormalTok{model)}\OperatorTok{-}\DecValTok{1}
\KeywordTok{abline}\NormalTok{(}\DataTypeTok{h=}\DecValTok{4}\OperatorTok{/}\NormalTok{n, }\DataTypeTok{col=}\StringTok{"red"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-45-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{outlier_index_leverage <-}\StringTok{ }\KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{rownames}\NormalTok{(x[}\KeywordTok{hatvalues}\NormalTok{(model2) }\OperatorTok{>}\StringTok{ }\DecValTok{3}\OperatorTok{*}\NormalTok{(p}\OperatorTok{+}\DecValTok{1}\NormalTok{)}\OperatorTok{/}\NormalTok{n, ]))}
\NormalTok{outlier_index_final <-}\StringTok{ }\NormalTok{outlier_index_leverage}
\KeywordTok{length}\NormalTok{(outlier_index_leverage)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 9
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# There are 10 outliers that might be influential on the regression}
\NormalTok{x[outlier_index_leverage, }\KeywordTok{c}\NormalTok{(}\StringTok{"Track_Title"}\NormalTok{,}\StringTok{"Track_Artist"}\NormalTok{, }\StringTok{"Artist_Popularity"}\NormalTok{, }\StringTok{"Artist_Follower"}\NormalTok{, }\StringTok{"viewsCount"}\NormalTok{, }\StringTok{"pc_1"}\NormalTok{,}
                            \StringTok{"pc_2"}\NormalTok{)]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##                                                                        Track_Title
## 1   The Well-Tempered Clavier: Book 1, BWV 846-869: 1. Prelude in C Major, BWV 846
## 4                  Clarinet Concerto in A K622 (1990 Digital Remaster): II. Adagio
## 5                           Symphony No. 5 in C Minor, Op. 67: 1. Allegro con brio
## 22                                          Take Me Back to London (feat. Stormzy)
## 23                                                                    Dance Monkey
## 29                                                  Girls Like You (feat. Cardi B)
## 32                                                                      Intentions
## 40                                        It's the Most Wonderful Time of the Year
## 101                                                                    In Too Deep
##                Track_Artist Artist_Popularity Artist_Follower viewsCount
## 1     Johann Sebastian Bach                80        2.492413       8580
## 4   Wolfgang Amadeus Mozart                79        3.321232        509
## 5      Ludwig van Beethoven                77        3.104946       3845
## 22               Ed Sheeran                96       60.136077   60116012
## 23              Tones and I                91        0.748052  748367421
## 29                 Maroon 5                92       22.742618 2598870760
## 32            Justin Bieber                99       33.340962     281241
## 40            Andy Williams                66        0.259580   34771011
## 101                  Eminem                98       33.281605    1865363
##           pc_1       pc_2
## 1   -3.3073383 -0.1982107
## 4   -4.1998641  0.1962436
## 5   -2.7872996 -0.2343815
## 22   2.2469418  0.7616642
## 23   0.7007740  1.1930701
## 29   0.7251177  0.4301579
## 32   1.6587543  0.6042377
## 40  -0.1809257  0.6228892
## 101  1.7900961  1.2759421
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Rule of thumb Cook's distance}
\CommentTok{# movement of regression coefficients all together if ith observation is excluded}
\NormalTok{outlier_index_cooksd <-}\StringTok{ }\KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{rownames}\NormalTok{(x[}\KeywordTok{cooks.distance}\NormalTok{(model2) }\OperatorTok{>}\StringTok{ }\DecValTok{3}\OperatorTok{*}\NormalTok{(p}\OperatorTok{+}\DecValTok{1}\NormalTok{)}\OperatorTok{/}\NormalTok{n, ]))}
\KeywordTok{length}\NormalTok{(outlier_index_cooksd)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 2
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x[outlier_index_cooksd, }\KeywordTok{c}\NormalTok{(}\StringTok{"Track_Title"}\NormalTok{,}\StringTok{"Track_Artist"}\NormalTok{, }\StringTok{"Artist_Popularity"}\NormalTok{, }\StringTok{"Artist_Follower"}\NormalTok{, }\StringTok{"viewsCount"}\NormalTok{, }\StringTok{"pc_1"}\NormalTok{,}
                            \StringTok{"pc_2"}\NormalTok{)]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##                               Track_Title Track_Artist Artist_Popularity
## 22 Take Me Back to London (feat. Stormzy)   Ed Sheeran                96
## 29         Girls Like You (feat. Cardi B)     Maroon 5                92
##    Artist_Follower viewsCount      pc_1      pc_2
## 22        60.13608   60116012 2.2469418 0.7616642
## 29        22.74262 2598870760 0.7251177 0.4301579
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# differences}

\CommentTok{# SDBETA}

\NormalTok{SDBETA <-}\StringTok{ }\KeywordTok{dfbetas}\NormalTok{(model2)}
\NormalTok{n <-}\StringTok{ }\KeywordTok{nrow}\NormalTok{(model2}\OperatorTok{$}\NormalTok{model)}
\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfcol=}\KeywordTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{))}
\KeywordTok{plot}\NormalTok{(SDBETA[, }\StringTok{'fa_2'}\NormalTok{], }\DataTypeTok{main=}\StringTok{"fa_2"}\NormalTok{, }\DataTypeTok{pch=}\DecValTok{19}\NormalTok{)}
\KeywordTok{abline}\NormalTok{(}\DataTypeTok{h=}\KeywordTok{c}\NormalTok{(}\OperatorTok{-}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{)}\OperatorTok{/}\KeywordTok{sqrt}\NormalTok{(n), }\DataTypeTok{col=}\StringTok{"red"}\NormalTok{)}
\KeywordTok{plot}\NormalTok{(SDBETA[, }\StringTok{'fa_3'}\NormalTok{], }\DataTypeTok{main=}\StringTok{"fa_3"}\NormalTok{, }\DataTypeTok{pch=}\DecValTok{19}\NormalTok{)}
\KeywordTok{abline}\NormalTok{(}\DataTypeTok{h=}\KeywordTok{c}\NormalTok{(}\OperatorTok{-}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{)}\OperatorTok{/}\KeywordTok{sqrt}\NormalTok{(n), }\DataTypeTok{col=}\StringTok{"red"}\NormalTok{)}
\KeywordTok{plot}\NormalTok{(SDBETA[, }\StringTok{'pc_1'}\NormalTok{], }\DataTypeTok{main=}\StringTok{"pc_1"}\NormalTok{, }\DataTypeTok{pch=}\DecValTok{19}\NormalTok{)}
\KeywordTok{abline}\NormalTok{(}\DataTypeTok{h=}\KeywordTok{c}\NormalTok{(}\OperatorTok{-}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{)}\OperatorTok{/}\KeywordTok{sqrt}\NormalTok{(n), }\DataTypeTok{col=}\StringTok{"red"}\NormalTok{)}
\KeywordTok{plot}\NormalTok{(SDBETA[, }\StringTok{'pc_2'}\NormalTok{], }\DataTypeTok{main=}\StringTok{"pc_2"}\NormalTok{, }\DataTypeTok{pch=}\DecValTok{19}\NormalTok{)}
\KeywordTok{abline}\NormalTok{(}\DataTypeTok{h=}\KeywordTok{c}\NormalTok{(}\OperatorTok{-}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{)}\OperatorTok{/}\KeywordTok{sqrt}\NormalTok{(n), }\DataTypeTok{col=}\StringTok{"red"}\NormalTok{)}
\KeywordTok{plot}\NormalTok{(SDBETA[, }\StringTok{'Artist_Follower'}\NormalTok{], }\DataTypeTok{main=}\StringTok{"Artist_Follower"}\NormalTok{, }\DataTypeTok{pch=}\DecValTok{19}\NormalTok{)}
\KeywordTok{abline}\NormalTok{(}\DataTypeTok{h=}\KeywordTok{c}\NormalTok{(}\OperatorTok{-}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{)}\OperatorTok{/}\KeywordTok{sqrt}\NormalTok{(n), }\DataTypeTok{col=}\StringTok{"red"}\NormalTok{)}
\KeywordTok{plot}\NormalTok{(SDBETA[, }\StringTok{'days_release_orig'}\NormalTok{], }\DataTypeTok{main=}\StringTok{"days_release_orig"}\NormalTok{, }\DataTypeTok{pch=}\DecValTok{19}\NormalTok{)}
\KeywordTok{abline}\NormalTok{(}\DataTypeTok{h=}\KeywordTok{c}\NormalTok{(}\OperatorTok{-}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{)}\OperatorTok{/}\KeywordTok{sqrt}\NormalTok{(n), }\DataTypeTok{col=}\StringTok{"red"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-46-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# SDFITS}
\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfcol=}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{))}
\NormalTok{SDFITS <-}\StringTok{ }\KeywordTok{dffits}\NormalTok{(model2)}
\KeywordTok{plot}\NormalTok{(SDFITS, }\DataTypeTok{pch=}\DecValTok{19}\NormalTok{)}
\KeywordTok{abline}\NormalTok{(}\DataTypeTok{h=}\KeywordTok{c}\NormalTok{(}\OperatorTok{-}\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{), }\DataTypeTok{col=}\StringTok{"red"}\NormalTok{)}
\NormalTok{n <-}\StringTok{ }\KeywordTok{nrow}\NormalTok{(model2}\OperatorTok{$}\NormalTok{model)}
\NormalTok{p <-}\StringTok{ }\KeywordTok{ncol}\NormalTok{(model2}\OperatorTok{$}\NormalTok{model)}\OperatorTok{-}\DecValTok{1}
\KeywordTok{abline}\NormalTok{(}\DataTypeTok{h=}\KeywordTok{c}\NormalTok{(}\OperatorTok{-}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{)}\OperatorTok{*}\KeywordTok{sqrt}\NormalTok{(p}\OperatorTok{/}\NormalTok{n), }\DataTypeTok{col=}\StringTok{"darkred"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-46-2.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# As this is a small data set, it is sufficient to analyze |\textbackslash{}delta*y_i| > 1, in this case two observations are identified}
\CommentTok{# of exceeding this limit. They are}

\NormalTok{outlier_index_sdfits <-}\StringTok{ }\KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{names}\NormalTok{(}\KeywordTok{which}\NormalTok{(}\KeywordTok{abs}\NormalTok{(SDFITS) }\OperatorTok{>}\StringTok{ }\DecValTok{1}\NormalTok{))) }

\NormalTok{x[outlier_index_sdfits, }\KeywordTok{c}\NormalTok{(}\StringTok{"Track_Title"}\NormalTok{,}\StringTok{"Track_Artist"}\NormalTok{, }\StringTok{"Artist_Popularity"}\NormalTok{, }\StringTok{"Artist_Follower"}\NormalTok{, }\StringTok{"viewsCount"}\NormalTok{, }\StringTok{"pc_1"}\NormalTok{,}
                          \StringTok{"pc_2"}\NormalTok{)]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##                               Track_Title Track_Artist Artist_Popularity
## 22 Take Me Back to London (feat. Stormzy)   Ed Sheeran                96
## 29         Girls Like You (feat. Cardi B)     Maroon 5                92
##    Artist_Follower viewsCount      pc_1      pc_2
## 22        60.13608   60116012 2.2469418 0.7616642
## 29        22.74262 2598870760 0.7251177 0.4301579
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Add quadratic terms for fa_2, Artist_Follower and pc_2 first before excluding outliers!}

\NormalTok{x}\OperatorTok{$}\NormalTok{fa_2sq <-}\StringTok{ }\NormalTok{x}\OperatorTok{$}\NormalTok{fa_}\DecValTok{2}\OperatorTok{^}\DecValTok{2}
\NormalTok{x}\OperatorTok{$}\NormalTok{pc_2sq <-}\StringTok{ }\NormalTok{x}\OperatorTok{$}\NormalTok{pc_}\DecValTok{2}\OperatorTok{^}\DecValTok{2}
\NormalTok{x}\OperatorTok{$}\NormalTok{Artist_Followersq <-}\StringTok{ }\NormalTok{x}\OperatorTok{$}\NormalTok{Artist_Follower}\OperatorTok{^}\DecValTok{2}
\CommentTok{# model2: lm(Artist_Popularity ~ fa_2 + fa_3 + pc_1 + pc_2 + Artist_Follower + days_release_orig, data = x)}


\NormalTok{model3 <-}\StringTok{ }\KeywordTok{lm}\NormalTok{(Artist_Popularity }\OperatorTok{~}\StringTok{ }\NormalTok{fa_}\DecValTok{2} \OperatorTok{+}\StringTok{ }\NormalTok{fa_2sq }\OperatorTok{+}\StringTok{ }\NormalTok{fa_}\DecValTok{3} \OperatorTok{+}\StringTok{ }\NormalTok{pc_}\DecValTok{1} \OperatorTok{+}\StringTok{ }\NormalTok{pc_}\DecValTok{2} \OperatorTok{+}\StringTok{ }\NormalTok{pc_2sq }\OperatorTok{+}\StringTok{ }\NormalTok{Artist_Follower }\OperatorTok{+}\StringTok{ }\NormalTok{Artist_Followersq }\OperatorTok{+}\StringTok{ }\NormalTok{days_release_orig, }\DataTypeTok{data =}\NormalTok{ x)}
\KeywordTok{summary}\NormalTok{(model3)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## lm(formula = Artist_Popularity ~ fa_2 + fa_2sq + fa_3 + pc_1 + 
##     pc_2 + pc_2sq + Artist_Follower + Artist_Followersq + days_release_orig, 
##     data = x)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -28.3742  -5.6832   0.3771   4.9769  19.6356 
## 
## Coefficients:
##                     Estimate Std. Error t value Pr(>|t|)    
## (Intercept)       67.5611323  0.9877844  68.397  < 2e-16 ***
## fa_2               6.0858820  1.7276487   3.523 0.000538 ***
## fa_2sq            -0.5504304  0.1615332  -3.408 0.000803 ***
## fa_3               4.4969138  0.9010981   4.990 1.38e-06 ***
## pc_1               1.8133635  0.4088899   4.435 1.57e-05 ***
## pc_2               5.9511646  0.5374732  11.072  < 2e-16 ***
## pc_2sq            -2.1818759  0.3886134  -5.615 7.08e-08 ***
## Artist_Follower    1.6608731  0.2291803   7.247 1.10e-11 ***
## Artist_Followersq -0.0233799  0.0049095  -4.762 3.84e-06 ***
## days_release_orig -0.0004777  0.0001710  -2.794 0.005745 ** 
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 8.206 on 186 degrees of freedom
## Multiple R-squared:  0.7446, Adjusted R-squared:  0.7322 
## F-statistic: 60.25 on 9 and 186 DF,  p-value: < 2.2e-16
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{vif}\NormalTok{(model3)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##              fa_2            fa_2sq              fa_3              pc_1 
##          8.309381          7.584394          1.710158          2.084608 
##              pc_2            pc_2sq   Artist_Follower Artist_Followersq 
##          1.223166          1.286026          6.603869          5.824194 
## days_release_orig 
##          1.519144
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ks.test}\NormalTok{(model3}\OperatorTok{$}\NormalTok{residuals, }\StringTok{"pnorm"}\NormalTok{, }\DataTypeTok{mean =} \KeywordTok{mean}\NormalTok{(model3}\OperatorTok{$}\NormalTok{residuals), }\DataTypeTok{sd=}\KeywordTok{sd}\NormalTok{(model3}\OperatorTok{$}\NormalTok{residuals))}\OperatorTok{$}\NormalTok{statistic}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##         D 
## 0.0367905
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FloatTok{1.3581} \OperatorTok{/}\StringTok{ }\KeywordTok{sqrt}\NormalTok{(}\KeywordTok{length}\NormalTok{(model3}\OperatorTok{$}\NormalTok{residuals))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.09700714
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfcol=}\KeywordTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{))}
\KeywordTok{plot}\NormalTok{(model2)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-48-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfcol=}\KeywordTok{c}\NormalTok{(}\DecValTok{3}\NormalTok{,}\DecValTok{3}\NormalTok{))}
\NormalTok{nx <-}\StringTok{ }\KeywordTok{names}\NormalTok{(model3}\OperatorTok{$}\NormalTok{model)}
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{2}\OperatorTok{:}\KeywordTok{length}\NormalTok{(model3}\OperatorTok{$}\NormalTok{model)) \{}
  \KeywordTok{plot}\NormalTok{(model3}\OperatorTok{$}\NormalTok{model[,i], }\KeywordTok{residuals}\NormalTok{(model3), }\DataTypeTok{xlab=}\NormalTok{nx[i])}
  \KeywordTok{lines}\NormalTok{(}\KeywordTok{lowess}\NormalTok{(model3}\OperatorTok{$}\NormalTok{model[,i], }\KeywordTok{residuals}\NormalTok{(model3)), }\DataTypeTok{col =} \StringTok{"red"}\NormalTok{)}
  \KeywordTok{abline}\NormalTok{(}\DataTypeTok{h =} \DecValTok{0}\NormalTok{, }\DataTypeTok{col =} \StringTok{"black"}\NormalTok{, }\DataTypeTok{lty =} \DecValTok{2}\NormalTok{)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-48-2.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfcol=}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{))}
\KeywordTok{plot}\NormalTok{(model3}\OperatorTok{$}\NormalTok{fitted.values, }\KeywordTok{residuals}\NormalTok{(model3))}
\KeywordTok{lines}\NormalTok{(}\KeywordTok{lowess}\NormalTok{(model3}\OperatorTok{$}\NormalTok{fitted.values, }\KeywordTok{residuals}\NormalTok{(model3)), }\DataTypeTok{col =} \StringTok{"red"}\NormalTok{)}
\KeywordTok{abline}\NormalTok{(}\DataTypeTok{h =} \DecValTok{0}\NormalTok{, }\DataTypeTok{col =} \StringTok{"black"}\NormalTok{, }\DataTypeTok{lty =} \DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-48-3.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# residuals vs. predictors and fitted values suggests accounting for nonlinearity of the regression function has improved}

\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfcol=}\KeywordTok{c}\NormalTok{(}\DecValTok{3}\NormalTok{,}\DecValTok{3}\NormalTok{))}
\NormalTok{nx <-}\StringTok{ }\KeywordTok{names}\NormalTok{(model3}\OperatorTok{$}\NormalTok{model)}
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{2}\OperatorTok{:}\KeywordTok{length}\NormalTok{(model3}\OperatorTok{$}\NormalTok{model)) \{}
  \KeywordTok{plot}\NormalTok{(model3}\OperatorTok{$}\NormalTok{model[,i], }\KeywordTok{rstandard}\NormalTok{(model3), }\DataTypeTok{xlab=}\NormalTok{nx[i])}
  \KeywordTok{lines}\NormalTok{(}\KeywordTok{lowess}\NormalTok{(model3}\OperatorTok{$}\NormalTok{model[,i], }\KeywordTok{rstandard}\NormalTok{(model3)), }\DataTypeTok{col =} \StringTok{"red"}\NormalTok{)}
  \CommentTok{# wenn Linie von 0 abweicht: Residuen sind biased, sprich deren Mittelwert nicht 0}
  \KeywordTok{abline}\NormalTok{(}\DataTypeTok{h =} \DecValTok{0}\NormalTok{, }\DataTypeTok{col =} \StringTok{"black"}\NormalTok{, }\DataTypeTok{lty =} \DecValTok{2}\NormalTok{)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-48-4.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# standardized residuals vs. fitted values}

\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfcol=}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{))}
\KeywordTok{plot}\NormalTok{(model3}\OperatorTok{$}\NormalTok{fitted.values, }\KeywordTok{rstandard}\NormalTok{(model3), }\DataTypeTok{main =} \StringTok{'Standardized residuals vs. fitted values'}\NormalTok{)}
\KeywordTok{lines}\NormalTok{(}\KeywordTok{lowess}\NormalTok{(model3}\OperatorTok{$}\NormalTok{fitted.values, }\KeywordTok{rstandard}\NormalTok{(model3)), }\DataTypeTok{col =} \StringTok{"red"}\NormalTok{)}
\KeywordTok{abline}\NormalTok{(}\DataTypeTok{h =} \DecValTok{0}\NormalTok{, }\DataTypeTok{col =} \StringTok{"black"}\NormalTok{, }\DataTypeTok{lty =} \DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-48-5.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Breusch-Pagan Test + Durbin-Watson Test / spherical errors (i.e. iid)}
\CommentTok{# model2 uses unscaled data}
\NormalTok{auxiliary_reg <-}\StringTok{ }\KeywordTok{lm}\NormalTok{(model3}\OperatorTok{$}\NormalTok{residuals}\OperatorTok{^}\DecValTok{2} \OperatorTok{~}\StringTok{ }\NormalTok{fa_}\DecValTok{2} \OperatorTok{+}\StringTok{ }\NormalTok{fa_2sq }\OperatorTok{+}\StringTok{ }\NormalTok{fa_}\DecValTok{3} \OperatorTok{+}\StringTok{ }\NormalTok{pc_}\DecValTok{1} \OperatorTok{+}\StringTok{ }\NormalTok{pc_}\DecValTok{2} \OperatorTok{+}\StringTok{ }\NormalTok{pc_2sq }\OperatorTok{+}\StringTok{ }\NormalTok{Artist_Follower }\OperatorTok{+}\StringTok{ }\NormalTok{Artist_Followersq }\OperatorTok{+}\StringTok{ }\NormalTok{days_release_orig, }\DataTypeTok{data =}\NormalTok{ x)}
\KeywordTok{summary}\NormalTok{(auxiliary_reg)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## lm(formula = model3$residuals^2 ~ fa_2 + fa_2sq + fa_3 + pc_1 + 
##     pc_2 + pc_2sq + Artist_Follower + Artist_Followersq + days_release_orig, 
##     data = x)
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
## -98.32 -52.32 -23.00  18.34 719.43 
## 
## Coefficients:
##                     Estimate Std. Error t value Pr(>|t|)    
## (Intercept)        78.727326  11.223118   7.015 4.15e-11 ***
## fa_2                2.535328  19.629390   0.129   0.8974    
## fa_2sq             -0.474656   1.835326  -0.259   0.7962    
## fa_3              -24.009503  10.238196  -2.345   0.0201 *  
## pc_1               -6.105726   4.645771  -1.314   0.1904    
## pc_2               -9.200191   6.106722  -1.507   0.1336    
## pc_2sq             -4.239332   4.415390  -0.960   0.3382    
## Artist_Follower    -1.901275   2.603926  -0.730   0.4662    
## Artist_Followersq   0.021242   0.055781   0.381   0.7038    
## days_release_orig  -0.002471   0.001942  -1.272   0.2050    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 93.24 on 186 degrees of freedom
## Multiple R-squared:  0.06758,    Adjusted R-squared:  0.02246 
## F-statistic: 1.498 on 9 and 186 DF,  p-value: 0.1513
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# R^2: 0.06758}
\CommentTok{# N = 196, N = nrow(x) }
\CommentTok{# test stat: }
\KeywordTok{summary}\NormalTok{(auxiliary_reg)}\OperatorTok{$}\NormalTok{r.square }\OperatorTok{*}\StringTok{ }\KeywordTok{nrow}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 13.24499
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# test stat: 13.24499}
\NormalTok{p <-}\StringTok{ }\KeywordTok{ncol}\NormalTok{(model3}\OperatorTok{$}\NormalTok{model)}\OperatorTok{-}\DecValTok{1}
\KeywordTok{qchisq}\NormalTok{(.}\DecValTok{95}\NormalTok{, }\DataTypeTok{df =}\NormalTok{ p) }\CommentTok{# df = number of parameters p (without the constant!), acc. to Klinke: q = 5*(5+3)/2 WTF?}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 16.91898
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# p_value = P(z > 16.91898) = 1-pchisq(13.24499, p=9) = 0.1518304 > 0.05 ,  fail to reject H0 of homoskedasticity, i.e. constant variance of error term}
\DecValTok{1}\OperatorTok{-}\KeywordTok{pchisq}\NormalTok{(}\FloatTok{13.24499}\NormalTok{, p)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.1518304
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(}\StringTok{"lmtest"}\NormalTok{)}
\KeywordTok{bptest}\NormalTok{(model3)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##  studentized Breusch-Pagan test
## 
## data:  model3
## BP = 13.245, df = 9, p-value = 0.1518
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# test statistic n*R^2_aux > X^2_crit = qchisq(.95, df = 5), hence fail to reject H0 and conclude that there's}
\CommentTok{# no heteroskedasticity --> valid inference}

\KeywordTok{dwtest}\NormalTok{(model3)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##  Durbin-Watson test
## 
## data:  model3
## DW = 2.0528, p-value = 0.5856
## alternative hypothesis: true autocorrelation is greater than 0
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Durbin Watson test confirms that the error variance-covariance is diagonal, i.e. var(eps | X) =  \textbackslash{}Omega * I}
\CommentTok{# fail to reject H0: rho = 0 (alternative hypothesis is that there is autocorrelation in the errors)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# outlier detection / leverage}

\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfcol=}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{))}
\KeywordTok{plot}\NormalTok{(}\KeywordTok{hatvalues}\NormalTok{(model3), }\DataTypeTok{pch=}\DecValTok{19}\NormalTok{, }\DataTypeTok{cex=}\FloatTok{0.5}\NormalTok{)}
\NormalTok{n <-}\StringTok{ }\KeywordTok{nrow}\NormalTok{(model3}\OperatorTok{$}\NormalTok{model)}
\NormalTok{p <-}\StringTok{ }\KeywordTok{ncol}\NormalTok{(model3}\OperatorTok{$}\NormalTok{model)}\OperatorTok{-}\DecValTok{1}
\KeywordTok{abline}\NormalTok{(}\DataTypeTok{h=}\NormalTok{(}\DecValTok{1}\OperatorTok{:}\DecValTok{3}\NormalTok{)}\OperatorTok{*}\NormalTok{(p}\OperatorTok{+}\DecValTok{1}\NormalTok{)}\OperatorTok{/}\NormalTok{n, }\DataTypeTok{col=}\KeywordTok{c}\NormalTok{(}\StringTok{"black"}\NormalTok{, }\StringTok{"darkred"}\NormalTok{, }\StringTok{"red"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-49-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{plot}\NormalTok{(}\KeywordTok{cooks.distance}\NormalTok{(model3), }\DataTypeTok{pch=}\DecValTok{19}\NormalTok{,}
     \DataTypeTok{cex=}\FloatTok{0.5}\NormalTok{)}
\NormalTok{n <-}\StringTok{ }\KeywordTok{nrow}\NormalTok{(model3}\OperatorTok{$}\NormalTok{model)}
\NormalTok{p <-}\StringTok{ }\KeywordTok{ncol}\NormalTok{(model3}\OperatorTok{$}\NormalTok{model)}\OperatorTok{-}\DecValTok{1}
\KeywordTok{abline}\NormalTok{(}\DataTypeTok{h=}\DecValTok{4}\OperatorTok{/}\NormalTok{n, }\DataTypeTok{col=}\StringTok{"red"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-49-2.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{outlier_index_leverage <-}\StringTok{ }\KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{rownames}\NormalTok{(x[}\KeywordTok{hatvalues}\NormalTok{(model3) }\OperatorTok{>}\StringTok{ }\DecValTok{3}\OperatorTok{*}\NormalTok{(p}\OperatorTok{+}\DecValTok{1}\NormalTok{)}\OperatorTok{/}\NormalTok{n, ]))}
\NormalTok{outlier_index_final <-}\StringTok{ }\NormalTok{outlier_index_leverage}
\KeywordTok{length}\NormalTok{(outlier_index_leverage)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 10
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# There are 10 outliers that might be influential on the regression}
\NormalTok{x[outlier_index_leverage, }\KeywordTok{c}\NormalTok{(}\StringTok{"Track_Title"}\NormalTok{,}\StringTok{"Track_Artist"}\NormalTok{, }\StringTok{"Genre"}\NormalTok{, }\StringTok{"Artist_Popularity"}\NormalTok{, }\StringTok{"Artist_Follower"}\NormalTok{, }\StringTok{"viewsCount"}\NormalTok{)]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##                                                                        Track_Title
## 1   The Well-Tempered Clavier: Book 1, BWV 846-869: 1. Prelude in C Major, BWV 846
## 4                  Clarinet Concerto in A K622 (1990 Digital Remaster): II. Adagio
## 5                           Symphony No. 5 in C Minor, Op. 67: 1. Allegro con brio
## 21                                                                   Gibt es Dich?
## 22                                          Take Me Back to London (feat. Stormzy)
## 23                                                                    Dance Monkey
## 29                                                  Girls Like You (feat. Cardi B)
## 32                                                                      Intentions
## 61                                                   all the good girls go to hell
## 101                                                                    In Too Deep
##                Track_Artist   Genre Artist_Popularity Artist_Follower
## 1     Johann Sebastian Bach Classic                80        2.492413
## 4   Wolfgang Amadeus Mozart Classic                79        3.321232
## 5      Ludwig van Beethoven Classic                77        3.104946
## 21             Shirin David     Pop                66        0.370642
## 22               Ed Sheeran     Pop                96       60.136077
## 23              Tones and I     Pop                91        0.748052
## 29                 Maroon 5     Pop                92       22.742618
## 32            Justin Bieber     Pop                99       33.340962
## 61            Billie Eilish     Pop                99       21.832072
## 101                  Eminem Hip Hop                98       33.281605
##     viewsCount
## 1         8580
## 4          509
## 5         3845
## 21      201567
## 22    60116012
## 23   748367421
## 29  2598870760
## 32      281241
## 61   117405850
## 101    1865363
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Rule of thumb Cook's distance}
\CommentTok{# movement of regression coefficients all together if ith observation is excluded}
\NormalTok{outlier_index_cooksd <-}\StringTok{ }\KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{rownames}\NormalTok{(x[}\KeywordTok{cooks.distance}\NormalTok{(model3) }\OperatorTok{>}\StringTok{ }\DecValTok{3}\OperatorTok{*}\NormalTok{(p}\OperatorTok{+}\DecValTok{1}\NormalTok{)}\OperatorTok{/}\NormalTok{n, ]))}
\KeywordTok{length}\NormalTok{(outlier_index_cooksd)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 2
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x[outlier_index_cooksd, }\KeywordTok{c}\NormalTok{(}\StringTok{"Track_Title"}\NormalTok{,}\StringTok{"Track_Artist"}\NormalTok{, }\StringTok{"Artist_Popularity"}\NormalTok{, }\StringTok{"Artist_Follower"}\NormalTok{, }\StringTok{"viewsCount"}\NormalTok{, }\StringTok{"pc_1"}\NormalTok{,}
                            \StringTok{"pc_2"}\NormalTok{)]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##                               Track_Title Track_Artist Artist_Popularity
## 22 Take Me Back to London (feat. Stormzy)   Ed Sheeran                96
## 29         Girls Like You (feat. Cardi B)     Maroon 5                92
##    Artist_Follower viewsCount      pc_1      pc_2
## 22        60.13608   60116012 2.2469418 0.7616642
## 29        22.74262 2598870760 0.7251177 0.4301579
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# same outliers detected as in model2 even after modification of the model}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# differences}

\CommentTok{# SDBETA}

\NormalTok{SDBETA <-}\StringTok{ }\KeywordTok{dfbetas}\NormalTok{(model3)}
\NormalTok{n <-}\StringTok{ }\KeywordTok{nrow}\NormalTok{(model3}\OperatorTok{$}\NormalTok{model)}
\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfcol=}\KeywordTok{c}\NormalTok{(}\DecValTok{3}\NormalTok{,}\DecValTok{3}\NormalTok{))}
\KeywordTok{plot}\NormalTok{(SDBETA[, }\StringTok{'fa_2'}\NormalTok{], }\DataTypeTok{main=}\StringTok{"fa_2"}\NormalTok{, }\DataTypeTok{pch=}\DecValTok{19}\NormalTok{, }\DataTypeTok{ylab =} \StringTok{"fa_2"}\NormalTok{)}
\KeywordTok{abline}\NormalTok{(}\DataTypeTok{h=}\KeywordTok{c}\NormalTok{(}\OperatorTok{-}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{)}\OperatorTok{/}\KeywordTok{sqrt}\NormalTok{(n), }\DataTypeTok{col=}\StringTok{"red"}\NormalTok{)}
\KeywordTok{plot}\NormalTok{(SDBETA[, }\StringTok{'fa_2sq'}\NormalTok{], }\DataTypeTok{main=}\StringTok{"fa_2sq"}\NormalTok{, }\DataTypeTok{pch=}\DecValTok{19}\NormalTok{, }\DataTypeTok{ylab =} \StringTok{"fa_2sq"}\NormalTok{)}
\KeywordTok{abline}\NormalTok{(}\DataTypeTok{h=}\KeywordTok{c}\NormalTok{(}\OperatorTok{-}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{)}\OperatorTok{/}\KeywordTok{sqrt}\NormalTok{(n), }\DataTypeTok{col=}\StringTok{"red"}\NormalTok{)}
\KeywordTok{plot}\NormalTok{(SDBETA[, }\StringTok{'fa_3'}\NormalTok{], }\DataTypeTok{main=}\StringTok{"fa_3"}\NormalTok{, }\DataTypeTok{pch=}\DecValTok{19}\NormalTok{, }\DataTypeTok{ylab =} \StringTok{"fa_3"}\NormalTok{)}
\KeywordTok{abline}\NormalTok{(}\DataTypeTok{h=}\KeywordTok{c}\NormalTok{(}\OperatorTok{-}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{)}\OperatorTok{/}\KeywordTok{sqrt}\NormalTok{(n), }\DataTypeTok{col=}\StringTok{"red"}\NormalTok{)}
\KeywordTok{plot}\NormalTok{(SDBETA[, }\StringTok{'pc_1'}\NormalTok{], }\DataTypeTok{main=}\StringTok{"pc_1"}\NormalTok{, }\DataTypeTok{pch=}\DecValTok{19}\NormalTok{, }\DataTypeTok{ylab =} \StringTok{"pc_1"}\NormalTok{)}
\KeywordTok{abline}\NormalTok{(}\DataTypeTok{h=}\KeywordTok{c}\NormalTok{(}\OperatorTok{-}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{)}\OperatorTok{/}\KeywordTok{sqrt}\NormalTok{(n), }\DataTypeTok{col=}\StringTok{"red"}\NormalTok{)}
\KeywordTok{plot}\NormalTok{(SDBETA[, }\StringTok{'pc_2'}\NormalTok{], }\DataTypeTok{main=}\StringTok{"pc_2"}\NormalTok{, }\DataTypeTok{pch=}\DecValTok{19}\NormalTok{, }\DataTypeTok{ylab =} \StringTok{"pc_2"}\NormalTok{)}
\KeywordTok{abline}\NormalTok{(}\DataTypeTok{h=}\KeywordTok{c}\NormalTok{(}\OperatorTok{-}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{)}\OperatorTok{/}\KeywordTok{sqrt}\NormalTok{(n), }\DataTypeTok{col=}\StringTok{"red"}\NormalTok{)}
\KeywordTok{plot}\NormalTok{(SDBETA[, }\StringTok{'pc_2sq'}\NormalTok{], }\DataTypeTok{main=}\StringTok{"pc_2sq"}\NormalTok{, }\DataTypeTok{pch=}\DecValTok{19}\NormalTok{, }\DataTypeTok{ylab =} \StringTok{"pc_2sq"}\NormalTok{)}
\KeywordTok{abline}\NormalTok{(}\DataTypeTok{h=}\KeywordTok{c}\NormalTok{(}\OperatorTok{-}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{)}\OperatorTok{/}\KeywordTok{sqrt}\NormalTok{(n), }\DataTypeTok{col=}\StringTok{"red"}\NormalTok{)}
\KeywordTok{plot}\NormalTok{(SDBETA[, }\StringTok{'Artist_Follower'}\NormalTok{], }\DataTypeTok{main=}\StringTok{"Artist_Follower"}\NormalTok{, }\DataTypeTok{pch=}\DecValTok{19}\NormalTok{, }\DataTypeTok{ylab =} \StringTok{"Artist_Follower"}\NormalTok{)}
\KeywordTok{abline}\NormalTok{(}\DataTypeTok{h=}\KeywordTok{c}\NormalTok{(}\OperatorTok{-}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{)}\OperatorTok{/}\KeywordTok{sqrt}\NormalTok{(n), }\DataTypeTok{col=}\StringTok{"red"}\NormalTok{)}
\KeywordTok{plot}\NormalTok{(SDBETA[, }\StringTok{'Artist_Followersq'}\NormalTok{], }\DataTypeTok{main=}\StringTok{"Artist_Followersq"}\NormalTok{, }\DataTypeTok{pch=}\DecValTok{19}\NormalTok{, }\DataTypeTok{ylab =} \StringTok{'Artist_Followersq'}\NormalTok{)}
\KeywordTok{abline}\NormalTok{(}\DataTypeTok{h=}\KeywordTok{c}\NormalTok{(}\OperatorTok{-}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{)}\OperatorTok{/}\KeywordTok{sqrt}\NormalTok{(n), }\DataTypeTok{col=}\StringTok{"red"}\NormalTok{)}
\KeywordTok{plot}\NormalTok{(SDBETA[, }\StringTok{'days_release_orig'}\NormalTok{], }\DataTypeTok{main=}\StringTok{"days_release_orig"}\NormalTok{, }\DataTypeTok{pch=}\DecValTok{19}\NormalTok{, }\DataTypeTok{ylab =} \StringTok{'days_release'}\NormalTok{)}
\KeywordTok{abline}\NormalTok{(}\DataTypeTok{h=}\KeywordTok{c}\NormalTok{(}\OperatorTok{-}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{)}\OperatorTok{/}\KeywordTok{sqrt}\NormalTok{(n), }\DataTypeTok{col=}\StringTok{"red"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-50-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# SDFITS}
\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfcol=}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{))}
\NormalTok{SDFITS <-}\StringTok{ }\KeywordTok{dffits}\NormalTok{(model3)}
\KeywordTok{plot}\NormalTok{(SDFITS, }\DataTypeTok{pch=}\DecValTok{19}\NormalTok{)}
\KeywordTok{abline}\NormalTok{(}\DataTypeTok{h=}\KeywordTok{c}\NormalTok{(}\OperatorTok{-}\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{), }\DataTypeTok{col=}\StringTok{"red"}\NormalTok{)}
\NormalTok{n <-}\StringTok{ }\KeywordTok{nrow}\NormalTok{(model3}\OperatorTok{$}\NormalTok{model)}
\NormalTok{p <-}\StringTok{ }\KeywordTok{ncol}\NormalTok{(model3}\OperatorTok{$}\NormalTok{model)}\OperatorTok{-}\DecValTok{1}
\KeywordTok{abline}\NormalTok{(}\DataTypeTok{h=}\KeywordTok{c}\NormalTok{(}\OperatorTok{-}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{)}\OperatorTok{*}\KeywordTok{sqrt}\NormalTok{(p}\OperatorTok{/}\NormalTok{n), }\DataTypeTok{col=}\StringTok{"darkred"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-50-2.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# As this is a small data set, it is sufficient to analyze |\textbackslash{}delta*y_i| > 1, in this case two observations are identified}
\CommentTok{# of exceeding this limit. They are}

\NormalTok{outlier_index_sdfits <-}\StringTok{ }\KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{names}\NormalTok{(}\KeywordTok{which}\NormalTok{(}\KeywordTok{abs}\NormalTok{(SDFITS) }\OperatorTok{>}\StringTok{ }\DecValTok{1}\NormalTok{))) }

\NormalTok{x[outlier_index_sdfits, }\KeywordTok{c}\NormalTok{(}\StringTok{"Track_Title"}\NormalTok{,}\StringTok{"Track_Artist"}\NormalTok{, }\StringTok{"Artist_Popularity"}\NormalTok{, }\StringTok{"Artist_Follower"}\NormalTok{, }\StringTok{"viewsCount"}\NormalTok{, }\StringTok{"pc_1"}\NormalTok{,}
                          \StringTok{"pc_2"}\NormalTok{)]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##                               Track_Title  Track_Artist Artist_Popularity
## 22 Take Me Back to London (feat. Stormzy)    Ed Sheeran                96
## 29         Girls Like You (feat. Cardi B)      Maroon 5                92
## 61          all the good girls go to hell Billie Eilish                99
##    Artist_Follower viewsCount      pc_1      pc_2
## 22        60.13608   60116012 2.2469418 0.7616642
## 29        22.74262 2598870760 0.7251177 0.4301579
## 61        21.83207  117405850 1.8266560 1.1413509
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Now exclude the outliers from leverage analysis}

\NormalTok{x_noout <-}\StringTok{ }\NormalTok{x[}\OperatorTok{-}\NormalTok{outlier_index_final, ]}

\NormalTok{lm_final <-}\StringTok{ }\KeywordTok{lm}\NormalTok{(Artist_Popularity }\OperatorTok{~}\StringTok{ }\NormalTok{fa_}\DecValTok{2} \OperatorTok{+}\StringTok{ }\NormalTok{fa_2sq }\OperatorTok{+}\StringTok{ }\NormalTok{fa_}\DecValTok{3} \OperatorTok{+}\StringTok{ }\NormalTok{pc_}\DecValTok{1} \OperatorTok{+}\StringTok{ }\NormalTok{pc_}\DecValTok{2} \OperatorTok{+}\StringTok{ }\NormalTok{pc_2sq }\OperatorTok{+}\StringTok{ }\NormalTok{Artist_Follower }\OperatorTok{+}\StringTok{ }\NormalTok{Artist_Followersq }\OperatorTok{+}\StringTok{ }\NormalTok{days_release_orig, }\DataTypeTok{data =}\NormalTok{ x_noout)}
\KeywordTok{summary}\NormalTok{(lm_final) }\CommentTok{#  result: R^2 decreased a little bit}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## lm(formula = Artist_Popularity ~ fa_2 + fa_2sq + fa_3 + pc_1 + 
##     pc_2 + pc_2sq + Artist_Follower + Artist_Followersq + days_release_orig, 
##     data = x_noout)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -27.4824  -5.2041  -0.3971   4.9615  19.4089 
## 
## Coefficients:
##                     Estimate Std. Error t value Pr(>|t|)    
## (Intercept)       67.5778523  1.1556264  58.477  < 2e-16 ***
## fa_2              14.0294272  3.7773779   3.714 0.000274 ***
## fa_2sq            -7.7026797  2.3813018  -3.235 0.001455 ** 
## fa_3               4.1812469  1.1144664   3.752 0.000238 ***
## pc_1               1.5664575  0.4198679   3.731 0.000257 ***
## pc_2               5.2986744  0.5665857   9.352  < 2e-16 ***
## pc_2sq            -1.9828773  0.4235979  -4.681 5.68e-06 ***
## Artist_Follower    4.0311406  0.6231803   6.469 9.45e-10 ***
## Artist_Followersq -0.1626515  0.0347541  -4.680 5.70e-06 ***
## days_release_orig -0.0004396  0.0001751  -2.510 0.012974 *  
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 7.855 on 176 degrees of freedom
## Multiple R-squared:  0.7448, Adjusted R-squared:  0.7317 
## F-statistic: 57.06 on 9 and 176 DF,  p-value: < 2.2e-16
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{vif}\NormalTok{(lm_final)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##              fa_2            fa_2sq              fa_3              pc_1 
##          3.847406          3.207554          1.750377          2.249691 
##              pc_2            pc_2sq   Artist_Follower Artist_Followersq 
##          1.401325          1.436766         13.792858         12.676491 
## days_release_orig 
##          1.497164
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# library("stargazer")}
\CommentTok{# stargazer::stargazer(model1, model2, model3, lm_final)}

\KeywordTok{library}\NormalTok{(}\StringTok{"boot"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Attaching package: 'boot'
\end{verbatim}

\begin{verbatim}
## The following object is masked from 'package:robustbase':
## 
##     salinity
\end{verbatim}

\begin{verbatim}
## The following object is masked from 'package:lattice':
## 
##     melanoma
\end{verbatim}

\begin{verbatim}
## The following object is masked from 'package:car':
## 
##     logit
\end{verbatim}

\begin{verbatim}
## The following object is masked from 'package:psych':
## 
##     logit
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ci <-}\StringTok{ }\KeywordTok{confint}\NormalTok{(lm_final, }\DataTypeTok{level =} \FloatTok{0.95}\NormalTok{)}

\NormalTok{plot.confint <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{ (b, b.boot, ci, main) \{}
  \KeywordTok{hist}\NormalTok{(b.boot, }\DataTypeTok{main=}\NormalTok{main); }\KeywordTok{rug}\NormalTok{(b.boot)}
  \KeywordTok{abline}\NormalTok{(}\DataTypeTok{v=}\NormalTok{b, }\DataTypeTok{col=}\StringTok{"red"}\NormalTok{); }\KeywordTok{abline}\NormalTok{(}\DataTypeTok{v=}\NormalTok{ci, }\DataTypeTok{col=}\StringTok{"blue"}\NormalTok{)}
  \KeywordTok{abline}\NormalTok{(}\DataTypeTok{v=}\KeywordTok{quantile}\NormalTok{(b.boot, }\KeywordTok{c}\NormalTok{(}\FloatTok{0.025}\NormalTok{, }\FloatTok{0.975}\NormalTok{)), }\DataTypeTok{col=}\StringTok{"green"}\NormalTok{)}
\NormalTok{\}}

\NormalTok{betahat <-}\StringTok{ }\KeywordTok{boot}\NormalTok{(lm_final}\OperatorTok{$}\NormalTok{model, }\DataTypeTok{R=}\DecValTok{999}\NormalTok{, }
                \ControlFlowTok{function}\NormalTok{(x, index) \{ }\KeywordTok{lm}\NormalTok{(Artist_Popularity }\OperatorTok{~}\StringTok{ }\NormalTok{fa_}\DecValTok{2} \OperatorTok{+}\StringTok{ }\NormalTok{fa_2sq }\OperatorTok{+}\StringTok{ }\NormalTok{fa_}\DecValTok{3} \OperatorTok{+}\StringTok{ }\NormalTok{pc_}\DecValTok{1} \OperatorTok{+}\StringTok{ }\NormalTok{pc_}\DecValTok{2} \OperatorTok{+}\StringTok{ }\NormalTok{pc_2sq }\OperatorTok{+}\StringTok{ }\NormalTok{Artist_Follower }\OperatorTok{+}\StringTok{ }\NormalTok{Artist_Followersq }\OperatorTok{+}\StringTok{ }\NormalTok{days_release_orig, }\DataTypeTok{data =}\NormalTok{ x_noout, }\DataTypeTok{subset=}\NormalTok{index)}\OperatorTok{$}\NormalTok{coefficients \})}

\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfcol=}\KeywordTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{))}

\KeywordTok{plot.confint}\NormalTok{(lm_final}\OperatorTok{$}\NormalTok{coefficients[}\DecValTok{1}\NormalTok{], betahat}\OperatorTok{$}\NormalTok{t[,}\DecValTok{1}\NormalTok{], ci[}\DecValTok{1}\NormalTok{,], }\StringTok{"Intercept"}\NormalTok{)}
\KeywordTok{plot.confint}\NormalTok{(lm_final}\OperatorTok{$}\NormalTok{coefficients[}\DecValTok{2}\NormalTok{], betahat}\OperatorTok{$}\NormalTok{t[,}\DecValTok{2}\NormalTok{], ci[}\DecValTok{2}\NormalTok{,], }\StringTok{"fa_2"}\NormalTok{)}
\KeywordTok{plot.confint}\NormalTok{(lm_final}\OperatorTok{$}\NormalTok{coefficients[}\DecValTok{3}\NormalTok{], betahat}\OperatorTok{$}\NormalTok{t[,}\DecValTok{3}\NormalTok{], ci[}\DecValTok{3}\NormalTok{,], }\StringTok{"fa_2sq"}\NormalTok{)}
\KeywordTok{plot.confint}\NormalTok{(lm_final}\OperatorTok{$}\NormalTok{coefficients[}\DecValTok{4}\NormalTok{], betahat}\OperatorTok{$}\NormalTok{t[,}\DecValTok{4}\NormalTok{], ci[}\DecValTok{4}\NormalTok{,], }\StringTok{"fa_3"}\NormalTok{)}
\KeywordTok{plot.confint}\NormalTok{(lm_final}\OperatorTok{$}\NormalTok{coefficients[}\DecValTok{5}\NormalTok{], betahat}\OperatorTok{$}\NormalTok{t[,}\DecValTok{5}\NormalTok{], ci[}\DecValTok{5}\NormalTok{,], }\StringTok{"pc_1"}\NormalTok{)}
\KeywordTok{plot.confint}\NormalTok{(lm_final}\OperatorTok{$}\NormalTok{coefficients[}\DecValTok{6}\NormalTok{], betahat}\OperatorTok{$}\NormalTok{t[,}\DecValTok{6}\NormalTok{], ci[}\DecValTok{6}\NormalTok{,], }\StringTok{"pc_2"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-51-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfcol=}\KeywordTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{))}

\KeywordTok{plot.confint}\NormalTok{(lm_final}\OperatorTok{$}\NormalTok{coefficients[}\DecValTok{7}\NormalTok{], betahat}\OperatorTok{$}\NormalTok{t[,}\DecValTok{7}\NormalTok{], ci[}\DecValTok{7}\NormalTok{,], }\StringTok{"pc_2sq"}\NormalTok{)}
\KeywordTok{plot.confint}\NormalTok{(lm_final}\OperatorTok{$}\NormalTok{coefficients[}\DecValTok{8}\NormalTok{], betahat}\OperatorTok{$}\NormalTok{t[,}\DecValTok{8}\NormalTok{], ci[}\DecValTok{8}\NormalTok{,], }\StringTok{"Artist_Follower"}\NormalTok{)}
\KeywordTok{plot.confint}\NormalTok{(lm_final}\OperatorTok{$}\NormalTok{coefficients[}\DecValTok{9}\NormalTok{], betahat}\OperatorTok{$}\NormalTok{t[,}\DecValTok{9}\NormalTok{], ci[}\DecValTok{9}\NormalTok{,], }\StringTok{"Artist_Followersq"}\NormalTok{)}
\KeywordTok{plot.confint}\NormalTok{(lm_final}\OperatorTok{$}\NormalTok{coefficients[}\DecValTok{10}\NormalTok{], betahat}\OperatorTok{$}\NormalTok{t[,}\DecValTok{10}\NormalTok{], ci[}\DecValTok{10}\NormalTok{,], }\StringTok{"days_release"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-51-2.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{model5 <-}\StringTok{ }\KeywordTok{lm}\NormalTok{(Artist_Popularity }\OperatorTok{~}\StringTok{ }\NormalTok{fa_}\DecValTok{2} \OperatorTok{+}\StringTok{ }\NormalTok{fa_2sq, }\DataTypeTok{data =}\NormalTok{ x)}
\KeywordTok{summary}\NormalTok{(model5)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## lm(formula = Artist_Popularity ~ fa_2 + fa_2sq, data = x)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -37.506 -10.505   1.289  10.461  36.224 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(>|t|)    
## (Intercept)  66.5658     1.0458  63.649  < 2e-16 ***
## fa_2         18.0348     2.7106   6.654 2.88e-10 ***
## fa_2sq       -1.3864     0.2653  -5.226 4.47e-07 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 14.2 on 193 degrees of freedom
## Multiple R-squared:  0.2059, Adjusted R-squared:  0.1977 
## F-statistic: 25.03 on 2 and 193 DF,  p-value: 2.167e-10
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{vertex <-}\StringTok{ }\OperatorTok{-}\NormalTok{model5}\OperatorTok{$}\NormalTok{coefficients[}\DecValTok{2}\NormalTok{] }\OperatorTok{/}\StringTok{ }\NormalTok{(}\DecValTok{2}\OperatorTok{*}\NormalTok{model5}\OperatorTok{$}\NormalTok{coefficients[}\DecValTok{3}\NormalTok{])}
\NormalTok{vertex}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##     fa_2 
## 6.504143
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(vertex }\OperatorTok{<=}\StringTok{ }\KeywordTok{max}\NormalTok{(x}\OperatorTok{$}\NormalTok{fa_}\DecValTok{2}\NormalTok{)) }\OperatorTok{&}\StringTok{ }\NormalTok{(vertex }\OperatorTok{>=}\StringTok{ }\KeywordTok{min}\NormalTok{(x}\OperatorTok{$}\NormalTok{fa_}\DecValTok{2}\NormalTok{)) }\CommentTok{# so vertex is inside of range of Artist_Follower and there exists a quadratic component}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## fa_2 
## TRUE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# https://stats.idre.ucla.edu/r/faq/how-can-i-estimate-the-standard-error-of-transformed-regression-parameters-in-r-using-the-delta-method/}
\CommentTok{# https://www.statalist.org/forums/forum/general-stata-discussion/general/1376936-testing-whether-to-include-a-squared-term}
\CommentTok{# https://www.statalist.org/forums/forum/general-stata-discussion/general/1344089-how-to-find-the-turning-point-for-a-quadratic-function}
\CommentTok{# https://www.statalist.org/forums/forum/general-stata-discussion/general/1408413-significance-level-of-quadratic-term}
\CommentTok{# https://psych.unl.edu/psycrs/statpage/nonlin_eg.pdf ("true" quadratic component vs. skewed predictor)}


\KeywordTok{library}\NormalTok{(}\StringTok{"msm"}\NormalTok{) }\CommentTok{# equivalent to the nlcom function in Stata}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Attaching package: 'msm'
\end{verbatim}

\begin{verbatim}
## The following object is masked from 'package:boot':
## 
##     cav
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# z-value according to the Delta method}

\NormalTok{vertex }\OperatorTok{/}\StringTok{ }\NormalTok{msm}\OperatorTok{::}\KeywordTok{deltamethod}\NormalTok{(}\OperatorTok{~}\StringTok{ }\OperatorTok{-}\NormalTok{x2 }\OperatorTok{/}\StringTok{ }\NormalTok{(}\DecValTok{2} \OperatorTok{*}\StringTok{ }\NormalTok{x3), }\KeywordTok{coef}\NormalTok{(model5), }\KeywordTok{vcov}\NormalTok{(model5)) }\CommentTok{# = 12.8421}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    fa_2 
## 12.8421
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# CI according to Stata}

\NormalTok{vertex }\OperatorTok{-}\StringTok{ }\KeywordTok{qt}\NormalTok{(}\FloatTok{0.975}\NormalTok{, }\DataTypeTok{df =} \DecValTok{10000000}\NormalTok{) }\OperatorTok{*}\StringTok{ }\NormalTok{msm}\OperatorTok{::}\KeywordTok{deltamethod}\NormalTok{(}\OperatorTok{~}\StringTok{ }\OperatorTok{-}\NormalTok{x2 }\OperatorTok{/}\StringTok{ }\NormalTok{(}\DecValTok{2} \OperatorTok{*}\StringTok{ }\NormalTok{x3), }\KeywordTok{coef}\NormalTok{(model5), }\KeywordTok{vcov}\NormalTok{(model5))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##     fa_2 
## 5.511479
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{vertex }\OperatorTok{+}\StringTok{ }\KeywordTok{qt}\NormalTok{(}\FloatTok{0.975}\NormalTok{, }\DataTypeTok{df =} \DecValTok{10000000}\NormalTok{) }\OperatorTok{*}\StringTok{ }\NormalTok{msm}\OperatorTok{::}\KeywordTok{deltamethod}\NormalTok{(}\OperatorTok{~}\StringTok{ }\OperatorTok{-}\NormalTok{x2 }\OperatorTok{/}\StringTok{ }\NormalTok{(}\DecValTok{2} \OperatorTok{*}\StringTok{ }\NormalTok{x3), }\KeywordTok{coef}\NormalTok{(model5), }\KeywordTok{vcov}\NormalTok{(model5))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##     fa_2 
## 7.496808
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{n <-}\StringTok{ }\KeywordTok{nrow}\NormalTok{(model5}\OperatorTok{$}\NormalTok{model)}
\NormalTok{d <-}\StringTok{ }\KeywordTok{length}\NormalTok{(model5}\OperatorTok{$}\NormalTok{coefficients)}
\NormalTok{df <-}\StringTok{ }\NormalTok{n }\OperatorTok{-}\StringTok{ }\NormalTok{d}

\CommentTok{# http://sia.webpopix.org/nonlinearRegression.html}

\CommentTok{# p_value = P(z > 1.959964) = 1-pt(z, df=df) = 3.270659e-10 < 0.05 <-- reject H0 that vertex is equal to zero}

\CommentTok{# vertex for fa_2}

\NormalTok{vertex <-}\StringTok{ }\OperatorTok{-}\NormalTok{model3}\OperatorTok{$}\NormalTok{coefficients[}\DecValTok{2}\NormalTok{] }\OperatorTok{/}\StringTok{ }\NormalTok{(}\DecValTok{2}\OperatorTok{*}\NormalTok{model3}\OperatorTok{$}\NormalTok{coefficients[}\DecValTok{3}\NormalTok{])}
\NormalTok{vertex}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##     fa_2 
## 5.528294
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(vertex }\OperatorTok{<=}\StringTok{ }\KeywordTok{max}\NormalTok{(x}\OperatorTok{$}\NormalTok{fa_}\DecValTok{2}\NormalTok{)) }\OperatorTok{&}\StringTok{ }\NormalTok{(vertex }\OperatorTok{>=}\StringTok{ }\KeywordTok{min}\NormalTok{(x}\OperatorTok{$}\NormalTok{fa_}\DecValTok{2}\NormalTok{)) }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## fa_2 
## TRUE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{z <-}\StringTok{ }\NormalTok{vertex }\OperatorTok{/}\StringTok{ }\NormalTok{msm}\OperatorTok{::}\KeywordTok{deltamethod}\NormalTok{(}\OperatorTok{~}\StringTok{ }\OperatorTok{-}\NormalTok{x2 }\OperatorTok{/}\StringTok{ }\NormalTok{(}\DecValTok{2} \OperatorTok{*}\StringTok{ }\NormalTok{x3), }\KeywordTok{coef}\NormalTok{(model3), }\KeywordTok{vcov}\NormalTok{(model3))}
\NormalTok{z}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##     fa_2 
## 8.814632
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{lower_CI <-}\StringTok{ }\NormalTok{vertex }\OperatorTok{-}\StringTok{ }\KeywordTok{qt}\NormalTok{(}\FloatTok{0.975}\NormalTok{, }\DataTypeTok{df =} \DecValTok{10000000}\NormalTok{) }\OperatorTok{*}\StringTok{ }\NormalTok{msm}\OperatorTok{::}\KeywordTok{deltamethod}\NormalTok{(}\OperatorTok{~}\StringTok{ }\OperatorTok{-}\NormalTok{x2 }\OperatorTok{/}\StringTok{ }\NormalTok{(}\DecValTok{2} \OperatorTok{*}\StringTok{ }\NormalTok{x3), }\KeywordTok{coef}\NormalTok{(model3), }\KeywordTok{vcov}\NormalTok{(model3))}
\NormalTok{upper_CI <-}\StringTok{ }\NormalTok{vertex }\OperatorTok{+}\StringTok{ }\KeywordTok{qt}\NormalTok{(}\FloatTok{0.975}\NormalTok{, }\DataTypeTok{df =} \DecValTok{10000000}\NormalTok{) }\OperatorTok{*}\StringTok{ }\NormalTok{msm}\OperatorTok{::}\KeywordTok{deltamethod}\NormalTok{(}\OperatorTok{~}\StringTok{ }\OperatorTok{-}\NormalTok{x2 }\OperatorTok{/}\StringTok{ }\NormalTok{(}\DecValTok{2} \OperatorTok{*}\StringTok{ }\NormalTok{x3), }\KeywordTok{coef}\NormalTok{(model3), }\KeywordTok{vcov}\NormalTok{(model3))}
\NormalTok{n <-}\StringTok{ }\KeywordTok{nrow}\NormalTok{(model3}\OperatorTok{$}\NormalTok{model)}
\NormalTok{d <-}\StringTok{ }\KeywordTok{length}\NormalTok{(model3}\OperatorTok{$}\NormalTok{coefficients)}
\NormalTok{df <-}\StringTok{ }\NormalTok{n }\OperatorTok{-}\StringTok{ }\NormalTok{d}
\DecValTok{1}\OperatorTok{-}\KeywordTok{pt}\NormalTok{(z, }\DataTypeTok{df=}\NormalTok{df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##         fa_2 
## 4.440892e-16
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# p_value = P(z > 1.959964) = 1-pt(z, df=df) = 4.440892e-16 < 0.05 <-- reject H0 that vertex is equal to zero}

\CommentTok{# vertex for pc_2}

\NormalTok{vertex <-}\StringTok{ }\OperatorTok{-}\NormalTok{model3}\OperatorTok{$}\NormalTok{coefficients[}\DecValTok{6}\NormalTok{] }\OperatorTok{/}\StringTok{ }\NormalTok{(}\DecValTok{2}\OperatorTok{*}\NormalTok{model3}\OperatorTok{$}\NormalTok{coefficients[}\DecValTok{7}\NormalTok{])}
\NormalTok{vertex}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##     pc_2 
## 1.363773
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(vertex }\OperatorTok{<=}\StringTok{ }\KeywordTok{max}\NormalTok{(x}\OperatorTok{$}\NormalTok{pc_}\DecValTok{2}\NormalTok{)) }\OperatorTok{&}\StringTok{ }\NormalTok{(vertex }\OperatorTok{>=}\StringTok{ }\KeywordTok{min}\NormalTok{(x}\OperatorTok{$}\NormalTok{pc_}\DecValTok{2}\NormalTok{)) }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## pc_2 
## TRUE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{z <-}\StringTok{ }\NormalTok{vertex }\OperatorTok{/}\StringTok{ }\NormalTok{msm}\OperatorTok{::}\KeywordTok{deltamethod}\NormalTok{(}\OperatorTok{~}\StringTok{ }\OperatorTok{-}\NormalTok{x6 }\OperatorTok{/}\StringTok{ }\NormalTok{(}\DecValTok{2} \OperatorTok{*}\StringTok{ }\NormalTok{x7), }\KeywordTok{coef}\NormalTok{(model3), }\KeywordTok{vcov}\NormalTok{(model3))}
\NormalTok{z}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##     pc_2 
## 4.536158
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{lower_CI <-}\StringTok{ }\NormalTok{vertex }\OperatorTok{-}\StringTok{ }\KeywordTok{qt}\NormalTok{(}\FloatTok{0.975}\NormalTok{, }\DataTypeTok{df =} \DecValTok{10000000}\NormalTok{) }\OperatorTok{*}\StringTok{ }\NormalTok{msm}\OperatorTok{::}\KeywordTok{deltamethod}\NormalTok{(}\OperatorTok{~}\StringTok{ }\OperatorTok{-}\NormalTok{x6 }\OperatorTok{/}\StringTok{ }\NormalTok{(}\DecValTok{2} \OperatorTok{*}\StringTok{ }\NormalTok{x7), }\KeywordTok{coef}\NormalTok{(model3), }\KeywordTok{vcov}\NormalTok{(model3))}
\NormalTok{upper_CI <-}\StringTok{ }\NormalTok{vertex }\OperatorTok{+}\StringTok{ }\KeywordTok{qt}\NormalTok{(}\FloatTok{0.975}\NormalTok{, }\DataTypeTok{df =} \DecValTok{10000000}\NormalTok{) }\OperatorTok{*}\StringTok{ }\NormalTok{msm}\OperatorTok{::}\KeywordTok{deltamethod}\NormalTok{(}\OperatorTok{~}\StringTok{ }\OperatorTok{-}\NormalTok{x6 }\OperatorTok{/}\StringTok{ }\NormalTok{(}\DecValTok{2} \OperatorTok{*}\StringTok{ }\NormalTok{x7), }\KeywordTok{coef}\NormalTok{(model3), }\KeywordTok{vcov}\NormalTok{(model3))}
\NormalTok{n <-}\StringTok{ }\KeywordTok{nrow}\NormalTok{(model3}\OperatorTok{$}\NormalTok{model)}
\NormalTok{d <-}\StringTok{ }\KeywordTok{length}\NormalTok{(model3}\OperatorTok{$}\NormalTok{coefficients)}
\NormalTok{df <-}\StringTok{ }\NormalTok{n }\OperatorTok{-}\StringTok{ }\NormalTok{d}
\DecValTok{1}\OperatorTok{-}\KeywordTok{pt}\NormalTok{(z, }\DataTypeTok{df=}\NormalTok{df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##         pc_2 
## 5.125243e-06
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# p_value = P(z > 1.959964) = 1-pt(z, df=df) = 5.125243e-06 < 0.05 <-- reject H0 that vertex is equal to zero}

\CommentTok{# vertex for Artist_Follower}

\NormalTok{vertex <-}\StringTok{ }\OperatorTok{-}\NormalTok{model3}\OperatorTok{$}\NormalTok{coefficients[}\DecValTok{8}\NormalTok{] }\OperatorTok{/}\StringTok{ }\NormalTok{(}\DecValTok{2}\OperatorTok{*}\NormalTok{model3}\OperatorTok{$}\NormalTok{coefficients[}\DecValTok{9}\NormalTok{])}
\NormalTok{vertex}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Artist_Follower 
##        35.51927
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(vertex }\OperatorTok{<=}\StringTok{ }\KeywordTok{max}\NormalTok{(x}\OperatorTok{$}\NormalTok{Artist_Follower)) }\OperatorTok{&}\StringTok{ }\NormalTok{(vertex }\OperatorTok{>=}\StringTok{ }\KeywordTok{min}\NormalTok{(x}\OperatorTok{$}\NormalTok{Artist_Follower)) }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Artist_Follower 
##            TRUE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{z <-}\StringTok{ }\NormalTok{vertex }\OperatorTok{/}\StringTok{ }\NormalTok{msm}\OperatorTok{::}\KeywordTok{deltamethod}\NormalTok{(}\OperatorTok{~}\StringTok{ }\OperatorTok{-}\NormalTok{x8 }\OperatorTok{/}\StringTok{ }\NormalTok{(}\DecValTok{2} \OperatorTok{*}\StringTok{ }\NormalTok{x9), }\KeywordTok{coef}\NormalTok{(model3), }\KeywordTok{vcov}\NormalTok{(model3))}
\NormalTok{z}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Artist_Follower 
##        9.652667
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{lower_CI <-}\StringTok{ }\NormalTok{vertex }\OperatorTok{-}\StringTok{ }\KeywordTok{qt}\NormalTok{(}\FloatTok{0.975}\NormalTok{, }\DataTypeTok{df =} \DecValTok{10000000}\NormalTok{) }\OperatorTok{*}\StringTok{ }\NormalTok{msm}\OperatorTok{::}\KeywordTok{deltamethod}\NormalTok{(}\OperatorTok{~}\StringTok{ }\OperatorTok{-}\NormalTok{x8 }\OperatorTok{/}\StringTok{ }\NormalTok{(}\DecValTok{2} \OperatorTok{*}\StringTok{ }\NormalTok{x9), }\KeywordTok{coef}\NormalTok{(model3), }\KeywordTok{vcov}\NormalTok{(model3))}
\NormalTok{upper_CI <-}\StringTok{ }\NormalTok{vertex }\OperatorTok{+}\StringTok{ }\KeywordTok{qt}\NormalTok{(}\FloatTok{0.975}\NormalTok{, }\DataTypeTok{df =} \DecValTok{10000000}\NormalTok{) }\OperatorTok{*}\StringTok{ }\NormalTok{msm}\OperatorTok{::}\KeywordTok{deltamethod}\NormalTok{(}\OperatorTok{~}\StringTok{ }\OperatorTok{-}\NormalTok{x8 }\OperatorTok{/}\StringTok{ }\NormalTok{(}\DecValTok{2} \OperatorTok{*}\StringTok{ }\NormalTok{x9), }\KeywordTok{coef}\NormalTok{(model3), }\KeywordTok{vcov}\NormalTok{(model3))}
\NormalTok{n <-}\StringTok{ }\KeywordTok{nrow}\NormalTok{(model3}\OperatorTok{$}\NormalTok{model)}
\NormalTok{d <-}\StringTok{ }\KeywordTok{length}\NormalTok{(model3}\OperatorTok{$}\NormalTok{coefficients)}
\NormalTok{df <-}\StringTok{ }\NormalTok{n }\OperatorTok{-}\StringTok{ }\NormalTok{d}
\DecValTok{1}\OperatorTok{-}\KeywordTok{pt}\NormalTok{(z, }\DataTypeTok{df=}\NormalTok{df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Artist_Follower 
##               0
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#plot(Artist_Follower_trans, x$Artist_Popularity)}

\CommentTok{#min_max_normalize <- function(x)}
\CommentTok{#\{}
\CommentTok{#  return( (10-1)*((x- min(x)) /(max(x)-min(x))) + 1)}
\CommentTok{#\}}

\CommentTok{#min_fa_2 <- optimize(ksD, c(-10,10), x=min_max_normalize(x$pc_2))$minimum}
\CommentTok{#fa_2bc <- bcPower(min_max_normalize(x$pc_2), min_fa_2)}

\CommentTok{#fa_2bcsqrr <- fa_2bc ** 0.5}
\CommentTok{#fa_2bcsqrrcenter <- fa_2bcsqrr - mean(fa_2bcsqrr)}
\CommentTok{#fa_2bcsqrrcentersq <- fa_2bcsqrrcenter ** 2}

\CommentTok{#cor(cbind(x$Artist_Popularity, fa_2bcsqrrcenter, fa_2bcsqrrcentersq))}





\CommentTok{#plot(x$fa_2, x$Artist_Popularity)}
\CommentTok{#plot(x$pc_2, x$Artist_Popularity)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# baseline model:}
\CommentTok{# forward}

\NormalTok{lmi <-}\StringTok{ }\KeywordTok{lm}\NormalTok{(Artist_Popularity}\OperatorTok{~}\DecValTok{1}\NormalTok{, }\DataTypeTok{data=}\NormalTok{lm_final}\OperatorTok{$}\NormalTok{model)}
\NormalTok{lmf <-}\StringTok{ }\NormalTok{MASS}\OperatorTok{::}\KeywordTok{stepAIC}\NormalTok{(lmi, }\DataTypeTok{scope=}\OperatorTok{~}
\StringTok{                }\NormalTok{fa_}\DecValTok{2} 
               \OperatorTok{+}\StringTok{ }\NormalTok{fa_2sq}
               \OperatorTok{+}\StringTok{ }\NormalTok{fa_}\DecValTok{3} 
               \OperatorTok{+}\StringTok{ }\NormalTok{x_noout[,}\StringTok{'fa_4'}\NormalTok{] }
               \OperatorTok{+}\StringTok{ }\NormalTok{pc_}\DecValTok{1}
               \OperatorTok{+}\StringTok{ }\NormalTok{pc_}\DecValTok{2}
               \OperatorTok{+}\StringTok{ }\NormalTok{pc_2sq}
               \OperatorTok{+}\StringTok{ }\NormalTok{Artist_Follower}
               \OperatorTok{+}\StringTok{ }\NormalTok{Artist_Followersq}
               \OperatorTok{+}\StringTok{ }\NormalTok{days_release_orig}
               \OperatorTok{+}\StringTok{ }\NormalTok{x_noout[, }\StringTok{'fa_1'}\NormalTok{]}
               \OperatorTok{+}\StringTok{ }\NormalTok{x_noout[, }\StringTok{'Track_Duration_ms'}\NormalTok{]}
               \OperatorTok{+}\StringTok{ }\NormalTok{x_noout[, }\StringTok{'Track_Popularity'}\NormalTok{]}
\NormalTok{               ,}\DataTypeTok{direction =} \StringTok{"forward"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Start:  AIC=1012.44
## Artist_Popularity ~ 1
## 
##                                  Df Sum of Sq   RSS     AIC
## + pc_2                            1   17048.4 25493  919.20
## + x_noout[, "Track_Duration_ms"]  1   12472.7 30069  949.90
## + Artist_Follower                 1   11518.9 31023  955.71
## + pc_2sq                          1   10312.7 32229  962.81
## + fa_2                            1    8694.3 33848  971.92
## + x_noout[, "Track_Popularity"]   1    7421.3 35120  978.79
## + Artist_Followersq               1    6625.6 35916  982.95
## + pc_1                            1    1481.0 41061 1007.85
## + fa_2sq                          1    1418.9 41123 1008.13
## <none>                                        42542 1012.44
## + days_release_orig               1     414.5 42127 1012.62
## + x_noout[, "fa_4"]               1     398.2 42144 1012.69
## + x_noout[, "fa_1"]               1     176.7 42365 1013.67
## + fa_3                            1     133.5 42408 1013.86
## 
## Step:  AIC=919.2
## Artist_Popularity ~ pc_2
## 
##                                  Df Sum of Sq   RSS    AIC
## + Artist_Follower                 1    7669.0 17824 854.64
## + Artist_Followersq               1    4882.1 20611 881.66
## + x_noout[, "Track_Duration_ms"]  1    4480.6 21013 885.25
## + fa_2                            1    4209.3 21284 887.63
## + x_noout[, "Track_Popularity"]   1    3579.8 21914 893.06
## + pc_2sq                          1    2528.4 22965 901.77
## + days_release_orig               1    2251.5 23242 904.00
## + pc_1                            1    1731.7 23762 908.12
## + x_noout[, "fa_4"]               1    1088.3 24405 913.09
## + fa_2sq                          1     856.0 24637 914.85
## + x_noout[, "fa_1"]               1     736.0 24757 915.75
## <none>                                        25493 919.20
## + fa_3                            1      25.1 25468 921.02
## 
## Step:  AIC=854.64
## Artist_Popularity ~ pc_2 + Artist_Follower
## 
##                                  Df Sum of Sq   RSS    AIC
## + x_noout[, "Track_Popularity"]   1    3198.4 14626 819.85
## + x_noout[, "Track_Duration_ms"]  1    2853.7 14971 824.19
## + Artist_Followersq               1    2136.9 15688 832.89
## + pc_2sq                          1    1360.1 16464 841.88
## + days_release_orig               1    1225.0 16599 843.40
## + fa_2                            1    1157.3 16667 844.15
## + x_noout[, "fa_4"]               1    1050.6 16774 845.34
## + pc_1                            1     843.0 16981 847.63
## <none>                                        17824 854.64
## + fa_2sq                          1      96.1 17728 855.63
## + fa_3                            1      71.3 17753 855.89
## + x_noout[, "fa_1"]               1      19.1 17805 856.44
## 
## Step:  AIC=819.85
## Artist_Popularity ~ pc_2 + Artist_Follower + x_noout[, "Track_Popularity"]
## 
##                                  Df Sum of Sq   RSS    AIC
## + x_noout[, "Track_Duration_ms"]  1   1841.18 12785 796.83
## + Artist_Followersq               1   1806.26 12820 797.34
## + pc_2sq                          1   1150.74 13475 806.61
## + days_release_orig               1    501.06 14125 815.37
## + pc_1                            1    417.59 14208 816.47
## + x_noout[, "fa_4"]               1    282.55 14343 818.23
## + fa_3                            1    198.73 14427 819.31
## <none>                                        14626 819.85
## + fa_2                            1    142.21 14484 820.04
## + x_noout[, "fa_1"]               1     23.05 14603 821.56
## + fa_2sq                          1      7.91 14618 821.75
## 
## Step:  AIC=796.83
## Artist_Popularity ~ pc_2 + Artist_Follower + x_noout[, "Track_Popularity"] + 
##     x_noout[, "Track_Duration_ms"]
## 
##                     Df Sum of Sq   RSS    AIC
## + Artist_Followersq  1   1508.10 11277 775.48
## + pc_2sq             1   1241.24 11544 779.83
## + fa_3               1    664.00 12121 788.91
## + x_noout[, "fa_1"]  1    147.88 12637 796.67
## <none>                           12785 796.83
## + fa_2               1     83.00 12702 797.62
## + days_release_orig  1     71.00 12714 797.79
## + pc_1               1      6.16 12779 798.74
## + x_noout[, "fa_4"]  1      5.55 12779 798.75
## + fa_2sq             1      4.04 12781 798.77
## 
## Step:  AIC=775.48
## Artist_Popularity ~ pc_2 + Artist_Follower + x_noout[, "Track_Popularity"] + 
##     x_noout[, "Track_Duration_ms"] + Artist_Followersq
## 
##                     Df Sum of Sq   RSS    AIC
## + pc_2sq             1   1076.83 10200 758.82
## + fa_3               1    598.01 10679 767.35
## + fa_2sq             1    185.08 11092 774.40
## <none>                           11277 775.48
## + x_noout[, "fa_1"]  1     84.76 11192 776.08
## + days_release_orig  1     36.02 11241 776.89
## + x_noout[, "fa_4"]  1      5.24 11272 777.40
## + pc_1               1      3.80 11273 777.42
## + fa_2               1      0.27 11276 777.48
## 
## Step:  AIC=758.82
## Artist_Popularity ~ pc_2 + Artist_Follower + x_noout[, "Track_Popularity"] + 
##     x_noout[, "Track_Duration_ms"] + Artist_Followersq + pc_2sq
## 
##                     Df Sum of Sq     RSS    AIC
## + fa_3               1   250.781  9949.1 756.19
## + fa_2sq             1   177.173 10022.7 757.56
## + days_release_orig  1   167.813 10032.1 757.73
## <none>                           10199.9 758.82
## + pc_1               1    98.887 10101.0 759.00
## + x_noout[, "fa_1"]  1    81.693 10118.2 759.32
## + x_noout[, "fa_4"]  1    28.307 10171.6 760.30
## + fa_2               1     0.969 10198.9 760.80
## 
## Step:  AIC=756.19
## Artist_Popularity ~ pc_2 + Artist_Follower + x_noout[, "Track_Popularity"] + 
##     x_noout[, "Track_Duration_ms"] + Artist_Followersq + pc_2sq + 
##     fa_3
## 
##                     Df Sum of Sq    RSS    AIC
## + pc_1               1    546.47 9402.6 747.68
## + days_release_orig  1    302.11 9647.0 752.45
## + x_noout[, "fa_4"]  1    190.84 9758.3 754.58
## + fa_2sq             1    159.29 9789.8 755.18
## <none>                           9949.1 756.19
## + x_noout[, "fa_1"]  1      1.79 9947.3 758.15
## + fa_2               1      0.74 9948.4 758.17
## 
## Step:  AIC=747.68
## Artist_Popularity ~ pc_2 + Artist_Follower + x_noout[, "Track_Popularity"] + 
##     x_noout[, "Track_Duration_ms"] + Artist_Followersq + pc_2sq + 
##     fa_3 + pc_1
## 
##                     Df Sum of Sq    RSS    AIC
## + fa_2sq             1   156.732 9245.9 746.55
## + days_release_orig  1   117.363 9285.3 747.34
## <none>                           9402.6 747.68
## + x_noout[, "fa_1"]  1    25.394 9377.2 749.17
## + x_noout[, "fa_4"]  1     4.049 9398.6 749.60
## + fa_2               1     2.462 9400.2 749.63
## 
## Step:  AIC=746.55
## Artist_Popularity ~ pc_2 + Artist_Follower + x_noout[, "Track_Popularity"] + 
##     x_noout[, "Track_Duration_ms"] + Artist_Followersq + pc_2sq + 
##     fa_3 + pc_1 + fa_2sq
## 
##                     Df Sum of Sq    RSS    AIC
## + fa_2               1   191.308 9054.6 744.66
## + days_release_orig  1   105.159 9140.7 746.42
## <none>                           9245.9 746.55
## + x_noout[, "fa_1"]  1    37.651 9208.2 747.79
## + x_noout[, "fa_4"]  1     0.048 9245.8 748.55
## 
## Step:  AIC=744.66
## Artist_Popularity ~ pc_2 + Artist_Follower + x_noout[, "Track_Popularity"] + 
##     x_noout[, "Track_Duration_ms"] + Artist_Followersq + pc_2sq + 
##     fa_3 + pc_1 + fa_2sq + fa_2
## 
##                     Df Sum of Sq    RSS    AIC
## + days_release_orig  1   109.025 8945.6 744.41
## <none>                           9054.6 744.66
## + x_noout[, "fa_1"]  1    36.249 9018.3 745.92
## + x_noout[, "fa_4"]  1     0.008 9054.6 746.66
## 
## Step:  AIC=744.41
## Artist_Popularity ~ pc_2 + Artist_Follower + x_noout[, "Track_Popularity"] + 
##     x_noout[, "Track_Duration_ms"] + Artist_Followersq + pc_2sq + 
##     fa_3 + pc_1 + fa_2sq + fa_2 + days_release_orig
## 
##                     Df Sum of Sq    RSS    AIC
## <none>                           8945.6 744.41
## + x_noout[, "fa_1"]  1    49.184 8896.4 745.38
## + x_noout[, "fa_4"]  1     6.072 8939.5 746.28
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{summary}\NormalTok{(lmf)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## lm(formula = Artist_Popularity ~ pc_2 + Artist_Follower + x_noout[, 
##     "Track_Popularity"] + x_noout[, "Track_Duration_ms"] + Artist_Followersq + 
##     pc_2sq + fa_3 + pc_1 + fa_2sq + fa_2 + days_release_orig, 
##     data = lm_final$model)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -23.0380  -5.2954   0.3417   4.5413  17.3011 
## 
## Coefficients:
##                                  Estimate Std. Error t value Pr(>|t|)    
## (Intercept)                     5.987e+01  3.045e+00  19.664  < 2e-16 ***
## pc_2                            4.357e+00  5.531e-01   7.877 3.48e-13 ***
## Artist_Follower                 4.143e+00  5.731e-01   7.229 1.48e-11 ***
## x_noout[, "Track_Popularity"]   1.936e-01  4.086e-02   4.737 4.48e-06 ***
## x_noout[, "Track_Duration_ms"] -1.528e-05  4.591e-06  -3.329 0.001065 ** 
## Artist_Followersq              -1.614e-01  3.182e-02  -5.071 1.01e-06 ***
## pc_2sq                         -1.667e+00  3.918e-01  -4.255 3.41e-05 ***
## fa_3                            3.769e+00  1.024e+00   3.682 0.000308 ***
## pc_1                            9.810e-01  4.271e-01   2.297 0.022806 *  
## fa_2sq                         -5.659e+00  2.205e+00  -2.566 0.011127 *  
## fa_2                            7.210e+00  3.700e+00   1.948 0.052974 .  
## days_release_orig              -2.378e-04  1.633e-04  -1.456 0.147127    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 7.17 on 174 degrees of freedom
## Multiple R-squared:  0.7897, Adjusted R-squared:  0.7764 
## F-statistic: 59.41 on 11 and 174 DF,  p-value: < 2.2e-16
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# backward:}
\NormalTok{lma <-}\StringTok{ }\KeywordTok{lm}\NormalTok{(Artist_Popularity }\OperatorTok{~}\StringTok{ }\NormalTok{fa_}\DecValTok{2} \OperatorTok{+}\StringTok{ }\NormalTok{fa_2sq }\OperatorTok{+}\StringTok{ }\NormalTok{fa_}\DecValTok{3} \OperatorTok{+}\StringTok{ }\NormalTok{fa_}\DecValTok{4} \OperatorTok{+}\StringTok{ }\NormalTok{pc_}\DecValTok{1} \OperatorTok{+}\StringTok{ }\NormalTok{pc_}\DecValTok{2} \OperatorTok{+}\StringTok{ }\NormalTok{pc_2sq }\OperatorTok{+}\StringTok{ }\NormalTok{Artist_Follower }
          \OperatorTok{+}\StringTok{ }\NormalTok{Artist_Followersq }\OperatorTok{+}\StringTok{ }\NormalTok{fa_}\DecValTok{1} \OperatorTok{+}\StringTok{ }\NormalTok{Track_Duration_ms}
          \OperatorTok{+}\StringTok{ }\NormalTok{days_release_orig }\OperatorTok{+}\StringTok{ }\NormalTok{Track_Popularity, }
          \DataTypeTok{data=}\NormalTok{ x_noout)}

\NormalTok{lmb <-}\StringTok{ }\NormalTok{MASS}\OperatorTok{::}\KeywordTok{stepAIC}\NormalTok{(lma)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Start:  AIC=747.24
## Artist_Popularity ~ fa_2 + fa_2sq + fa_3 + fa_4 + pc_1 + pc_2 + 
##     pc_2sq + Artist_Follower + Artist_Followersq + fa_1 + Track_Duration_ms + 
##     days_release_orig + Track_Popularity
## 
##                     Df Sum of Sq     RSS    AIC
## - fa_4               1      6.65  8896.4 745.38
## - fa_1               1     49.76  8939.5 746.28
## <none>                            8889.7 747.24
## - days_release_orig  1    128.61  9018.3 747.92
## - fa_2               1    195.49  9085.2 749.29
## - pc_1               1    271.47  9161.2 750.84
## - fa_2sq             1    355.61  9245.3 752.54
## - Track_Duration_ms  1    536.66  9426.4 756.15
## - fa_3               1    615.81  9505.5 757.70
## - pc_2sq             1    830.66  9720.4 761.86
## - Track_Popularity   1   1166.70 10056.4 768.18
## - Artist_Followersq  1   1363.69 10253.4 771.79
## - pc_2               1   2572.29 11462.0 792.51
## - Artist_Follower    1   2719.78 11609.5 794.89
## 
## Step:  AIC=745.38
## Artist_Popularity ~ fa_2 + fa_2sq + fa_3 + pc_1 + pc_2 + pc_2sq + 
##     Artist_Follower + Artist_Followersq + fa_1 + Track_Duration_ms + 
##     days_release_orig + Track_Popularity
## 
##                     Df Sum of Sq     RSS    AIC
## - fa_1               1     49.18  8945.6 744.41
## <none>                            8896.4 745.38
## - days_release_orig  1    121.96  9018.3 745.92
## - fa_2               1    193.77  9090.1 747.39
## - pc_1               1    295.87  9192.2 749.47
## - fa_2sq             1    349.34  9245.7 750.55
## - Track_Duration_ms  1    530.56  9426.9 754.16
## - fa_3               1    632.49  9528.9 756.16
## - pc_2sq             1    828.02  9724.4 759.94
## - Track_Popularity   1   1183.07 10079.4 766.61
## - Artist_Followersq  1   1358.68 10255.0 769.82
## - pc_2               1   2647.56 11543.9 791.84
## - Artist_Follower    1   2723.31 11619.7 793.06
## 
## Step:  AIC=744.41
## Artist_Popularity ~ fa_2 + fa_2sq + fa_3 + pc_1 + pc_2 + pc_2sq + 
##     Artist_Follower + Artist_Followersq + Track_Duration_ms + 
##     days_release_orig + Track_Popularity
## 
##                     Df Sum of Sq     RSS    AIC
## <none>                            8945.6 744.41
## - days_release_orig  1     109.0  9054.6 744.66
## - fa_2               1     195.2  9140.7 746.42
## - pc_1               1     271.3  9216.8 747.97
## - fa_2sq             1     338.5  9284.1 749.32
## - Track_Duration_ms  1     569.7  9515.2 753.89
## - fa_3               1     697.0  9642.6 756.37
## - pc_2sq             1     930.7  9876.3 760.82
## - Track_Popularity   1    1153.8 10099.4 764.97
## - Artist_Followersq  1    1321.8 10267.4 768.04
## - Artist_Follower    1    2686.6 11632.1 791.26
## - pc_2               1    3190.0 12135.5 799.13
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{summary}\NormalTok{(lmb)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## lm(formula = Artist_Popularity ~ fa_2 + fa_2sq + fa_3 + pc_1 + 
##     pc_2 + pc_2sq + Artist_Follower + Artist_Followersq + Track_Duration_ms + 
##     days_release_orig + Track_Popularity, data = x_noout)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -23.0380  -5.2954   0.3417   4.5413  17.3011 
## 
## Coefficients:
##                     Estimate Std. Error t value Pr(>|t|)    
## (Intercept)        5.987e+01  3.045e+00  19.664  < 2e-16 ***
## fa_2               7.210e+00  3.700e+00   1.948 0.052974 .  
## fa_2sq            -5.659e+00  2.205e+00  -2.566 0.011127 *  
## fa_3               3.769e+00  1.024e+00   3.682 0.000308 ***
## pc_1               9.810e-01  4.271e-01   2.297 0.022806 *  
## pc_2               4.357e+00  5.531e-01   7.877 3.48e-13 ***
## pc_2sq            -1.667e+00  3.918e-01  -4.255 3.41e-05 ***
## Artist_Follower    4.143e+00  5.731e-01   7.229 1.48e-11 ***
## Artist_Followersq -1.614e-01  3.182e-02  -5.071 1.01e-06 ***
## Track_Duration_ms -1.528e-05  4.591e-06  -3.329 0.001065 ** 
## days_release_orig -2.378e-04  1.633e-04  -1.456 0.147127    
## Track_Popularity   1.936e-01  4.086e-02   4.737 4.48e-06 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 7.17 on 174 degrees of freedom
## Multiple R-squared:  0.7897, Adjusted R-squared:  0.7764 
## F-statistic: 59.41 on 11 and 174 DF,  p-value: < 2.2e-16
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Regularization}

\NormalTok{sel.var <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"fa_1"}\NormalTok{, }\StringTok{"fa_2"}\NormalTok{, }\StringTok{"fa_2sq"}\NormalTok{, }\StringTok{"fa_3"}\NormalTok{, }\StringTok{"fa_4"}\NormalTok{, }\StringTok{"pc_1"}\NormalTok{, }\StringTok{"pc_2"}\NormalTok{, }\StringTok{"pc_2sq"}\NormalTok{, }\StringTok{"Artist_Follower"}\NormalTok{, }\StringTok{"Artist_Followersq"}\NormalTok{, }\StringTok{"Artist_Popularity"}\NormalTok{, }\StringTok{"days_release_orig"}\NormalTok{, }\StringTok{"Track_Popularity"}\NormalTok{, }\StringTok{"Track_Duration_ms"}\NormalTok{) }

\NormalTok{df <-}\StringTok{ }\NormalTok{dplyr}\OperatorTok{::}\KeywordTok{select}\NormalTok{(x_noout, sel.var)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Note: Using an external vector in selections is ambiguous.
## i Use `all_of(sel.var)` instead of `sel.var` to silence this message.
## i See <https://tidyselect.r-lib.org/reference/faq-external-vector.html>.
## This message is displayed once per session.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{lmfull <-}\StringTok{ }\KeywordTok{lm}\NormalTok{(Artist_Popularity}\OperatorTok{~}\NormalTok{., }\DataTypeTok{data=}\NormalTok{df)}
\NormalTok{lmback <-}\StringTok{ }\KeywordTok{step}\NormalTok{(lmfull)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Start:  AIC=747.24
## Artist_Popularity ~ fa_1 + fa_2 + fa_2sq + fa_3 + fa_4 + pc_1 + 
##     pc_2 + pc_2sq + Artist_Follower + Artist_Followersq + days_release_orig + 
##     Track_Popularity + Track_Duration_ms
## 
##                     Df Sum of Sq     RSS    AIC
## - fa_4               1      6.65  8896.4 745.38
## - fa_1               1     49.76  8939.5 746.28
## <none>                            8889.7 747.24
## - days_release_orig  1    128.61  9018.3 747.92
## - fa_2               1    195.49  9085.2 749.29
## - pc_1               1    271.47  9161.2 750.84
## - fa_2sq             1    355.61  9245.3 752.54
## - Track_Duration_ms  1    536.66  9426.4 756.15
## - fa_3               1    615.81  9505.5 757.70
## - pc_2sq             1    830.66  9720.4 761.86
## - Track_Popularity   1   1166.70 10056.4 768.18
## - Artist_Followersq  1   1363.69 10253.4 771.79
## - pc_2               1   2572.29 11462.0 792.51
## - Artist_Follower    1   2719.78 11609.5 794.89
## 
## Step:  AIC=745.38
## Artist_Popularity ~ fa_1 + fa_2 + fa_2sq + fa_3 + pc_1 + pc_2 + 
##     pc_2sq + Artist_Follower + Artist_Followersq + days_release_orig + 
##     Track_Popularity + Track_Duration_ms
## 
##                     Df Sum of Sq     RSS    AIC
## - fa_1               1     49.18  8945.6 744.41
## <none>                            8896.4 745.38
## - days_release_orig  1    121.96  9018.3 745.92
## - fa_2               1    193.77  9090.1 747.39
## - pc_1               1    295.87  9192.2 749.47
## - fa_2sq             1    349.34  9245.7 750.55
## - Track_Duration_ms  1    530.56  9426.9 754.16
## - fa_3               1    632.49  9528.9 756.16
## - pc_2sq             1    828.02  9724.4 759.94
## - Track_Popularity   1   1183.07 10079.4 766.61
## - Artist_Followersq  1   1358.68 10255.0 769.82
## - pc_2               1   2647.56 11543.9 791.84
## - Artist_Follower    1   2723.31 11619.7 793.06
## 
## Step:  AIC=744.41
## Artist_Popularity ~ fa_2 + fa_2sq + fa_3 + pc_1 + pc_2 + pc_2sq + 
##     Artist_Follower + Artist_Followersq + days_release_orig + 
##     Track_Popularity + Track_Duration_ms
## 
##                     Df Sum of Sq     RSS    AIC
## <none>                            8945.6 744.41
## - days_release_orig  1     109.0  9054.6 744.66
## - fa_2               1     195.2  9140.7 746.42
## - pc_1               1     271.3  9216.8 747.97
## - fa_2sq             1     338.5  9284.1 749.32
## - Track_Duration_ms  1     569.7  9515.2 753.89
## - fa_3               1     697.0  9642.6 756.37
## - pc_2sq             1     930.7  9876.3 760.82
## - Track_Popularity   1    1153.8 10099.4 764.97
## - Artist_Followersq  1    1321.8 10267.4 768.04
## - Artist_Follower    1    2686.6 11632.1 791.26
## - pc_2               1    3190.0 12135.5 799.13
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(}\StringTok{"glmnet"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Loading required package: Matrix
\end{verbatim}

\begin{verbatim}
## Loaded glmnet 3.0-2
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{xl <-}\StringTok{ }\KeywordTok{as.matrix}\NormalTok{(df[,}\OperatorTok{-}\DecValTok{11}\NormalTok{])}
\NormalTok{yl <-}\StringTok{ }\NormalTok{df[,}\DecValTok{11}\NormalTok{]}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{42}\NormalTok{)}
\NormalTok{lmlasso <-}\StringTok{ }\KeywordTok{cv.glmnet}\NormalTok{(xl, yl, }\DataTypeTok{alpha =}\DecValTok{1}\NormalTok{) }\CommentTok{# cross-validation finds the value of lambda which minimizes MSE, alpha = 1 for LASSO}
\KeywordTok{plot}\NormalTok{(lmlasso) }\CommentTok{# displays the bias-variance trade-off (MSE = variance + bias^2)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-54-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{best.lambda <-}\StringTok{ }\NormalTok{lmlasso}\OperatorTok{$}\NormalTok{lambda.min}
\NormalTok{lmlasso}\OperatorTok{$}\NormalTok{lambda}\FloatTok{.1}\NormalTok{se}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.3361553
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{cl <-}\StringTok{ }\KeywordTok{list}\NormalTok{(}\KeywordTok{coef}\NormalTok{(lmlasso, }\DataTypeTok{s=}\StringTok{"lambda.min"}\NormalTok{)[,}\DecValTok{1}\NormalTok{], }\KeywordTok{coef}\NormalTok{(lmlasso, }\DataTypeTok{s=}\StringTok{"lambda.1se"}\NormalTok{)[,}\DecValTok{1}\NormalTok{], }\KeywordTok{coef}\NormalTok{(lmback), }\KeywordTok{coef}\NormalTok{(lmfull))}
\NormalTok{cf <-}\StringTok{ }\KeywordTok{matrix}\NormalTok{(}\OtherTok{NA}\NormalTok{, }\DataTypeTok{nrow=}\KeywordTok{dim}\NormalTok{(xl)[}\DecValTok{2}\NormalTok{]}\OperatorTok{+}\DecValTok{1}\NormalTok{, }\DataTypeTok{ncol=}\KeywordTok{length}\NormalTok{(cl))}
\KeywordTok{row.names}\NormalTok{(cf) <-}\StringTok{ }\KeywordTok{names}\NormalTok{(lmfull}\OperatorTok{$}\NormalTok{coefficients)}
\NormalTok{i <-}\StringTok{ }\DecValTok{1}
\ControlFlowTok{for}\NormalTok{ (ci }\ControlFlowTok{in}\NormalTok{ cl) \{}
\NormalTok{  cf[}\KeywordTok{names}\NormalTok{(ci),i] <-}\StringTok{ }\NormalTok{ci[}\KeywordTok{names}\NormalTok{(ci)]}
\NormalTok{  i <-}\StringTok{ }\NormalTok{i}\OperatorTok{+}\DecValTok{1}
\NormalTok{\}}
\KeywordTok{colnames}\NormalTok{(cf) <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"min"}\NormalTok{, }\StringTok{"1se"}\NormalTok{, }\StringTok{"back"}\NormalTok{, }\StringTok{"full"}\NormalTok{)}
\NormalTok{cf[cf}\OperatorTok{==}\DecValTok{0}\NormalTok{] <-}\StringTok{ }\OtherTok{NA}
\NormalTok{cf}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##                             min           1se          back          full
## (Intercept)        6.040412e+01  6.114886e+01  5.987096e+01  5.933345e+01
## fa_1              -4.950318e-02            NA            NA -8.893245e-01
## fa_2               5.222430e+00  2.626698e+00  7.209531e+00  7.217918e+00
## fa_2sq            -3.457641e+00 -5.763024e-01 -5.658801e+00 -5.837164e+00
## fa_3               3.323039e+00  2.638256e+00  3.769373e+00  4.505508e+00
## fa_4                         NA            NA            NA  3.733388e-01
## pc_1               8.325534e-01  6.300647e-01  9.809889e-01  1.111732e+00
## pc_2               4.444693e+00  4.581303e+00  4.356624e+00  4.151896e+00
## pc_2sq            -1.666188e+00 -1.671870e+00 -1.667241e+00 -1.600879e+00
## Artist_Follower    3.098932e+00  1.731344e+00  4.143098e+00  4.255461e+00
## Artist_Followersq -1.000969e-01 -2.026752e-02 -1.613611e-01 -1.647535e-01
## days_release_orig -2.334705e-04 -2.257810e-04 -2.377630e-04 -2.659810e-04
## Track_Popularity   1.908254e-01  1.868568e-01  1.935870e-01  1.997832e-01
## Track_Duration_ms -1.648856e-05 -1.812532e-05 -1.528159e-05 -1.495624e-05
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# variable importance}
\NormalTok{glmmod <-}\StringTok{ }\KeywordTok{glmnet}\NormalTok{(xl, yl, }\DataTypeTok{lambda =}\NormalTok{ best.lambda)}
\NormalTok{coefs =}\StringTok{ }\KeywordTok{coef}\NormalTok{(glmmod)[,}\DecValTok{1}\NormalTok{]}
\NormalTok{coefs =}\StringTok{ }\KeywordTok{sort}\NormalTok{(}\KeywordTok{abs}\NormalTok{(coefs), }\DataTypeTok{decreasing =}\NormalTok{ T)}
\NormalTok{coefs}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##       (Intercept)              fa_2              pc_2            fa_2sq 
##      6.041106e+01      5.233869e+00      4.444640e+00      3.461076e+00 
##              fa_3   Artist_Follower            pc_2sq              pc_1 
##      3.325658e+00      3.096916e+00      1.666081e+00      8.321862e-01 
##  Track_Popularity Artist_Followersq              fa_1 days_release_orig 
##      1.907631e-01      9.999550e-02      5.110609e-02      2.337083e-04 
## Track_Duration_ms              fa_4 
##      1.649063e-05      0.000000e+00
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{coef}\NormalTok{(lmlasso, }\DataTypeTok{s=}\StringTok{"lambda.1se"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 14 x 1 sparse Matrix of class "dgCMatrix"
##                               1
## (Intercept)        6.114886e+01
## fa_1               .           
## fa_2               2.626698e+00
## fa_2sq            -5.763024e-01
## fa_3               2.638256e+00
## fa_4               .           
## pc_1               6.300647e-01
## pc_2               4.581303e+00
## pc_2sq            -1.671870e+00
## Artist_Follower    1.731344e+00
## Artist_Followersq -2.026752e-02
## days_release_orig -2.257810e-04
## Track_Popularity   1.868568e-01
## Track_Duration_ms -1.812532e-05
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{######################}
\CommentTok{# Performance metrics - full data}

\NormalTok{performace_metrics <-}\StringTok{ }\KeywordTok{matrix}\NormalTok{(}\DataTypeTok{nrow =} \DecValTok{10}\NormalTok{, }\DataTypeTok{ncol =} \DecValTok{6}\NormalTok{)}

\KeywordTok{RMSE}\NormalTok{(}\KeywordTok{predict}\NormalTok{(lmfull, }\DataTypeTok{newdata =}\NormalTok{ df), df}\OperatorTok{$}\NormalTok{Artist_Popularity)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 6.913336
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{R2}\NormalTok{(}\KeywordTok{predict}\NormalTok{(lmfull, }\DataTypeTok{newdata =}\NormalTok{ df), df}\OperatorTok{$}\NormalTok{Artist_Popularity)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.7910356
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{performace_metrics[}\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{] <-}\StringTok{ }\KeywordTok{RMSE}\NormalTok{(}\KeywordTok{predict}\NormalTok{(lmfull, }\DataTypeTok{newdata =}\NormalTok{ df), df}\OperatorTok{$}\NormalTok{Artist_Popularity)}
\NormalTok{performace_metrics[}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{] <-}\StringTok{ }\KeywordTok{R2}\NormalTok{(}\KeywordTok{predict}\NormalTok{(lmfull, }\DataTypeTok{newdata =}\NormalTok{ df), df}\OperatorTok{$}\NormalTok{Artist_Popularity)}


\CommentTok{# x_model <- model.matrix(Artist_Popularity~., x_noout)}

\KeywordTok{library}\NormalTok{(}\StringTok{"glmnet"}\NormalTok{)}
\StringTok{"Ridge regression"}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Ridge regression"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{42}\NormalTok{)}
\NormalTok{best.lambda <-}\StringTok{ }\KeywordTok{cv.glmnet}\NormalTok{(}\DataTypeTok{x =} \KeywordTok{as.matrix}\NormalTok{(df[,}\OperatorTok{-}\DecValTok{11}\NormalTok{]), }\DataTypeTok{y =} \KeywordTok{as.matrix}\NormalTok{(df[,}\DecValTok{11}\NormalTok{]), }\DataTypeTok{alpha =} \DecValTok{0}\NormalTok{)}\OperatorTok{$}\NormalTok{lambda.min}
\NormalTok{ridge.cv <-}\StringTok{ }\KeywordTok{glmnet}\NormalTok{(}\DataTypeTok{x =} \KeywordTok{as.matrix}\NormalTok{(df[,}\OperatorTok{-}\DecValTok{11}\NormalTok{]), }\DataTypeTok{y =} \KeywordTok{as.matrix}\NormalTok{(df[,}\DecValTok{11}\NormalTok{]), }\DataTypeTok{alpha =} \DecValTok{0}\NormalTok{, }\DataTypeTok{lambda =}\NormalTok{ best.lambda)}
\CommentTok{# as.numeric(coef(ridge.cv)[,1]) %*% as.numeric(x_model[1,]) equivalent}
\CommentTok{# predict(ridge.cv, newx = as.matrix(x_noout[1,-8])) equivalent}
\KeywordTok{RMSE}\NormalTok{(}\KeywordTok{predict}\NormalTok{(ridge.cv, }\DataTypeTok{newx =} \KeywordTok{as.matrix}\NormalTok{(df[,}\OperatorTok{-}\DecValTok{11}\NormalTok{])), }\KeywordTok{as.matrix}\NormalTok{(df[,}\DecValTok{11}\NormalTok{]))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 7.239088
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{R2}\NormalTok{(}\KeywordTok{predict}\NormalTok{(ridge.cv, }\DataTypeTok{newx =} \KeywordTok{as.matrix}\NormalTok{(df[,}\OperatorTok{-}\DecValTok{11}\NormalTok{])), }\KeywordTok{as.matrix}\NormalTok{(df[,}\DecValTok{11}\NormalTok{]))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##             s0
## [1,] 0.7724354
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{performace_metrics[}\DecValTok{2}\NormalTok{,}\DecValTok{1}\NormalTok{] <-}\StringTok{ }\KeywordTok{RMSE}\NormalTok{(}\KeywordTok{predict}\NormalTok{(ridge.cv, }\DataTypeTok{newx =} \KeywordTok{as.matrix}\NormalTok{(df[,}\OperatorTok{-}\DecValTok{11}\NormalTok{])), }\KeywordTok{as.matrix}\NormalTok{(df[,}\DecValTok{11}\NormalTok{]))}
\NormalTok{performace_metrics[}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{] <-}\StringTok{ }\KeywordTok{R2}\NormalTok{(}\KeywordTok{predict}\NormalTok{(ridge.cv, }\DataTypeTok{newx =} \KeywordTok{as.matrix}\NormalTok{(df[,}\OperatorTok{-}\DecValTok{11}\NormalTok{])), }\KeywordTok{as.matrix}\NormalTok{(df[,}\DecValTok{11}\NormalTok{]))}

\StringTok{"LASSO regression"}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "LASSO regression"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{42}\NormalTok{)}
\NormalTok{best.lambda <-}\StringTok{ }\KeywordTok{cv.glmnet}\NormalTok{(}\DataTypeTok{x =} \KeywordTok{as.matrix}\NormalTok{(df[,}\OperatorTok{-}\DecValTok{11}\NormalTok{]), }\DataTypeTok{y =} \KeywordTok{as.matrix}\NormalTok{(df[,}\DecValTok{11}\NormalTok{]), }\DataTypeTok{alpha =} \DecValTok{1}\NormalTok{)}\OperatorTok{$}\NormalTok{lambda.min}
\NormalTok{lasso.cv <-}\StringTok{ }\KeywordTok{glmnet}\NormalTok{(}\DataTypeTok{x =} \KeywordTok{as.matrix}\NormalTok{(df[,}\OperatorTok{-}\DecValTok{11}\NormalTok{]), }\DataTypeTok{y =} \KeywordTok{as.matrix}\NormalTok{(df[,}\DecValTok{11}\NormalTok{]), }\DataTypeTok{alpha =} \DecValTok{1}\NormalTok{, }\DataTypeTok{lambda =}\NormalTok{ best.lambda)}
\KeywordTok{RMSE}\NormalTok{(}\KeywordTok{predict}\NormalTok{(lasso.cv, }\DataTypeTok{newx =} \KeywordTok{as.matrix}\NormalTok{(df[,}\OperatorTok{-}\DecValTok{11}\NormalTok{])), }\KeywordTok{as.matrix}\NormalTok{(df[,}\DecValTok{11}\NormalTok{]))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 7.029595
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{R2}\NormalTok{(}\KeywordTok{predict}\NormalTok{(lasso.cv, }\DataTypeTok{newx =} \KeywordTok{as.matrix}\NormalTok{(df[,}\OperatorTok{-}\DecValTok{11}\NormalTok{])), }\KeywordTok{as.matrix}\NormalTok{(df[,}\DecValTok{11}\NormalTok{]))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##             s0
## [1,] 0.7847568
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{performace_metrics[}\DecValTok{3}\NormalTok{,}\DecValTok{1}\NormalTok{] <-}\StringTok{ }\KeywordTok{RMSE}\NormalTok{(}\KeywordTok{predict}\NormalTok{(lasso.cv, }\DataTypeTok{newx =} \KeywordTok{as.matrix}\NormalTok{(df[,}\OperatorTok{-}\DecValTok{11}\NormalTok{])), }\KeywordTok{as.matrix}\NormalTok{(df[,}\DecValTok{11}\NormalTok{]))}
\NormalTok{performace_metrics[}\DecValTok{3}\NormalTok{,}\DecValTok{2}\NormalTok{] <-}\StringTok{ }\KeywordTok{R2}\NormalTok{(}\KeywordTok{predict}\NormalTok{(lasso.cv, }\DataTypeTok{newx =} \KeywordTok{as.matrix}\NormalTok{(df[,}\OperatorTok{-}\DecValTok{11}\NormalTok{])), }\KeywordTok{as.matrix}\NormalTok{(df[,}\DecValTok{11}\NormalTok{]))}

\StringTok{"Elasticnet regression"}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Elasticnet regression"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{42}\NormalTok{)}
\NormalTok{best.lambda <-}\StringTok{ }\KeywordTok{cv.glmnet}\NormalTok{(}\DataTypeTok{x =} \KeywordTok{as.matrix}\NormalTok{(df[,}\OperatorTok{-}\DecValTok{11}\NormalTok{]), }\DataTypeTok{y =} \KeywordTok{as.matrix}\NormalTok{(df[,}\DecValTok{11}\NormalTok{]), }\DataTypeTok{alpha =} \FloatTok{0.5}\NormalTok{)}\OperatorTok{$}\NormalTok{lambda.min}
\NormalTok{elasticnet.cv <-}\StringTok{ }\KeywordTok{glmnet}\NormalTok{(}\DataTypeTok{x =} \KeywordTok{as.matrix}\NormalTok{(df[,}\OperatorTok{-}\DecValTok{11}\NormalTok{]), }\DataTypeTok{y =} \KeywordTok{as.matrix}\NormalTok{(df[,}\DecValTok{11}\NormalTok{]), }\DataTypeTok{alpha =} \FloatTok{0.5}\NormalTok{, }\DataTypeTok{lambda =}\NormalTok{ best.lambda)}
\KeywordTok{RMSE}\NormalTok{(}\KeywordTok{predict}\NormalTok{(elasticnet.cv, }\DataTypeTok{newx =} \KeywordTok{as.matrix}\NormalTok{(df[,}\OperatorTok{-}\DecValTok{11}\NormalTok{])), }\KeywordTok{as.matrix}\NormalTok{(df[,}\DecValTok{11}\NormalTok{]))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 7.043502
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{R2}\NormalTok{(}\KeywordTok{predict}\NormalTok{(elasticnet.cv, }\DataTypeTok{newx =} \KeywordTok{as.matrix}\NormalTok{(df[,}\OperatorTok{-}\DecValTok{11}\NormalTok{])), }\KeywordTok{as.matrix}\NormalTok{(df[,}\DecValTok{11}\NormalTok{]))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##             s0
## [1,] 0.7839069
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{performace_metrics[}\DecValTok{4}\NormalTok{,}\DecValTok{1}\NormalTok{] <-}\StringTok{ }\KeywordTok{RMSE}\NormalTok{(}\KeywordTok{predict}\NormalTok{(elasticnet.cv, }\DataTypeTok{newx =} \KeywordTok{as.matrix}\NormalTok{(df[,}\OperatorTok{-}\DecValTok{11}\NormalTok{])), }\KeywordTok{as.matrix}\NormalTok{(df[,}\DecValTok{11}\NormalTok{]))}
\NormalTok{performace_metrics[}\DecValTok{4}\NormalTok{,}\DecValTok{2}\NormalTok{] <-}\StringTok{ }\KeywordTok{R2}\NormalTok{(}\KeywordTok{predict}\NormalTok{(elasticnet.cv, }\DataTypeTok{newx =} \KeywordTok{as.matrix}\NormalTok{(df[,}\OperatorTok{-}\DecValTok{11}\NormalTok{])), }\KeywordTok{as.matrix}\NormalTok{(df[,}\DecValTok{11}\NormalTok{]))}

\NormalTok{x_full <-}\StringTok{ }\KeywordTok{model.matrix}\NormalTok{(Artist_Popularity}\OperatorTok{~}\NormalTok{., df)[,}\OperatorTok{-}\DecValTok{1}\NormalTok{]}

\NormalTok{ridge_res2 <-}\StringTok{ }\KeywordTok{as.numeric}\NormalTok{(df}\OperatorTok{$}\NormalTok{Artist_Popularity }\OperatorTok{-}\StringTok{ }\KeywordTok{predict}\NormalTok{(ridge.cv, x_full))}\OperatorTok{^}\DecValTok{2}
\NormalTok{lasso_res2 <-}\StringTok{ }\KeywordTok{as.numeric}\NormalTok{(df}\OperatorTok{$}\NormalTok{Artist_Popularity }\OperatorTok{-}\StringTok{ }\KeywordTok{predict}\NormalTok{(lasso.cv, x_full))}\OperatorTok{^}\DecValTok{2}
\NormalTok{elasticnet_res2 <-}\StringTok{ }\KeywordTok{as.numeric}\NormalTok{(df}\OperatorTok{$}\NormalTok{Artist_Popularity }\OperatorTok{-}\StringTok{ }\KeywordTok{predict}\NormalTok{(elasticnet.cv, x_full))}\OperatorTok{^}\DecValTok{2}

\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfcol=}\KeywordTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{))}
\KeywordTok{barplot}\NormalTok{((df}\OperatorTok{$}\NormalTok{Artist_Popularity }\OperatorTok{-}\StringTok{ }\KeywordTok{predict}\NormalTok{(lmfull, df))}\OperatorTok{^}\DecValTok{2}\NormalTok{)}
\KeywordTok{Axis}\NormalTok{(}\DataTypeTok{side=}\DecValTok{2}\NormalTok{)}
\KeywordTok{title}\NormalTok{(}\DataTypeTok{main =} \KeywordTok{paste}\NormalTok{(}\StringTok{"LM (full sample): RMSE ="}\NormalTok{,}\KeywordTok{round}\NormalTok{(}\KeywordTok{RMSE}\NormalTok{(}\KeywordTok{predict}\NormalTok{(lmfull, df), df}\OperatorTok{$}\NormalTok{Artist_Popularity), }\DataTypeTok{digits =} \DecValTok{2}\NormalTok{), }\StringTok{", R^2:"}\NormalTok{, }\KeywordTok{round}\NormalTok{(}\KeywordTok{R2}\NormalTok{(}\KeywordTok{predict}\NormalTok{(lmfull, df), df}\OperatorTok{$}\NormalTok{Artist_Popularity), }\DataTypeTok{digits =} \DecValTok{2}\NormalTok{)))}
\KeywordTok{barplot}\NormalTok{(ridge_res2, }\DataTypeTok{main =} \KeywordTok{paste}\NormalTok{(}\StringTok{"Ridge (full sample): RMSE ="}\NormalTok{,}\KeywordTok{round}\NormalTok{(}\KeywordTok{RMSE}\NormalTok{(}\KeywordTok{predict}\NormalTok{(ridge.cv, x_full), df}\OperatorTok{$}\NormalTok{Artist_Popularity), }\DataTypeTok{digits =} \DecValTok{2}\NormalTok{), }\StringTok{", R^2:"}\NormalTok{, }\KeywordTok{round}\NormalTok{(}\KeywordTok{R2}\NormalTok{(}\KeywordTok{predict}\NormalTok{(ridge.cv, x_full), df}\OperatorTok{$}\NormalTok{Artist_Popularity), }\DataTypeTok{digits =} \DecValTok{2}\NormalTok{)))}
\KeywordTok{barplot}\NormalTok{(lasso_res2, }\DataTypeTok{main =} \KeywordTok{paste}\NormalTok{(}\StringTok{"LASSO (full sample): RMSE ="}\NormalTok{,}\KeywordTok{round}\NormalTok{(}\KeywordTok{RMSE}\NormalTok{(}\KeywordTok{predict}\NormalTok{(lasso.cv, x_full), df}\OperatorTok{$}\NormalTok{Artist_Popularity), }\DataTypeTok{digits =} \DecValTok{2}\NormalTok{), }\StringTok{", R^2:"}\NormalTok{, }\KeywordTok{round}\NormalTok{(}\KeywordTok{R2}\NormalTok{(}\KeywordTok{predict}\NormalTok{(lasso.cv, x_full), df}\OperatorTok{$}\NormalTok{Artist_Popularity), }\DataTypeTok{digits =} \DecValTok{2}\NormalTok{)))}
\KeywordTok{barplot}\NormalTok{(elasticnet_res2, }\DataTypeTok{main =} \KeywordTok{paste}\NormalTok{(}\StringTok{"Elasticnet (full sample): RMSE ="}\NormalTok{,}\KeywordTok{round}\NormalTok{(}\KeywordTok{RMSE}\NormalTok{(}\KeywordTok{predict}\NormalTok{(elasticnet.cv, x_full), df}\OperatorTok{$}\NormalTok{Artist_Popularity), }\DataTypeTok{digits =} \DecValTok{2}\NormalTok{), }\StringTok{", R^2:"}\NormalTok{, }\KeywordTok{round}\NormalTok{(}\KeywordTok{R2}\NormalTok{(}\KeywordTok{predict}\NormalTok{(elasticnet.cv, x_full), df}\OperatorTok{$}\NormalTok{Artist_Popularity), }\DataTypeTok{digits =} \DecValTok{2}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-55-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(}\StringTok{"caret"}\NormalTok{)}

\CommentTok{# Splitting in train and test data}

\KeywordTok{set.seed}\NormalTok{(}\DecValTok{42}\NormalTok{)}
\NormalTok{idx.train <-}\StringTok{ }\KeywordTok{createDataPartition}\NormalTok{(}\DataTypeTok{y =}\NormalTok{ df}\OperatorTok{$}\NormalTok{Artist_Popularity, }\DataTypeTok{p =} \FloatTok{0.75}\NormalTok{, }\DataTypeTok{list =} \OtherTok{FALSE}\NormalTok{)}
\NormalTok{train <-}\StringTok{ }\NormalTok{df[idx.train, ]}
\NormalTok{test <-}\StringTok{ }\NormalTok{df[}\OperatorTok{-}\NormalTok{idx.train,]}

\NormalTok{lm_train <-}\StringTok{ }\KeywordTok{lm}\NormalTok{(Artist_Popularity}\OperatorTok{~}\NormalTok{., }\DataTypeTok{data=}\NormalTok{train)}
\KeywordTok{RMSE}\NormalTok{(}\KeywordTok{predict}\NormalTok{(lm_train, }\DataTypeTok{newdata =}\NormalTok{ train), train}\OperatorTok{$}\NormalTok{Artist_Popularity)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 6.835059
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{R2}\NormalTok{(}\KeywordTok{predict}\NormalTok{(lm_train, }\DataTypeTok{newdata =}\NormalTok{ train), train}\OperatorTok{$}\NormalTok{Artist_Popularity)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.7999369
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{performace_metrics[}\DecValTok{1}\NormalTok{,}\DecValTok{3}\NormalTok{] <-}\StringTok{ }\KeywordTok{RMSE}\NormalTok{(}\KeywordTok{predict}\NormalTok{(lm_train, }\DataTypeTok{newdata =}\NormalTok{ train), train}\OperatorTok{$}\NormalTok{Artist_Popularity)}
\NormalTok{performace_metrics[}\DecValTok{1}\NormalTok{,}\DecValTok{4}\NormalTok{] <-}\StringTok{ }\KeywordTok{R2}\NormalTok{(}\KeywordTok{predict}\NormalTok{(lm_train, }\DataTypeTok{newdata =}\NormalTok{ train), train}\OperatorTok{$}\NormalTok{Artist_Popularity)}

\KeywordTok{RMSE}\NormalTok{(}\KeywordTok{predict}\NormalTok{(lm_train, }\DataTypeTok{newdata =}\NormalTok{ test), test}\OperatorTok{$}\NormalTok{Artist_Popularity)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 9.279663
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{R2}\NormalTok{(}\KeywordTok{predict}\NormalTok{(lm_train, }\DataTypeTok{newdata =}\NormalTok{ test), test}\OperatorTok{$}\NormalTok{Artist_Popularity)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.6328343
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{performace_metrics[}\DecValTok{1}\NormalTok{,}\DecValTok{5}\NormalTok{] <-}\StringTok{ }\KeywordTok{RMSE}\NormalTok{(}\KeywordTok{predict}\NormalTok{(lm_train, }\DataTypeTok{newdata =}\NormalTok{ test), test}\OperatorTok{$}\NormalTok{Artist_Popularity)}
\NormalTok{performace_metrics[}\DecValTok{1}\NormalTok{,}\DecValTok{6}\NormalTok{] <-}\StringTok{ }\KeywordTok{R2}\NormalTok{(}\KeywordTok{predict}\NormalTok{(lm_train, }\DataTypeTok{newdata =}\NormalTok{ test), test}\OperatorTok{$}\NormalTok{Artist_Popularity)}

\StringTok{"Ridge regression"}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Ridge regression"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{42}\NormalTok{)}
\NormalTok{best.lambda <-}\StringTok{ }\KeywordTok{cv.glmnet}\NormalTok{(}\DataTypeTok{x =} \KeywordTok{as.matrix}\NormalTok{(train[,}\OperatorTok{-}\DecValTok{11}\NormalTok{]), }\DataTypeTok{y =} \KeywordTok{as.matrix}\NormalTok{(train[,}\DecValTok{11}\NormalTok{]), }\DataTypeTok{alpha =} \DecValTok{0}\NormalTok{)}\OperatorTok{$}\NormalTok{lambda.min}
\NormalTok{ridge.cv <-}\StringTok{ }\KeywordTok{glmnet}\NormalTok{(}\DataTypeTok{x =} \KeywordTok{as.matrix}\NormalTok{(train[,}\OperatorTok{-}\DecValTok{11}\NormalTok{]), }\DataTypeTok{y =} \KeywordTok{as.matrix}\NormalTok{(train[,}\DecValTok{11}\NormalTok{]), }\DataTypeTok{alpha =} \DecValTok{0}\NormalTok{, }\DataTypeTok{lambda =}\NormalTok{ best.lambda)}
\CommentTok{# as.numeric(coef(ridge.cv)[,1]) %*% as.numeric(x_model[1,]) equivalent}
\CommentTok{# predict(ridge.cv, newx = as.matrix(x_noout[1,-8])) equivalent}
\KeywordTok{RMSE}\NormalTok{(}\KeywordTok{predict}\NormalTok{(ridge.cv, }\DataTypeTok{newx =} \KeywordTok{as.matrix}\NormalTok{(train[,}\OperatorTok{-}\DecValTok{11}\NormalTok{])), }\KeywordTok{as.matrix}\NormalTok{(train[,}\DecValTok{11}\NormalTok{]))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 7.209575
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{R2}\NormalTok{(}\KeywordTok{predict}\NormalTok{(ridge.cv, }\DataTypeTok{newx =} \KeywordTok{as.matrix}\NormalTok{(train[,}\OperatorTok{-}\DecValTok{11}\NormalTok{])), }\KeywordTok{as.matrix}\NormalTok{(train[,}\DecValTok{11}\NormalTok{]))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##             s0
## [1,] 0.7787364
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{performace_metrics[}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{] <-}\StringTok{ }\KeywordTok{RMSE}\NormalTok{(}\KeywordTok{predict}\NormalTok{(ridge.cv, }\DataTypeTok{newx =} \KeywordTok{as.matrix}\NormalTok{(train[,}\OperatorTok{-}\DecValTok{11}\NormalTok{])), }\KeywordTok{as.matrix}\NormalTok{(train[,}\DecValTok{11}\NormalTok{]))}
\NormalTok{performace_metrics[}\DecValTok{2}\NormalTok{,}\DecValTok{4}\NormalTok{] <-}\StringTok{ }\KeywordTok{R2}\NormalTok{(}\KeywordTok{predict}\NormalTok{(ridge.cv, }\DataTypeTok{newx =} \KeywordTok{as.matrix}\NormalTok{(train[,}\OperatorTok{-}\DecValTok{11}\NormalTok{])), }\KeywordTok{as.matrix}\NormalTok{(train[,}\DecValTok{11}\NormalTok{]))}

\KeywordTok{RMSE}\NormalTok{(}\KeywordTok{predict}\NormalTok{(ridge.cv, }\DataTypeTok{newx =} \KeywordTok{as.matrix}\NormalTok{(test[,}\OperatorTok{-}\DecValTok{11}\NormalTok{])), }\KeywordTok{as.matrix}\NormalTok{(test[,}\DecValTok{11}\NormalTok{]))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 8.186115
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{R2}\NormalTok{(}\KeywordTok{predict}\NormalTok{(ridge.cv, }\DataTypeTok{newx =} \KeywordTok{as.matrix}\NormalTok{(test[,}\OperatorTok{-}\DecValTok{11}\NormalTok{])), }\KeywordTok{as.matrix}\NormalTok{(test[,}\DecValTok{11}\NormalTok{]))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##             s0
## [1,] 0.7030654
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{performace_metrics[}\DecValTok{2}\NormalTok{,}\DecValTok{5}\NormalTok{] <-}\StringTok{ }\KeywordTok{RMSE}\NormalTok{(}\KeywordTok{predict}\NormalTok{(ridge.cv, }\DataTypeTok{newx =} \KeywordTok{as.matrix}\NormalTok{(test[,}\OperatorTok{-}\DecValTok{11}\NormalTok{])), }\KeywordTok{as.matrix}\NormalTok{(test[,}\DecValTok{11}\NormalTok{])) }
\NormalTok{performace_metrics[}\DecValTok{2}\NormalTok{,}\DecValTok{6}\NormalTok{] <-}\StringTok{ }\KeywordTok{R2}\NormalTok{(}\KeywordTok{predict}\NormalTok{(ridge.cv, }\DataTypeTok{newx =} \KeywordTok{as.matrix}\NormalTok{(test[,}\OperatorTok{-}\DecValTok{11}\NormalTok{])), }\KeywordTok{as.matrix}\NormalTok{(test[,}\DecValTok{11}\NormalTok{]))}


\StringTok{"LASSO regression"}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "LASSO regression"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{42}\NormalTok{)}
\NormalTok{best.lambda <-}\StringTok{ }\KeywordTok{cv.glmnet}\NormalTok{(}\DataTypeTok{x =} \KeywordTok{as.matrix}\NormalTok{(train[,}\OperatorTok{-}\DecValTok{11}\NormalTok{]), }\DataTypeTok{y =} \KeywordTok{as.matrix}\NormalTok{(train[,}\DecValTok{11}\NormalTok{]), }\DataTypeTok{alpha =} \DecValTok{1}\NormalTok{)}\OperatorTok{$}\NormalTok{lambda.min}
\NormalTok{lasso.cv <-}\StringTok{ }\KeywordTok{glmnet}\NormalTok{(}\DataTypeTok{x =} \KeywordTok{as.matrix}\NormalTok{(train[,}\OperatorTok{-}\DecValTok{11}\NormalTok{]), }\DataTypeTok{y =} \KeywordTok{as.matrix}\NormalTok{(train[,}\DecValTok{11}\NormalTok{]), }\DataTypeTok{alpha =} \DecValTok{1}\NormalTok{, }\DataTypeTok{lambda =}\NormalTok{ best.lambda)}
\KeywordTok{RMSE}\NormalTok{(}\KeywordTok{predict}\NormalTok{(lasso.cv, }\DataTypeTok{newx =} \KeywordTok{as.matrix}\NormalTok{(train[,}\OperatorTok{-}\DecValTok{11}\NormalTok{])), }\KeywordTok{as.matrix}\NormalTok{(train[,}\DecValTok{11}\NormalTok{]))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 6.940459
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{R2}\NormalTok{(}\KeywordTok{predict}\NormalTok{(lasso.cv, }\DataTypeTok{newx =} \KeywordTok{as.matrix}\NormalTok{(train[,}\OperatorTok{-}\DecValTok{11}\NormalTok{])), }\KeywordTok{as.matrix}\NormalTok{(train[,}\DecValTok{11}\NormalTok{]))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##             s0
## [1,] 0.7944228
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{performace_metrics[}\DecValTok{3}\NormalTok{,}\DecValTok{3}\NormalTok{] <-}\StringTok{ }\KeywordTok{RMSE}\NormalTok{(}\KeywordTok{predict}\NormalTok{(lasso.cv, }\DataTypeTok{newx =} \KeywordTok{as.matrix}\NormalTok{(train[,}\OperatorTok{-}\DecValTok{11}\NormalTok{])), }\KeywordTok{as.matrix}\NormalTok{(train[,}\DecValTok{11}\NormalTok{]))}
\NormalTok{performace_metrics[}\DecValTok{3}\NormalTok{,}\DecValTok{4}\NormalTok{] <-}\StringTok{ }\KeywordTok{R2}\NormalTok{(}\KeywordTok{predict}\NormalTok{(lasso.cv, }\DataTypeTok{newx =} \KeywordTok{as.matrix}\NormalTok{(train[,}\OperatorTok{-}\DecValTok{11}\NormalTok{])), }\KeywordTok{as.matrix}\NormalTok{(train[,}\DecValTok{11}\NormalTok{]))}

\KeywordTok{RMSE}\NormalTok{(}\KeywordTok{predict}\NormalTok{(lasso.cv, }\DataTypeTok{newx =} \KeywordTok{as.matrix}\NormalTok{(test[,}\OperatorTok{-}\DecValTok{11}\NormalTok{])), }\KeywordTok{as.matrix}\NormalTok{(test[,}\DecValTok{11}\NormalTok{]))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 7.695779
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{R2}\NormalTok{(}\KeywordTok{predict}\NormalTok{(lasso.cv, }\DataTypeTok{newx =} \KeywordTok{as.matrix}\NormalTok{(test[,}\OperatorTok{-}\DecValTok{11}\NormalTok{])), }\KeywordTok{as.matrix}\NormalTok{(test[,}\DecValTok{11}\NormalTok{]))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##             s0
## [1,] 0.7335293
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{performace_metrics[}\DecValTok{3}\NormalTok{,}\DecValTok{5}\NormalTok{] <-}\StringTok{ }\KeywordTok{RMSE}\NormalTok{(}\KeywordTok{predict}\NormalTok{(lasso.cv, }\DataTypeTok{newx =} \KeywordTok{as.matrix}\NormalTok{(test[,}\OperatorTok{-}\DecValTok{11}\NormalTok{])), }\KeywordTok{as.matrix}\NormalTok{(test[,}\DecValTok{11}\NormalTok{]))}
\NormalTok{performace_metrics[}\DecValTok{3}\NormalTok{,}\DecValTok{6}\NormalTok{] <-}\StringTok{ }\KeywordTok{R2}\NormalTok{(}\KeywordTok{predict}\NormalTok{(lasso.cv, }\DataTypeTok{newx =} \KeywordTok{as.matrix}\NormalTok{(test[,}\OperatorTok{-}\DecValTok{11}\NormalTok{])), }\KeywordTok{as.matrix}\NormalTok{(test[,}\DecValTok{11}\NormalTok{]))}
  
\StringTok{"Elasticnet regression"}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Elasticnet regression"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{42}\NormalTok{)}
\NormalTok{best.lambda <-}\StringTok{ }\KeywordTok{cv.glmnet}\NormalTok{(}\DataTypeTok{x =} \KeywordTok{as.matrix}\NormalTok{(train[,}\OperatorTok{-}\DecValTok{11}\NormalTok{]), }\DataTypeTok{y =} \KeywordTok{as.matrix}\NormalTok{(train[,}\DecValTok{11}\NormalTok{]), }\DataTypeTok{alpha =} \FloatTok{0.5}\NormalTok{)}\OperatorTok{$}\NormalTok{lambda.min}
\NormalTok{elasticnet.cv <-}\StringTok{ }\KeywordTok{glmnet}\NormalTok{(}\DataTypeTok{x =} \KeywordTok{as.matrix}\NormalTok{(train[,}\OperatorTok{-}\DecValTok{11}\NormalTok{]), }\DataTypeTok{y =} \KeywordTok{as.matrix}\NormalTok{(train[,}\DecValTok{11}\NormalTok{]), }\DataTypeTok{alpha =} \FloatTok{0.5}\NormalTok{, }\DataTypeTok{lambda =}\NormalTok{ best.lambda)}
\KeywordTok{RMSE}\NormalTok{(}\KeywordTok{predict}\NormalTok{(elasticnet.cv, }\DataTypeTok{newx =} \KeywordTok{as.matrix}\NormalTok{(train[,}\OperatorTok{-}\DecValTok{11}\NormalTok{])), }\KeywordTok{as.matrix}\NormalTok{(train[,}\DecValTok{11}\NormalTok{]))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 6.935805
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{R2}\NormalTok{(}\KeywordTok{predict}\NormalTok{(elasticnet.cv, }\DataTypeTok{newx =} \KeywordTok{as.matrix}\NormalTok{(train[,}\OperatorTok{-}\DecValTok{11}\NormalTok{])), }\KeywordTok{as.matrix}\NormalTok{(train[,}\DecValTok{11}\NormalTok{]))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##             s0
## [1,] 0.7945423
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{performace_metrics[}\DecValTok{4}\NormalTok{,}\DecValTok{3}\NormalTok{] <-}\StringTok{ }\KeywordTok{RMSE}\NormalTok{(}\KeywordTok{predict}\NormalTok{(elasticnet.cv, }\DataTypeTok{newx =} \KeywordTok{as.matrix}\NormalTok{(train[,}\OperatorTok{-}\DecValTok{11}\NormalTok{])), }\KeywordTok{as.matrix}\NormalTok{(train[,}\DecValTok{11}\NormalTok{]))}
\NormalTok{performace_metrics[}\DecValTok{4}\NormalTok{,}\DecValTok{4}\NormalTok{] <-}\StringTok{ }\KeywordTok{R2}\NormalTok{(}\KeywordTok{predict}\NormalTok{(elasticnet.cv, }\DataTypeTok{newx =} \KeywordTok{as.matrix}\NormalTok{(train[,}\OperatorTok{-}\DecValTok{11}\NormalTok{])), }\KeywordTok{as.matrix}\NormalTok{(train[,}\DecValTok{11}\NormalTok{]))}

\KeywordTok{RMSE}\NormalTok{(}\KeywordTok{predict}\NormalTok{(elasticnet.cv, }\DataTypeTok{newx =} \KeywordTok{as.matrix}\NormalTok{(test[,}\OperatorTok{-}\DecValTok{11}\NormalTok{])), }\KeywordTok{as.matrix}\NormalTok{(test[,}\DecValTok{11}\NormalTok{]))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 8.055396
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{R2}\NormalTok{(}\KeywordTok{predict}\NormalTok{(elasticnet.cv, }\DataTypeTok{newx =} \KeywordTok{as.matrix}\NormalTok{(test[,}\OperatorTok{-}\DecValTok{11}\NormalTok{])), }\KeywordTok{as.matrix}\NormalTok{(test[,}\DecValTok{11}\NormalTok{]))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##             s0
## [1,] 0.7106164
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{performace_metrics[}\DecValTok{4}\NormalTok{,}\DecValTok{5}\NormalTok{] <-}\StringTok{ }\KeywordTok{RMSE}\NormalTok{(}\KeywordTok{predict}\NormalTok{(elasticnet.cv, }\DataTypeTok{newx =} \KeywordTok{as.matrix}\NormalTok{(test[,}\OperatorTok{-}\DecValTok{11}\NormalTok{])), }\KeywordTok{as.matrix}\NormalTok{(test[,}\DecValTok{11}\NormalTok{]))}
\NormalTok{performace_metrics[}\DecValTok{4}\NormalTok{,}\DecValTok{6}\NormalTok{] <-}\StringTok{ }\KeywordTok{R2}\NormalTok{(}\KeywordTok{predict}\NormalTok{(elasticnet.cv, }\DataTypeTok{newx =} \KeywordTok{as.matrix}\NormalTok{(test[,}\OperatorTok{-}\DecValTok{11}\NormalTok{])), }\KeywordTok{as.matrix}\NormalTok{(test[,}\DecValTok{11}\NormalTok{]))}
  
\CommentTok{# Graphics}

\CommentTok{# Training data}

\NormalTok{x_train <-}\StringTok{ }\KeywordTok{model.matrix}\NormalTok{(Artist_Popularity}\OperatorTok{~}\NormalTok{., train)[,}\OperatorTok{-}\DecValTok{1}\NormalTok{]}

\NormalTok{ridge_res2 <-}\StringTok{ }\KeywordTok{as.numeric}\NormalTok{(train}\OperatorTok{$}\NormalTok{Artist_Popularity }\OperatorTok{-}\StringTok{ }\KeywordTok{predict}\NormalTok{(ridge.cv, x_train))}\OperatorTok{^}\DecValTok{2}
\NormalTok{lasso_res2 <-}\StringTok{ }\KeywordTok{as.numeric}\NormalTok{(train}\OperatorTok{$}\NormalTok{Artist_Popularity }\OperatorTok{-}\StringTok{ }\KeywordTok{predict}\NormalTok{(lasso.cv, x_train))}\OperatorTok{^}\DecValTok{2}
\NormalTok{elasticnet_res2 <-}\StringTok{ }\KeywordTok{as.numeric}\NormalTok{(train}\OperatorTok{$}\NormalTok{Artist_Popularity }\OperatorTok{-}\StringTok{ }\KeywordTok{predict}\NormalTok{(elasticnet.cv, x_train))}\OperatorTok{^}\DecValTok{2}

\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfcol=}\KeywordTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{))}
\KeywordTok{barplot}\NormalTok{((train}\OperatorTok{$}\NormalTok{Artist_Popularity }\OperatorTok{-}\StringTok{ }\KeywordTok{predict}\NormalTok{(lm_train, train))}\OperatorTok{^}\DecValTok{2}\NormalTok{, }\DataTypeTok{main =} \KeywordTok{paste}\NormalTok{(}\StringTok{"LM (train): RMSE ="}\NormalTok{,}\KeywordTok{round}\NormalTok{(}\KeywordTok{RMSE}\NormalTok{(}\KeywordTok{predict}\NormalTok{(lm_train, train), train}\OperatorTok{$}\NormalTok{Artist_Popularity), }\DataTypeTok{digits =} \DecValTok{2}\NormalTok{), }\StringTok{", R^2:"}\NormalTok{, }\KeywordTok{round}\NormalTok{(}\KeywordTok{R2}\NormalTok{(}\KeywordTok{predict}\NormalTok{(lm_train, train), train}\OperatorTok{$}\NormalTok{Artist_Popularity), }\DataTypeTok{digits =} \DecValTok{2}\NormalTok{)))}
\KeywordTok{barplot}\NormalTok{(ridge_res2, }\DataTypeTok{main =} \KeywordTok{paste}\NormalTok{(}\StringTok{"Ridge (train): RMSE ="}\NormalTok{,}\KeywordTok{round}\NormalTok{(}\KeywordTok{RMSE}\NormalTok{(}\KeywordTok{predict}\NormalTok{(ridge.cv, x_train), train}\OperatorTok{$}\NormalTok{Artist_Popularity), }\DataTypeTok{digits =} \DecValTok{2}\NormalTok{), }\StringTok{", R^2:"}\NormalTok{, }\KeywordTok{round}\NormalTok{(}\KeywordTok{R2}\NormalTok{(}\KeywordTok{predict}\NormalTok{(ridge.cv, x_train), train}\OperatorTok{$}\NormalTok{Artist_Popularity), }\DataTypeTok{digits =} \DecValTok{2}\NormalTok{)))}
\KeywordTok{barplot}\NormalTok{(lasso_res2, }\DataTypeTok{main =} \KeywordTok{paste}\NormalTok{(}\StringTok{"LASSO (train): RMSE ="}\NormalTok{,}\KeywordTok{round}\NormalTok{(}\KeywordTok{RMSE}\NormalTok{(}\KeywordTok{predict}\NormalTok{(lasso.cv, x_train), train}\OperatorTok{$}\NormalTok{Artist_Popularity), }\DataTypeTok{digits =} \DecValTok{2}\NormalTok{), }\StringTok{", R^2:"}\NormalTok{, }\KeywordTok{round}\NormalTok{(}\KeywordTok{R2}\NormalTok{(}\KeywordTok{predict}\NormalTok{(lasso.cv, x_train), train}\OperatorTok{$}\NormalTok{Artist_Popularity), }\DataTypeTok{digits =} \DecValTok{2}\NormalTok{)))}
\KeywordTok{barplot}\NormalTok{(elasticnet_res2, }\DataTypeTok{main =} \KeywordTok{paste}\NormalTok{(}\StringTok{"Elasticnet (train): RMSE ="}\NormalTok{,}\KeywordTok{round}\NormalTok{(}\KeywordTok{RMSE}\NormalTok{(}\KeywordTok{predict}\NormalTok{(elasticnet.cv, x_train), train}\OperatorTok{$}\NormalTok{Artist_Popularity), }\DataTypeTok{digits =} \DecValTok{2}\NormalTok{), }\StringTok{", R^2:"}\NormalTok{, }\KeywordTok{round}\NormalTok{(}\KeywordTok{R2}\NormalTok{(}\KeywordTok{predict}\NormalTok{(elasticnet.cv, x_train), train}\OperatorTok{$}\NormalTok{Artist_Popularity), }\DataTypeTok{digits =} \DecValTok{2}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-56-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Test data}

\NormalTok{x_test <-}\StringTok{ }\KeywordTok{model.matrix}\NormalTok{(Artist_Popularity}\OperatorTok{~}\NormalTok{., test)[,}\OperatorTok{-}\DecValTok{1}\NormalTok{]}

\NormalTok{ridge_res2 <-}\StringTok{ }\KeywordTok{as.numeric}\NormalTok{(test}\OperatorTok{$}\NormalTok{Artist_Popularity }\OperatorTok{-}\StringTok{ }\KeywordTok{predict}\NormalTok{(ridge.cv, x_test))}\OperatorTok{^}\DecValTok{2}
\NormalTok{lasso_res2 <-}\StringTok{ }\KeywordTok{as.numeric}\NormalTok{(test}\OperatorTok{$}\NormalTok{Artist_Popularity }\OperatorTok{-}\StringTok{ }\KeywordTok{predict}\NormalTok{(lasso.cv, x_test))}\OperatorTok{^}\DecValTok{2}
\NormalTok{elasticnet_res2 <-}\StringTok{ }\KeywordTok{as.numeric}\NormalTok{(test}\OperatorTok{$}\NormalTok{Artist_Popularity }\OperatorTok{-}\StringTok{ }\KeywordTok{predict}\NormalTok{(elasticnet.cv, x_test))}\OperatorTok{^}\DecValTok{2}

\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfcol=}\KeywordTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{))}
\KeywordTok{barplot}\NormalTok{((test}\OperatorTok{$}\NormalTok{Artist_Popularity }\OperatorTok{-}\StringTok{ }\KeywordTok{predict}\NormalTok{(lm_train, test))}\OperatorTok{^}\DecValTok{2}\NormalTok{, }\DataTypeTok{main =} \KeywordTok{paste}\NormalTok{(}\StringTok{"LM (test): RMSE ="}\NormalTok{,}\KeywordTok{round}\NormalTok{(}\KeywordTok{RMSE}\NormalTok{(}\KeywordTok{predict}\NormalTok{(lm_train, test), test}\OperatorTok{$}\NormalTok{Artist_Popularity), }\DataTypeTok{digits =} \DecValTok{2}\NormalTok{), }\StringTok{", R^2:"}\NormalTok{, }\KeywordTok{round}\NormalTok{(}\KeywordTok{R2}\NormalTok{(}\KeywordTok{predict}\NormalTok{(lm_train, test), test}\OperatorTok{$}\NormalTok{Artist_Popularity), }\DataTypeTok{digits =} \DecValTok{2}\NormalTok{)))}
\KeywordTok{barplot}\NormalTok{(ridge_res2, }\DataTypeTok{main =} \KeywordTok{paste}\NormalTok{(}\StringTok{"Ridge (test): RMSE ="}\NormalTok{,}\KeywordTok{round}\NormalTok{(}\KeywordTok{RMSE}\NormalTok{(}\KeywordTok{predict}\NormalTok{(ridge.cv, x_test), test}\OperatorTok{$}\NormalTok{Artist_Popularity), }\DataTypeTok{digits =} \DecValTok{2}\NormalTok{), }\StringTok{", R^2:"}\NormalTok{, }\KeywordTok{round}\NormalTok{(}\KeywordTok{R2}\NormalTok{(}\KeywordTok{predict}\NormalTok{(ridge.cv, x_test), test}\OperatorTok{$}\NormalTok{Artist_Popularity), }\DataTypeTok{digits =} \DecValTok{2}\NormalTok{)))}
\KeywordTok{barplot}\NormalTok{(lasso_res2, }\DataTypeTok{main =} \KeywordTok{paste}\NormalTok{(}\StringTok{"LASSO (test): RMSE ="}\NormalTok{,}\KeywordTok{round}\NormalTok{(}\KeywordTok{RMSE}\NormalTok{(}\KeywordTok{predict}\NormalTok{(lasso.cv, x_test), test}\OperatorTok{$}\NormalTok{Artist_Popularity), }\DataTypeTok{digits =} \DecValTok{2}\NormalTok{), }\StringTok{", R^2:"}\NormalTok{, }\KeywordTok{round}\NormalTok{(}\KeywordTok{R2}\NormalTok{(}\KeywordTok{predict}\NormalTok{(lasso.cv, x_test), test}\OperatorTok{$}\NormalTok{Artist_Popularity), }\DataTypeTok{digits =} \DecValTok{2}\NormalTok{)))}
\KeywordTok{barplot}\NormalTok{(elasticnet_res2, }\DataTypeTok{main =} \KeywordTok{paste}\NormalTok{(}\StringTok{"Elasticnet (test): RMSE ="}\NormalTok{,}\KeywordTok{round}\NormalTok{(}\KeywordTok{RMSE}\NormalTok{(}\KeywordTok{predict}\NormalTok{(elasticnet.cv, x_test), test}\OperatorTok{$}\NormalTok{Artist_Popularity), }\DataTypeTok{digits =} \DecValTok{2}\NormalTok{), }\StringTok{", R^2:"}\NormalTok{, }\KeywordTok{round}\NormalTok{(}\KeywordTok{R2}\NormalTok{(}\KeywordTok{predict}\NormalTok{(elasticnet.cv, x_test), test}\OperatorTok{$}\NormalTok{Artist_Popularity), }\DataTypeTok{digits =} \DecValTok{2}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-56-2.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Non-parametric and semiparametric regression}

\CommentTok{# Kernel density estimator}

\KeywordTok{library}\NormalTok{(}\StringTok{"np"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Nonparametric Kernel Methods for Mixed Datatypes (version 0.60-10)
## [vignette("np_faq",package="np") provides answers to frequently asked questions]
## [vignette("np",package="np") an overview]
## [vignette("entropy_np",package="np") an overview of entropy-based methods]
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{bw   <-}\StringTok{ }\KeywordTok{npudensbw}\NormalTok{(}\OperatorTok{~}\NormalTok{Track_Duration_ms, }\DataTypeTok{data=}\NormalTok{df) }\CommentTok{# Track_Duration_ms bi-modal?}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Multistart 1 of 1 |Multistart 1 of 1 |Multistart 1 of 1 |Multistart 1 of 1 /Multistart 1 of 1 |Multistart 1 of 1 |                   
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fhat <-}\StringTok{ }\KeywordTok{npudens}\NormalTok{(bw)}
\NormalTok{fhat}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Density Data: 186 training points, in 1 variable(s)
##               Track_Duration_ms
## Bandwidth(s):          25427.78
## 
## Bandwidth Type: Fixed
## Log Likelihood: -2404.132
## 
## Continuous Kernel Type: Second-Order Gaussian
## No. Continuous Vars.: 1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{plot}\NormalTok{(fhat, }\DataTypeTok{main=}\KeywordTok{sprintf}\NormalTok{(}\StringTok{"%s with h=%.2f"}\NormalTok{, fhat}\OperatorTok{$}\NormalTok{pckertype, fhat}\OperatorTok{$}\NormalTok{bw))}
\KeywordTok{rug}\NormalTok{(df}\OperatorTok{$}\NormalTok{Track_Duration_ms)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-57-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{bw <-}\StringTok{ }\KeywordTok{npudensbw}\NormalTok{(}\OperatorTok{~}\NormalTok{Artist_Popularity}\OperatorTok{+}\NormalTok{Track_Duration_ms, }\DataTypeTok{data=}\NormalTok{df, }\DataTypeTok{bwmethod=}\StringTok{"normal-reference"}\NormalTok{)}
\NormalTok{fhat <-}\StringTok{ }\KeywordTok{npudens}\NormalTok{(bw)}
\CommentTok{# plot(fhat) # bi-modal}

\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfcol=}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{))}
\CommentTok{#1) at Track_Duration_ms ~ 1 and Artist_Popularity ~ -1 (meaning longer tracks' artists are less popular)}
\KeywordTok{plot}\NormalTok{(fhat, }\DataTypeTok{view=}\StringTok{"fixed"}\NormalTok{, }\DataTypeTok{phi=}\DecValTok{10}\NormalTok{, }\DataTypeTok{theta=}\DecValTok{320}\NormalTok{, }\DataTypeTok{main =} \StringTok{""}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-57-2.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfcol=}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{))}
\CommentTok{# 2) at Track_Duration_ms ~ -0.5 and Artist_Popularity ~ 1}
\KeywordTok{plot}\NormalTok{(fhat, }\DataTypeTok{view=}\StringTok{"fixed"}\NormalTok{, }\DataTypeTok{phi=}\DecValTok{10}\NormalTok{, }\DataTypeTok{theta=}\DecValTok{155}\NormalTok{, }\DataTypeTok{main =} \StringTok{""}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-57-3.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfcol=}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{))}
\NormalTok{nw2 <-}\StringTok{ }\KeywordTok{npreg}\NormalTok{(Artist_Popularity}\OperatorTok{~}\NormalTok{pc_}\DecValTok{2}\OperatorTok{+}\NormalTok{Track_Duration_ms, }\DataTypeTok{data=}\NormalTok{df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Multistart 1 of 2 |Multistart 1 of 2 |Multistart 1 of 2 |Multistart 1 of 2 /Multistart 1 of 2 -Multistart 1 of 2 |Multistart 1 of 2 |Multistart 2 of 2 |Multistart 2 of 2 |Multistart 2 of 2 /Multistart 2 of 2 -Multistart 2 of 2 |Multistart 2 of 2 |                   
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{summary}\NormalTok{(nw2)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Regression Data: 186 training points, in 2 variable(s)
##                    pc_2 Track_Duration_ms
## Bandwidth(s): 0.6558287          64051.76
## 
## Kernel Regression Estimator: Local-Constant
## Bandwidth Type: Fixed
## Residual standard error: 9.136543
## R-squared: 0.6351856
## 
## Continuous Kernel Type: Second-Order Gaussian
## No. Continuous Explanatory Vars.: 2
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# plot(nw2)}

\CommentTok{# Nadaraya-Watson estimator}

\CommentTok{# bw <- npregbw(Artist_Popularity~Track_Duration_ms, data=df)}
\CommentTok{# mhat <- npreg(bw)}
\CommentTok{# main <- sprintf("%s with h=%.2f", mhat$pckertype, mhat$bw)}
\CommentTok{# plot(df$Artist_Popularity, df$Track_Duration_ms, pch=19, cex=0.3, main=main)}
\CommentTok{# ind <- order(df$Track_Duration_ms)}
\CommentTok{# xs  <- cbind(df$Track_Duration_ms, fitted(mhat))[ind,]}
\CommentTok{# lines(xs[,1], xs[,2], col="red", lwd=2)}
\CommentTok{# rug(df$Track_Duration_ms)}

\CommentTok{# bw <- npregbw(Artist_Popularity~Track_Duration_ms+Track_Popularity, data=df)}
\CommentTok{# mhat <- npreg(bw)}
\CommentTok{# plot(mhat)}


\NormalTok{plotContour <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{ (model, data, }\DataTypeTok{n=}\DecValTok{30}\NormalTok{) \{}
\NormalTok{  mf <-}\StringTok{ }\KeywordTok{model.frame}\NormalTok{(model}\OperatorTok{$}\NormalTok{terms, data)}
\NormalTok{  mc <-}\StringTok{ }\KeywordTok{lapply}\NormalTok{(}\KeywordTok{as.list}\NormalTok{(mf[,}\OperatorTok{-}\DecValTok{1}\NormalTok{]), pretty, }\DataTypeTok{n=}\NormalTok{n)}
\NormalTok{  zc <-}\StringTok{ }\KeywordTok{predict}\NormalTok{(model, }\KeywordTok{expand.grid}\NormalTok{(mc))}
  \KeywordTok{dim}\NormalTok{(zc) <-}\StringTok{ }\KeywordTok{sapply}\NormalTok{(mc, length)}
\NormalTok{  r2 <-}\StringTok{ }\DecValTok{1}\OperatorTok{-}\KeywordTok{var}\NormalTok{(}\KeywordTok{residuals}\NormalTok{(model))}\OperatorTok{/}\KeywordTok{var}\NormalTok{(mf[,}\DecValTok{1}\NormalTok{])}
  \KeywordTok{contour}\NormalTok{(mc[[}\DecValTok{1}\NormalTok{]], mc[[}\DecValTok{2}\NormalTok{]], zc, }\DataTypeTok{xlab=}\KeywordTok{names}\NormalTok{(mf)[}\DecValTok{2}\NormalTok{], }\DataTypeTok{ylab=}\KeywordTok{names}\NormalTok{(mf)[}\DecValTok{3}\NormalTok{],}
            \DataTypeTok{main=}\KeywordTok{sprintf}\NormalTok{(}\StringTok{"R^2=%.3f"}\NormalTok{, r2))}
\NormalTok{  cc <-}\StringTok{ }\KeywordTok{gray}\NormalTok{(}\FloatTok{0.75-0.75}\OperatorTok{*}\NormalTok{(mf[,}\DecValTok{1}\NormalTok{]}\OperatorTok{-}\KeywordTok{min}\NormalTok{(mf[,}\DecValTok{1}\NormalTok{]))}\OperatorTok{/}\NormalTok{(}\KeywordTok{max}\NormalTok{(mf[,}\DecValTok{1}\NormalTok{])}\OperatorTok{-}\KeywordTok{min}\NormalTok{(mf[,}\DecValTok{1}\NormalTok{])))}
  \KeywordTok{points}\NormalTok{(mf[,}\DecValTok{2}\NormalTok{], mf[,}\DecValTok{3}\NormalTok{], }\DataTypeTok{pch=}\DecValTok{19}\NormalTok{, }\DataTypeTok{cex=}\FloatTok{0.5}\NormalTok{, }\DataTypeTok{col=}\NormalTok{cc)}
\NormalTok{  \}}


\NormalTok{model <-}\StringTok{ }\KeywordTok{lm}\NormalTok{(Artist_Popularity}\OperatorTok{~}\NormalTok{pc_}\DecValTok{1} \OperatorTok{+}\StringTok{ }\NormalTok{pc_}\DecValTok{2}\NormalTok{, }\DataTypeTok{data=}\NormalTok{df)}
\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfrow=}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{))}
\KeywordTok{plotContour}\NormalTok{(model, df)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-57-4.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Partial linear model (mixing linear and spline terms)}

\KeywordTok{library}\NormalTok{(}\StringTok{"mgcv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Loading required package: nlme
\end{verbatim}

\begin{verbatim}
## 
## Attaching package: 'nlme'
\end{verbatim}

\begin{verbatim}
## The following object is masked from 'package:ryouready':
## 
##     intervals
\end{verbatim}

\begin{verbatim}
## The following object is masked from 'package:dplyr':
## 
##     collapse
\end{verbatim}

\begin{verbatim}
## This is mgcv 1.8-31. For overview type 'help("mgcv-package")'.
\end{verbatim}

\begin{verbatim}
## 
## Attaching package: 'mgcv'
\end{verbatim}

\begin{verbatim}
## The following object is masked from 'package:mclust':
## 
##     mvn
\end{verbatim}

\begin{verbatim}
## The following object is masked from 'package:MVN':
## 
##     mvn
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{model <-}\StringTok{ }\KeywordTok{gam}\NormalTok{(Artist_Popularity}\OperatorTok{~}\KeywordTok{s}\NormalTok{(Track_Popularity)}\OperatorTok{+}\NormalTok{Track_Duration_ms, }\DataTypeTok{data=}\NormalTok{df)}
\CommentTok{# plotContour(model, df$Track_Popularity, df$Track_Duration_ms, df$Artist_Popularity)}
\CommentTok{# plot(model)}

\CommentTok{# Additive model}

\KeywordTok{library}\NormalTok{(}\StringTok{"gam"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Loading required package: splines
\end{verbatim}

\begin{verbatim}
## Loading required package: foreach
\end{verbatim}

\begin{verbatim}
## Loaded gam 1.16.1
\end{verbatim}

\begin{verbatim}
## 
## Attaching package: 'gam'
\end{verbatim}

\begin{verbatim}
## The following objects are masked from 'package:mgcv':
## 
##     gam, gam.control, gam.fit, s
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{am1 <-}\StringTok{ }\KeywordTok{gam}\NormalTok{(Artist_Popularity }\OperatorTok{~}\StringTok{ }\KeywordTok{s}\NormalTok{(fa_}\DecValTok{1}\NormalTok{) }\OperatorTok{+}\StringTok{ }\KeywordTok{s}\NormalTok{(fa_}\DecValTok{2}\NormalTok{) }\OperatorTok{+}\StringTok{ }\KeywordTok{s}\NormalTok{(fa_}\DecValTok{3}\NormalTok{) }\OperatorTok{+}\StringTok{ }\KeywordTok{s}\NormalTok{(fa_}\DecValTok{4}\NormalTok{) }\OperatorTok{+}\StringTok{ }\KeywordTok{s}\NormalTok{(pc_}\DecValTok{1}\NormalTok{) }\OperatorTok{+}\StringTok{ }\KeywordTok{s}\NormalTok{(pc_}\DecValTok{2}\NormalTok{) }\OperatorTok{+}\StringTok{ }\KeywordTok{s}\NormalTok{(Artist_Follower) }\OperatorTok{+}\StringTok{ }\KeywordTok{s}\NormalTok{(days_release_orig) }\OperatorTok{+}\StringTok{ }\KeywordTok{s}\NormalTok{(Track_Popularity) }\OperatorTok{+}\StringTok{ }\KeywordTok{s}\NormalTok{(Track_Duration_ms) }\OperatorTok{+}\StringTok{ }\KeywordTok{s}\NormalTok{(fa_2sq) }\OperatorTok{+}\StringTok{ }\KeywordTok{s}\NormalTok{(pc_2sq) }\OperatorTok{+}\StringTok{ }\KeywordTok{s}\NormalTok{(Artist_Followersq), }\DataTypeTok{data=}\NormalTok{df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning in model.matrix.default(mt, mf, contrasts): non-list contrasts argument
## ignored
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{print}\NormalTok{(am1)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Call:
## gam(formula = Artist_Popularity ~ s(fa_1) + s(fa_2) + s(fa_3) + 
##     s(fa_4) + s(pc_1) + s(pc_2) + s(Artist_Follower) + s(days_release_orig) + 
##     s(Track_Popularity) + s(Track_Duration_ms) + s(fa_2sq) + 
##     s(pc_2sq) + s(Artist_Followersq), data = df)
## 
## Degrees of Freedom: 185 total; 76.48856 Residual
## Residual Deviance: 2110.514
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfrow=}\KeywordTok{c}\NormalTok{(}\DecValTok{3}\NormalTok{,}\DecValTok{4}\NormalTok{))}
\KeywordTok{plot}\NormalTok{(am1)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-58-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{plot}\NormalTok{(}\KeywordTok{fitted}\NormalTok{(am1), }\KeywordTok{residuals}\NormalTok{(am1))}
\KeywordTok{lines}\NormalTok{(}\KeywordTok{lowess}\NormalTok{(}\KeywordTok{fitted}\NormalTok{(am1), }\KeywordTok{residuals}\NormalTok{(am1)), }\DataTypeTok{col=}\StringTok{"red"}\NormalTok{, }\DataTypeTok{lwd=}\DecValTok{2}\NormalTok{)}
\NormalTok{n <-}\StringTok{ }\KeywordTok{nrow}\NormalTok{(df)}
\DecValTok{1}\OperatorTok{-}\KeywordTok{sum}\NormalTok{(}\KeywordTok{residuals}\NormalTok{(am1)}\OperatorTok{^}\DecValTok{2}\NormalTok{)}\OperatorTok{/}\NormalTok{((n}\DecValTok{-1}\NormalTok{)}\OperatorTok{*}\KeywordTok{var}\NormalTok{(df}\OperatorTok{$}\NormalTok{Artist_Popularity))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.9503897
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{performace_metrics[}\DecValTok{5}\NormalTok{,}\DecValTok{1}\NormalTok{] <-}\StringTok{ }\KeywordTok{RMSE}\NormalTok{(}\KeywordTok{predict}\NormalTok{(am1, }\DataTypeTok{newdata =}\NormalTok{ df), df}\OperatorTok{$}\NormalTok{Artist_Popularity)}
\NormalTok{performace_metrics[}\DecValTok{5}\NormalTok{,}\DecValTok{2}\NormalTok{] <-}\StringTok{ }\KeywordTok{R2}\NormalTok{(}\KeywordTok{predict}\NormalTok{(am1, }\DataTypeTok{newdata =}\NormalTok{ df), df}\OperatorTok{$}\NormalTok{Artist_Popularity)}

\NormalTok{am1_train <-}\StringTok{ }\KeywordTok{gam}\NormalTok{(Artist_Popularity }\OperatorTok{~}\StringTok{ }\KeywordTok{s}\NormalTok{(fa_}\DecValTok{1}\NormalTok{) }\OperatorTok{+}\StringTok{ }\KeywordTok{s}\NormalTok{(fa_}\DecValTok{2}\NormalTok{) }\OperatorTok{+}\StringTok{ }\KeywordTok{s}\NormalTok{(fa_}\DecValTok{3}\NormalTok{) }\OperatorTok{+}\StringTok{ }\KeywordTok{s}\NormalTok{(fa_}\DecValTok{4}\NormalTok{) }\OperatorTok{+}\StringTok{ }\KeywordTok{s}\NormalTok{(pc_}\DecValTok{1}\NormalTok{) }\OperatorTok{+}\StringTok{ }\KeywordTok{s}\NormalTok{(pc_}\DecValTok{2}\NormalTok{) }\OperatorTok{+}\StringTok{ }\KeywordTok{s}\NormalTok{(Artist_Follower) }\OperatorTok{+}\StringTok{ }\KeywordTok{s}\NormalTok{(days_release_orig) }\OperatorTok{+}\StringTok{ }\KeywordTok{s}\NormalTok{(Track_Popularity) }\OperatorTok{+}\StringTok{ }\KeywordTok{s}\NormalTok{(Track_Duration_ms) }\OperatorTok{+}\StringTok{ }\KeywordTok{s}\NormalTok{(fa_2sq) }\OperatorTok{+}\StringTok{ }\KeywordTok{s}\NormalTok{(pc_2sq) }\OperatorTok{+}\StringTok{ }\KeywordTok{s}\NormalTok{(Artist_Followersq), }\DataTypeTok{data=}\NormalTok{train)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning in model.matrix.default(mt, mf, contrasts): non-list contrasts argument
## ignored
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{performace_metrics[}\DecValTok{5}\NormalTok{,}\DecValTok{3}\NormalTok{] <-}\StringTok{ }\KeywordTok{RMSE}\NormalTok{(}\KeywordTok{predict}\NormalTok{(am1_train, }\DataTypeTok{newdata =}\NormalTok{ train), train}\OperatorTok{$}\NormalTok{Artist_Popularity)}
\NormalTok{performace_metrics[}\DecValTok{5}\NormalTok{,}\DecValTok{4}\NormalTok{] <-}\StringTok{ }\KeywordTok{R2}\NormalTok{(}\KeywordTok{predict}\NormalTok{(am1_train, }\DataTypeTok{newdata =}\NormalTok{ train), train}\OperatorTok{$}\NormalTok{Artist_Popularity)}

\NormalTok{performace_metrics[}\DecValTok{5}\NormalTok{,}\DecValTok{5}\NormalTok{] <-}\StringTok{ }\KeywordTok{RMSE}\NormalTok{(}\KeywordTok{predict}\NormalTok{(am1_train, }\DataTypeTok{newdata =}\NormalTok{ test), test}\OperatorTok{$}\NormalTok{Artist_Popularity)}
\NormalTok{performace_metrics[}\DecValTok{5}\NormalTok{,}\DecValTok{6}\NormalTok{] <-}\StringTok{ }\KeywordTok{R2}\NormalTok{(}\KeywordTok{predict}\NormalTok{(am1_train, }\DataTypeTok{newdata =}\NormalTok{ test), test}\OperatorTok{$}\NormalTok{Artist_Popularity)}


\CommentTok{# Single index model}

\NormalTok{sim <-}\StringTok{ }\KeywordTok{npindex}\NormalTok{(Artist_Popularity }\OperatorTok{~}\StringTok{ }\NormalTok{fa_}\DecValTok{1} \OperatorTok{+}\StringTok{ }\NormalTok{fa_}\DecValTok{2} \OperatorTok{+}\StringTok{ }\NormalTok{fa_}\DecValTok{3} \OperatorTok{+}\StringTok{ }\NormalTok{fa_}\DecValTok{4} \OperatorTok{+}\StringTok{ }\NormalTok{pc_}\DecValTok{1} \OperatorTok{+}\StringTok{ }\NormalTok{pc_}\DecValTok{2} \OperatorTok{+}\StringTok{ }\NormalTok{Artist_Follower }\OperatorTok{+}\StringTok{ }\NormalTok{days_release_orig }\OperatorTok{+}\StringTok{ }\NormalTok{Track_Popularity }\OperatorTok{+}\StringTok{ }\NormalTok{Track_Duration_ms }\OperatorTok{+}\StringTok{ }\NormalTok{fa_2sq }\OperatorTok{+}\StringTok{ }\NormalTok{pc_2sq }\OperatorTok{+}\StringTok{ }\NormalTok{Artist_Followersq, }\DataTypeTok{data=}\NormalTok{df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Multistart 1 of 5...Multistart 2 of 5...Multistart 3 of 5...Multistart 4 of 5...Multistart 5 of 5...                    
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{summary}\NormalTok{(sim)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Single Index Model
## Regression Data: 186 training points, in 13 variable(s)
## 
##       fa_1     fa_2       fa_3     fa_4      pc_1     pc_2 Artist_Follower
## Beta:    1 7.140808 -0.9481839 1.320797 0.3963661 1.316466        10.62225
##       days_release_orig Track_Popularity Track_Duration_ms    fa_2sq     pc_2sq
## Beta:     -4.818576e-05       0.08091355     -7.782318e-06 -7.679957 -0.8994251
##       Artist_Followersq
## Beta:        -0.1862698
## Bandwidth: 0.8377536
## Kernel Regression Estimator: Local-Constant
## 
## Residual standard error: 5.506267
## R-squared: 0.8675706
## 
## Continuous Kernel Type: Second-Order Gaussian
## No. Continuous Explanatory Vars.: 1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{performace_metrics[}\DecValTok{6}\NormalTok{,}\DecValTok{1}\NormalTok{] <-}\StringTok{ }\KeywordTok{RMSE}\NormalTok{(}\KeywordTok{predict}\NormalTok{(sim, }\DataTypeTok{newdata =}\NormalTok{ df), df}\OperatorTok{$}\NormalTok{Artist_Popularity)}
\NormalTok{performace_metrics[}\DecValTok{6}\NormalTok{,}\DecValTok{2}\NormalTok{] <-}\StringTok{ }\KeywordTok{R2}\NormalTok{(}\KeywordTok{predict}\NormalTok{(sim, }\DataTypeTok{newdata =}\NormalTok{ df), df}\OperatorTok{$}\NormalTok{Artist_Popularity)}

\NormalTok{sim_train <-}\StringTok{ }\KeywordTok{npindex}\NormalTok{(Artist_Popularity }\OperatorTok{~}\StringTok{ }\NormalTok{fa_}\DecValTok{1} \OperatorTok{+}\StringTok{ }\NormalTok{fa_}\DecValTok{2} \OperatorTok{+}\StringTok{ }\NormalTok{fa_}\DecValTok{3} \OperatorTok{+}\StringTok{ }\NormalTok{fa_}\DecValTok{4} \OperatorTok{+}\StringTok{ }\NormalTok{pc_}\DecValTok{1} \OperatorTok{+}\StringTok{ }\NormalTok{pc_}\DecValTok{2} \OperatorTok{+}\StringTok{ }\NormalTok{Artist_Follower }\OperatorTok{+}\StringTok{ }\NormalTok{days_release_orig }\OperatorTok{+}\StringTok{ }\NormalTok{Track_Popularity }\OperatorTok{+}\StringTok{ }\NormalTok{Track_Duration_ms }\OperatorTok{+}\StringTok{ }\NormalTok{fa_2sq }\OperatorTok{+}\StringTok{ }\NormalTok{pc_2sq }\OperatorTok{+}\StringTok{ }\NormalTok{Artist_Followersq, }\DataTypeTok{data=}\NormalTok{train)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Multistart 1 of 5...Multistart 2 of 5...Multistart 3 of 5...Multistart 4 of 5...Multistart 5 of 5...                    
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{performace_metrics[}\DecValTok{6}\NormalTok{,}\DecValTok{3}\NormalTok{] <-}\StringTok{ }\KeywordTok{RMSE}\NormalTok{(}\KeywordTok{predict}\NormalTok{(sim_train, }\DataTypeTok{newdata =}\NormalTok{ train), train}\OperatorTok{$}\NormalTok{Artist_Popularity)}
\NormalTok{performace_metrics[}\DecValTok{6}\NormalTok{,}\DecValTok{4}\NormalTok{] <-}\StringTok{ }\KeywordTok{R2}\NormalTok{(}\KeywordTok{predict}\NormalTok{(sim_train, }\DataTypeTok{newdata =}\NormalTok{ train), train}\OperatorTok{$}\NormalTok{Artist_Popularity)}

\NormalTok{performace_metrics[}\DecValTok{6}\NormalTok{,}\DecValTok{5}\NormalTok{] <-}\StringTok{ }\KeywordTok{RMSE}\NormalTok{(}\KeywordTok{predict}\NormalTok{(sim_train, }\DataTypeTok{newdata =}\NormalTok{ test), test}\OperatorTok{$}\NormalTok{Artist_Popularity)}
\NormalTok{performace_metrics[}\DecValTok{6}\NormalTok{,}\DecValTok{6}\NormalTok{] <-}\StringTok{ }\KeywordTok{R2}\NormalTok{(}\KeywordTok{predict}\NormalTok{(sim_train, }\DataTypeTok{newdata =}\NormalTok{ test), test}\OperatorTok{$}\NormalTok{Artist_Popularity)}

\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfrow=}\KeywordTok{c}\NormalTok{(}\DecValTok{3}\NormalTok{,}\DecValTok{4}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-58-2.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{plot}\NormalTok{(sim)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-58-3.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{plot}\NormalTok{(}\KeywordTok{fitted}\NormalTok{(sim), }\KeywordTok{residuals}\NormalTok{(sim))}
\KeywordTok{lines}\NormalTok{(}\KeywordTok{lowess}\NormalTok{(}\KeywordTok{fitted}\NormalTok{(sim), }\KeywordTok{residuals}\NormalTok{(sim)), }\DataTypeTok{col=}\StringTok{"red"}\NormalTok{, }\DataTypeTok{lwd=}\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-58-4.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{n <-}\StringTok{ }\KeywordTok{nrow}\NormalTok{(df)}
\DecValTok{1}\OperatorTok{-}\KeywordTok{sum}\NormalTok{(}\KeywordTok{residuals}\NormalTok{(sim)}\OperatorTok{^}\DecValTok{2}\NormalTok{)}\OperatorTok{/}\NormalTok{((n}\DecValTok{-1}\NormalTok{)}\OperatorTok{*}\KeywordTok{var}\NormalTok{(df}\OperatorTok{$}\NormalTok{Artist_Popularity))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.8674403
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Projection Pursuit Regression}

\NormalTok{ppr <-}\StringTok{ }\KeywordTok{ppr}\NormalTok{(Artist_Popularity }\OperatorTok{~}\StringTok{ }\NormalTok{fa_}\DecValTok{1} \OperatorTok{+}\StringTok{ }\NormalTok{fa_}\DecValTok{2} \OperatorTok{+}\StringTok{ }\NormalTok{fa_}\DecValTok{3} \OperatorTok{+}\StringTok{ }\NormalTok{fa_}\DecValTok{4} \OperatorTok{+}\StringTok{ }\NormalTok{pc_}\DecValTok{1} \OperatorTok{+}\StringTok{ }\NormalTok{pc_}\DecValTok{2} \OperatorTok{+}\StringTok{ }\NormalTok{Artist_Follower }\OperatorTok{+}\StringTok{ }\NormalTok{days_release_orig }\OperatorTok{+}\StringTok{ }\NormalTok{Track_Popularity }\OperatorTok{+}\StringTok{ }\NormalTok{Track_Duration_ms }\OperatorTok{+}\StringTok{ }\NormalTok{fa_2sq }\OperatorTok{+}\StringTok{ }\NormalTok{pc_2sq }\OperatorTok{+}\StringTok{ }\NormalTok{Artist_Followersq, }\DataTypeTok{data=}\NormalTok{df, }\DataTypeTok{nterm=}\DecValTok{5}\NormalTok{)}

\NormalTok{performace_metrics[}\DecValTok{7}\NormalTok{,}\DecValTok{1}\NormalTok{] <-}\StringTok{ }\KeywordTok{RMSE}\NormalTok{(}\KeywordTok{predict}\NormalTok{(ppr, }\DataTypeTok{newdata =}\NormalTok{ df), df}\OperatorTok{$}\NormalTok{Artist_Popularity)}
\NormalTok{performace_metrics[}\DecValTok{7}\NormalTok{,}\DecValTok{2}\NormalTok{] <-}\StringTok{ }\KeywordTok{R2}\NormalTok{(}\KeywordTok{predict}\NormalTok{(ppr, }\DataTypeTok{newdata =}\NormalTok{ df), df}\OperatorTok{$}\NormalTok{Artist_Popularity)}

\NormalTok{ppr_train <-}\StringTok{ }\KeywordTok{ppr}\NormalTok{(Artist_Popularity }\OperatorTok{~}\StringTok{ }\NormalTok{fa_}\DecValTok{1} \OperatorTok{+}\StringTok{ }\NormalTok{fa_}\DecValTok{2} \OperatorTok{+}\StringTok{ }\NormalTok{fa_}\DecValTok{3} \OperatorTok{+}\StringTok{ }\NormalTok{fa_}\DecValTok{4} \OperatorTok{+}\StringTok{ }\NormalTok{pc_}\DecValTok{1} \OperatorTok{+}\StringTok{ }\NormalTok{pc_}\DecValTok{2} \OperatorTok{+}\StringTok{ }\NormalTok{Artist_Follower }\OperatorTok{+}\StringTok{ }\NormalTok{days_release_orig }\OperatorTok{+}\StringTok{ }\NormalTok{Track_Popularity }\OperatorTok{+}\StringTok{ }\NormalTok{Track_Duration_ms }\OperatorTok{+}\StringTok{ }\NormalTok{fa_2sq }\OperatorTok{+}\StringTok{ }\NormalTok{pc_2sq }\OperatorTok{+}\StringTok{ }\NormalTok{Artist_Followersq, }\DataTypeTok{data=}\NormalTok{train, }\DataTypeTok{nterm=}\DecValTok{5}\NormalTok{)}

\NormalTok{performace_metrics[}\DecValTok{7}\NormalTok{,}\DecValTok{3}\NormalTok{] <-}\StringTok{ }\KeywordTok{RMSE}\NormalTok{(}\KeywordTok{predict}\NormalTok{(ppr_train, }\DataTypeTok{newdata =}\NormalTok{ train), train}\OperatorTok{$}\NormalTok{Artist_Popularity)}
\NormalTok{performace_metrics[}\DecValTok{7}\NormalTok{,}\DecValTok{4}\NormalTok{] <-}\StringTok{ }\KeywordTok{R2}\NormalTok{(}\KeywordTok{predict}\NormalTok{(ppr_train, }\DataTypeTok{newdata =}\NormalTok{ train), train}\OperatorTok{$}\NormalTok{Artist_Popularity)}
\NormalTok{performace_metrics[}\DecValTok{7}\NormalTok{,}\DecValTok{5}\NormalTok{] <-}\StringTok{ }\KeywordTok{RMSE}\NormalTok{(}\KeywordTok{predict}\NormalTok{(ppr_train, }\DataTypeTok{newdata =}\NormalTok{ test), test}\OperatorTok{$}\NormalTok{Artist_Popularity)}
\NormalTok{performace_metrics[}\DecValTok{7}\NormalTok{,}\DecValTok{6}\NormalTok{] <-}\StringTok{ }\KeywordTok{R2}\NormalTok{(}\KeywordTok{predict}\NormalTok{(ppr_train, }\DataTypeTok{newdata =}\NormalTok{ test), test}\OperatorTok{$}\NormalTok{Artist_Popularity)}

\KeywordTok{summary}\NormalTok{(ppr)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Call:
## ppr(formula = Artist_Popularity ~ fa_1 + fa_2 + fa_3 + fa_4 + 
##     pc_1 + pc_2 + Artist_Follower + days_release_orig + Track_Popularity + 
##     Track_Duration_ms + fa_2sq + pc_2sq + Artist_Followersq, 
##     data = df, nterm = 5)
## 
## Goodness of fit:
##  5 terms 
## 1741.435 
## 
## Projection direction vectors ('alpha'):
##                   term 1        term 2        term 3        term 4       
## fa_1              -6.325427e-02  2.081791e-01 -8.112105e-02  4.462995e-01
## fa_2               1.999522e-01  1.988317e-01  3.820633e-01 -1.225150e-01
## fa_3               1.776410e-01 -4.813375e-01  4.625303e-01 -2.615833e-01
## fa_4               9.095299e-02 -7.325872e-01  5.161008e-01 -2.094942e-01
## pc_1               5.912856e-02 -1.634530e-01 -1.398765e-01 -2.846767e-02
## pc_2               7.261656e-02  1.218474e-01 -3.230672e-01 -5.558153e-01
## Artist_Follower    9.472078e-01 -2.009118e-01  1.651405e-01  5.085105e-01
## days_release_orig  5.284337e-07 -2.107916e-05  5.900920e-05  2.729395e-05
## Track_Popularity   6.925853e-03  1.765052e-02 -6.223949e-02  2.066660e-03
## Track_Duration_ms -3.916723e-07  4.233016e-07  2.333658e-06 -2.253623e-06
## fa_2sq            -9.559306e-02 -2.453111e-01  5.941416e-02 -1.868207e-01
## pc_2sq            -7.315117e-03 -7.878193e-02  4.566070e-01 -2.623794e-01
## Artist_Followersq -3.126859e-02  1.152058e-02 -7.044398e-03 -3.768289e-02
##                   term 5       
## fa_1              -6.211143e-01
## fa_2              -1.261187e-01
## fa_3              -2.121784e-01
## fa_4               4.149667e-01
## pc_1              -2.597611e-01
## pc_2               4.152905e-01
## Artist_Follower   -1.891676e-01
## days_release_orig -7.811224e-05
## Track_Popularity  -2.572436e-03
## Track_Duration_ms -2.907082e-06
## fa_2sq            -1.176104e-01
## pc_2sq             3.024768e-01
## Artist_Followersq  6.051800e-03
## 
## Coefficients of ridge terms ('beta'):
##    term 1    term 2    term 3    term 4    term 5 
## 15.436585  3.228392  3.418258  2.647310  2.190618
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfrow=}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{))}
\KeywordTok{plot}\NormalTok{(ppr)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-58-5.pdf}
\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-58-6.pdf}
\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-58-7.pdf}
\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-58-8.pdf}
\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-58-9.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{plot}\NormalTok{(}\KeywordTok{fitted}\NormalTok{(ppr), }\KeywordTok{residuals}\NormalTok{(ppr))}
\KeywordTok{lines}\NormalTok{(}\KeywordTok{lowess}\NormalTok{(}\KeywordTok{fitted}\NormalTok{(ppr), }\KeywordTok{residuals}\NormalTok{(ppr)), }\DataTypeTok{col=}\StringTok{"red"}\NormalTok{, }\DataTypeTok{lwd=}\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-58-10.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{n <-}\StringTok{ }\KeywordTok{nrow}\NormalTok{(df)}
\DecValTok{1}\OperatorTok{-}\KeywordTok{sum}\NormalTok{(}\KeywordTok{residuals}\NormalTok{(ppr)}\OperatorTok{^}\DecValTok{2}\NormalTok{)}\OperatorTok{/}\NormalTok{((n}\DecValTok{-1}\NormalTok{)}\OperatorTok{*}\KeywordTok{var}\NormalTok{(df}\OperatorTok{$}\NormalTok{Artist_Popularity))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.9590653
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(}\StringTok{"rpart"}\NormalTok{)}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{42}\NormalTok{)}
\NormalTok{tr1 <-}\StringTok{ }\KeywordTok{rpart}\NormalTok{(Artist_Popularity}\OperatorTok{~}\NormalTok{fa_}\DecValTok{1}\OperatorTok{+}\NormalTok{fa_}\DecValTok{2}\OperatorTok{+}\NormalTok{fa_}\DecValTok{3}\OperatorTok{+}\NormalTok{fa_}\DecValTok{4}\OperatorTok{+}\NormalTok{pc_}\DecValTok{1}\OperatorTok{+}\NormalTok{pc_}\DecValTok{2}\OperatorTok{+}\NormalTok{Artist_Follower}\OperatorTok{+}\NormalTok{days_release_orig}
             \OperatorTok{+}\NormalTok{Track_Popularity}\OperatorTok{+}\NormalTok{Track_Duration_ms}\OperatorTok{+}\NormalTok{fa_2sq}\OperatorTok{+}\NormalTok{pc_2sq}\OperatorTok{+}\NormalTok{Artist_Followersq, }\DataTypeTok{data=}\NormalTok{df, }\DataTypeTok{cp =} \DecValTok{0}\NormalTok{)}

\NormalTok{tr1}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## n= 186 
## 
## node), split, n, deviance, yval
##       * denotes terminal node
## 
##   1) root 186 42541.81000 64.03226  
##     2) Artist_Follower< 0.069933 69  6966.63800 49.07246  
##       4) fa_2sq>=0.04873442 44  1927.88600 43.65909  
##         8) Artist_Follower< 0.0063065 24   493.33330 39.33333  
##          16) Track_Popularity< 42.5 7   246.85710 36.14286 *
##          17) Track_Popularity>=42.5 17   145.88240 40.64706 *
##         9) Artist_Follower>=0.0063065 20   446.55000 48.85000  
##          18) Artist_Follower< 0.0181555 7    27.42857 45.71429 *
##          19) Artist_Follower>=0.0181555 13   313.23080 50.53846 *
##       5) fa_2sq< 0.04873442 25  1480.00000 58.60000  
##        10) Track_Duration_ms>=322237 11   247.63640 53.81818 *
##        11) Track_Duration_ms< 322237 14   783.21430 62.35714 *
##     3) Artist_Follower>=0.069933 117 11026.53000 72.85470  
##       6) Artist_Follower< 0.538149 59  2850.67800 66.23729  
##        12) Track_Duration_ms>=327871 16   283.00000 59.25000 *
##        13) Track_Duration_ms< 327871 43  1495.86000 68.83721  
##          26) Track_Popularity< 66 33   762.90910 66.81818  
##            52) fa_1< -0.7142649 12   117.66670 64.16667 *
##            53) fa_1>=-0.7142649 21   512.66670 68.33333  
##             106) Track_Duration_ms>=208616 7    77.71429 65.42857 *
##             107) Track_Duration_ms< 208616 14   346.35710 69.78571 *
##          27) Track_Popularity>=66 10   154.50000 75.50000 *
##       7) Artist_Follower>=0.538149 58  2964.06900 79.58621  
##        14) Artist_Follower< 2.122275 41  1084.04900 76.26829  
##          28) Track_Popularity< 59 25   470.96000 73.96000  
##            56) Artist_Follower< 0.779791 11   144.54550 71.36364 *
##            57) Artist_Follower>=0.779791 14   194.00000 76.00000 *
##          29) Track_Popularity>=59 16   271.75000 79.87500 *
##        15) Artist_Follower>=2.122275 17   340.11760 87.58824 *
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfrow=}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{))}
\KeywordTok{plot}\NormalTok{(tr1)}
\KeywordTok{text}\NormalTok{(tr1)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-59-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# summary(tr1)}

\KeywordTok{library}\NormalTok{(}\StringTok{"rpart.plot"}\NormalTok{)}
\KeywordTok{rpart.plot}\NormalTok{(tr1, }\DataTypeTok{cex =} \FloatTok{0.7}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-59-2.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{n <-}\StringTok{ }\KeywordTok{nrow}\NormalTok{(x_noout)}
\DecValTok{1}\OperatorTok{-}\KeywordTok{sum}\NormalTok{(}\KeywordTok{residuals}\NormalTok{(tr1)}\OperatorTok{^}\DecValTok{2}\NormalTok{)}\OperatorTok{/}\NormalTok{((n}\DecValTok{-1}\NormalTok{)}\OperatorTok{*}\KeywordTok{var}\NormalTok{(df}\OperatorTok{$}\NormalTok{Artist_Popularity))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.9131701
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{RMSE}\NormalTok{(}\KeywordTok{predict}\NormalTok{(tr1, }\DataTypeTok{newx =} \KeywordTok{as.matrix}\NormalTok{(df[,}\OperatorTok{-}\DecValTok{11}\NormalTok{])), }\KeywordTok{as.matrix}\NormalTok{(df[,}\DecValTok{11}\NormalTok{]))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 4.45642
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{R2}\NormalTok{(}\KeywordTok{predict}\NormalTok{(tr1, }\DataTypeTok{newx =} \KeywordTok{as.matrix}\NormalTok{(df[,}\OperatorTok{-}\DecValTok{11}\NormalTok{])), }\KeywordTok{as.matrix}\NormalTok{(df[,}\DecValTok{11}\NormalTok{]))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##           [,1]
## [1,] 0.9131701
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{performace_metrics[}\DecValTok{8}\NormalTok{,}\DecValTok{1}\NormalTok{] <-}\StringTok{ }\KeywordTok{RMSE}\NormalTok{(}\KeywordTok{predict}\NormalTok{(tr1, }\DataTypeTok{newx =} \KeywordTok{as.matrix}\NormalTok{(df[,}\OperatorTok{-}\DecValTok{11}\NormalTok{])), }\KeywordTok{as.matrix}\NormalTok{(df[,}\DecValTok{11}\NormalTok{]))}
\NormalTok{performace_metrics[}\DecValTok{8}\NormalTok{,}\DecValTok{2}\NormalTok{] <-}\StringTok{ }\KeywordTok{R2}\NormalTok{(}\KeywordTok{predict}\NormalTok{(tr1, }\DataTypeTok{newx =} \KeywordTok{as.matrix}\NormalTok{(df[,}\OperatorTok{-}\DecValTok{11}\NormalTok{])), }\KeywordTok{as.matrix}\NormalTok{(df[,}\DecValTok{11}\NormalTok{]))}

\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfrow=}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{))}
\KeywordTok{printcp}\NormalTok{(tr1)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Regression tree:
## rpart(formula = Artist_Popularity ~ fa_1 + fa_2 + fa_3 + fa_4 + 
##     pc_1 + pc_2 + Artist_Follower + days_release_orig + Track_Popularity + 
##     Track_Duration_ms + fa_2sq + pc_2sq + Artist_Followersq, 
##     data = df, cp = 0)
## 
## Variables actually used in tree construction:
## [1] Artist_Follower   fa_1              fa_2sq            Track_Duration_ms
## [5] Track_Popularity 
## 
## Root node error: 42542/186 = 228.72
## 
## n= 186 
## 
##           CP nsplit rel error  xerror     xstd
## 1  0.5770474      0  1.000000 1.00653 0.083049
## 2  0.1225097      1  0.422953 0.48655 0.048436
## 3  0.0836530      2  0.300443 0.40487 0.043226
## 4  0.0361974      3  0.216790 0.31837 0.031836
## 5  0.0251945      4  0.180592 0.25499 0.027825
## 6  0.0232243      5  0.155398 0.25364 0.027712
## 7  0.0135972      6  0.132174 0.22116 0.026618
## 8  0.0105578      7  0.118577 0.20613 0.021909
## 9  0.0080236      8  0.108019 0.20183 0.021094
## 10 0.0031164      9  0.099995 0.18382 0.019763
## 11 0.0031126     10  0.096879 0.17620 0.018307
## 12 0.0024891     11  0.093766 0.17494 0.018228
## 13 0.0023646     12  0.091277 0.17700 0.018198
## 14 0.0020825     13  0.088912 0.17707 0.018191
## 15 0.0000000     14  0.086830 0.17756 0.018387
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{plotcp}\NormalTok{(tr1)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-59-3.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tr1}\OperatorTok{$}\NormalTok{cptable}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##             CP nsplit  rel error    xerror       xstd
## 1  0.577047401      0 1.00000000 1.0065265 0.08304941
## 2  0.122509677      1 0.42295260 0.4865458 0.04843559
## 3  0.083653037      2 0.30044292 0.4048674 0.04322625
## 4  0.036197394      3 0.21678988 0.3183658 0.03183584
## 5  0.025194452      4 0.18059249 0.2549941 0.02782496
## 6  0.023224285      5 0.15539804 0.2536358 0.02771156
## 7  0.013597245      6 0.13217375 0.2211631 0.02661788
## 8  0.010557834      7 0.11857651 0.2061339 0.02190935
## 9  0.008023608      8 0.10801867 0.2018287 0.02109449
## 10 0.003116364      9 0.09999507 0.1838249 0.01976306
## 11 0.003112575     10 0.09687870 0.1761958 0.01830748
## 12 0.002489096     11 0.09376613 0.1749360 0.01822793
## 13 0.002364588     12 0.09127703 0.1770043 0.01819798
## 14 0.002082545     13 0.08891244 0.1770745 0.01819139
## 15 0.000000000     14 0.08682990 0.1775587 0.01838699
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{best.cp <-}\StringTok{ }\NormalTok{tr1}\OperatorTok{$}\NormalTok{cptable[}\KeywordTok{which.min}\NormalTok{(tr1}\OperatorTok{$}\NormalTok{cptable[,}\StringTok{"xerror"}\NormalTok{]),}\StringTok{"CP"}\NormalTok{]}
\NormalTok{best.cp}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.002489096
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dt_pruned <-}\StringTok{ }\KeywordTok{prune}\NormalTok{(tr1, }\DataTypeTok{cp=}\NormalTok{best.cp)}

\DecValTok{1}\OperatorTok{-}\KeywordTok{sum}\NormalTok{(}\KeywordTok{residuals}\NormalTok{(dt_pruned)}\OperatorTok{^}\DecValTok{2}\NormalTok{)}\OperatorTok{/}\NormalTok{((n}\DecValTok{-1}\NormalTok{)}\OperatorTok{*}\KeywordTok{var}\NormalTok{(df}\OperatorTok{$}\NormalTok{Artist_Popularity))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.9062339
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{RMSE}\NormalTok{(}\KeywordTok{predict}\NormalTok{(dt_pruned, }\DataTypeTok{newx =} \KeywordTok{as.matrix}\NormalTok{(df[,}\OperatorTok{-}\DecValTok{11}\NormalTok{])), }\KeywordTok{as.matrix}\NormalTok{(df[,}\DecValTok{11}\NormalTok{]))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 4.630997
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{R2}\NormalTok{(}\KeywordTok{predict}\NormalTok{(dt_pruned, }\DataTypeTok{newx =} \KeywordTok{as.matrix}\NormalTok{(df[,}\OperatorTok{-}\DecValTok{11}\NormalTok{])), }\KeywordTok{as.matrix}\NormalTok{(df[,}\DecValTok{11}\NormalTok{])) }\CommentTok{# lower R^2 after pruning}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##           [,1]
## [1,] 0.9062339
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(}\StringTok{"caret"}\NormalTok{)}

\CommentTok{# DT CV on full data}

\NormalTok{caret.control <-}\StringTok{ }\KeywordTok{trainControl}\NormalTok{(}\DataTypeTok{method =} \StringTok{"repeatedcv"}\NormalTok{,}
                              \DataTypeTok{number =} \DecValTok{10}\NormalTok{,}
                              \DataTypeTok{repeats =} \DecValTok{3}\NormalTok{)}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{42}\NormalTok{)}
\NormalTok{rpart.cv <-}\StringTok{ }\NormalTok{caret}\OperatorTok{::}\KeywordTok{train}\NormalTok{(Artist_Popularity }\OperatorTok{~}\StringTok{ }\NormalTok{., }
                         \DataTypeTok{data =}\NormalTok{ df,}
                         \DataTypeTok{method =} \StringTok{"rpart"}\NormalTok{,}
                         \DataTypeTok{trControl =}\NormalTok{ caret.control,}
                         \DataTypeTok{tuneLength =} \DecValTok{15}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning in nominalTrainWorkflow(x = x, y = y, wts = weights, info = trainInfo, :
## There were missing values in resampled performance measures.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{rpart.cv}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## CART 
## 
## 186 samples
##  13 predictor
## 
## No pre-processing
## Resampling: Cross-Validated (10 fold, repeated 3 times) 
## Summary of sample sizes: 168, 167, 168, 168, 167, 167, ... 
## Resampling results across tuning parameters:
## 
##   cp           RMSE       Rsquared   MAE      
##   0.000000000   6.074712  0.8414403   4.810231
##   0.002082545   6.068751  0.8423901   4.800191
##   0.002364588   6.052218  0.8437084   4.782182
##   0.002489096   6.053917  0.8434435   4.782970
##   0.003112575   6.044344  0.8438105   4.745985
##   0.003116364   6.044344  0.8438105   4.745985
##   0.008023608   6.226200  0.8325732   4.866355
##   0.010557834   6.403122  0.8199671   5.034487
##   0.013597245   6.553546  0.8110770   5.189022
##   0.023224285   7.292639  0.7677304   5.825220
##   0.025194452   7.438172  0.7583776   5.953699
##   0.036197394   8.040694  0.7224670   6.491552
##   0.083653037   8.679390  0.6818844   7.072580
##   0.122509677   9.979465  0.5780608   8.139785
##   0.577047401  13.444956  0.4565212  10.949275
## 
## RMSE was used to select the optimal model using the smallest value.
## The final value used for the model was cp = 0.003116364.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{rpart.best.cv <-}\StringTok{ }\NormalTok{rpart.cv}\OperatorTok{$}\NormalTok{finalModel}
\NormalTok{rpart.best.cv}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## n= 186 
## 
## node), split, n, deviance, yval
##       * denotes terminal node
## 
##  1) root 186 42541.8100 64.03226  
##    2) Artist_Follower< 0.069933 69  6966.6380 49.07246  
##      4) fa_2sq>=0.04873442 44  1927.8860 43.65909  
##        8) Artist_Follower< 0.0063065 24   493.3333 39.33333 *
##        9) Artist_Follower>=0.0063065 20   446.5500 48.85000 *
##      5) fa_2sq< 0.04873442 25  1480.0000 58.60000  
##       10) Track_Duration_ms>=322237 11   247.6364 53.81818 *
##       11) Track_Duration_ms< 322237 14   783.2143 62.35714 *
##    3) Artist_Follower>=0.069933 117 11026.5300 72.85470  
##      6) Artist_Follower< 0.538149 59  2850.6780 66.23729  
##       12) Track_Duration_ms>=327871 16   283.0000 59.25000 *
##       13) Track_Duration_ms< 327871 43  1495.8600 68.83721  
##         26) Track_Popularity< 66 33   762.9091 66.81818 *
##         27) Track_Popularity>=66 10   154.5000 75.50000 *
##      7) Artist_Follower>=0.538149 58  2964.0690 79.58621  
##       14) Artist_Follower< 2.122275 41  1084.0490 76.26829  
##         28) Track_Popularity< 59 25   470.9600 73.96000 *
##         29) Track_Popularity>=59 16   271.7500 79.87500 *
##       15) Artist_Follower>=2.122275 17   340.1176 87.58824 *
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{rpart.plot}\NormalTok{(rpart.best.cv)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-60-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{RMSE}\NormalTok{(}\KeywordTok{predict}\NormalTok{(rpart.best.cv, }\DataTypeTok{newdata =}\NormalTok{ df), df}\OperatorTok{$}\NormalTok{Artist_Popularity) }\CommentTok{# corresponds exactly to the pruned tree solution}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 4.782344
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{R2}\NormalTok{(}\KeywordTok{predict}\NormalTok{(rpart.best.cv, }\DataTypeTok{newdata =}\NormalTok{ df), df}\OperatorTok{$}\NormalTok{Artist_Popularity) }\CommentTok{# corresponds exactly to the pruned tree solution}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.9000049
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# DT CV on split data}

\KeywordTok{set.seed}\NormalTok{(}\DecValTok{42}\NormalTok{)}
\NormalTok{idx.train <-}\StringTok{ }\KeywordTok{createDataPartition}\NormalTok{(}\DataTypeTok{y =}\NormalTok{ df}\OperatorTok{$}\NormalTok{Artist_Popularity, }\DataTypeTok{p =} \FloatTok{0.75}\NormalTok{, }\DataTypeTok{list =} \OtherTok{FALSE}\NormalTok{)}
\NormalTok{train.data <-}\StringTok{ }\NormalTok{df[idx.train, ]}
\NormalTok{test.data <-}\StringTok{ }\NormalTok{df[}\OperatorTok{-}\NormalTok{idx.train,]}

\NormalTok{caret.control <-}\StringTok{ }\KeywordTok{trainControl}\NormalTok{(}\DataTypeTok{method =} \StringTok{"repeatedcv"}\NormalTok{,}
                              \DataTypeTok{number =} \DecValTok{10}\NormalTok{,}
                              \DataTypeTok{repeats =} \DecValTok{3}\NormalTok{)}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{42}\NormalTok{)}
\NormalTok{rpart.cv <-}\StringTok{ }\NormalTok{caret}\OperatorTok{::}\KeywordTok{train}\NormalTok{(Artist_Popularity }\OperatorTok{~}\StringTok{ }\NormalTok{., }
                  \DataTypeTok{data =}\NormalTok{ train.data,}
                  \DataTypeTok{method =} \StringTok{"rpart"}\NormalTok{,}
                  \DataTypeTok{trControl =}\NormalTok{ caret.control,}
                  \DataTypeTok{tuneLength =} \DecValTok{15}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning in nominalTrainWorkflow(x = x, y = y, wts = weights, info = trainInfo, :
## There were missing values in resampled performance measures.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{rpart.cv}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## CART 
## 
## 142 samples
##  13 predictor
## 
## No pre-processing
## Resampling: Cross-Validated (10 fold, repeated 3 times) 
## Summary of sample sizes: 128, 127, 128, 128, 127, 128, ... 
## Resampling results across tuning parameters:
## 
##   cp          RMSE       Rsquared   MAE      
##   0.00000000   6.262619  0.8356051   4.945561
##   0.03893783   7.948876  0.7357777   6.587601
##   0.07787565   8.733659  0.6826962   7.209211
##   0.11681348   9.340591  0.6418864   7.682783
##   0.15575130  10.167727  0.5758572   8.268144
##   0.19468913  11.032049  0.5094994   9.065660
##   0.23362695  11.336369  0.4881129   9.306610
##   0.27256478  11.336369  0.4881129   9.306610
##   0.31150261  11.336369  0.4881129   9.306610
##   0.35044043  11.336369  0.4881129   9.306610
##   0.38937826  11.336369  0.4881129   9.306610
##   0.42831608  11.336369  0.4881129   9.306610
##   0.46725391  11.336369  0.4881129   9.306610
##   0.50619173  11.336369  0.4881129   9.306610
##   0.54512956  13.737829  0.3936640  11.451762
## 
## RMSE was used to select the optimal model using the smallest value.
## The final value used for the model was cp = 0.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{rpart.best.cv <-}\StringTok{ }\NormalTok{rpart.cv}\OperatorTok{$}\NormalTok{finalModel}
\NormalTok{rpart.best.cv}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## n= 142 
## 
## node), split, n, deviance, yval
##       * denotes terminal node
## 
##  1) root 142 33159.33000 64.23239  
##    2) Artist_Follower< 0.2779545 84 11318.29000 54.85714  
##      4) Artist_Follower< 0.008695 24   756.62500 40.87500  
##        8) Track_Popularity< 48.5 15   399.73330 38.53333 *
##        9) Track_Popularity>=48.5 9   137.55560 44.77778 *
##      5) Artist_Follower>=0.008695 60  3992.85000 60.45000  
##       10) pc_1< 1.01413 40  1397.97500 56.52500  
##         20) Artist_Follower< 0.0946055 26   814.96150 54.03846  
##           40) fa_2< -0.2211121 10   130.50000 49.50000 *
##           41) fa_2>=-0.2211121 16   349.75000 56.87500 *
##         21) Artist_Follower>=0.0946055 14   123.71430 61.14286 *
##       11) pc_1>=1.01413 20   746.20000 68.30000  
##         22) Track_Popularity< 54.5 7    75.42857 63.71429 *
##         23) Track_Popularity>=54.5 13   444.30770 70.76923 *
##    3) Artist_Follower>=0.2779545 58  3764.91400 77.81034  
##      6) Artist_Follower< 2.122275 46  1593.93500 74.84783  
##       12) Track_Popularity< 68.5 37  1001.29700 73.27027  
##         24) Artist_Follower< 0.5444075 11   250.72730 68.54545 *
##         25) Artist_Follower>=0.5444075 26   401.11540 75.26923  
##           50) pc_2sq>=0.5148601 13   124.92310 73.07692 *
##           51) pc_2sq< 0.5148601 13   151.23080 77.46154 *
##       13) Track_Popularity>=68.5 9   122.00000 81.33333 *
##      7) Artist_Follower>=2.122275 12   219.66670 89.16667 *
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{rpart.plot}\NormalTok{(rpart.best.cv)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-60-2.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{RMSE}\NormalTok{(}\KeywordTok{predict}\NormalTok{(rpart.best.cv, }\DataTypeTok{newdata =}\NormalTok{ train.data), train.data}\OperatorTok{$}\NormalTok{Artist_Popularity)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 4.220621
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{R2}\NormalTok{(}\KeywordTok{predict}\NormalTok{(rpart.best.cv, }\DataTypeTok{newdata =}\NormalTok{ train.data), train.data}\OperatorTok{$}\NormalTok{Artist_Popularity)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.9237157
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{performace_metrics[}\DecValTok{8}\NormalTok{,}\DecValTok{3}\NormalTok{] <-}\StringTok{ }\KeywordTok{RMSE}\NormalTok{(}\KeywordTok{predict}\NormalTok{(rpart.best.cv, }\DataTypeTok{newdata =}\NormalTok{ train.data), train.data}\OperatorTok{$}\NormalTok{Artist_Popularity)}
\NormalTok{performace_metrics[}\DecValTok{8}\NormalTok{,}\DecValTok{4}\NormalTok{] <-}\StringTok{ }\KeywordTok{R2}\NormalTok{(}\KeywordTok{predict}\NormalTok{(rpart.best.cv, }\DataTypeTok{newdata =}\NormalTok{ train.data), train.data}\OperatorTok{$}\NormalTok{Artist_Popularity)}

\KeywordTok{RMSE}\NormalTok{(}\KeywordTok{predict}\NormalTok{(rpart.best.cv, }\DataTypeTok{newdata =}\NormalTok{ test.data), test.data}\OperatorTok{$}\NormalTok{Artist_Popularity)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 7.001912
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{R2}\NormalTok{(}\KeywordTok{predict}\NormalTok{(rpart.best.cv, }\DataTypeTok{newdata =}\NormalTok{ test.data), test.data}\OperatorTok{$}\NormalTok{Artist_Popularity)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.808911
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{performace_metrics[}\DecValTok{8}\NormalTok{,}\DecValTok{5}\NormalTok{] <-}\StringTok{ }\KeywordTok{RMSE}\NormalTok{(}\KeywordTok{predict}\NormalTok{(rpart.best.cv, }\DataTypeTok{newdata =}\NormalTok{ test.data), test.data}\OperatorTok{$}\NormalTok{Artist_Popularity)}
\NormalTok{performace_metrics[}\DecValTok{8}\NormalTok{,}\DecValTok{6}\NormalTok{] <-}\StringTok{ }\KeywordTok{R2}\NormalTok{(}\KeywordTok{predict}\NormalTok{(rpart.best.cv, }\DataTypeTok{newdata =}\NormalTok{ test.data), test.data}\OperatorTok{$}\NormalTok{Artist_Popularity)}

\CommentTok{#########################################################################}

\KeywordTok{library}\NormalTok{(}\StringTok{"randomForest"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## randomForest 4.6-14
\end{verbatim}

\begin{verbatim}
## Type rfNews() to see new features/changes/bug fixes.
\end{verbatim}

\begin{verbatim}
## 
## Attaching package: 'randomForest'
\end{verbatim}

\begin{verbatim}
## The following object is masked from 'package:ggplot2':
## 
##     margin
\end{verbatim}

\begin{verbatim}
## The following object is masked from 'package:psych':
## 
##     outlier
\end{verbatim}

\begin{verbatim}
## The following object is masked from 'package:dplyr':
## 
##     combine
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{42}\NormalTok{)}
\NormalTok{rf <-}\KeywordTok{randomForest}\NormalTok{(Artist_Popularity}\OperatorTok{~}\NormalTok{fa_}\DecValTok{1}\OperatorTok{+}\NormalTok{fa_}\DecValTok{2}\OperatorTok{+}\NormalTok{fa_}\DecValTok{3}\OperatorTok{+}\NormalTok{fa_}\DecValTok{4}\OperatorTok{+}\NormalTok{pc_}\DecValTok{1}\OperatorTok{+}\NormalTok{pc_}\DecValTok{2}\OperatorTok{+}\NormalTok{Artist_Follower}\OperatorTok{+}\NormalTok{days_release_orig}
                  \OperatorTok{+}\NormalTok{Track_Popularity}\OperatorTok{+}\NormalTok{Track_Duration_ms}\OperatorTok{+}\NormalTok{fa_2sq}\OperatorTok{+}\NormalTok{pc_2sq}\OperatorTok{+}\NormalTok{Artist_Followersq, }\DataTypeTok{data=}\NormalTok{df, }\DataTypeTok{cp =} \DecValTok{0}\NormalTok{, }\DataTypeTok{method =} \StringTok{'anova'}\NormalTok{)}
\KeywordTok{summary}\NormalTok{(rf)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##                 Length Class  Mode     
## call              5    -none- call     
## type              1    -none- character
## predicted       186    -none- numeric  
## mse             500    -none- numeric  
## rsq             500    -none- numeric  
## oob.times       186    -none- numeric  
## importance       13    -none- numeric  
## importanceSD      0    -none- NULL     
## localImportance   0    -none- NULL     
## proximity         0    -none- NULL     
## ntree             1    -none- numeric  
## mtry              1    -none- numeric  
## forest           11    -none- list     
## coefs             0    -none- NULL     
## y               186    -none- numeric  
## test              0    -none- NULL     
## inbag             0    -none- NULL     
## terms             3    terms  call
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imp <-}\StringTok{ }\KeywordTok{importance}\NormalTok{(rf)}
\NormalTok{ind <-}\StringTok{ }\KeywordTok{order}\NormalTok{(imp, }\DataTypeTok{decreasing=}\NormalTok{T)}
\NormalTok{imp[ind,]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   Artist_Follower Artist_Followersq              fa_2 Track_Duration_ms 
##        12415.9483        11284.4988         3553.0032         3522.9291 
##              pc_2  Track_Popularity            fa_2sq            pc_2sq 
##         3490.9451         1639.1507         1388.5078          979.8766 
##              pc_1 days_release_orig              fa_4              fa_3 
##          896.7161          769.5573          713.0933          706.7977 
##              fa_1 
##          455.5893
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{rf_pred <-}\StringTok{ }\KeywordTok{predict}\NormalTok{(rf, df, }\DataTypeTok{type=}\StringTok{"class"}\NormalTok{)}
\NormalTok{n <-}\StringTok{ }\KeywordTok{nrow}\NormalTok{(df)}
\DecValTok{1}\OperatorTok{-}\KeywordTok{sum}\NormalTok{(}\KeywordTok{residuals}\NormalTok{(rf)}\OperatorTok{^}\DecValTok{2}\NormalTok{)}\OperatorTok{/}\NormalTok{((n}\DecValTok{-1}\NormalTok{)}\OperatorTok{*}\KeywordTok{var}\NormalTok{(df}\OperatorTok{$}\NormalTok{Artist_Popularity))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{RMSE}\NormalTok{(}\KeywordTok{predict}\NormalTok{(rf, }\DataTypeTok{newdata =}\NormalTok{ df), df}\OperatorTok{$}\NormalTok{Artist_Popularity)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 2.114803
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{R2}\NormalTok{(}\KeywordTok{predict}\NormalTok{(rf, }\DataTypeTok{newdata =}\NormalTok{ df), df}\OperatorTok{$}\NormalTok{Artist_Popularity)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.9825223
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{performace_metrics[}\DecValTok{9}\NormalTok{,}\DecValTok{1}\NormalTok{] <-}\StringTok{ }\KeywordTok{RMSE}\NormalTok{(}\KeywordTok{predict}\NormalTok{(rf, }\DataTypeTok{newdata =}\NormalTok{ df), df}\OperatorTok{$}\NormalTok{Artist_Popularity)}
\NormalTok{performace_metrics[}\DecValTok{9}\NormalTok{,}\DecValTok{2}\NormalTok{] <-}\StringTok{ }\KeywordTok{R2}\NormalTok{(}\KeywordTok{predict}\NormalTok{(rf, }\DataTypeTok{newdata =}\NormalTok{ df), df}\OperatorTok{$}\NormalTok{Artist_Popularity)}

\CommentTok{# RMSE(predict(rf, newdata = train.data), train.data$Artist_Popularity)}
\CommentTok{# R2(predict(rf, newdata = train.data), train.data$Artist_Popularity)}

\CommentTok{# RMSE(predict(rf, newdata = test.data), test.data$Artist_Popularity)}
\CommentTok{# R2(predict(rf, newdata = test.data), test.data$Artist_Popularity)}


\CommentTok{#########################################################################}
\KeywordTok{library}\NormalTok{(}\StringTok{"data.table"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Attaching package: 'data.table'
\end{verbatim}

\begin{verbatim}
## The following objects are masked from 'package:dplyr':
## 
##     between, first, last
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(}\StringTok{"mlr"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Loading required package: ParamHelpers
\end{verbatim}

\begin{verbatim}
## 'mlr' is in maintenance mode since July 2019. Future development
## efforts will go into its successor 'mlr3' (<https://mlr3.mlr-org.com>).
\end{verbatim}

\begin{verbatim}
## 
## Attaching package: 'mlr'
\end{verbatim}

\begin{verbatim}
## The following objects are masked _by_ '.GlobalEnv':
## 
##     f1, rmse
\end{verbatim}

\begin{verbatim}
## The following object is masked from 'package:e1071':
## 
##     impute
\end{verbatim}

\begin{verbatim}
## The following object is masked from 'package:caret':
## 
##     train
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(}\StringTok{"parallel"}\NormalTok{)}

\NormalTok{rf_train <-}\StringTok{ }\KeywordTok{as.data.table}\NormalTok{(train)}
\NormalTok{rf_test <-}\StringTok{ }\KeywordTok{as.data.table}\NormalTok{(test)}

\NormalTok{task <-}\StringTok{ }\KeywordTok{makeRegrTask}\NormalTok{(}\DataTypeTok{data =}\NormalTok{ train, }\DataTypeTok{target =} \StringTok{"Artist_Popularity"}\NormalTok{)}

\NormalTok{rf_learner <-}\StringTok{ }\KeywordTok{makeLearner}\NormalTok{(}\StringTok{"regr.randomForest"}\NormalTok{, }
                          \DataTypeTok{predict.type =} \StringTok{"response"}\NormalTok{)}

\NormalTok{rf.parms <-}\StringTok{ }\KeywordTok{makeParamSet}\NormalTok{(}
  \CommentTok{# The recommendation for mtry by Breiman is squareroot number of columns}
  \KeywordTok{makeDiscreteParam}\NormalTok{(}\StringTok{"mtry"}\NormalTok{, }\DataTypeTok{values =} \KeywordTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{,}\DecValTok{4}\NormalTok{,}\DecValTok{5}\NormalTok{,}\DecValTok{6}\NormalTok{)), }\CommentTok{# Number of features selected at each node, smaller -> faster}
  \KeywordTok{makeDiscreteParam}\NormalTok{(}\StringTok{"sampsize"}\NormalTok{, }\DataTypeTok{values =}  \KeywordTok{c}\NormalTok{(}\DecValTok{30}\NormalTok{, }\DecValTok{50}\NormalTok{, }\DecValTok{70}\NormalTok{)), }\CommentTok{# bootstrap sample size, smaller -> faster}
  \KeywordTok{makeDiscreteParam}\NormalTok{(}\StringTok{"ntree"}\NormalTok{, }\DataTypeTok{values =} \KeywordTok{c}\NormalTok{(}\DecValTok{10}\NormalTok{,}\DecValTok{30}\NormalTok{,}\DecValTok{50}\NormalTok{,}\DecValTok{100}\NormalTok{, }\DecValTok{500}\NormalTok{, }\DecValTok{1000}\NormalTok{)) }\CommentTok{# Number of tree, smaller -> faster}
\NormalTok{) }

\NormalTok{tuneControl <-}\StringTok{ }\KeywordTok{makeTuneControlGrid}\NormalTok{(}\DataTypeTok{resolution =} \DecValTok{3}\NormalTok{, }\DataTypeTok{tune.threshold =} \OtherTok{FALSE}\NormalTok{)}

\NormalTok{rdesc <-}\StringTok{ }\KeywordTok{makeResampleDesc}\NormalTok{(}\DataTypeTok{method =} \StringTok{"CV"}\NormalTok{, }\DataTypeTok{iters =} \DecValTok{5}\NormalTok{, }\DataTypeTok{stratify =} \OtherTok{FALSE}\NormalTok{)}

\KeywordTok{library}\NormalTok{(}\StringTok{"parallelMap"}\NormalTok{)}

\KeywordTok{parallelStartSocket}\NormalTok{(}\DecValTok{4}\NormalTok{, }\DataTypeTok{level =} \StringTok{"mlr.tuneParams"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Starting parallelization in mode=socket with cpus=4.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#tuning <- tuneParams(rf_learner, task = task, resampling = rdesc,}
\CommentTok{#                     par.set = rf.parms, control = tuneControl, measures = mlr::rmse)}

\CommentTok{# https://stackoverflow.com/questions/51333410/mlr-why-does-reproducibility-of-hyperparameter-tuning-fail-using-parallelizatio}

\KeywordTok{suppressMessages}\NormalTok{(\{}

  \KeywordTok{set.seed}\NormalTok{(}\DecValTok{123456}\NormalTok{, }\StringTok{"L'Ecuyer-CMRG"}\NormalTok{)}
  \KeywordTok{clusterSetRNGStream}\NormalTok{(}\DataTypeTok{iseed =} \DecValTok{123456}\NormalTok{)}
\NormalTok{  tuning <-}\StringTok{ }\KeywordTok{tuneParams}\NormalTok{(rf_learner, }\DataTypeTok{task =}\NormalTok{ task, }\DataTypeTok{resampling =}\NormalTok{ rdesc,}
                     \DataTypeTok{par.set =}\NormalTok{ rf.parms, }\DataTypeTok{control =}\NormalTok{ tuneControl, }\DataTypeTok{measures =}\NormalTok{ mlr}\OperatorTok{::}\NormalTok{rmse)}
  
\NormalTok{\})}

\KeywordTok{parallelStop}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Stopped parallelization. All cleaned up.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tuning}\OperatorTok{$}\NormalTok{x}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## $mtry
## [1] 5
## 
## $sampsize
## [1] 70
## 
## $ntree
## [1] 1000
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tuning_results <-}\StringTok{ }\KeywordTok{generateHyperParsEffectData}\NormalTok{(tuning, }\DataTypeTok{partial.dep =} \OtherTok{TRUE}\NormalTok{)}

\NormalTok{tuning_results}\OperatorTok{$}\NormalTok{data}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    mtry sampsize ntree rmse.test.rmse iteration exec.time
## 1     2       30    10       7.057063         1      0.08
## 2     3       30    10       6.989316         2      0.08
## 3     4       30    10       5.905006         3      0.08
## 4     5       30    10       6.178184         4      0.08
## 5     6       30    10       6.634412         5      0.04
## 6     2       50    10       6.541576         6      0.04
## 7     3       50    10       6.383277         7      0.05
## 8     4       50    10       5.635925         8      0.03
## 9     5       50    10       5.551285         9      0.01
## 10    6       50    10       6.255736        10      0.03
## 11    2       70    10       6.140716        11      0.03
## 12    3       70    10       5.908193        12      0.03
## 13    4       70    10       5.977313        13      0.05
## 14    5       70    10       5.805297        14      0.04
## 15    6       70    10       5.714555        15      0.05
## 16    2       30    30       6.816564        16      0.04
## 17    3       30    30       6.097395        17      0.03
## 18    4       30    30       6.032659        18      0.03
## 19    5       30    30       6.198610        19      0.04
## 20    6       30    30       6.074380        20      0.05
## 21    2       50    30       6.384471        21      0.03
## 22    3       50    30       5.915555        22      0.03
## 23    4       50    30       5.861672        23      0.05
## 24    5       50    30       5.578854        24      0.04
## 25    6       50    30       5.718469        25      0.05
## 26    2       70    30       6.044581        26      0.05
## 27    3       70    30       5.724959        27      0.04
## 28    4       70    30       5.380153        28      0.03
## 29    5       70    30       5.361231        29      0.05
## 30    6       70    30       5.367752        30      0.04
## 31    2       30    50       6.653960        31      0.03
## 32    3       30    50       6.352227        32      0.05
## 33    4       30    50       6.024734        33      0.04
## 34    5       30    50       5.887570        34      0.03
## 35    6       30    50       5.846218        35      0.05
## 36    2       50    50       6.326371        36      0.04
## 37    3       50    50       5.917528        37      0.05
## 38    4       50    50       5.751127        38      0.04
## 39    5       50    50       5.583523        39      0.06
## 40    6       50    50       5.615794        40      0.05
## 41    2       70    50       5.915201        41      0.05
## 42    3       70    50       5.466326        42      0.05
## 43    4       70    50       5.551985        43      0.05
## 44    5       70    50       5.351609        44      0.06
## 45    6       70    50       5.467980        45      0.08
## 46    2       30   100       6.611929        46      0.04
## 47    3       30   100       5.965426        47      0.04
## 48    4       30   100       5.785383        48      0.05
## 49    5       30   100       5.953708        49      0.05
## 50    6       30   100       5.774957        50      0.05
## 51    2       50   100       6.232674        51      0.06
## 52    3       50   100       5.656968        52      0.05
## 53    4       50   100       5.518861        53      0.07
## 54    5       50   100       5.561284        54      0.06
## 55    6       50   100       5.450817        55      0.06
## 56    2       70   100       5.941343        56      0.06
## 57    3       70   100       5.418707        57      0.07
## 58    4       70   100       5.413302        58      0.09
## 59    5       70   100       5.351007        59      0.10
## 60    6       70   100       5.357893        60      0.12
## 61    2       30   500       6.554279        61      0.10
## 62    3       30   500       6.013938        62      0.10
## 63    4       30   500       5.931863        63      0.14
## 64    5       30   500       5.745746        64      0.14
## 65    6       30   500       5.744130        65      0.18
## 66    2       50   500       5.983638        66      0.15
## 67    3       50   500       5.584582        67      0.19
## 68    4       50   500       5.496129        68      0.23
## 69    5       50   500       5.443598        69      0.22
## 70    6       50   500       5.445620        70      0.25
## 71    2       70   500       5.657875        71      0.22
## 72    3       70   500       5.443639        72      0.25
## 73    4       70   500       5.320122        73      0.30
## 74    5       70   500       5.318396        74      0.36
## 75    6       70   500       5.350204        75      0.40
## 76    2       30  1000       6.458021        76      0.17
## 77    3       30  1000       6.075335        77      0.19
## 78    4       30  1000       5.868188        78      0.25
## 79    5       30  1000       5.844182        79      0.27
## 80    6       30  1000       5.763801        80      0.30
## 81    2       50  1000       5.945530        81      0.32
## 82    3       50  1000       5.550041        82      0.33
## 83    4       50  1000       5.465704        83      0.39
## 84    5       50  1000       5.423774        84      0.46
## 85    6       50  1000       5.442359        85      0.53
## 86    2       70  1000       5.718196        86      0.42
## 87    3       70  1000       5.414982        87      0.50
## 88    4       70  1000       5.343901        88      0.56
## 89    5       70  1000       5.303770        89      0.64
## 90    6       70  1000       5.374509        90      0.70
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{tapply}\NormalTok{(tuning_results}\OperatorTok{$}\NormalTok{data}\OperatorTok{$}\NormalTok{rmse.test.rmse, }\DataTypeTok{INDEX =} \KeywordTok{c}\NormalTok{(tuning_results}\OperatorTok{$}\NormalTok{data}\OperatorTok{$}\NormalTok{mtry), mean)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##        2        3        4        5        6 
## 6.276888 5.882133 5.681335 5.635646 5.688866
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{rf_tuned <-}\StringTok{ }\KeywordTok{setHyperPars}\NormalTok{(rf_learner, }\DataTypeTok{par.vals =}\NormalTok{ tuning}\OperatorTok{$}\NormalTok{x)}
\NormalTok{rf_model <-}\StringTok{ }\NormalTok{mlr}\OperatorTok{::}\KeywordTok{train}\NormalTok{(rf_tuned, }\DataTypeTok{task =}\NormalTok{ task)}
\NormalTok{rf_pred_train <-}\StringTok{ }\KeywordTok{predict}\NormalTok{(rf_model, }\DataTypeTok{newdata =}\NormalTok{ train, }\DataTypeTok{type =} \StringTok{"response"}\NormalTok{)}
\NormalTok{rf_pred_test <-}\StringTok{ }\KeywordTok{predict}\NormalTok{(rf_model, }\DataTypeTok{newdata =}\NormalTok{ test, }\DataTypeTok{type =} \StringTok{"response"}\NormalTok{)}
\CommentTok{# rf_pred_train$data$response}
\CommentTok{# rf_pred_test$data$response}

\KeywordTok{RMSE}\NormalTok{(}\KeywordTok{predict}\NormalTok{(rf_model, }\DataTypeTok{newdata =}\NormalTok{ train, }\DataTypeTok{type =} \StringTok{"response"}\NormalTok{)}\OperatorTok{$}\NormalTok{data}\OperatorTok{$}\NormalTok{response, train}\OperatorTok{$}\NormalTok{Artist_Popularity)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 3.370124
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{R2}\NormalTok{(}\KeywordTok{predict}\NormalTok{(rf_model, }\DataTypeTok{newdata =}\NormalTok{ train, }\DataTypeTok{type =} \StringTok{"response"}\NormalTok{)}\OperatorTok{$}\NormalTok{data}\OperatorTok{$}\NormalTok{response, train}\OperatorTok{$}\NormalTok{Artist_Popularity)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.9581589
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{performace_metrics[}\DecValTok{9}\NormalTok{,}\DecValTok{3}\NormalTok{] <-}\StringTok{ }\KeywordTok{RMSE}\NormalTok{(}\KeywordTok{predict}\NormalTok{(rf_model, }\DataTypeTok{newdata =}\NormalTok{ train, }\DataTypeTok{type =} \StringTok{"response"}\NormalTok{)}\OperatorTok{$}\NormalTok{data}\OperatorTok{$}\NormalTok{response, train}\OperatorTok{$}\NormalTok{Artist_Popularity)}
\NormalTok{performace_metrics[}\DecValTok{9}\NormalTok{,}\DecValTok{4}\NormalTok{] <-}\StringTok{ }\KeywordTok{R2}\NormalTok{(}\KeywordTok{predict}\NormalTok{(rf_model, }\DataTypeTok{newdata =}\NormalTok{ train, }\DataTypeTok{type =} \StringTok{"response"}\NormalTok{)}\OperatorTok{$}\NormalTok{data}\OperatorTok{$}\NormalTok{response, train}\OperatorTok{$}\NormalTok{Artist_Popularity)}

\KeywordTok{RMSE}\NormalTok{(}\KeywordTok{predict}\NormalTok{(rf_model, }\DataTypeTok{newdata =}\NormalTok{ test, }\DataTypeTok{type =} \StringTok{"class"}\NormalTok{)}\OperatorTok{$}\NormalTok{data}\OperatorTok{$}\NormalTok{response, test}\OperatorTok{$}\NormalTok{Artist_Popularity)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 4.740843
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{R2}\NormalTok{(}\KeywordTok{predict}\NormalTok{(rf_model, }\DataTypeTok{newdata =}\NormalTok{ test, }\DataTypeTok{type =} \StringTok{"class"}\NormalTok{)}\OperatorTok{$}\NormalTok{data}\OperatorTok{$}\NormalTok{response, test}\OperatorTok{$}\NormalTok{Artist_Popularity)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.9040584
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{performace_metrics[}\DecValTok{9}\NormalTok{,}\DecValTok{5}\NormalTok{] <-}\StringTok{ }\KeywordTok{RMSE}\NormalTok{(}\KeywordTok{predict}\NormalTok{(rf_model, }\DataTypeTok{newdata =}\NormalTok{ test, }\DataTypeTok{type =} \StringTok{"response"}\NormalTok{)}\OperatorTok{$}\NormalTok{data}\OperatorTok{$}\NormalTok{response, test}\OperatorTok{$}\NormalTok{Artist_Popularity)}
\NormalTok{performace_metrics[}\DecValTok{9}\NormalTok{,}\DecValTok{6}\NormalTok{] <-}\StringTok{ }\KeywordTok{R2}\NormalTok{(}\KeywordTok{predict}\NormalTok{(rf_model, }\DataTypeTok{newdata =}\NormalTok{ test, }\DataTypeTok{type =} \StringTok{"response"}\NormalTok{)}\OperatorTok{$}\NormalTok{data}\OperatorTok{$}\NormalTok{response, test}\OperatorTok{$}\NormalTok{Artist_Popularity)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(}\StringTok{"MASS"}\NormalTok{)}
\KeywordTok{library}\NormalTok{(}\StringTok{"nnet"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Attaching package: 'nnet'
\end{verbatim}

\begin{verbatim}
## The following object is masked from 'package:mgcv':
## 
##     multinom
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df_z <-}\StringTok{ }\KeywordTok{scale}\NormalTok{(}\KeywordTok{as.matrix}\NormalTok{(df))}
\NormalTok{train_z <-}\StringTok{ }\KeywordTok{as.data.frame}\NormalTok{(df_z[idx.train, ])}
\NormalTok{test_z <-}\StringTok{ }\KeywordTok{as.data.frame}\NormalTok{(df_z[}\OperatorTok{-}\NormalTok{idx.train,])}

\NormalTok{mean_mat <-}\StringTok{ }\KeywordTok{matrix}\NormalTok{(, }\DataTypeTok{nrow =} \KeywordTok{dim}\NormalTok{(df)[}\DecValTok{1}\NormalTok{], }\DataTypeTok{ncol =} \KeywordTok{dim}\NormalTok{(df)[}\DecValTok{2}\NormalTok{])}
\NormalTok{mean_mat[}\DecValTok{1}\NormalTok{, ] <-}\StringTok{ }\KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{sapply}\NormalTok{(df, mean, }\DataTypeTok{na.rm =} \OtherTok{TRUE}\NormalTok{))}

\KeywordTok{library}\NormalTok{(}\StringTok{"zoo"}\NormalTok{)}
\NormalTok{mean_mat <-}\StringTok{ }\KeywordTok{na.locf}\NormalTok{(mean_mat)}

\NormalTok{diag_sd <-}\StringTok{ }\KeywordTok{diag}\NormalTok{(}\KeywordTok{sapply}\NormalTok{(df, sd, }\DataTypeTok{na.rm =} \OtherTok{TRUE}\NormalTok{))}

\CommentTok{# Backtransformation scale to orginal}

\CommentTok{# as.matrix(df_z) %*% diag_sd + mean_mat}

\NormalTok{task <-}\StringTok{ }\KeywordTok{makeRegrTask}\NormalTok{(}\DataTypeTok{data =}\NormalTok{ train_z, }\DataTypeTok{target =} \StringTok{"Artist_Popularity"}\NormalTok{)}
\NormalTok{nnet <-}\StringTok{ }\KeywordTok{makeLearner}\NormalTok{(}\StringTok{"regr.nnet"}\NormalTok{, }\DataTypeTok{predict.type =} \StringTok{"response"}\NormalTok{, }\DataTypeTok{par.vals =} \KeywordTok{list}\NormalTok{(}\StringTok{"trace"}\NormalTok{ =}\StringTok{ }\OtherTok{FALSE}\NormalTok{, }\StringTok{"maxit"}\NormalTok{ =}\StringTok{ }\DecValTok{1000}\NormalTok{,}
                                                                           \StringTok{"MaxNWts"}\NormalTok{ =}\StringTok{ }\DecValTok{80000}\NormalTok{))}

\NormalTok{nn.parms <-}\StringTok{ }\KeywordTok{makeParamSet}\NormalTok{(}
  \KeywordTok{makeDiscreteParam}\NormalTok{(}\StringTok{"decay"}\NormalTok{, }\DataTypeTok{values =} \KeywordTok{c}\NormalTok{(}\FloatTok{0.0001}\NormalTok{,}\FloatTok{0.001}\NormalTok{, }\FloatTok{0.01}\NormalTok{, }\FloatTok{0.1}\NormalTok{)), }
  \KeywordTok{makeDiscreteParam}\NormalTok{(}\StringTok{"size"}\NormalTok{, }\DataTypeTok{values =} \KeywordTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{,}\DecValTok{4}\NormalTok{,}\DecValTok{6}\NormalTok{,}\DecValTok{8}\NormalTok{,}\DecValTok{10}\NormalTok{,}\DecValTok{12}\NormalTok{,}\DecValTok{14}\NormalTok{)))}

\NormalTok{tuneControl <-}\StringTok{ }\KeywordTok{makeTuneControlGrid}\NormalTok{(}\DataTypeTok{resolution =} \DecValTok{3}\NormalTok{, }\DataTypeTok{tune.threshold =} \OtherTok{FALSE}\NormalTok{)}

\NormalTok{rdesc <-}\StringTok{ }\KeywordTok{makeResampleDesc}\NormalTok{(}\DataTypeTok{method =} \StringTok{"CV"}\NormalTok{, }\DataTypeTok{iters =} \DecValTok{5}\NormalTok{, }\DataTypeTok{stratify =} \OtherTok{FALSE}\NormalTok{)}


\KeywordTok{parallelStartSocket}\NormalTok{(}\DecValTok{4}\NormalTok{, }\DataTypeTok{level =} \StringTok{"mlr.tuneParams"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Starting parallelization in mode=socket with cpus=4.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# tuning <- tuneParams(nnet, task = task, resampling = rdesc, par.set = nn.parms, control = tuneControl,}
\CommentTok{#                     measures = mlr::rmse)}

\KeywordTok{suppressMessages}\NormalTok{(\{}

  \KeywordTok{set.seed}\NormalTok{(}\DecValTok{123456}\NormalTok{, }\StringTok{"L'Ecuyer-CMRG"}\NormalTok{)}
  \KeywordTok{clusterSetRNGStream}\NormalTok{(}\DataTypeTok{iseed =} \DecValTok{123456}\NormalTok{)}
\NormalTok{  tuning <-}\StringTok{ }\KeywordTok{tuneParams}\NormalTok{(nnet, }\DataTypeTok{task =}\NormalTok{ task, }\DataTypeTok{resampling =}\NormalTok{ rdesc, }\DataTypeTok{par.set =}\NormalTok{ nn.parms, }\DataTypeTok{control =}\NormalTok{ tuneControl,}
                     \DataTypeTok{measures =}\NormalTok{ mlr}\OperatorTok{::}\NormalTok{rmse)}
\NormalTok{\})}

\KeywordTok{parallelStop}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Stopped parallelization. All cleaned up.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tuning}\OperatorTok{$}\NormalTok{x }\CommentTok{# result with full data set was decay = 1e-04, size = 2, rmse.test.rmse = 0.4336486}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## $decay
## [1] 0.01
## 
## $size
## [1] 2
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tuning_results <-}\StringTok{ }\KeywordTok{generateHyperParsEffectData}\NormalTok{(tuning, }\DataTypeTok{partial.dep =} \OtherTok{FALSE}\NormalTok{)}

\KeywordTok{plotHyperParsEffect}\NormalTok{(tuning_results, }\DataTypeTok{x =} \StringTok{"size"}\NormalTok{, }\DataTypeTok{y =} \StringTok{"rmse.test.rmse"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-61-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{plotHyperParsEffect}\NormalTok{(tuning_results, }\DataTypeTok{x =} \StringTok{"decay"}\NormalTok{, }\DataTypeTok{y =} \StringTok{"rmse.test.rmse"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-61-2.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{nnet.tuned <-}\StringTok{ }\KeywordTok{setHyperPars}\NormalTok{(nnet, }\DataTypeTok{par.vals =}\NormalTok{ tuning}\OperatorTok{$}\NormalTok{x)}
\NormalTok{nn_model <-}\StringTok{ }\NormalTok{mlr}\OperatorTok{::}\KeywordTok{train}\NormalTok{(nnet.tuned, }\DataTypeTok{task =}\NormalTok{ task)}

\NormalTok{nn_pred_train <-}\StringTok{ }\KeywordTok{predict}\NormalTok{(nn_model, }\DataTypeTok{newdata =}\NormalTok{ train_z, }\DataTypeTok{type =} \StringTok{"response"}\NormalTok{)}
\NormalTok{nn_pred_test <-}\StringTok{ }\KeywordTok{predict}\NormalTok{(nn_model, }\DataTypeTok{newdata =}\NormalTok{ test_z, }\DataTypeTok{type =} \StringTok{"response"}\NormalTok{)}

\KeywordTok{RMSE}\NormalTok{(}\KeywordTok{predict}\NormalTok{(nn_model, }\DataTypeTok{newdata =}\NormalTok{ train_z, }\DataTypeTok{type =} \StringTok{"response"}\NormalTok{)}\OperatorTok{$}\NormalTok{data}\OperatorTok{$}\NormalTok{response, train_z}\OperatorTok{$}\NormalTok{Artist_Popularity)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.3410186
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{R2}\NormalTok{(}\KeywordTok{predict}\NormalTok{(nn_model, }\DataTypeTok{newdata =}\NormalTok{ train_z, }\DataTypeTok{type =} \StringTok{"response"}\NormalTok{)}\OperatorTok{$}\NormalTok{data}\OperatorTok{$}\NormalTok{response, train_z}\OperatorTok{$}\NormalTok{Artist_Popularity)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.8854886
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{RMSE}\NormalTok{(}\KeywordTok{predict}\NormalTok{(nn_model, }\DataTypeTok{newdata =}\NormalTok{ test_z, }\DataTypeTok{type =} \StringTok{"response"}\NormalTok{)}\OperatorTok{$}\NormalTok{data}\OperatorTok{$}\NormalTok{response, test_z}\OperatorTok{$}\NormalTok{Artist_Popularity)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.4563401
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{R2}\NormalTok{(}\KeywordTok{predict}\NormalTok{(nn_model, }\DataTypeTok{newdata =}\NormalTok{ test_z, }\DataTypeTok{type =} \StringTok{"response"}\NormalTok{)}\OperatorTok{$}\NormalTok{data}\OperatorTok{$}\NormalTok{response, test_z}\OperatorTok{$}\NormalTok{Artist_Popularity)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.8231612
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Scale predictions back to original:}

\CommentTok{# as.matrix(train_z[, 11]) %*% diag_sd[11,11] + mean_mat[1,11] == train[,11]}

\KeywordTok{RMSE}\NormalTok{(}\KeywordTok{as.matrix}\NormalTok{(nn_pred_train}\OperatorTok{$}\NormalTok{data}\OperatorTok{$}\NormalTok{response) }\OperatorTok{%*%}\StringTok{ }\NormalTok{diag_sd[}\DecValTok{11}\NormalTok{,}\DecValTok{11}\NormalTok{] }\OperatorTok{+}\StringTok{ }\NormalTok{mean_mat[}\DecValTok{1}\NormalTok{,}\DecValTok{11}\NormalTok{], train}\OperatorTok{$}\NormalTok{Artist_Popularity)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 5.171305
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{R2}\NormalTok{(}\KeywordTok{as.matrix}\NormalTok{(nn_pred_train}\OperatorTok{$}\NormalTok{data}\OperatorTok{$}\NormalTok{response) }\OperatorTok{%*%}\StringTok{ }\NormalTok{diag_sd[}\DecValTok{11}\NormalTok{,}\DecValTok{11}\NormalTok{] }\OperatorTok{+}\StringTok{ }\NormalTok{mean_mat[}\DecValTok{1}\NormalTok{,}\DecValTok{11}\NormalTok{], train}\OperatorTok{$}\NormalTok{Artist_Popularity)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##           [,1]
## [1,] 0.8854886
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{performace_metrics[}\DecValTok{10}\NormalTok{,}\DecValTok{3}\NormalTok{] <-}\StringTok{ }\KeywordTok{RMSE}\NormalTok{(}\KeywordTok{as.matrix}\NormalTok{(nn_pred_train}\OperatorTok{$}\NormalTok{data}\OperatorTok{$}\NormalTok{response) }\OperatorTok{%*%}\StringTok{ }\NormalTok{diag_sd[}\DecValTok{11}\NormalTok{,}\DecValTok{11}\NormalTok{] }\OperatorTok{+}\StringTok{ }\NormalTok{mean_mat[}\DecValTok{1}\NormalTok{,}\DecValTok{11}\NormalTok{], train}\OperatorTok{$}\NormalTok{Artist_Popularity)}
\NormalTok{performace_metrics[}\DecValTok{10}\NormalTok{,}\DecValTok{4}\NormalTok{] <-}\StringTok{ }\KeywordTok{R2}\NormalTok{(}\KeywordTok{as.matrix}\NormalTok{(nn_pred_train}\OperatorTok{$}\NormalTok{data}\OperatorTok{$}\NormalTok{response) }\OperatorTok{%*%}\StringTok{ }\NormalTok{diag_sd[}\DecValTok{11}\NormalTok{,}\DecValTok{11}\NormalTok{] }\OperatorTok{+}\StringTok{ }\NormalTok{mean_mat[}\DecValTok{1}\NormalTok{,}\DecValTok{11}\NormalTok{], train}\OperatorTok{$}\NormalTok{Artist_Popularity)}

\KeywordTok{RMSE}\NormalTok{(}\KeywordTok{as.matrix}\NormalTok{(nn_pred_test}\OperatorTok{$}\NormalTok{data}\OperatorTok{$}\NormalTok{response) }\OperatorTok{%*%}\StringTok{ }\NormalTok{diag_sd[}\DecValTok{11}\NormalTok{,}\DecValTok{11}\NormalTok{] }\OperatorTok{+}\StringTok{ }\NormalTok{mean_mat[}\DecValTok{1}\NormalTok{,}\DecValTok{11}\NormalTok{], test}\OperatorTok{$}\NormalTok{Artist_Popularity)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 6.920074
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{R2}\NormalTok{(}\KeywordTok{as.matrix}\NormalTok{(nn_pred_test}\OperatorTok{$}\NormalTok{data}\OperatorTok{$}\NormalTok{response) }\OperatorTok{%*%}\StringTok{ }\NormalTok{diag_sd[}\DecValTok{11}\NormalTok{,}\DecValTok{11}\NormalTok{] }\OperatorTok{+}\StringTok{ }\NormalTok{mean_mat[}\DecValTok{1}\NormalTok{,}\DecValTok{11}\NormalTok{], test}\OperatorTok{$}\NormalTok{Artist_Popularity)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##           [,1]
## [1,] 0.8231612
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{performace_metrics[}\DecValTok{10}\NormalTok{,}\DecValTok{5}\NormalTok{] <-}\StringTok{ }\KeywordTok{RMSE}\NormalTok{(}\KeywordTok{as.matrix}\NormalTok{(nn_pred_test}\OperatorTok{$}\NormalTok{data}\OperatorTok{$}\NormalTok{response) }\OperatorTok{%*%}\StringTok{ }\NormalTok{diag_sd[}\DecValTok{11}\NormalTok{,}\DecValTok{11}\NormalTok{] }\OperatorTok{+}\StringTok{ }\NormalTok{mean_mat[}\DecValTok{1}\NormalTok{,}\DecValTok{11}\NormalTok{], test}\OperatorTok{$}\NormalTok{Artist_Popularity)}
\NormalTok{performace_metrics[}\DecValTok{10}\NormalTok{,}\DecValTok{6}\NormalTok{] <-}\StringTok{ }\KeywordTok{R2}\NormalTok{(}\KeywordTok{as.matrix}\NormalTok{(nn_pred_test}\OperatorTok{$}\NormalTok{data}\OperatorTok{$}\NormalTok{response) }\OperatorTok{%*%}\StringTok{ }\NormalTok{diag_sd[}\DecValTok{11}\NormalTok{,}\DecValTok{11}\NormalTok{] }\OperatorTok{+}\StringTok{ }\NormalTok{mean_mat[}\DecValTok{1}\NormalTok{,}\DecValTok{11}\NormalTok{], test}\OperatorTok{$}\NormalTok{Artist_Popularity)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{round}\NormalTok{(performace_metrics, }\DataTypeTok{digits =} \DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##       [,1] [,2] [,3] [,4]  [,5] [,6]
##  [1,] 6.91 0.79 6.84 0.80  9.28 0.63
##  [2,] 7.24 0.77 7.21 0.78  8.19 0.70
##  [3,] 7.03 0.78 6.94 0.79  7.70 0.73
##  [4,] 7.04 0.78 6.94 0.79  8.06 0.71
##  [5,] 3.37 0.95 3.32 0.95 53.30 0.22
##  [6,] 5.51 0.87 5.59 0.87  5.93 0.84
##  [7,] 3.06 0.96 3.11 0.96  8.09 0.77
##  [8,] 4.46 0.91 4.22 0.92  7.00 0.81
##  [9,] 2.11 0.98 3.37 0.96  4.74 0.90
## [10,]   NA   NA 5.17 0.89  6.92 0.82
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Classification}

\NormalTok{df}\OperatorTok{$}\NormalTok{Charts <-}\StringTok{ }\KeywordTok{as.factor}\NormalTok{(x_noout}\OperatorTok{$}\NormalTok{Charts)}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{42}\NormalTok{)}
\NormalTok{rpart <-}\StringTok{ }\KeywordTok{rpart}\NormalTok{(}\DataTypeTok{data =}\NormalTok{ df,Charts}\OperatorTok{~}\NormalTok{.,}\DataTypeTok{method =} \StringTok{'class'}\NormalTok{)}
\KeywordTok{rpart.plot}\NormalTok{(rpart)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-63-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{rf_pred <-}\StringTok{ }\KeywordTok{predict}\NormalTok{(rpart, }\DataTypeTok{newdata =}\NormalTok{ df, }\DataTypeTok{type =} \StringTok{"class"}\NormalTok{)}
\NormalTok{confMat <-}\StringTok{ }\KeywordTok{table}\NormalTok{(df}\OperatorTok{$}\NormalTok{Charts,rf_pred)}
\NormalTok{confMat }\CommentTok{# 0: not in charts, 1: in charts}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    rf_pred
##      0  1
##   0 93  0
##   1  7 86
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{accuracy <-}\StringTok{ }\KeywordTok{sum}\NormalTok{(}\KeywordTok{diag}\NormalTok{(confMat))}\OperatorTok{/}\KeywordTok{sum}\NormalTok{(confMat)}
\NormalTok{accuracy}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.9623656
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# 0.9623656}

\KeywordTok{par}\NormalTok{(}\DataTypeTok{mfrow=}\KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{))}
\KeywordTok{printcp}\NormalTok{(rpart)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Classification tree:
## rpart(formula = Charts ~ ., data = df, method = "class")
## 
## Variables actually used in tree construction:
## [1] fa_2              pc_1              Track_Duration_ms
## 
## Root node error: 93/186 = 0.5
## 
## n= 186 
## 
##         CP nsplit rel error  xerror     xstd
## 1 0.795699      0  1.000000 1.18280 0.072088
## 2 0.118280      1  0.204301 0.21505 0.045429
## 3 0.010753      2  0.086022 0.10753 0.033076
## 4 0.010000      3  0.075269 0.13978 0.037390
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{plotcp}\NormalTok{(rpart)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-63-2.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{rpart}\OperatorTok{$}\NormalTok{cptable}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##           CP nsplit  rel error    xerror       xstd
## 1 0.79569892      0 1.00000000 1.1827957 0.07208812
## 2 0.11827957      1 0.20430108 0.2150538 0.04542863
## 3 0.01075269      2 0.08602151 0.1075269 0.03307630
## 4 0.01000000      3 0.07526882 0.1397849 0.03738999
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{best.cp <-}\StringTok{ }\NormalTok{rpart}\OperatorTok{$}\NormalTok{cptable[}\KeywordTok{which.min}\NormalTok{(rpart}\OperatorTok{$}\NormalTok{cptable[,}\StringTok{"xerror"}\NormalTok{]),}\StringTok{"CP"}\NormalTok{]}
\NormalTok{best.cp}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.01075269
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{42}\NormalTok{)}
\NormalTok{rpart_pruned <-}\StringTok{ }\KeywordTok{prune}\NormalTok{(rpart, }\DataTypeTok{cp=}\NormalTok{best.cp)}
\KeywordTok{rpart.plot}\NormalTok{(rpart_pruned)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-63-3.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{rf_pred <-}\StringTok{ }\KeywordTok{predict}\NormalTok{(rpart_pruned, }\DataTypeTok{newdata =}\NormalTok{ df, }\DataTypeTok{type =} \StringTok{"class"}\NormalTok{)}
\NormalTok{confMat <-}\StringTok{ }\KeywordTok{table}\NormalTok{(df}\OperatorTok{$}\NormalTok{Charts,rf_pred)}
\NormalTok{confMat }\CommentTok{# 0: not in charts, 1: in charts}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    rf_pred
##      0  1
##   0 89  4
##   1  4 89
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{accuracy <-}\StringTok{ }\KeywordTok{sum}\NormalTok{(}\KeywordTok{diag}\NormalTok{(confMat))}\OperatorTok{/}\KeywordTok{sum}\NormalTok{(confMat)}
\NormalTok{accuracy}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.9569892
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# 0.9569892}

\KeywordTok{library}\NormalTok{(}\StringTok{"caret"}\NormalTok{)}

\NormalTok{train.data <-}\StringTok{ }\NormalTok{df[idx.train, ]}
\NormalTok{test.data <-}\StringTok{ }\NormalTok{df[}\OperatorTok{-}\NormalTok{idx.train,]}

\NormalTok{caret.control <-}\StringTok{ }\KeywordTok{trainControl}\NormalTok{(}\DataTypeTok{method =} \StringTok{"repeatedcv"}\NormalTok{,}
                              \DataTypeTok{number =} \DecValTok{10}\NormalTok{,}
                              \DataTypeTok{repeats =} \DecValTok{3}\NormalTok{)}

\KeywordTok{set.seed}\NormalTok{(}\DecValTok{42}\NormalTok{)}
\NormalTok{rpart.cv <-}\StringTok{ }\NormalTok{caret}\OperatorTok{::}\KeywordTok{train}\NormalTok{(Charts }\OperatorTok{~}\StringTok{ }\NormalTok{., }
                         \DataTypeTok{data =}\NormalTok{ train.data,}
                         \DataTypeTok{method =} \StringTok{"rpart"}\NormalTok{,}
                         \DataTypeTok{trControl =}\NormalTok{ caret.control,}
                         \DataTypeTok{tuneLength =} \DecValTok{15}\NormalTok{)}

\NormalTok{rpart.cv}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## CART 
## 
## 142 samples
##  14 predictor
##   2 classes: '0', '1' 
## 
## No pre-processing
## Resampling: Cross-Validated (10 fold, repeated 3 times) 
## Summary of sample sizes: 127, 128, 127, 127, 128, 129, ... 
## Resampling results across tuning parameters:
## 
##   cp         Accuracy   Kappa    
##   0.0000000  0.8944567  0.7881329
##   0.0575693  0.8852503  0.7690778
##   0.1151386  0.8663126  0.7304763
##   0.1727079  0.8685348  0.7345800
##   0.2302772  0.8685348  0.7345800
##   0.2878465  0.8685348  0.7345800
##   0.3454158  0.8685348  0.7345800
##   0.4029851  0.8685348  0.7345800
##   0.4605544  0.8685348  0.7345800
##   0.5181237  0.8685348  0.7345800
##   0.5756930  0.8685348  0.7345800
##   0.6332623  0.8685348  0.7345800
##   0.6908316  0.8685348  0.7345800
##   0.7484009  0.8685348  0.7345800
##   0.8059701  0.6919536  0.3540940
## 
## Accuracy was used to select the optimal model using the largest value.
## The final value used for the model was cp = 0.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{42}\NormalTok{)}
\NormalTok{rpart.best.cv <-}\StringTok{ }\NormalTok{rpart.cv}\OperatorTok{$}\NormalTok{finalModel}
\NormalTok{rpart.best.cv}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## n= 142 
## 
## node), split, n, loss, yval, (yprob)
##       * denotes terminal node
## 
##  1) root 142 67 1 (0.47183099 0.52816901)  
##    2) Track_Duration_ms>=257068 56  1 0 (0.98214286 0.01785714) *
##    3) Track_Duration_ms< 257068 86 12 1 (0.13953488 0.86046512)  
##      6) fa_2< -0.220861 9  1 0 (0.88888889 0.11111111) *
##      7) fa_2>=-0.220861 77  4 1 (0.05194805 0.94805195)  
##       14) pc_1< -0.7482784 7  3 0 (0.57142857 0.42857143) *
##       15) pc_1>=-0.7482784 70  0 1 (0.00000000 1.00000000) *
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{rpart.plot}\NormalTok{(rpart.best.cv)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-63-4.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{rpart_pred <-}\StringTok{ }\KeywordTok{predict}\NormalTok{(rpart.best.cv, }\DataTypeTok{newdata =}\NormalTok{ train.data, }\DataTypeTok{type =} \StringTok{"class"}\NormalTok{)}
\NormalTok{confMat <-}\StringTok{ }\KeywordTok{table}\NormalTok{(train.data}\OperatorTok{$}\NormalTok{Charts,rpart_pred)}
\NormalTok{confMat }\CommentTok{# 0: not in charts, 1: in charts}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    rpart_pred
##      0  1
##   0 67  0
##   1  5 70
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{accuracy <-}\StringTok{ }\KeywordTok{sum}\NormalTok{(}\KeywordTok{diag}\NormalTok{(confMat))}\OperatorTok{/}\KeywordTok{sum}\NormalTok{(confMat)}
\NormalTok{accuracy}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.9647887
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# 0.9507042}

\NormalTok{rpart_pred <-}\StringTok{ }\KeywordTok{predict}\NormalTok{(rpart.best.cv, }\DataTypeTok{newdata =}\NormalTok{ test.data, }\DataTypeTok{type =} \StringTok{"class"}\NormalTok{)}
\NormalTok{confMat <-}\StringTok{ }\KeywordTok{table}\NormalTok{(test.data}\OperatorTok{$}\NormalTok{Charts,rpart_pred)}
\NormalTok{confMat }\CommentTok{# 0: not in charts, 1: in charts}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    rpart_pred
##      0  1
##   0 26  0
##   1  1 17
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{accuracy <-}\StringTok{ }\KeywordTok{sum}\NormalTok{(}\KeywordTok{diag}\NormalTok{(confMat))}\OperatorTok{/}\KeywordTok{sum}\NormalTok{(confMat)}
\NormalTok{accuracy}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.9772727
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# 0.9318182}

\CommentTok{#################################################}

\CommentTok{# Random forest}

\NormalTok{rf_train <-}\StringTok{ }\NormalTok{train.data}
\NormalTok{rf_test <-}\StringTok{ }\NormalTok{test.data}
\NormalTok{task <-}\StringTok{ }\KeywordTok{makeClassifTask}\NormalTok{(}\DataTypeTok{data =}\NormalTok{ rf_train, }\DataTypeTok{target =} \StringTok{"Charts"}\NormalTok{, }\DataTypeTok{positive =} \StringTok{"1"}\NormalTok{)}
\NormalTok{rf_learner <-}\StringTok{ }\KeywordTok{makeLearner}\NormalTok{(}\StringTok{"classif.randomForest"}\NormalTok{, }
                          \DataTypeTok{predict.type =} \StringTok{"prob"}\NormalTok{, }\CommentTok{# prediction type needs to be specified for the learner }
                          \DataTypeTok{par.vals =} \KeywordTok{list}\NormalTok{(}\StringTok{"replace"}\NormalTok{ =}\StringTok{ }\OtherTok{TRUE}\NormalTok{, }\StringTok{"importance"}\NormalTok{ =}\StringTok{ }\OtherTok{FALSE}\NormalTok{))}

\NormalTok{rf.parms <-}\StringTok{ }\KeywordTok{makeParamSet}\NormalTok{(}
  \CommentTok{# The recommendation for mtry by Breiman is squareroot number of columns}
  \KeywordTok{makeDiscreteParam}\NormalTok{(}\StringTok{"mtry"}\NormalTok{, }\DataTypeTok{values =} \KeywordTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{,}\DecValTok{4}\NormalTok{,}\DecValTok{5}\NormalTok{,}\DecValTok{6}\NormalTok{)), }\CommentTok{# Number of features selected at each node, smaller -> faster}
  \KeywordTok{makeDiscreteParam}\NormalTok{(}\StringTok{"sampsize"}\NormalTok{, }\DataTypeTok{values =}  \KeywordTok{c}\NormalTok{(}\DecValTok{30}\NormalTok{, }\DecValTok{50}\NormalTok{, }\DecValTok{70}\NormalTok{)), }\CommentTok{# bootstrap sample size, smaller -> faster}
  \KeywordTok{makeDiscreteParam}\NormalTok{(}\StringTok{"ntree"}\NormalTok{, }\DataTypeTok{values =} \KeywordTok{c}\NormalTok{(}\DecValTok{10}\NormalTok{,}\DecValTok{30}\NormalTok{,}\DecValTok{50}\NormalTok{,}\DecValTok{100}\NormalTok{, }\DecValTok{500}\NormalTok{, }\DecValTok{1000}\NormalTok{)) }\CommentTok{# Number of tree, smaller -> faster}
\NormalTok{) }

\NormalTok{tuneControl <-}\StringTok{ }\KeywordTok{makeTuneControlGrid}\NormalTok{(}\DataTypeTok{resolution =} \DecValTok{3}\NormalTok{, }\DataTypeTok{tune.threshold =} \OtherTok{FALSE}\NormalTok{)}

\NormalTok{rdesc <-}\StringTok{ }\KeywordTok{makeResampleDesc}\NormalTok{(}\DataTypeTok{method =} \StringTok{"CV"}\NormalTok{, }\DataTypeTok{iters =} \DecValTok{5}\NormalTok{, }\DataTypeTok{stratify =} \OtherTok{TRUE}\NormalTok{)}

\KeywordTok{parallelStartSocket}\NormalTok{(}\DecValTok{4}\NormalTok{, }\DataTypeTok{level =} \StringTok{"mlr.tuneParams"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Starting parallelization in mode=socket with cpus=4.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{suppressMessages}\NormalTok{(\{}

  \KeywordTok{set.seed}\NormalTok{(}\DecValTok{123456}\NormalTok{, }\StringTok{"L'Ecuyer-CMRG"}\NormalTok{)}
  \KeywordTok{clusterSetRNGStream}\NormalTok{(}\DataTypeTok{iseed =} \DecValTok{123456}\NormalTok{)}
\NormalTok{  tuning <-}\StringTok{ }\KeywordTok{tuneParams}\NormalTok{(rf_learner, }\DataTypeTok{task =}\NormalTok{ task, }\DataTypeTok{resampling =}\NormalTok{ rdesc,}
                     \DataTypeTok{par.set =}\NormalTok{ rf.parms, }\DataTypeTok{control =}\NormalTok{ tuneControl, }\DataTypeTok{measures =}\NormalTok{ mlr}\OperatorTok{::}\NormalTok{auc)}
\NormalTok{\})}


\KeywordTok{parallelStop}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Stopped parallelization. All cleaned up.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tuning}\OperatorTok{$}\NormalTok{x}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## $mtry
## [1] 2
## 
## $sampsize
## [1] 70
## 
## $ntree
## [1] 30
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tuning_results <-}\StringTok{ }\KeywordTok{generateHyperParsEffectData}\NormalTok{(tuning, }\DataTypeTok{partial.dep =} \OtherTok{TRUE}\NormalTok{)}

\NormalTok{tuning_results}\OperatorTok{$}\NormalTok{data}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    mtry sampsize ntree auc.test.mean iteration exec.time
## 1     2       30    10     0.9861905         1      0.11
## 2     3       30    10     0.9905128         2      0.13
## 3     4       30    10     0.9913553         3      0.11
## 4     5       30    10     0.9882051         4      0.11
## 5     6       30    10     0.9897436         5      0.06
## 6     2       50    10     0.9892674         6      0.06
## 7     3       50    10     0.9928571         7      0.05
## 8     4       50    10     0.9945421         8      0.05
## 9     5       50    10     0.9784615         9      0.08
## 10    6       50    10     0.9908059        10      0.08
## 11    2       70    10     0.9969231        11      0.07
## 12    3       70    10     0.9832234        12      0.07
## 13    4       70    10     0.9841392        13      0.04
## 14    5       70    10     0.9898535        14      0.06
## 15    6       70    10     0.9917949        15      0.06
## 16    2       30    30     0.9904029        16      0.05
## 17    3       30    30     0.9913553        17      0.07
## 18    4       30    30     0.9959341        18      0.07
## 19    5       30    30     0.9964835        19      0.06
## 20    6       30    30     0.9954212        20      0.07
## 21    2       50    30     0.9979487        21      0.06
## 22    3       50    30     0.9979853        22      0.06
## 23    4       50    30     0.9953846        23      0.06
## 24    5       50    30     0.9907692        24      0.06
## 25    6       50    30     0.9974359        25      0.08
## 26    2       70    30     0.9989744        26      0.08
## 27    3       70    30     0.9907692        27      0.08
## 28    4       70    30     0.9933333        28      0.06
## 29    5       70    30     0.9928205        29      0.06
## 30    6       70    30     0.9939194        30      0.05
## 31    2       30    50     0.9958974        31      0.07
## 32    3       30    50     0.9984615        32      0.06
## 33    4       30    50     0.9943590        33      0.08
## 34    5       30    50     0.9917949        34      0.06
## 35    6       30    50     0.9974725        35      0.05
## 36    2       50    50     0.9974359        36      0.06
## 37    3       50    50     0.9953846        37      0.05
## 38    4       50    50     0.9974359        38      0.07
## 39    5       50    50     0.9954579        39      0.08
## 40    6       50    50     0.9923810        40      0.07
## 41    2       70    50     0.9958974        41      0.08
## 42    3       70    50     0.9980220        42      0.08
## 43    4       70    50     0.9933333        43      0.06
## 44    5       70    50     0.9979487        44      0.08
## 45    6       70    50     0.9928205        45      0.06
## 46    2       30   100     0.9974359        46      0.07
## 47    3       30   100     0.9979487        47      0.08
## 48    4       30   100     0.9974725        48      0.06
## 49    5       30   100     0.9938462        49      0.08
## 50    6       30   100     0.9979487        50      0.08
## 51    2       50   100     0.9969231        51      0.09
## 52    3       50   100     0.9948718        52      0.09
## 53    4       50   100     0.9969231        53      0.10
## 54    5       50   100     0.9928205        54      0.08
## 55    6       50   100     0.9953846        55      0.08
## 56    2       70   100     0.9979487        56      0.09
## 57    3       70   100     0.9979487        57      0.11
## 58    4       70   100     0.9969231        58      0.11
## 59    5       70   100     0.9948718        59      0.11
## 60    6       70   100     0.9928205        60      0.09
## 61    2       30   500     0.9969231        61      0.19
## 62    3       30   500     0.9979487        62      0.19
## 63    4       30   500     0.9979487        63      0.19
## 64    5       30   500     0.9969231        64      0.18
## 65    6       30   500     0.9958974        65      0.16
## 66    2       50   500     0.9979487        66      0.17
## 67    3       50   500     0.9969231        67      0.17
## 68    4       50   500     0.9969231        68      0.17
## 69    5       50   500     0.9969231        69      0.16
## 70    6       50   500     0.9958974        70      0.17
## 71    2       70   500     0.9969231        71      0.21
## 72    3       70   500     0.9948718        72      0.19
## 73    4       70   500     0.9958974        73      0.19
## 74    5       70   500     0.9958974        74      0.19
## 75    6       70   500     0.9933333        75      0.19
## 76    2       30  1000     0.9979487        76      0.22
## 77    3       30  1000     0.9979487        77      0.22
## 78    4       30  1000     0.9969231        78      0.22
## 79    5       30  1000     0.9969231        79      0.20
## 80    6       30  1000     0.9969231        80      0.20
## 81    2       50  1000     0.9979487        81      0.30
## 82    3       50  1000     0.9979487        82      0.30
## 83    4       50  1000     0.9969231        83      0.28
## 84    5       50  1000     0.9969231        84      0.30
## 85    6       50  1000     0.9948718        85      0.28
## 86    2       70  1000     0.9979487        86      0.36
## 87    3       70  1000     0.9969231        87      0.33
## 88    4       70  1000     0.9969231        88      0.35
## 89    5       70  1000     0.9969231        89      0.28
## 90    6       70  1000     0.9969231        90      0.30
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{tapply}\NormalTok{(tuning_results}\OperatorTok{$}\NormalTok{data}\OperatorTok{$}\NormalTok{auc.test.mean, }\DataTypeTok{INDEX =} \KeywordTok{c}\NormalTok{(tuning_results}\OperatorTok{$}\NormalTok{data}\OperatorTok{$}\NormalTok{mtry), mean)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##         2         3         4         5         6 
## 0.9959381 0.9951058 0.9951486 0.9935470 0.9945442
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{rf_tuned <-}\StringTok{ }\KeywordTok{setHyperPars}\NormalTok{(rf_learner, }\DataTypeTok{par.vals =}\NormalTok{ tuning}\OperatorTok{$}\NormalTok{x)}
\NormalTok{rf_model <-}\StringTok{ }\NormalTok{mlr}\OperatorTok{::}\KeywordTok{train}\NormalTok{(rf_tuned, }\DataTypeTok{task =}\NormalTok{ task)}
\NormalTok{rf_pred <-}\StringTok{ }\KeywordTok{predict}\NormalTok{(rf_model, }\DataTypeTok{newdata =}\NormalTok{ train.data, }\DataTypeTok{type =} \StringTok{"class"}\NormalTok{)}
\CommentTok{# rf_pred$data$response}
\NormalTok{confMat <-}\StringTok{ }\KeywordTok{table}\NormalTok{(train.data}\OperatorTok{$}\NormalTok{Charts,rf_pred}\OperatorTok{$}\NormalTok{data}\OperatorTok{$}\NormalTok{response)}
\NormalTok{confMat }\CommentTok{# 0: not in charts, 1: in charts}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    
##      0  1
##   0 67  0
##   1  0 75
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{accuracy <-}\StringTok{ }\KeywordTok{sum}\NormalTok{(}\KeywordTok{diag}\NormalTok{(confMat))}\OperatorTok{/}\KeywordTok{sum}\NormalTok{(confMat)}
\NormalTok{accuracy}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# 1}

\NormalTok{rf_pred <-}\StringTok{ }\KeywordTok{predict}\NormalTok{(rf_model, }\DataTypeTok{newdata =}\NormalTok{ test.data, }\DataTypeTok{type =} \StringTok{"class"}\NormalTok{)}
\CommentTok{# rf_pred$data$response}
\NormalTok{confMat <-}\StringTok{ }\KeywordTok{table}\NormalTok{(test.data}\OperatorTok{$}\NormalTok{Charts,rf_pred}\OperatorTok{$}\NormalTok{data}\OperatorTok{$}\NormalTok{response)}
\NormalTok{confMat }\CommentTok{# 0: not in charts, 1: in charts}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    
##      0  1
##   0 26  0
##   1  0 18
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{accuracy <-}\StringTok{ }\KeywordTok{sum}\NormalTok{(}\KeywordTok{diag}\NormalTok{(confMat))}\OperatorTok{/}\KeywordTok{sum}\NormalTok{(confMat)}
\NormalTok{accuracy}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# 1}

\CommentTok{# Neural net classification}

\NormalTok{df}\OperatorTok{$}\NormalTok{Charts <-}\StringTok{ }\NormalTok{x_noout}\OperatorTok{$}\NormalTok{Charts}
\NormalTok{train_z}\OperatorTok{$}\NormalTok{Charts <-}\StringTok{ }\NormalTok{df[idx.train, }\StringTok{"Charts"}\NormalTok{]}
\NormalTok{test_z}\OperatorTok{$}\NormalTok{Charts <-}\StringTok{ }\NormalTok{df[}\OperatorTok{-}\NormalTok{idx.train, }\StringTok{"Charts"}\NormalTok{]}


\NormalTok{task <-}\StringTok{ }\KeywordTok{makeClassifTask}\NormalTok{(}\DataTypeTok{data =}\NormalTok{ train_z, }\DataTypeTok{target =} \StringTok{"Charts"}\NormalTok{, }\DataTypeTok{positive =} \StringTok{"1"}\NormalTok{)}
\NormalTok{nnet <-}\StringTok{ }\KeywordTok{makeLearner}\NormalTok{(}\StringTok{"classif.nnet"}\NormalTok{, }\DataTypeTok{predict.type =} \StringTok{"prob"}\NormalTok{, }\DataTypeTok{par.vals =} \KeywordTok{list}\NormalTok{(}\StringTok{"trace"}\NormalTok{ =}\StringTok{ }\OtherTok{FALSE}\NormalTok{, }\StringTok{"maxit"}\NormalTok{ =}\StringTok{ }\DecValTok{1000}\NormalTok{,}
                                                                           \StringTok{"MaxNWts"}\NormalTok{ =}\StringTok{ }\DecValTok{80000}\NormalTok{))}

\NormalTok{nn.parms <-}\StringTok{ }\KeywordTok{makeParamSet}\NormalTok{(}
  \KeywordTok{makeDiscreteParam}\NormalTok{(}\StringTok{"decay"}\NormalTok{, }\DataTypeTok{values =} \KeywordTok{c}\NormalTok{(}\FloatTok{0.0001}\NormalTok{,}\FloatTok{0.001}\NormalTok{, }\FloatTok{0.01}\NormalTok{, }\FloatTok{0.1}\NormalTok{)), }
  \KeywordTok{makeDiscreteParam}\NormalTok{(}\StringTok{"size"}\NormalTok{, }\DataTypeTok{values =} \KeywordTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{,}\DecValTok{4}\NormalTok{,}\DecValTok{6}\NormalTok{,}\DecValTok{8}\NormalTok{,}\DecValTok{10}\NormalTok{,}\DecValTok{12}\NormalTok{,}\DecValTok{14}\NormalTok{)))}

\NormalTok{tuneControl <-}\StringTok{ }\KeywordTok{makeTuneControlGrid}\NormalTok{(}\DataTypeTok{resolution =} \DecValTok{3}\NormalTok{, }\DataTypeTok{tune.threshold =} \OtherTok{FALSE}\NormalTok{)}

\NormalTok{rdesc <-}\StringTok{ }\KeywordTok{makeResampleDesc}\NormalTok{(}\DataTypeTok{method =} \StringTok{"CV"}\NormalTok{, }\DataTypeTok{iters =} \DecValTok{5}\NormalTok{, }\DataTypeTok{stratify =} \OtherTok{TRUE}\NormalTok{)}


\KeywordTok{parallelStartSocket}\NormalTok{(}\DecValTok{4}\NormalTok{, }\DataTypeTok{level =} \StringTok{"mlr.tuneParams"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Starting parallelization in mode=socket with cpus=4.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{suppressMessages}\NormalTok{(\{}

  \KeywordTok{set.seed}\NormalTok{(}\DecValTok{123456}\NormalTok{, }\StringTok{"L'Ecuyer-CMRG"}\NormalTok{)}
  \KeywordTok{clusterSetRNGStream}\NormalTok{(}\DataTypeTok{iseed =} \DecValTok{123456}\NormalTok{)}
\NormalTok{  tuning <-}\StringTok{ }\KeywordTok{tuneParams}\NormalTok{(nnet, }\DataTypeTok{task =}\NormalTok{ task, }\DataTypeTok{resampling =}\NormalTok{ rdesc, }\DataTypeTok{par.set =}\NormalTok{ nn.parms, }\DataTypeTok{control =}\NormalTok{ tuneControl,}
                     \DataTypeTok{measures =}\NormalTok{ mlr}\OperatorTok{::}\NormalTok{auc)}
\NormalTok{\})}

\KeywordTok{parallelStop}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Stopped parallelization. All cleaned up.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tuning}\OperatorTok{$}\NormalTok{x }\CommentTok{# result with full data set was decay = 1e-04, size = 2, rmse.test.rmse = 0.4336486}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## $decay
## [1] 0.1
## 
## $size
## [1] 12
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tuning_results <-}\StringTok{ }\KeywordTok{generateHyperParsEffectData}\NormalTok{(tuning, }\DataTypeTok{partial.dep =} \OtherTok{FALSE}\NormalTok{)}

\KeywordTok{plotHyperParsEffect}\NormalTok{(tuning_results, }\DataTypeTok{x =} \StringTok{"size"}\NormalTok{, }\DataTypeTok{y =} \StringTok{"auc.test.mean"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-63-5.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{plotHyperParsEffect}\NormalTok{(tuning_results, }\DataTypeTok{x =} \StringTok{"decay"}\NormalTok{, }\DataTypeTok{y =} \StringTok{"auc.test.mean"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{Notebook_Submission_files/figure-latex/unnamed-chunk-63-6.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{nnet.tuned <-}\StringTok{ }\KeywordTok{setHyperPars}\NormalTok{(nnet, }\DataTypeTok{par.vals =}\NormalTok{ tuning}\OperatorTok{$}\NormalTok{x)}
\NormalTok{nn_model <-}\StringTok{ }\NormalTok{mlr}\OperatorTok{::}\KeywordTok{train}\NormalTok{(nnet.tuned, }\DataTypeTok{task =}\NormalTok{ task)}

\NormalTok{model <-}\StringTok{ }\NormalTok{mlr}\OperatorTok{::}\KeywordTok{train}\NormalTok{(nnet.tuned, }\DataTypeTok{task =}\NormalTok{ task)}

\NormalTok{nn_pred_train <-}\StringTok{ }\KeywordTok{predict}\NormalTok{(model, }\DataTypeTok{newdata =}\NormalTok{ train_z, }\DataTypeTok{type =} \StringTok{"class"}\NormalTok{)}
\NormalTok{nn_pred_test <-}\StringTok{ }\KeywordTok{predict}\NormalTok{(model, }\DataTypeTok{newdata =}\NormalTok{ test_z, }\DataTypeTok{type =} \StringTok{"class"}\NormalTok{)}

\NormalTok{confMat <-}\StringTok{ }\KeywordTok{table}\NormalTok{(train_z}\OperatorTok{$}\NormalTok{Charts,nn_pred_train}\OperatorTok{$}\NormalTok{data}\OperatorTok{$}\NormalTok{response)}
\NormalTok{confMat }\CommentTok{# 0: not in charts, 1: in charts}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    
##      0  1
##   0 67  0
##   1  0 75
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{accuracy <-}\StringTok{ }\KeywordTok{sum}\NormalTok{(}\KeywordTok{diag}\NormalTok{(confMat))}\OperatorTok{/}\KeywordTok{sum}\NormalTok{(confMat)}
\NormalTok{accuracy}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# 1}

\NormalTok{confMat <-}\StringTok{ }\KeywordTok{table}\NormalTok{(test_z}\OperatorTok{$}\NormalTok{Charts,nn_pred_test}\OperatorTok{$}\NormalTok{data}\OperatorTok{$}\NormalTok{response)}
\NormalTok{confMat }\CommentTok{# 0: not in charts, 1: in charts}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    
##      0  1
##   0 25  1
##   1  0 18
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{accuracy <-}\StringTok{ }\KeywordTok{sum}\NormalTok{(}\KeywordTok{diag}\NormalTok{(confMat))}\OperatorTok{/}\KeywordTok{sum}\NormalTok{(confMat)}
\NormalTok{accuracy}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.9772727
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# 1}
\end{Highlighting}
\end{Shaded}

```

\end{document}

---
title: "R Notebook"
output:
  pdf_document: default
  html_notebook: default
---

This is the mark-up file for the Datenanalyse 2 homework assignment.


```{r}
library("rio")
x <- import("https://docs.google.com/spreadsheets/d/1SWEakSjZUvvV3w8peOf5FHrGI9NTEDls3c9zETVZ5kQ/export?format=csv&gid=447556196")

```


```{r}
library("dplyr")

drop.cols <- c('Artist_ID', 'Genre', 'Release_Date', 'Track_Artist', 'Track_ID', 'Track_Title', 'video_ID')
numeric_x <- select(x, -one_of(drop.cols))

keep.cols <- c('Streams', 'Artist_Follower', 'Track_Duration_ms', 'Artist_Google_searches_11m', 'Title_Google_searches_11m',
               'viewsCount')

# keep.cols <- c('Streams', 'viewsCount', 'Title_Youtube_searches_11m')

selected_pairs <- select(x, keep.cols)

pairs(selected_pairs, cex=0.5)

```


Descriptive statistics

```{r}

summary(numeric_x)

```


Histograms and kernel density plots of base variables

```{r}
par(mfrow=c(4,6))

hist(x$Artist_Albums_Number, probability = TRUE, col = "gray")
lines(density(x$Artist_Albums_Number), col = "red")

hist(x$Artist_Albums_Tracks_Number, probability = TRUE, col = "gray")
lines(density(x$Artist_Albums_Tracks_Number), col = "red")

hist(x$Artist_Appearances_Number, probability = TRUE, col = "gray")
lines(density(x$Artist_Appearances_Number), col = "red")

hist(x$Artist_Appearances_Tracks_Number, probability = TRUE, col = "gray")
lines(density(x$Artist_Appearances_Tracks_Number), col = "red")

hist(x$Artist_Follower, probability = TRUE, col = "gray")
lines(density(x$Artist_Follower), col = "red")

hist(x$Artist_Popularity, probability = TRUE, col = "gray")
lines(density(x$Artist_Popularity), col = "red")

hist(x$Artist_Singles_Number, probability = TRUE, col = "gray")
lines(density(x$Artist_Singles_Number), col = "red")

hist(x$Artist_Singles_Tracks_Number, probability = TRUE, col = "gray")
lines(density(x$Artist_Singles_Tracks_Number), col = "red")

hist(x$Streams, probability = TRUE, col = "gray")
lines(density(x$Streams), col = "red")

hist(x$Track_Duration_ms, probability = TRUE, col = "gray")
lines(density(x$Track_Duration_ms), col = "red")

hist(x$Track_Popularity, probability = TRUE, col = "gray")
lines(density(x$Track_Popularity), col = "red")

hist(x$Title_Artist_Google_searches_11m, probability = TRUE, col = "gray")
lines(density(x$Title_Artist_Google_searches_11m), col = "red")

hist(x$Title_Artist_Youtube_searches_11m, probability = TRUE, col = "gray")
lines(density(x$Title_Artist_Youtube_searches_11m), col = "red")

hist(x$Title_Google_searches_11m, probability = TRUE, col = "gray")
lines(density(x$Title_Google_searches_11m), col = "red")

hist(x$Total_tracks, probability = TRUE, col = "gray")
lines(density(x$Total_tracks), col = "red")

hist(x$Artist_Google_searches_11m, probability = TRUE, col = "gray")
lines(density(x$Artist_Google_searches_11m), col = "red")

hist(x$Artist_Youtube_searches_11m, probability = TRUE, col = "gray")
lines(density(x$Artist_Youtube_searches_11m), col = "red")

hist(x$commentCount, probability = TRUE, col = "gray")
lines(density(x$commentCount, na.rm = TRUE), col = "red")

hist(x$dislikeCount, probability = TRUE, col = "gray")
lines(density(x$dislikeCount), col = "red")

hist(log(x$viewsCount), probability = TRUE, col = "gray")
lines(density(log(x$viewsCount)), col = "red")
```

Distribution test

```{r}

strictly_positive_variables <- c('Artist_Follower', 'Artist_Popularity', 'Streams', 'Track_Duration_ms',
                                 'viewsCount', 'Artist_Google_searches_11m')


summary(select(x, strictly_positive_variables))


library("psych")
library("car")

ksD <- function (p, x) {
  y <- bcPower(x, p)
  ks.test(y, "pnorm", mean=mean(y), sd=sd(y))$statistic
}

for (column in strictly_positive_variables){
  
  x_sub <- as.numeric(x[[paste(column)]])
  
  result <- optimize(ksD, c(-5,5), x=x_sub)
  
  message(paste(column, ', minimum value is: ', result$minimum))
  
}









```



Variable transformations

1) Z-Transformation

```{r}

numeric_x_scaled <- scale(numeric_x, center = TRUE, scale = TRUE)
numeric_x_scaled <- as.data.frame(numeric_x_scaled)

par(mfrow=c(4,6))

hist(numeric_x_scaled$Artist_Albums_Number, probability = TRUE, col = "gray")
lines(density(numeric_x_scaled$Artist_Albums_Number), col = "red")

hist(numeric_x_scaled$Artist_Albums_Tracks_Number, probability = TRUE, col = "gray")
lines(density(numeric_x_scaled$Artist_Albums_Tracks_Number), col = "red")

hist(numeric_x_scaled$Artist_Appearances_Number, probability = TRUE, col = "gray")
lines(density(numeric_x_scaled$Artist_Appearances_Number), col = "red")

hist(numeric_x_scaled$Artist_Appearances_Tracks_Number, probability = TRUE, col = "gray")
lines(density(numeric_x_scaled$Artist_Appearances_Tracks_Number), col = "red")

hist(numeric_x_scaled$Artist_Follower, probability = TRUE, col = "gray")
lines(density(numeric_x_scaled$Artist_Follower), col = "red")

hist(numeric_x_scaled$Artist_Popularity, probability = TRUE, col = "gray")
lines(density(numeric_x_scaled$Artist_Popularity), col = "red")

hist(numeric_x_scaled$Artist_Singles_Number, probability = TRUE, col = "gray")
lines(density(numeric_x_scaled$Artist_Singles_Number), col = "red")

hist(numeric_x_scaled$Artist_Singles_Tracks_Number, probability = TRUE, col = "gray")
lines(density(numeric_x_scaled$Artist_Singles_Tracks_Number), col = "red")

hist(numeric_x_scaled$Streams, probability = TRUE, col = "gray")
lines(density(numeric_x_scaled$Streams), col = "red")

hist(numeric_x_scaled$Track_Duration_ms, probability = TRUE, col = "gray")
lines(density(numeric_x_scaled$Track_Duration_ms), col = "red")

hist(numeric_x_scaled$Track_Popularity, probability = TRUE, col = "gray")
lines(density(numeric_x_scaled$Track_Popularity), col = "red")

hist(numeric_x_scaled$Title_Artist_Google_searches_11m, probability = TRUE, col = "gray")
lines(density(numeric_x_scaled$Title_Artist_Google_searches_11m), col = "red")

hist(numeric_x_scaled$Title_Artist_Youtube_searches_11m, probability = TRUE, col = "gray")
lines(density(numeric_x_scaled$Title_Artist_Youtube_searches_11m), col = "red")

hist(numeric_x_scaled$Title_Google_searches_11m, probability = TRUE, col = "gray")
lines(density(numeric_x_scaled$Title_Google_searches_11m), col = "red")

hist(numeric_x_scaled$Total_tracks, probability = TRUE, col = "gray")
lines(density(numeric_x_scaled$Total_tracks), col = "red")

hist(numeric_x_scaled$Artist_Google_searches_11m, probability = TRUE, col = "gray")
lines(density(numeric_x_scaled$Artist_Google_searches_11m), col = "red")

hist(numeric_x_scaled$Artist_Youtube_searches_11m, probability = TRUE, col = "gray")
lines(density(numeric_x_scaled$Artist_Youtube_searches_11m), col = "red")

hist(numeric_x_scaled$commentCount, probability = TRUE, col = "gray")
lines(density(numeric_x_scaled$commentCount, na.rm = TRUE), col = "red")

hist(numeric_x_scaled$dislikeCount, probability = TRUE, col = "gray")
lines(density(numeric_x_scaled$dislikeCount), col = "red")

hist(log(x$viewsCount), probability = TRUE, col = "gray")
lines(density(log(x$viewsCount)), col = "red")




```

2) Log-Transformation

```{r}

log_numeric_x <- log(numeric_x)

par(mfrow=c(4,6))

hist(log_numeric_x$Artist_Albums_Number, probability = TRUE, col = "gray")
lines(density(log_numeric_x$Artist_Albums_Number), col = "red")

hist(log_numeric_x$Artist_Albums_Tracks_Number, probability = TRUE, col = "gray")
lines(density(log_numeric_x$Artist_Albums_Tracks_Number), col = "red")

hist(log_numeric_x$Artist_Appearances_Number, probability = TRUE, col = "gray")
lines(density(log_numeric_x$Artist_Appearances_Number), col = "red")

hist(log_numeric_x$Artist_Appearances_Tracks_Number, probability = TRUE, col = "gray")
lines(density(log_numeric_x$Artist_Appearances_Tracks_Number), col = "red")

hist(log_numeric_x$Artist_Follower, probability = TRUE, col = "gray")
lines(density(log_numeric_x$Artist_Follower), col = "red")

hist(log_numeric_x$Artist_Popularity, probability = TRUE, col = "gray")
lines(density(log_numeric_x$Artist_Popularity), col = "red")

hist(log_numeric_x$Artist_Singles_Number, probability = TRUE, col = "gray")
lines(density(log_numeric_x$Artist_Singles_Number), col = "red")

hist(log_numeric_x$Artist_Singles_Tracks_Number, probability = TRUE, col = "gray")
lines(density(log_numeric_x$Artist_Singles_Tracks_Number), col = "red")

hist(log_numeric_x$Streams, probability = TRUE, col = "gray")
lines(density(log_numeric_x$Streams), col = "red")

hist(log_numeric_x$Track_Duration_ms, probability = TRUE, col = "gray")
lines(density(log_numeric_x$Track_Duration_ms), col = "red")

hist(log_numeric_x$Track_Popularity, probability = TRUE, col = "gray")
lines(density(log_numeric_x$Track_Popularity), col = "red")

hist(log_numeric_x$Title_Artist_Google_searches_11m, probability = TRUE, col = "gray")
lines(density(log_numeric_x$Title_Artist_Google_searches_11m), col = "red")

hist(log_numeric_x$Title_Artist_Youtube_searches_11m, probability = TRUE, col = "gray")
lines(density(log_numeric_x$Title_Artist_Youtube_searches_11m), col = "red")

hist(log_numeric_x$Title_Google_searches_11m, probability = TRUE, col = "gray")
lines(density(log_numeric_x$Title_Google_searches_11m), col = "red")

hist(log_numeric_x$Total_tracks, probability = TRUE, col = "gray")
lines(density(log_numeric_x$Total_tracks), col = "red")

hist(log_numeric_x$Artist_Google_searches_11m, probability = TRUE, col = "gray")
lines(density(log_numeric_x$Artist_Google_searches_11m), col = "red")

hist(log_numeric_x$Artist_Youtube_searches_11m, probability = TRUE, col = "gray")
lines(density(log_numeric_x$Artist_Youtube_searches_11m), col = "red")

hist(log_numeric_x$commentCount, probability = TRUE, col = "gray")
lines(density(log_numeric_x$commentCount, na.rm = TRUE), col = "red")

hist(log_numeric_x$dislikeCount, probability = TRUE, col = "gray")
lines(density(log_numeric_x$dislikeCount), col = "red")

hist(log_numeric_x$viewsCount, probability = TRUE, col = "gray")
lines(density(log_numeric_x$viewsCount), col = "red")



```


Table by genre

```{r}

table(x$Genre)

```



```{r}

##1

col <- ifelse(x$Genre == "Hip Hop", "black", "red")

plot(x$viewsCount, x$Streams, main="Music streams", pch=19, col=col)

plot(log(x$viewsCount), log(x$Streams), main="Music streams", pch=19, col=col)


```

```{r}

library("lattice")
xyplot(Streams~viewsCount|Genre, data=x, pch=19)

```

```{r}

library("ggplot2")
d <-ggplot(x, aes(x=viewsCount, y=Streams, colour=Genre))
d + geom_point(shape=19)

```

Using sunflower plot to overcome problem of overplotting.

```{r}

sunflower_viewsCount <- 2*round(x$viewsCount/2)
sunflower_streams  <- 2*round(x$Streams/2)
sunflowerplot(sunflower_streams~sunflower_viewsCount)

```

```{r}

cor <- cor(numeric_x)
drop.cor_cols <- c('Artist_Compilations_Number', 'Artist_Compilations_Tracks_Number')
numeric_cor_x <- select(numeric_x, -one_of(drop.cor_cols))

clean_cor <- cor(numeric_cor_x)
heatmap(clean_cor, revC=T, col=topo.colors(10))

```

```{r}
library("lattice")
levelplot(clean_cor, scales=list(x=list(rot=90)), aspect = "fill", col.regions=heat.colors(100))


```

```{r}
library("gplots")
gplots::heatmap.2(clean_cor, revC=T, na.rm=T)

```

Steiger's Z test for significance of (Bravais-Pearson) correlation coefficients 

```{r}

library(corrplot)

corrplot(clean_cor, method="circle")

cor.mtest <- function(mat, ...) {
  mat <- as.matrix(mat)
  n <- ncol(mat)
  p.mat<- matrix(NA, n, n)
  diag(p.mat) <- 0
  for (i in 1:(n - 1)) {
    for (j in (i + 1):n) {
      tmp <- cor.test(mat[, i], mat[, j], ...)
      p.mat[i, j] <- p.mat[j, i] <- tmp$p.value
    }
  }
  colnames(p.mat) <- rownames(p.mat) <- colnames(mat)
  p.mat
}
# matrix of the p-value of the correlation
#p.mat <- cor.mtest(clean_cor)

#col <- colorRampPalette(c("#BB4444", "#EE9988", "#FFFFFF", "#77AADD", "#4477AA"))
#significance_level <- 0.1

#corrplot(clean_cor, method="color", col=col(200),  
#         type="upper", order="hclust", 
#         addCoef.col = "black", # Add coefficient of correlation
#         tl.col="black", tl.srt=90, #Text label color and rotation
#         # Combine with significance
#         p.mat = p.mat, sig.level = significance_level, insig = "blank", 
#         # hide correlation coefficient on the principal diagonal
#         diag=FALSE)


```



![Correlogram with significant correlation coefficients at $\alpha$ = 0.01](images/Correl_Significance_1_resized.png)

Illustration of assumption that two variables are jointly normally distributed to perform Steiger's Z test:


```{r}

plot(x$viewsCount, x$Streams)
plot(log(x$viewsCount, log(x$Streams)))

bivariate_df <- select(x, c('Streams', 'viewsCount'))

# install.packages(“normwhn.test”)

library("normwhn.test")
normality.test1(bivariate_df)

bivariate_df$Streams <- log(bivariate_df$Streams)
bivariate_df$viewsCount <- log(bivariate_df$viewsCount)

normality.test1(bivariate_df)

```


